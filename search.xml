<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åœ¨æµè§ˆå™¨è¾“å…¥ URL å›è½¦ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼ˆè¶…è¯¦ç»†ç‰ˆï¼‰]]></title>
    <url>%2Farchives%2Fab98.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://4ark.me/post/b6c7c0a2.html#3-%E6%B8%B2%E6%9F%93%E6%A0%91è¿™ä¸ªé—®é¢˜å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œæ›´æ˜¯ç»å¸¸è¢«ä½œä¸ºé¢è¯•çš„å‹è½´é¢˜å‡ºç°ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ–‡ç« ï¼Œä½†æœ€è¿‘é—²çš„æ— èŠï¼Œç„¶åå°±è‡ªå·±åšäº†ä¸€ç¯‡ç¬”è®°ï¼Œæ„Ÿè§‰æ¯”ä¹‹å‰ç†è§£æ›´é€å½»äº†ã€‚å‰è¨€è¿™ä¸ªé—®é¢˜å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œæ›´æ˜¯ç»å¸¸è¢«ä½œä¸ºé¢è¯•çš„å‹è½´é¢˜å‡ºç°ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ–‡ç« ï¼Œä½†æœ€è¿‘é—²çš„æ— èŠï¼Œç„¶åå°±è‡ªå·±åšäº†ä¸€ç¯‡ç¬”è®°ï¼Œæ„Ÿè§‰æ¯”ä¹‹å‰ç†è§£æ›´é€å½»äº†ã€‚è¿™ç¯‡ç¬”è®°æ˜¯æˆ‘è¿™ä¸¤å¤©çœ‹äº†æ•°åç¯‡æ–‡ç« æ€»ç»“å‡ºæ¥çš„ï¼Œæ‰€ä»¥ç›¸å¯¹å…¨é¢ä¸€ç‚¹ï¼Œä½†ç”±äºæˆ‘æ˜¯åšå‰ç«¯çš„ï¼Œæ‰€ä»¥ä¼šæ¯”è¾ƒé‡ç‚¹åˆ†ææµè§ˆå™¨æ¸²æŸ“é¡µé¢é‚£ä¸€éƒ¨åˆ†ï¼Œè‡³äºå…¶ä»–éƒ¨åˆ†æˆ‘ä¼šç½—åˆ—å‡ºå…³é”®è¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼Œæ³¨æ„ï¼šæœ¬æ–‡çš„æ­¥éª¤æ˜¯å»ºç«‹åœ¨ï¼Œè¯·æ±‚çš„æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP è¯·æ±‚ï¼Œæ²¡æœ‰ HTTPSã€HTTP2ã€æœ€ç®€å•çš„ DNSã€æ²¡æœ‰ä»£ç†ã€å¹¶ä¸”æœåŠ¡å™¨æ²¡æœ‰ä»»ä½•é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œå°½ç®¡è¿™æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å¤§è‡´æµç¨‹URL è§£æDNS æŸ¥è¯¢TCP è¿æ¥å¤„ç†è¯·æ±‚æ¥å—å“åº”æ¸²æŸ“é¡µé¢ä¸€ã€URL è§£æåœ°å€è§£æï¼šé¦–å…ˆåˆ¤æ–­ä½ è¾“å…¥çš„æ˜¯ä¸€ä¸ªåˆæ³•çš„ URL è¿˜æ˜¯ä¸€ä¸ªå¾…æœç´¢çš„å…³é”®è¯ï¼Œå¹¶ä¸”æ ¹æ®ä½ è¾“å…¥çš„å†…å®¹è¿›è¡Œè‡ªåŠ¨å®Œæˆã€å­—ç¬¦ç¼–ç ç­‰æ“ä½œã€‚HSTSç”±äºå®‰å…¨éšæ‚£ï¼Œä¼šä½¿ç”¨ HSTS å¼ºåˆ¶å®¢æˆ·ç«¯ä½¿ç”¨ HTTPS è®¿é—®é¡µé¢ã€‚è¯¦è§ï¼šä½ æ‰€ä¸çŸ¥é“çš„ HSTSã€‚å…¶ä»–æ“ä½œæµè§ˆå™¨è¿˜ä¼šè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚å®‰å…¨æ£€æŸ¥ã€è®¿é—®é™åˆ¶ï¼ˆä¹‹å‰å›½äº§æµè§ˆå™¨é™åˆ¶ 996.icuï¼‰ã€‚æ£€æŸ¥ç¼“å­˜äºŒã€DNS æŸ¥è¯¢åŸºæœ¬æ­¥éª¤1. æµè§ˆå™¨ç¼“å­˜æµè§ˆå™¨ä¼šå…ˆæ£€æŸ¥æ˜¯å¦åœ¨ç¼“å­˜ä¸­ï¼Œæ²¡æœ‰åˆ™è°ƒç”¨ç³»ç»Ÿåº“å‡½æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚2. æ“ä½œç³»ç»Ÿç¼“å­˜æ“ä½œç³»ç»Ÿä¹Ÿæœ‰è‡ªå·±çš„ DNS ç¼“å­˜ï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œä¼šå‘æ£€æŸ¥åŸŸåæ˜¯å¦å­˜åœ¨æœ¬åœ°çš„ Hosts æ–‡ä»¶é‡Œï¼Œæ²¡æœ‰åˆ™å‘ DNS æœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚3. è·¯ç”±å™¨ç¼“å­˜è·¯ç”±å™¨ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚4. ISP DNS ç¼“å­˜ISP DNS å°±æ˜¯åœ¨å®¢æˆ·ç«¯ç”µè„‘ä¸Šè®¾ç½®çš„é¦–é€‰ DNS æœåŠ¡å™¨ï¼Œå®ƒä»¬åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¼šæœ‰ç¼“å­˜ã€‚æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢åœ¨å‰é¢æ‰€æœ‰æ­¥éª¤æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæœ¬åœ° DNS æœåŠ¡å™¨ä¼šå°†è¯·æ±‚è½¬å‘åˆ°äº’è”ç½‘ä¸Šçš„æ ¹åŸŸï¼Œä¸‹é¢è¿™ä¸ªå›¾å¾ˆå¥½çš„è¯ é‡Šäº†æ•´ä¸ªæµç¨‹ï¼šæ ¹åŸŸåæœåŠ¡å™¨ï¼šç»´åŸºç™¾ç§‘éœ€è¦æ³¨æ„çš„ç‚¹é€’å½’æ–¹å¼ï¼šä¸€è·¯æŸ¥ä¸‹å»ä¸­é—´ä¸è¿”å›ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœæ‰è¿”å›ä¿¡æ¯ï¼ˆæµè§ˆå™¨åˆ°æœ¬åœ° DNS æœåŠ¡å™¨çš„è¿‡ç¨‹ï¼‰è¿­ä»£æ–¹å¼ï¼Œå°±æ˜¯æœ¬åœ° DNS æœåŠ¡å™¨åˆ°æ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢çš„æ–¹å¼ã€‚ä»€ä¹ˆæ˜¯ DNS åŠ«æŒå‰ç«¯ dns-prefetch ä¼˜åŒ–ä¸‰ã€TCP è¿æ¥TCP/IP åˆ†ä¸ºå››å±‚ï¼Œåœ¨å‘é€æ•°æ®æ—¶ï¼Œæ¯å±‚éƒ½è¦å¯¹æ•°æ®è¿›è¡Œå°è£…ï¼š1. åº”ç”¨å±‚ï¼šå‘é€ HTTP è¯·æ±‚åœ¨å‰é¢çš„æ­¥éª¤æˆ‘ä»¬å·²ç»å¾—åˆ°æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œæµè§ˆå™¨ä¼šå¼€å§‹æ„é€ ä¸€ä¸ª HTTP æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šè¯·æ±‚æŠ¥å¤´ï¼ˆRequest Headerï¼‰ï¼šè¯·æ±‚æ–¹æ³•ã€ç›®æ ‡åœ°å€ã€éµå¾ªçš„åè®®ç­‰ç­‰è¯·æ±‚ä¸»ä½“ï¼ˆå…¶ä»–å‚æ•°ï¼‰å…¶ä¸­éœ€è¦æ³¨æ„çš„ç‚¹ï¼šæµè§ˆå™¨åªèƒ½å‘é€ GETã€POST æ–¹æ³•ï¼Œè€Œæ‰“å¼€ç½‘é¡µä½¿ç”¨çš„æ˜¯ GET æ–¹æ³•2. ä¼ è¾“å±‚ï¼šTCP ä¼ è¾“æŠ¥æ–‡ä¼ è¾“å±‚ä¼šå‘èµ·ä¸€æ¡åˆ°è¾¾æœåŠ¡å™¨çš„ TCP è¿æ¥ï¼Œä¸ºäº†æ–¹ä¾¿ä¼ è¾“ï¼Œä¼šå¯¹æ•°æ®è¿›è¡Œåˆ†å‰²ï¼ˆä»¥æŠ¥æ–‡æ®µä¸ºå•ä½ï¼‰ï¼Œå¹¶æ ‡è®°ç¼–å·ï¼Œæ–¹ä¾¿æœåŠ¡å™¨æ¥å—æ—¶èƒ½å¤Ÿå‡†ç¡®åœ°è¿˜åŸæŠ¥æ–‡ä¿¡æ¯ã€‚åœ¨å»ºç«‹è¿æ¥å‰ï¼Œä¼šå…ˆè¿›è¡Œ TCP ä¸‰æ¬¡æ¡æ‰‹ã€‚å…³äº TCP/IP ä¸‰æ¬¡æ¡æ‰‹ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šæ®µå­å’Œå›¾ç‰‡ç”ŸåŠ¨åœ°æè¿°äº†ã€‚ç›¸å…³çŸ¥è¯†ç‚¹ï¼šSYN æ³›æ´ªæ”»å‡»3. ç½‘ç»œå±‚ï¼šIP åè®®æŸ¥è¯¢ Mac åœ°å€å°†æ•°æ®æ®µæ‰“åŒ…ï¼Œå¹¶åŠ å…¥æºåŠç›®æ ‡çš„ IP åœ°å€ï¼Œå¹¶ä¸”è´Ÿè´£å¯»æ‰¾ä¼ è¾“è·¯çº¿ã€‚åˆ¤æ–­ç›®æ ‡åœ°å€æ˜¯å¦ä¸å½“å‰åœ°å€å¤„äºåŒä¸€ç½‘ç»œä¸­ï¼Œæ˜¯çš„è¯ç›´æ¥æ ¹æ® Mac åœ°å€å‘é€ï¼Œå¦åˆ™ä½¿ç”¨è·¯ç”±è¡¨æŸ¥æ‰¾ä¸‹ä¸€è·³åœ°å€ï¼Œä»¥åŠä½¿ç”¨ ARP åè®®æŸ¥è¯¢å®ƒçš„ Mac åœ°å€ã€‚æ³¨æ„ï¼šåœ¨ OSI å‚è€ƒæ¨¡å‹ä¸­ ARP åè®®ä½äºé“¾è·¯å±‚ï¼Œä½†åœ¨ TCP/IP ä¸­ï¼Œå®ƒä½äºç½‘ç»œå±‚ã€‚4. é“¾è·¯å±‚ï¼šä»¥å¤ªç½‘åè®®ä»¥å¤ªç½‘åè®®æ ¹æ®ä»¥å¤ªç½‘åè®®å°†æ•°æ®åˆ†ä¸ºä»¥ â€œå¸§â€ ä¸ºå•ä½çš„æ•°æ®åŒ…ï¼Œæ¯ä¸€å¸§åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ‡å¤´ï¼šæ•°æ®åŒ…çš„å‘é€è€…ã€æ¥å—è€…ã€æ•°æ®ç±»å‹æ•°æ®ï¼šæ•°æ®åŒ…å…·ä½“å†…å®¹Mac åœ°å€ä»¥å¤ªç½‘è§„å®šäº†è¿å…¥ç½‘ç»œçš„æ‰€æœ‰è®¾å¤‡éƒ½å¿…é¡»å…·å¤‡ â€œç½‘å¡â€ æ¥å£ï¼Œæ•°æ®åŒ…éƒ½æ˜¯ä»ä¸€å—ç½‘å¡ä¼ é€’åˆ°å¦ä¸€å—ç½‘å¡ï¼Œç½‘å¡çš„åœ°å€å°±æ˜¯ Mac åœ°å€ã€‚æ¯ä¸€ä¸ª Mac åœ°å€éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå…·å¤‡äº†ä¸€å¯¹ä¸€çš„èƒ½åŠ›ã€‚å¹¿æ’­å‘é€æ•°æ®çš„æ–¹æ³•å¾ˆåŸå§‹ï¼Œç›´æ¥æŠŠæ•°æ®é€šè¿‡ ARP åè®®ï¼Œå‘æœ¬ç½‘ç»œçš„æ‰€æœ‰æœºå™¨å‘é€ï¼Œæ¥æ”¶æ–¹æ ¹æ®æ ‡å¤´ä¿¡æ¯ä¸è‡ªèº« Mac åœ°å€æ¯”è¾ƒï¼Œä¸€è‡´å°±æ¥å—ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚æ³¨æ„ï¼šæ¥æ”¶æ–¹å›åº”æ˜¯å•æ’­ã€‚ç›¸å…³çŸ¥è¯†ç‚¹ï¼šARP æ”»å‡»æœåŠ¡å™¨æ¥å—è¯·æ±‚æ¥å—è¿‡ç¨‹å°±æ˜¯æŠŠä»¥ä¸Šæ­¥éª¤é€†è½¬è¿‡æ¥ï¼Œå‚è§ä¸Šå›¾ã€‚å››ã€æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¤§è‡´æµç¨‹HTTPDæœ€å¸¸è§çš„ HTTPD æœ‰ Linux ä¸Šå¸¸ç”¨çš„ Apache å’Œ Nginxï¼Œä»¥åŠ Windows ä¸Šçš„ IISã€‚å®ƒä¼šç›‘å¬å¾—åˆ°çš„è¯·æ±‚ï¼Œç„¶åå¼€å¯ä¸€ä¸ªå­è¿›ç¨‹å»å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚å¤„ç†è¯·æ±‚æ¥å— TCP æŠ¥æ–‡åï¼Œä¼šå¯¹è¿æ¥è¿›è¡Œå¤„ç†ï¼Œå¯¹ HTTP åè®®è¿›è¡Œè§£æï¼ˆè¯·æ±‚æ–¹æ³•ã€åŸŸåã€è·¯å¾„ç­‰ï¼‰ï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›éªŒè¯ï¼šéªŒè¯æ˜¯å¦é…ç½®è™šæ‹Ÿä¸»æœºéªŒè¯è™šæ‹Ÿä¸»æœºæ˜¯å¦æ¥å—æ­¤æ–¹æ³•éªŒè¯è¯¥ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ï¼ˆæ ¹æ® IP åœ°å€ã€èº«ä»½ä¿¡æ¯ç­‰ï¼‰é‡å®šå‘å‡å¦‚æœåŠ¡å™¨é…ç½®äº† HTTP é‡å®šå‘ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª 301æ°¸ä¹…é‡å®šå‘å“åº”ï¼Œæµè§ˆå™¨å°±ä¼šæ ¹æ®å“åº”ï¼Œé‡æ–°å‘é€ HTTP è¯·æ±‚ï¼ˆé‡æ–°æ‰§è¡Œä¸Šé¢çš„è¿‡ç¨‹ï¼‰ã€‚å…³äºæ›´å¤šï¼šè¯¦è§è¿™ç¯‡æ–‡ç« URL é‡å†™ç„¶åä¼šæŸ¥çœ‹ URL é‡å†™è§„åˆ™ï¼Œå¦‚æœè¯·æ±‚çš„æ–‡ä»¶æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œæ¯”å¦‚å›¾ç‰‡ã€htmlã€cssã€js æ–‡ä»¶ç­‰ï¼Œåˆ™ä¼šç›´æ¥æŠŠè¿™ä¸ªæ–‡ä»¶è¿”å›ã€‚å¦åˆ™æœåŠ¡å™¨ä¼šæŒ‰ç…§è§„åˆ™æŠŠè¯·æ±‚é‡å†™åˆ° ä¸€ä¸ª REST é£æ ¼çš„ URL ä¸Šã€‚ç„¶åæ ¹æ®åŠ¨æ€è¯­è¨€çš„è„šæœ¬ï¼Œæ¥å†³å®šè°ƒç”¨ä»€ä¹ˆç±»å‹çš„åŠ¨æ€æ–‡ä»¶è§£é‡Šå™¨æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚ä»¥ PHP è¯­è¨€çš„ MVC æ¡†æ¶ä¸¾ä¾‹ï¼Œå®ƒé¦–å…ˆä¼šåˆå§‹åŒ–ä¸€äº›ç¯å¢ƒçš„å‚æ•°ï¼Œæ ¹æ® URL ç”±ä¸Šåˆ°ä¸‹åœ°å»åŒ¹é…è·¯ç”±ï¼Œç„¶åè®©è·¯ç”±æ‰€å®šä¹‰çš„æ–¹æ³•å»å¤„ç†è¯·æ±‚ã€‚äº”ã€æµè§ˆå™¨æ¥å—å“åº”æµè§ˆå™¨æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„å“åº”èµ„æºåï¼Œä¼šå¯¹èµ„æºè¿›è¡Œåˆ†æã€‚é¦–å…ˆæŸ¥çœ‹ Response headerï¼Œæ ¹æ®ä¸åŒçŠ¶æ€ç åšä¸åŒçš„äº‹ï¼ˆæ¯”å¦‚ä¸Šé¢æåˆ°çš„é‡å®šå‘ï¼‰ã€‚å¦‚æœå“åº”èµ„æºè¿›è¡Œäº†å‹ç¼©ï¼ˆæ¯”å¦‚ gzipï¼‰ï¼Œè¿˜éœ€è¦è¿›è¡Œè§£å‹ã€‚ç„¶åï¼Œå¯¹å“åº”èµ„æºåšç¼“å­˜ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®å“åº”èµ„æºé‡Œçš„ MIME ç±»å‹å»è§£æå“åº”å†…å®¹ï¼ˆæ¯”å¦‚ HTMLã€Image å„æœ‰ä¸åŒçš„è§£ææ–¹å¼ï¼‰ã€‚å…­ã€æ¸²æŸ“é¡µé¢æµè§ˆå™¨å†…æ ¸ä¸åŒçš„æµè§ˆå™¨å†…æ ¸ï¼Œæ¸²æŸ“è¿‡ç¨‹ä¹Ÿä¸å®Œå…¨ç›¸åŒï¼Œä½†å¤§è‡´æµç¨‹éƒ½å·®ä¸å¤šã€‚åŸºæœ¬æµç¨‹1.HTML è§£æé¦–å…ˆè¦çŸ¥é“æµè§ˆå™¨è§£ææ˜¯ä»ä¸Šå¾€ä¸‹ä¸€è¡Œä¸€è¡Œåœ°è§£æçš„ã€‚è§£æçš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š1. è§£ç ï¼ˆencodingï¼‰ä¼ è¾“å›æ¥çš„å…¶å®éƒ½æ˜¯ä¸€äº›äºŒè¿›åˆ¶å­—èŠ‚æ•°æ®ï¼Œæµè§ˆå™¨éœ€è¦æ ¹æ®æ–‡ä»¶æŒ‡å®šç¼–ç ï¼ˆä¾‹å¦‚ UTF-8ï¼‰è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ HTML ä»£ç ã€‚2. é¢„è§£æï¼ˆpre-parsingï¼‰é¢„è§£æåšçš„äº‹æƒ…æ˜¯æå‰åŠ è½½èµ„æºï¼Œå‡å°‘å¤„ç†æ—¶é—´ï¼Œå®ƒä¼šè¯†åˆ«ä¸€äº›ä¼šè¯·æ±‚èµ„æºçš„å±æ€§ï¼Œæ¯”å¦‚imgæ ‡ç­¾çš„srcå±æ€§ï¼Œå¹¶å°†è¿™ä¸ªè¯·æ±‚åŠ åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚3. ç¬¦å·åŒ–ï¼ˆTokenizationï¼‰ç¬¦å·åŒ–æ˜¯è¯æ³•åˆ†æçš„è¿‡ç¨‹ï¼Œå°†è¾“å…¥è§£ææˆç¬¦å·ï¼ŒHTML ç¬¦å·åŒ…æ‹¬ï¼Œå¼€å§‹æ ‡ç­¾ã€ç»“æŸæ ‡ç­¾ã€å±æ€§åå’Œå±æ€§å€¼ã€‚å®ƒé€šè¿‡ä¸€ä¸ªçŠ¶æ€æœºå»è¯†åˆ«ç¬¦å·çš„çŠ¶æ€ï¼Œæ¯”å¦‚é‡åˆ°&lt;ï¼Œ&gt;çŠ¶æ€éƒ½ä¼šäº§ç”Ÿå˜åŒ–ã€‚4. æ„å»ºæ ‘ï¼ˆtree constructionï¼‰æ³¨æ„ï¼šç¬¦å·åŒ–å’Œæ„å»ºæ ‘æ˜¯å¹¶è¡Œæ“ä½œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦è§£æåˆ°ä¸€ä¸ªå¼€å§‹æ ‡ç­¾ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª DOM èŠ‚ç‚¹ã€‚åœ¨ä¸Šä¸€æ­¥ç¬¦å·åŒ–ä¸­ï¼Œè§£æå™¨è·å¾—è¿™äº›æ ‡è®°ï¼Œç„¶åä»¥åˆé€‚çš„æ–¹æ³•åˆ›å»ºDOMå¯¹è±¡å¹¶æŠŠè¿™äº›ç¬¦å·æ’å…¥åˆ°DOMå¯¹è±¡ä¸­ã€‚1234567891011&lt;html&gt;&lt;head&gt; &lt;title&gt;Web page parsing&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt; &lt;h1&gt;Web page parsing&lt;/h1&gt; &lt;p&gt;This is an example Web page.&lt;/p&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;æµè§ˆå™¨å®¹é”™è¿›åˆ¶ä½ ä»æ¥æ²¡æœ‰åœ¨æµè§ˆå™¨çœ‹è¿‡ç±»ä¼¼â€ è¯­æ³•æ— æ•ˆâ€ çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºæµè§ˆå™¨å»çº æ­£é”™è¯¯çš„è¯­æ³•ï¼Œç„¶åç»§ç»­å·¥ä½œã€‚äº‹ä»¶å½“æ•´ä¸ªè§£æçš„è¿‡ç¨‹å®Œæˆä»¥åï¼Œæµè§ˆå™¨ä¼šé€šè¿‡DOMContentLoadedäº‹ä»¶æ¥é€šçŸ¥DOMè§£æå®Œæˆã€‚2. CSS è§£æä¸€æ—¦æµè§ˆå™¨ä¸‹è½½äº† CSSï¼ŒCSS è§£æå™¨å°±ä¼šå¤„ç†å®ƒé‡åˆ°çš„ä»»ä½• CSSï¼Œæ ¹æ®è¯­æ³•è§„èŒƒè§£æå‡ºæ‰€æœ‰çš„ CSS å¹¶è¿›è¡Œæ ‡è®°åŒ–ï¼Œç„¶åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªè§„åˆ™è¡¨ã€‚CSS åŒ¹é…è§„åˆ™åœ¨åŒ¹é…ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”çš„ CSS è§„åˆ™æ—¶ï¼Œæ˜¯æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºçš„ï¼Œä¾‹å¦‚ï¼šdiv p { font-size :14px }ä¼šå…ˆå¯»æ‰¾æ‰€æœ‰çš„pæ ‡ç­¾ç„¶ååˆ¤æ–­å®ƒçš„çˆ¶å…ƒç´ æ˜¯å¦ä¸ºdivã€‚æ‰€ä»¥æˆ‘ä»¬å†™ CSS æ—¶ï¼Œå°½é‡ç”¨ id å’Œ classï¼Œåƒä¸‡ä¸è¦è¿‡åº¦å±‚å ã€‚3. æ¸²æŸ“æ ‘å…¶å®è¿™å°±æ˜¯ä¸€ä¸ª DOM æ ‘å’Œ CSS è§„åˆ™æ ‘åˆå¹¶çš„è¿‡ç¨‹ã€‚æ³¨æ„ï¼šæ¸²æŸ“æ ‘ä¼šå¿½ç•¥é‚£äº›ä¸éœ€è¦æ¸²æŸ“çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚è®¾ç½®äº†display:noneçš„èŠ‚ç‚¹ã€‚è®¡ç®—é€šè¿‡è®¡ç®—è®©ä»»ä½•å°ºå¯¸å€¼éƒ½å‡å°‘åˆ°ä¸‰ä¸ªå¯èƒ½ä¹‹ä¸€ï¼šautoã€ç™¾åˆ†æ¯”ã€pxï¼Œæ¯”å¦‚æŠŠremè½¬åŒ–ä¸ºpxã€‚çº§è”æµè§ˆå™¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç¡®å®šå“ªäº›æ ·å¼æ‰çœŸæ­£éœ€è¦åº”ç”¨åˆ°å¯¹åº”å…ƒç´ ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨ä¸€ä¸ªå«åšspecificityçš„å…¬å¼ï¼Œè¿™ä¸ªå…¬å¼ä¼šé€šè¿‡ï¼šæ ‡ç­¾åã€classã€idæ˜¯å¦å†…è”æ ·å¼!importantç„¶åå¾—å‡ºä¸€ä¸ªæƒé‡å€¼ï¼Œå–æœ€é«˜çš„é‚£ä¸ªã€‚æ¸²æŸ“é˜»å¡å½“é‡åˆ°ä¸€ä¸ªscriptæ ‡ç­¾æ—¶ï¼ŒDOM æ„å»ºä¼šè¢«æš‚åœï¼Œç›´è‡³è„šæœ¬å®Œæˆæ‰§è¡Œï¼Œç„¶åç»§ç»­æ„å»º DOM æ ‘ã€‚ä½†å¦‚æœ JS ä¾èµ– CSS æ ·å¼ï¼Œè€Œå®ƒè¿˜æ²¡æœ‰è¢«ä¸‹è½½å’Œæ„å»ºæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå»¶è¿Ÿè„šæœ¬æ‰§è¡Œï¼Œç›´è‡³ CSS Rules è¢«æ„å»ºã€‚æ‰€æœ‰æˆ‘ä»¬çŸ¥é“ï¼šCSS ä¼šé˜»å¡ JS æ‰§è¡ŒJS ä¼šé˜»å¡åé¢çš„ DOM è§£æä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåº”è¯¥ä»¥ä¸‹åŸåˆ™ï¼šCSS èµ„æºæ’åœ¨ JavaScript èµ„æºå‰é¢JS æ”¾åœ¨ HTML æœ€åº•éƒ¨ï¼Œä¹Ÿå°±æ˜¯ &lt;/body&gt;å‰å¦å¤–ï¼Œå¦‚æœè¦æ”¹å˜é˜»å¡æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ defer ä¸ asyncï¼Œè¯¦è§ï¼šè¿™ç¯‡æ–‡ç« 4. å¸ƒå±€ä¸ç»˜åˆ¶ç¡®å®šæ¸²æŸ“æ ‘ç§æ‰€æœ‰èŠ‚ç‚¹çš„å‡ ä½•å±æ€§ï¼Œæ¯”å¦‚ï¼šä½ç½®ã€å¤§å°ç­‰ç­‰ï¼Œæœ€åè¾“å…¥ä¸€ä¸ªç›’å­æ¨¡å‹ï¼Œå®ƒèƒ½ç²¾å‡†åœ°æ•è·åˆ°æ¯ä¸ªå…ƒç´ åœ¨å±å¹•å†…çš„å‡†ç¡®ä½ç½®ä¸å¤§å°ã€‚ç„¶åéå†æ¸²æŸ“æ ‘ï¼Œè°ƒç”¨æ¸²æŸ“å™¨çš„ paint() æ–¹æ³•åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå…¶å†…å®¹ã€‚5. åˆå¹¶æ¸²æŸ“å±‚æŠŠä»¥ä¸Šç»˜åˆ¶çš„æ‰€æœ‰å›¾ç‰‡åˆå¹¶ï¼Œæœ€ç»ˆè¾“å‡ºä¸€å¼ å›¾ç‰‡ã€‚6. å›æµä¸é‡ç»˜å›æµ (reflow)å½“æµè§ˆå™¨å‘ç°æŸä¸ªéƒ¨åˆ†å‘ç°å˜åŒ–å½±å“äº†å¸ƒå±€æ—¶ï¼Œéœ€è¦å€’å›å»é‡æ–°æ¸²æŸ“ï¼Œä¼šä»htmlæ ‡ç­¾å¼€å§‹é€’å½’å¾€ä¸‹ï¼Œé‡æ–°è®¡ç®—ä½ç½®å’Œå¤§å°ã€‚reflow åŸºæœ¬æ˜¯æ— æ³•é¿å…çš„ï¼Œå› ä¸ºå½“ä½ æ»‘åŠ¨ä¸€ä¸‹é¼ æ ‡ã€resize çª—å£ï¼Œé¡µé¢å°±ä¼šäº§ç”Ÿå˜åŒ–ã€‚é‡ç»˜ (repaint)æ”¹å˜äº†æŸä¸ªå…ƒç´ çš„èƒŒæ™¯è‰²ã€æ–‡å­—é¢œè‰²ç­‰ç­‰ä¸ä¼šå½±å“å‘¨å›´å…ƒç´ çš„ä½ç½®å˜åŒ–æ—¶ï¼Œå°±ä¼šå‘ç”Ÿé‡ç»˜ã€‚æ¯æ¬¡é‡ç»˜åï¼Œæµè§ˆå™¨è¿˜éœ€è¦åˆå¹¶æ¸²æŸ“å±‚å¹¶è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚å›æµçš„æˆæœ¬è¦æ¯”é‡ç»˜é«˜å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…äº§ç”Ÿå›æµã€‚æ¯”å¦‚ï¼šdisplay:none ä¼šè§¦å‘å›æµï¼Œè€Œ visibility:hidden åªä¼šè§¦å‘é‡ç»˜ã€‚7. JavaScript ç¼–è¯‘æ‰§è¡Œå¤§è‡´æµç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š1. è¯æ³•åˆ†æJS è„šæœ¬åŠ è½½å®Œæ¯•åï¼Œä¼šé¦–å…ˆè¿›å…¥è¯­æ³•åˆ†æé˜¶æ®µï¼Œå®ƒé¦–å…ˆä¼šåˆ†æä»£ç å—çš„è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼Œä¸æ­£ç¡®åˆ™æŠ›å‡º â€œè¯­æ³•é”™è¯¯â€ï¼Œåœæ­¢æ‰§è¡Œã€‚å‡ ä¸ªæ­¥éª¤ï¼šåˆ†è¯ï¼Œä¾‹å¦‚å°†var a = 2ï¼Œï¼Œåˆ†æˆvarã€aã€=ã€2è¿™æ ·çš„è¯æ³•å•å…ƒã€‚è§£æï¼Œå°†è¯æ³•å•å…ƒè½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚ä»£ç ç”Ÿæˆï¼Œå°†æŠ½è±¡è¯­æ³•æ ‘è½¬æ¢æˆæœºå™¨æŒ‡ä»¤ã€‚2. é¢„ç¼–è¯‘JS æœ‰ä¸‰ç§è¿è¡Œç¯å¢ƒï¼šå…¨å±€ç¯å¢ƒå‡½æ•°ç¯å¢ƒevalæ¯è¿›å…¥ä¸€ä¸ªä¸åŒçš„è¿è¡Œç¯å¢ƒéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ ¹æ®ä¸åŒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå½¢æˆä¸€ä¸ªå‡½æ•°è°ƒç”¨æ ˆï¼Œæ ˆåº•æ°¸è¿œæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ ˆé¡¶åˆ™æ°¸è¿œæ˜¯å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦åšäº†ä»¥ä¸‹ä¸‰ä»¶äº‹ï¼šåˆ›å»ºå˜é‡å¯¹è±¡å‚æ•°ã€å‡½æ•°ã€å˜é‡å»ºç«‹ä½œç”¨åŸŸé“¾ç¡®è®¤å½“å‰æ‰§è¡Œç¯å¢ƒæ˜¯å¦èƒ½è®¿é—®å˜é‡ç¡®å®š This æŒ‡å‘3. æ‰§è¡ŒJS çº¿ç¨‹è™½ç„¶ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†å®é™…ä¸Šå‚ä¸å·¥ä½œçš„çº¿ç¨‹ä¸€å…±æœ‰å››ä¸ªï¼šå…¶ä¸­ä¸‰ä¸ªåªæ˜¯ååŠ©ï¼Œåªæœ‰ JS å¼•æ“çº¿ç¨‹æ˜¯çœŸæ­£æ‰§è¡Œçš„JS å¼•æ“çº¿ç¨‹ï¼šä¹Ÿå« JS å†…æ ¸ï¼Œè´Ÿè´£è§£ææ‰§è¡Œ JS è„šæœ¬ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼Œä¾‹å¦‚ V8 å¼•æ“äº‹ä»¶è§¦å‘çº¿ç¨‹ï¼šå±äºæµè§ˆå™¨å†…æ ¸çº¿ç¨‹ï¼Œä¸»è¦ç”¨äºæ§åˆ¶äº‹ä»¶ï¼Œä¾‹å¦‚é¼ æ ‡ã€é”®ç›˜ç­‰ï¼Œå½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå°±ä¼šæŠŠäº‹ä»¶çš„å¤„ç†å‡½æ•°æ¨è¿›äº‹ä»¶é˜Ÿåˆ—ï¼Œç­‰å¾… JS å¼•æ“çº¿ç¨‹æ‰§è¡Œå®šæ—¶å™¨è§¦å‘çº¿ç¨‹ï¼šä¸»è¦æ§åˆ¶setIntervalå’ŒsetTimeoutï¼Œç”¨æ¥è®¡æ—¶ï¼Œè®¡æ—¶å®Œæ¯•åï¼Œåˆ™æŠŠå®šæ—¶å™¨çš„å¤„ç†å‡½æ•°æ¨è¿›äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“çº¿ç¨‹ã€‚HTTP å¼‚æ­¥è¯·æ±‚çº¿ç¨‹ï¼šé€šè¿‡ XMLHttpRequest è¿æ¥åï¼Œé€šè¿‡æµè§ˆå™¨æ–°å¼€çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œç›‘æ§ readyState çŠ¶æ€å˜æ›´æ—¶ï¼Œå¦‚æœè®¾ç½®äº†è¯¥çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œåˆ™å°†è¯¥çŠ¶æ€çš„å¤„ç†å‡½æ•°æ¨è¿›äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“çº¿ç¨‹æ‰§è¡Œã€‚æ³¨ï¼šæµè§ˆå™¨å¯¹åŒä¸€åŸŸåçš„å¹¶å‘è¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼Œé€šå¸¸ä¸º 6 ä¸ªã€‚å®ä»»åŠ¡åˆ†ä¸ºï¼šåŒæ­¥ä»»åŠ¡ï¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œåªæœ‰å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆåï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡å¼‚æ­¥ä»»åŠ¡ï¼šä¸ç›´æ¥æ‰§è¡Œï¼Œåªæœ‰æ»¡è¶³è§¦å‘æ¡ä»¶æ—¶ï¼Œç›¸å…³çš„çº¿ç¨‹å°†è¯¥å¼‚æ­¥ä»»åŠ¡æ¨è¿›ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶æ‰å¼€å§‹æ‰§è¡Œï¼Œä¾‹å¦‚å¼‚æ­¥ Ajaxã€DOM äº‹ä»¶ï¼ŒsetTimeout ç­‰ã€‚å¾®ä»»åŠ¡å¾®ä»»åŠ¡æ˜¯ ES6 å’Œ Node ç¯å¢ƒä¸‹çš„ï¼Œä¸»è¦ API æœ‰ï¼šPromiseï¼Œprocess.nextTickã€‚å¾®ä»»åŠ¡çš„æ‰§è¡Œåœ¨å®ä»»åŠ¡çš„åŒæ­¥ä»»åŠ¡ä¹‹åï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡ä¹‹å‰ã€‚ä»£ç ä¾‹å­1234567891011121314console.log(&apos;1&apos;); // å®ä»»åŠ¡ åŒæ­¥setTimeout(function() &#123; console.log(&apos;2&apos;); // å®ä»»åŠ¡ å¼‚æ­¥&#125;)new Promise(function(resolve) &#123; console.log(&apos;3&apos;); // å®ä»»åŠ¡ åŒæ­¥ resolve();&#125;).then(function() &#123; console.log(&apos;4&apos;) // å¾®ä»»åŠ¡&#125;)console.log(&apos;5&apos;) // å®ä»»åŠ¡ åŒæ­¥ä»¥ä¸Šä»£ç è¾“å‡ºé¡ºåºä¸ºï¼š1,3,5,4,2å‚è€ƒæ–‡æ¡£what-happens-when-zh_CNTags to DOMå½»åº•ç†è§£æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜æ·±å…¥æµ…å‡ºæµè§ˆå™¨æ¸²æŸ“åŸç†js å¼•æ“çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆä¸€ï¼‰è¿˜æœ‰ä¸€äº›æ‰¾ä¸åˆ°äº†ã€‚ã€‚ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Reactæ·±å…¥ã€‘ä»Mixinåˆ°HOCå†åˆ°Hook]]></title>
    <url>%2Farchives%2F90ac.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5cad39b3f265da03502b1c0a#heading-35å¯¼è¯»å‰ç«¯å‘å±•é€Ÿåº¦éå¸¸ä¹‹å¿«ï¼Œé¡µé¢å’Œç»„ä»¶å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¦‚ä½•æ›´å¥½çš„å®ç°çŠ¶æ€é€»è¾‘å¤ç”¨ä¸€ç›´éƒ½æ˜¯åº”ç”¨ç¨‹åºä¸­é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ç›´æ¥å…³ç³»ç€åº”ç”¨ç¨‹åºçš„è´¨é‡ä»¥åŠç»´æŠ¤çš„éš¾æ˜“ç¨‹åº¦ã€‚æœ¬æ–‡ä»‹ç»äº†Reacté‡‡ç”¨çš„ä¸‰ç§å®ç°çŠ¶æ€é€»è¾‘å¤ç”¨çš„æŠ€æœ¯ï¼Œå¹¶åˆ†æäº†ä»–ä»¬çš„å®ç°åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€å®é™…åº”ç”¨ä»¥åŠå¦‚ä½•é€‰æ‹©ä½¿ç”¨ä»–ä»¬ã€‚æœ¬æ–‡ç•¥é•¿ï¼Œä¸‹é¢æ˜¯æœ¬æ–‡çš„æ€ç»´å¯¼å›¾ï¼Œæ‚¨å¯ä»¥ä»å¤´å¼€å§‹é˜…è¯»ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ„Ÿå…´è¶£çš„éƒ¨åˆ†é˜…è¯»ï¼šMixin è®¾è®¡æ¨¡å¼Mixinï¼ˆæ··å…¥ï¼‰æ˜¯ä¸€ç§é€šè¿‡æ‰©å±•æ”¶é›†åŠŸèƒ½çš„æ–¹å¼ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å°†ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ‹·è´åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Šé¢å»ï¼Œä¸è¿‡ä½ å¯ä»¥æ‹·è´ä»»æ„å¤šä¸ªå¯¹è±¡çš„ä»»æ„ä¸ªæ–¹æ³•åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ä¸Šå»ï¼Œè¿™æ˜¯ç»§æ‰¿æ‰€ä¸èƒ½å®ç°çš„ã€‚å®ƒçš„å‡ºç°ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨é—®é¢˜ã€‚å¾ˆå¤šå¼€æºåº“æä¾›äº†Mixinçš„å®ç°ï¼Œå¦‚Underscoreçš„_.extendæ–¹æ³•ã€JQueryçš„extendæ–¹æ³•ã€‚ä½¿ç”¨_.extendæ–¹æ³•å®ç°ä»£ç å¤ç”¨ï¼š1234567891011121314151617var LogMixin = &#123; actionLog: function() &#123; console.log(&apos;action...&apos;); &#125;, requestLog: function() &#123; console.log(&apos;request...&apos;); &#125;,&#125;;function User() &#123; /*..*/ &#125;function Goods() &#123; /*..*/ &#125;_.extend(User.prototype, LogMixin);_.extend(Goods.prototype, LogMixin);var user = new User();var good = new Goods();user.actionLog();good.requestLog();å¤åˆ¶ä»£ç æˆ‘ä»¬å¯ä»¥å°è¯•æ‰‹åŠ¨å†™ä¸€ä¸ªç®€å•çš„Mixinæ–¹æ³•ï¼š1234567891011121314151617function setMixin(target, mixin) &#123; if (arguments[2]) &#123; for (var i = 2, len = arguments.length; i &lt; len; i++) &#123; target.prototype[arguments[i]] = mixin.prototype[arguments[i]]; &#125; &#125; else &#123; for (var methodName in mixin.prototype) &#123; if (!Object.hasOwnProperty(target.prototype, methodName)) &#123; target.prototype[methodName] = mixin.prototype[methodName]; &#125; &#125; &#125;&#125;setMixin(User,LogMixin,&apos;actionLog&apos;);setMixin(Goods,LogMixin,&apos;requestLog&apos;);å¤åˆ¶ä»£ç æ‚¨å¯ä»¥ä½¿ç”¨setMixinæ–¹æ³•å°†ä»»æ„å¯¹è±¡çš„ä»»æ„æ–¹æ³•æ‰©å±•åˆ°ç›®æ ‡å¯¹è±¡ä¸Šã€‚React ä¸­åº”ç”¨ MixinReactä¹Ÿæä¾›äº†Mixinçš„å®ç°ï¼Œå¦‚æœå®Œå…¨ä¸åŒçš„ç»„ä»¶æœ‰ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥æ¥å®ç°ä»£ç å¤ç”¨ï¼Œå½“ç„¶åªæœ‰åœ¨ä½¿ç”¨createClassæ¥åˆ›å»ºReactç»„ä»¶æ—¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºåœ¨Reactç»„ä»¶çš„es6å†™æ³•ä¸­å®ƒå·²ç»è¢«åºŸå¼ƒæ‰äº†ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œå¾ˆå¤šç»„ä»¶æˆ–é¡µé¢éƒ½éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ€§èƒ½æŒ‡æ ‡ç­‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªç»„ä»¶éƒ½å¼•å…¥å†™æ—¥å¿—çš„é€»è¾‘ï¼Œä¼šäº§ç”Ÿå¤§é‡é‡å¤ä»£ç ï¼Œé€šè¿‡Mixinæˆ‘ä»¬å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ï¼š1234567891011121314151617181920212223242526var LogMixin = &#123; log: function() &#123; console.log(&apos;log&apos;); &#125;, componentDidMount: function() &#123; console.log(&apos;in&apos;); &#125;, componentWillUnmount: function() &#123; console.log(&apos;out&apos;); &#125;&#125;;var User = React.createClass(&#123; mixins: [LogMixin], render: function() &#123; return (&lt;div&gt;...&lt;/div&gt;) &#125;&#125;);var Goods = React.createClass(&#123; mixins: [LogMixin], render: function() &#123; return (&lt;div&gt;...&lt;/div&gt;) &#125;&#125;);å¤åˆ¶ä»£ç Mixin å¸¦æ¥çš„å±å®³Reactå®˜æ–¹æ–‡æ¡£åœ¨ Mixins Considered Harmful ä¸€æ–‡ä¸­æåˆ°äº†Mixinå¸¦æ¥äº†å±å®³ï¼šMixin å¯èƒ½ä¼šç›¸äº’ä¾èµ–ï¼Œç›¸äº’è€¦åˆï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤ä¸åŒçš„Mixinä¸­çš„æ–¹æ³•å¯èƒ½ä¼šç›¸äº’å†²çªMixinéå¸¸å¤šæ—¶ï¼Œç»„ä»¶æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œç”šè‡³è¿˜è¦ä¸ºå…¶åšç›¸å…³å¤„ç†ï¼Œè¿™æ ·ä¼šç»™ä»£ç é€ æˆæ»šé›ªçƒå¼çš„å¤æ‚æ€§Reactç°åœ¨å·²ç»ä¸å†æ¨èä½¿ç”¨Mixinæ¥è§£å†³ä»£ç å¤ç”¨é—®é¢˜ï¼Œå› ä¸ºMixinå¸¦æ¥çš„å±å®³æ¯”ä»–äº§ç”Ÿçš„ä»·å€¼è¿˜è¦å·¨å¤§ï¼Œå¹¶ä¸”Reactå…¨é¢æ¨èä½¿ç”¨é«˜é˜¶ç»„ä»¶æ¥æ›¿ä»£å®ƒã€‚å¦å¤–ï¼Œé«˜é˜¶ç»„ä»¶è¿˜èƒ½å®ç°æ›´å¤šå…¶ä»–æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œåœ¨å­¦ä¹ é«˜é˜¶ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚è£…é¥°æ¨¡å¼è£…é¥°è€… (decorator) æ¨¡å¼èƒ½å¤Ÿåœ¨ä¸æ”¹å˜å¯¹è±¡è‡ªèº«çš„åŸºç¡€ä¸Šï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç»™å¯¹åƒåŠ¨æ€çš„æ·»åŠ èŒè´£ã€‚ä¸ç»§æ‰¿ç›¸æ¯”ï¼Œè£…é¥°è€…æ˜¯ä¸€ç§æ›´è½»ä¾¿çµæ´»çš„åšæ³•ã€‚é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰é«˜é˜¶ç»„ä»¶å¯ä»¥çœ‹ä½œReactå¯¹è£…é¥°æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œé«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æ˜¯Reactä¸­çš„é«˜çº§æŠ€æœ¯ï¼Œç”¨æ¥é‡ç”¨ç»„ä»¶é€»è¾‘ã€‚ä½†é«˜é˜¶ç»„ä»¶æœ¬èº«å¹¶ä¸æ˜¯React APIã€‚å®ƒåªæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯ç”±Reactè‡ªèº«çš„ç»„åˆæ€§è´¨å¿…ç„¶äº§ç”Ÿçš„ã€‚12345678910function visible(WrappedComponent) &#123; return class extends Component &#123; render() &#123; const &#123; visible, ...props &#125; = this.props; if (visible === false) return null; return &lt;WrappedComponent &#123;...props&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªHOCçš„ç®€å•åº”ç”¨ï¼Œå‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ï¼Œæ–°ç»„å»ºå¯ä»¥æ¥æ”¶ä¸€ä¸ªvisible propsï¼Œæ ¹æ®visibleçš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ Visibleã€‚ä¸‹é¢æˆ‘ä»¬ä»ä»¥ä¸‹å‡ æ–¹é¢æ¥å…·ä½“æ¢ç´¢HOCã€‚HOC çš„å®ç°æ–¹å¼å±æ€§ä»£ç†å‡½æ•°è¿”å›ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç»„ä»¶ï¼Œç„¶ååœ¨renderä¸­è¿”å›è¦åŒ…è£¹çš„ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»£ç†æ‰€æœ‰ä¼ å…¥çš„propsï¼Œå¹¶ä¸”å†³å®šå¦‚ä½•æ¸²æŸ“ï¼Œå®é™…ä¸Š ï¼Œè¿™ç§æ–¹å¼ç”Ÿæˆçš„é«˜é˜¶ç»„ä»¶å°±æ˜¯åŸç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œä¸Šé¢çš„å‡½æ•°visibleå°±æ˜¯ä¸€ä¸ªHOCå±æ€§ä»£ç†çš„å®ç°æ–¹å¼ã€‚12345678function proxyHOC(WrappedComponent) &#123; return class extends Component &#123; render() &#123; return &lt;WrappedComponent &#123;...this.props&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼šå¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„propså¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯æ“ä½œç»„ä»¶çš„staticæ–¹æ³•è·å–refsåå‘ç»§æ‰¿è¿”å›ä¸€ä¸ªç»„ä»¶ï¼Œç»§æ‰¿åŸç»„ä»¶ï¼Œåœ¨renderä¸­è°ƒç”¨åŸç»„ä»¶çš„renderã€‚ç”±äºç»§æ‰¿äº†åŸç»„ä»¶ï¼Œèƒ½é€šè¿‡ this è®¿é—®åˆ°åŸç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€propsã€stateã€renderç­‰ï¼Œç›¸æ¯”å±æ€§ä»£ç†å®ƒèƒ½æ“ä½œæ›´å¤šçš„å±æ€§ã€‚12345678function inheritHOC(WrappedComponent) &#123; return class extends WrappedComponent &#123; render() &#123; return super.render(); &#125; &#125;&#125;å¤åˆ¶ä»£ç å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼šå¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„propså¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯æ“ä½œç»„ä»¶çš„staticæ–¹æ³•è·å–refså¯æ“ä½œstateå¯ä»¥æ¸²æŸ“åŠ«æŒHOC å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½ç»„åˆæ¸²æŸ“å¯ä½¿ç”¨ä»»ä½•å…¶ä»–ç»„ä»¶å’ŒåŸç»„ä»¶è¿›è¡Œç»„åˆæ¸²æŸ“ï¼Œè¾¾åˆ°æ ·å¼ã€å¸ƒå±€å¤ç”¨ç­‰æ•ˆæœã€‚é€šè¿‡å±æ€§ä»£ç†å®ç°1234567891011function stylHOC(WrappedComponent) &#123; return class extends Component &#123; render() &#123; return (&lt;div&gt; &lt;div class&gt;&#123;this.props.title&#125;&lt;/div&gt; &lt;WrappedComponent &#123;...this.props&#125; /&gt; &lt;/div&gt;); &#125; &#125;&#125;å¤åˆ¶ä»£ç é€šè¿‡åå‘ç»§æ‰¿å®ç°1234567891011function styleHOC(WrappedComponent) &#123; return class extends WrappedComponent &#123; render() &#123; return &lt;div&gt; &lt;div class&gt;&#123;this.props.title&#125;&lt;/div&gt; &#123;super.render()&#125; &lt;/div&gt; &#125; &#125;&#125;å¤åˆ¶ä»£ç æ¡ä»¶æ¸²æŸ“æ ¹æ®ç‰¹å®šçš„å±æ€§å†³å®šåŸç»„ä»¶æ˜¯å¦æ¸²æŸ“é€šè¿‡å±æ€§ä»£ç†å®ç°123456789function visibleHOC(WrappedComponent) &#123; return class extends Component &#123; render() &#123; if (this.props.visible === false) return null; return &lt;WrappedComponent &#123;...props&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç é€šè¿‡åå‘ç»§æ‰¿å®ç°123456789101112function visibleHOC(WrappedComponent) &#123; return class extends WrappedComponent &#123; render() &#123; if (this.props.visible === false) &#123; return null &#125; else &#123; return super.render() &#125; &#125; &#125;&#125;å¤åˆ¶ä»£ç æ“ä½œ propså¯ä»¥å¯¹ä¼ å…¥ç»„ä»¶çš„propsè¿›è¡Œå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤æˆ–è€…æ ¹æ®ç‰¹å®šçš„propsè¿›è¡Œç‰¹æ®Šçš„æ“ä½œã€‚é€šè¿‡å±æ€§ä»£ç†å®ç°123456789101112function proxyHOC(WrappedComponent) &#123; return class extends Component &#123; render() &#123; const newProps = &#123; ...this.props, user: &apos;ConardLi&apos; &#125; return &lt;WrappedComponent &#123;...newProps&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç è·å– refsé«˜é˜¶ç»„ä»¶ä¸­å¯è·å–åŸç»„ä»¶çš„refï¼Œé€šè¿‡refè·å–ç»„ä»¶å®åŠ›ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œå½“ç¨‹åºåˆå§‹åŒ–å®Œæˆåè°ƒç”¨åŸç»„ä»¶çš„ log æ–¹æ³•ã€‚(ä¸çŸ¥é“ refs æ€ä¹ˆç”¨ï¼Œè¯·ğŸ‘‡Refs &amp; DOM)é€šè¿‡å±æ€§ä»£ç†å®ç°1234567891011function refHOC(WrappedComponent) &#123; return class extends Component &#123; componentDidMount() &#123; this.wapperRef.log() &#125; render() &#123; return &lt;WrappedComponent &#123;...this.props&#125; ref=&#123;ref =&gt; &#123; this.wapperRef = ref &#125;&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç è¿™é‡Œæ³¨æ„ï¼šè°ƒç”¨é«˜é˜¶ç»„ä»¶çš„æ—¶å€™å¹¶ä¸èƒ½è·å–åˆ°åŸç»„ä»¶çš„çœŸå®refï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œä¼ é€’ï¼Œå…·ä½“è¯·çœ‹ä¼ é€’ refsçŠ¶æ€ç®¡ç†å°†åŸç»„ä»¶çš„çŠ¶æ€æå–åˆ°HOCä¸­è¿›è¡Œç®¡ç†ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†Inputçš„valueæå–åˆ°HOCä¸­è¿›è¡Œç®¡ç†ï¼Œä½¿å®ƒå˜æˆå—æ§ç»„ä»¶ï¼ŒåŒæ—¶ä¸å½±å“å®ƒä½¿ç”¨onChangeæ–¹æ³•è¿›è¡Œä¸€äº›å…¶ä»–æ“ä½œã€‚åŸºäºè¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šï¼Œå…·ä½“è¯·çœ‹åŒå‘ç»‘å®šã€‚é€šè¿‡å±æ€§ä»£ç†å®ç°123456789101112131415161718192021222324252627282930313233343536function proxyHoc(WrappedComponent) &#123; return class extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; value: &apos;&apos; &#125;; &#125; onChange = (event) =&gt; &#123; const &#123; onChange &#125; = this.props; this.setState(&#123; value: event.target.value, &#125;, () =&gt; &#123; if(typeof onChange ===&apos;function&apos;)&#123; onChange(event); &#125; &#125;) &#125; render() &#123; const newProps = &#123; value: this.state.value, onChange: this.onChange, &#125; return &lt;WrappedComponent &#123;...this.props&#125; &#123;...newProps&#125; /&gt;; &#125; &#125;&#125;class HOC extends Component &#123; render() &#123; return &lt;input &#123;...this.props&#125;&gt;&lt;/input&gt; &#125;&#125;export default proxyHoc(HOC);å¤åˆ¶ä»£ç æ“ä½œ stateä¸Šé¢çš„ä¾‹å­é€šè¿‡å±æ€§ä»£ç†åˆ©ç”¨ HOC çš„ state å¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¸€å®šçš„å¢å¼ºï¼Œä½†å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶åŸç»„ä»¶çš„stateï¼Œè€Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œåŸç»„ä»¶çš„stateã€‚ä½†æ˜¯å¹¶ä¸æ¨èç›´æ¥ä¿®æ”¹æˆ–æ·»åŠ åŸç»„ä»¶çš„stateï¼Œå› ä¸ºè¿™æ ·æœ‰å¯èƒ½å’Œç»„ä»¶å†…éƒ¨çš„æ“ä½œæ„æˆå†²çªã€‚é€šè¿‡åå‘ç»§æ‰¿å®ç°1234567891011121314function debugHOC(WrappedComponent) &#123; return class extends WrappedComponent &#123; render() &#123; console.log(&apos;props&apos;, this.props); console.log(&apos;state&apos;, this.state); return ( &lt;div class&gt; &#123;super.render()&#125; &lt;/div&gt; ) &#125; &#125;&#125;å¤åˆ¶ä»£ç ä¸Šé¢çš„HOCåœ¨renderä¸­å°†propså’Œstateæ‰“å°å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä½œè°ƒè¯•é˜¶æ®µï¼Œå½“ç„¶ä½ å¯ä»¥åœ¨é‡Œé¢å†™æ›´å¤šçš„è°ƒè¯•ä»£ç ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåªéœ€è¦åœ¨æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„ç»„ä»¶ä¸ŠåŠ ä¸Š@debugå°±å¯ä»¥å¯¹è¯¥ç»„ä»¶è¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡è°ƒè¯•çš„æ—¶å€™å†™å¾ˆå¤šå†—ä½™ä»£ç ã€‚(å¦‚æœä½ è¿˜ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨ HOCï¼Œè¯·ğŸ‘‡å¦‚ä½•ä½¿ç”¨ HOC)æ¸²æŸ“åŠ«æŒé«˜é˜¶ç»„ä»¶å¯ä»¥åœ¨ render å‡½æ•°ä¸­åšéå¸¸å¤šçš„æ“ä½œï¼Œä»è€Œæ§åˆ¶åŸç»„ä»¶çš„æ¸²æŸ“è¾“å‡ºã€‚åªè¦æ”¹å˜äº†åŸç»„ä»¶çš„æ¸²æŸ“ï¼Œæˆ‘ä»¬éƒ½å°†å®ƒç§°ä¹‹ä¸ºä¸€ç§æ¸²æŸ“åŠ«æŒã€‚å®é™…ä¸Šï¼Œä¸Šé¢çš„ç»„åˆæ¸²æŸ“å’Œæ¡ä»¶æ¸²æŸ“éƒ½æ˜¯æ¸²æŸ“åŠ«æŒçš„ä¸€ç§ï¼Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œä¸ä»…å¯ä»¥å®ç°ä»¥ä¸Šä¸¤ç‚¹ï¼Œè¿˜å¯ç›´æ¥å¢å¼ºç”±åŸç»„ä»¶renderå‡½æ•°äº§ç”Ÿçš„Reactå…ƒç´ ã€‚é€šè¿‡åå‘ç»§æ‰¿å®ç°123456789101112131415function hijackHOC(WrappedComponent) &#123; return class extends WrappedComponent &#123; render() &#123; const tree = super.render(); let newProps = &#123;&#125;; if (tree &amp;&amp; tree.type === &apos;input&apos;) &#123; newProps = &#123; value: &apos;æ¸²æŸ“è¢«åŠ«æŒäº†&apos; &#125;; &#125; const props = Object.assign(&#123;&#125;, tree.props, newProps); const newTree = React.cloneElement(tree, props, tree.props.children); return newTree; &#125; &#125;&#125;å¤åˆ¶ä»£ç æ³¨æ„ä¸Šé¢çš„è¯´æ˜æˆ‘ç”¨çš„æ˜¯å¢å¼ºè€Œä¸æ˜¯æ›´æ”¹ã€‚renderå‡½æ•°å†…å®é™…ä¸Šæ˜¯è°ƒç”¨React.creatElementäº§ç”Ÿçš„Reactå…ƒç´ ï¼šè™½ç„¶æˆ‘ä»¬èƒ½æ‹¿åˆ°å®ƒï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒé‡Œé¢çš„å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡getOwnPropertyDescriptorså‡½æ•°æ¥æ‰“å°ä¸‹å®ƒçš„é…ç½®é¡¹ï¼šå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„writableå±æ€§å‡è¢«é…ç½®ä¸ºäº†falseï¼Œå³æ‰€æœ‰å±æ€§æ˜¯ä¸å¯å˜çš„ã€‚ï¼ˆå¯¹è¿™äº›é…ç½®é¡¹æœ‰ç–‘é—®ï¼Œè¯·ğŸ‘‡definePropertyï¼‰ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©cloneElementæ–¹æ³•æ¥åœ¨åŸç»„ä»¶çš„åŸºç¡€ä¸Šå¢å¼ºä¸€ä¸ªæ–°ç»„ä»¶ï¼šReact.cloneElement()å…‹éš†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„Reactå…ƒç´ ï¼Œä½¿ç”¨elementä½œä¸ºèµ·ç‚¹ã€‚ç”Ÿæˆçš„å…ƒç´ å°†ä¼šæ‹¥æœ‰åŸå§‹å…ƒç´  props ä¸æ–° props çš„æµ…åˆå¹¶ã€‚æ–°çš„å­çº§ä¼šæ›¿æ¢ç°æœ‰çš„å­çº§ã€‚æ¥è‡ªåŸå§‹å…ƒç´ çš„ key å’Œ ref å°†ä¼šä¿ç•™ã€‚React.cloneElement()å‡ ä¹ç›¸å½“äºï¼š12&lt;element.type &#123;...element.props&#125; &#123;...props&#125;&gt;&#123;children&#125;&lt;/element.type&gt;å¤åˆ¶ä»£ç å¦‚ä½•ä½¿ç”¨ HOCä¸Šé¢çš„ç¤ºä¾‹ä»£ç éƒ½å†™çš„æ˜¯å¦‚ä½•å£°æ˜ä¸€ä¸ªHOCï¼ŒHOCå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¦å¢å¼ºçš„ç»„ä»¶ä½œä¸ºå‚æ•°è°ƒç”¨HOCå‡½æ•°ï¼Œå¾—åˆ°å¢å¼ºåçš„ç»„ä»¶ã€‚1234567class myComponent extends Component &#123; render() &#123; return (&lt;span&gt;åŸç»„ä»¶&lt;/span&gt;) &#125;&#125;export default inheritHOC(myComponent);å¤åˆ¶ä»£ç composeåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€ä¸ªç»„ä»¶å¯èƒ½è¢«å¤šä¸ªHOCå¢å¼ºï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¢«æ‰€æœ‰çš„HOCå¢å¼ºåçš„ç»„ä»¶ï¼Œå€Ÿç”¨ä¸€å¼ è£…é¥°æ¨¡å¼çš„å›¾æ¥è¯´æ˜ï¼Œå¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼šå‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰loggerï¼Œvisibleï¼Œstyleç­‰å¤šä¸ªHOCï¼Œç°åœ¨è¦åŒæ—¶å¢å¼ºä¸€ä¸ªInputç»„ä»¶ï¼š12logger(visible(style(Input)))å¤åˆ¶ä»£ç è¿™ç§ä»£ç éå¸¸çš„éš¾ä»¥é˜…è¯»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°è£…ä¸€ä¸ªç®€å•çš„å‡½æ•°ç»„åˆå·¥å…·ï¼Œå°†å†™æ³•æ”¹å†™å¦‚ä¸‹ï¼š123const compose = (...fns) =&gt; fns.reduce((f, g) =&gt; (...args) =&gt; g(f(...args)));compose(logger,visible,style)(Input);å¤åˆ¶ä»£ç composeå‡½æ•°è¿”å›ä¸€ä¸ªæ‰€æœ‰å‡½æ•°ç»„åˆåçš„å‡½æ•°ï¼Œcompose(f, g, h) å’Œ (...args) =&gt; f(g(h(...args)))æ˜¯ä¸€æ ·çš„ã€‚å¾ˆå¤šç¬¬ä¸‰æ–¹åº“éƒ½æä¾›äº†ç±»ä¼¼composeçš„å‡½æ•°ï¼Œä¾‹å¦‚lodash.flowRightï¼ŒReduxæä¾›çš„combineReducerså‡½æ•°ç­‰ã€‚Decoratorsæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©ES7ä¸ºæˆ‘ä»¬æä¾›çš„Decoratorsæ¥è®©æˆ‘ä»¬çš„å†™æ³•å˜çš„æ›´åŠ ä¼˜é›…ï¼š1234567@logger@visible@styleclass Input extends Component &#123; // ...&#125;å¤åˆ¶ä»£ç Decoratorsæ˜¯ES7çš„ä¸€ä¸ªææ¡ˆï¼Œè¿˜æ²¡æœ‰è¢«æ ‡å‡†åŒ–ï¼Œä½†ç›®å‰Babelè½¬ç å™¨å·²ç»æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦æå‰é…ç½®babel-plugin-transform-decorators-legacyï¼š12&quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;]å¤åˆ¶ä»£ç è¿˜å¯ä»¥ç»“åˆä¸Šé¢çš„composeå‡½æ•°ä½¿ç”¨ï¼š123456const hoc = compose(logger, visible, style);@hocclass Input extends Component &#123; // ...&#125;å¤åˆ¶ä»£ç HOC çš„å®é™…åº”ç”¨ä¸‹é¢æ˜¯ä¸€äº›æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…å¯¹HOCçš„å®é™…åº”ç”¨åœºæ™¯ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç ç»è¿‡å¾ˆå¤šç®€åŒ–ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼šæ—¥å¿—æ‰“ç‚¹å®é™…ä¸Šè¿™å±äºä¸€ç±»æœ€å¸¸è§çš„åº”ç”¨ï¼Œå¤šä¸ªç»„ä»¶æ‹¥æœ‰ç±»ä¼¼çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¦å¯¹é‡å¤çš„é€»è¾‘è¿›è¡Œå¤ç”¨ï¼Œ å®˜æ–¹æ–‡æ¡£ä¸­CommentListçš„ç¤ºä¾‹ä¹Ÿæ˜¯è§£å†³äº†ä»£ç å¤ç”¨é—®é¢˜ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œæœ‰å…´è¶£å¯ä»¥ğŸ‘‡ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æŸäº›é¡µé¢éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ€§èƒ½æŒ‡æ ‡ç­‰ç­‰ï¼Œé€šè¿‡é«˜é˜¶ç»„ä»¶åšè¿™äº›äº‹æƒ…å¯ä»¥çœå»å¾ˆå¤šé‡å¤ä»£ç ã€‚12345678910111213141516171819function logHoc(WrappedComponent) &#123; return class extends Component &#123; componentWillMount() &#123; this.start = Date.now(); &#125; componentDidMount() &#123; this.end = Date.now(); console.log(`$&#123;WrappedComponent.dispalyName&#125; æ¸²æŸ“æ—¶é—´ï¼š$&#123;this.end - this.start&#125; ms`); console.log(`$&#123;user&#125;è¿›å…¥$&#123;WrappedComponent.dispalyName&#125;`); &#125; componentWillUnmount() &#123; console.log(`$&#123;user&#125;é€€å‡º$&#123;WrappedComponent.dispalyName&#125;`); &#125; render() &#123; return &lt;WrappedComponent &#123;...this.props&#125; /&gt; &#125; &#125;&#125;å¤åˆ¶ä»£ç å¯ç”¨ã€æƒé™æ§åˆ¶123456789101112function auth(WrappedComponent) &#123; return class extends Component &#123; render() &#123; const &#123; visible, auth, display = null, ...props &#125; = this.props; if (visible === false || (auth &amp;&amp; authList.indexOf(auth) === -1)) &#123; return display &#125; return &lt;WrappedComponent &#123;...props&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç authListæ˜¯æˆ‘ä»¬åœ¨è¿›å…¥ç¨‹åºæ—¶å‘åç«¯è¯·æ±‚çš„æ‰€æœ‰æƒé™åˆ—è¡¨ï¼Œå½“ç»„ä»¶æ‰€éœ€è¦çš„æƒé™ä¸åˆ—è¡¨ä¸­ï¼Œæˆ–è€…è®¾ç½®çš„ visibleæ˜¯falseï¼Œæˆ‘ä»¬å°†å…¶æ˜¾ç¤ºä¸ºä¼ å…¥çš„ç»„ä»¶æ ·å¼ï¼Œæˆ–è€…nullã€‚æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒçš„ç»„ä»¶åº”ç”¨HOCï¼š12345678 @auth class Input extends Component &#123; ... &#125; @auth class Button extends Component &#123; ... &#125; &lt;Button auth=&quot;user/addUser&quot;&gt;æ·»åŠ ç”¨æˆ·&lt;/Button&gt; &lt;Input auth=&quot;user/search&quot; visible=&#123;false&#125; &gt;æ·»åŠ ç”¨æˆ·&lt;/Input&gt;å¤åˆ¶ä»£ç åŒå‘ç»‘å®šåœ¨vueä¸­ï¼Œç»‘å®šä¸€ä¸ªå˜é‡åå¯å®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œå³è¡¨å•ä¸­çš„å€¼æ”¹å˜åç»‘å®šçš„å˜é‡ä¹Ÿä¼šè‡ªåŠ¨æ”¹å˜ã€‚è€ŒReactä¸­æ²¡æœ‰åšè¿™æ ·çš„å¤„ç†ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¡¨å•å…ƒç´ éƒ½æ˜¯éå—æ§ç»„ä»¶ã€‚ç»™è¡¨å•å…ƒç´ ç»‘å®šä¸€ä¸ªçŠ¶æ€åï¼Œå¾€å¾€éœ€è¦æ‰‹åŠ¨ä¹¦å†™onChangeæ–¹æ³•æ¥å°†å…¶æ”¹å†™ä¸ºå—æ§ç»„ä»¶ï¼Œåœ¨è¡¨å•å…ƒç´ éå¸¸å¤šçš„æƒ…å†µä¸‹è¿™äº›é‡å¤æ“ä½œæ˜¯éå¸¸ç—›è‹¦çš„ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©é«˜é˜¶ç»„ä»¶æ¥å®ç°ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šï¼Œä»£ç ç•¥é•¿ï¼Œå¯ä»¥ç»“åˆä¸‹é¢çš„æ€ç»´å¯¼å›¾è¿›è¡Œç†è§£ã€‚é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªFormç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨äºåŒ…è£¹æ‰€æœ‰éœ€è¦åŒ…è£¹çš„è¡¨å•ç»„ä»¶ï¼Œé€šè¿‡contexå‘å­ç»„ä»¶æš´éœ²ä¸¤ä¸ªå±æ€§ï¼šmodelï¼šå½“å‰Formç®¡æ§çš„æ‰€æœ‰æ•°æ®ï¼Œç”±è¡¨å•nameå’Œvalueç»„æˆï¼Œå¦‚{name:&#39;ConardLi&#39;,pwd:&#39;123&#39;}ã€‚modelå¯ç”±å¤–éƒ¨ä¼ å…¥ï¼Œä¹Ÿå¯è‡ªè¡Œç®¡æ§ã€‚changeModelï¼šæ”¹å˜modelä¸­æŸä¸ªnameçš„å€¼ã€‚12345678910111213141516171819202122232425262728293031323334353637383940class Form extends Component &#123; static childContextTypes = &#123; model: PropTypes.object, changeModel: PropTypes.func &#125; constructor(props, context) &#123; super(props, context); this.state = &#123; model: props.model || &#123;&#125; &#125;; &#125; componentWillReceiveProps(nextProps) &#123; if (nextProps.model) &#123; this.setState(&#123; model: nextProps.model &#125;) &#125; &#125; changeModel = (name, value) =&gt; &#123; this.setState(&#123; model: &#123; ...this.state.model, [name]: value &#125; &#125;) &#125; getChildContext() &#123; return &#123; changeModel: this.changeModel, model: this.props.model || this.state.model &#125;; &#125; onSubmit = () =&gt; &#123; console.log(this.state.model); &#125; render() &#123; return &lt;div&gt; &#123;this.props.children&#125; &lt;button onClick=&#123;this.onSubmit&#125;&gt;æäº¤&lt;/button&gt; &lt;/div&gt; &#125;&#125;å¤åˆ¶ä»£ç ä¸‹é¢å®šä¹‰ç”¨äºåŒå‘ç»‘å®šçš„HOCï¼Œå…¶ä»£ç†äº†è¡¨å•çš„onChangeå±æ€§å’Œvalueå±æ€§ï¼šå‘ç”ŸonChangeäº‹ä»¶æ—¶è°ƒç”¨ä¸Šå±‚Formçš„changeModelæ–¹æ³•æ¥æ”¹å˜contextä¸­çš„modelã€‚åœ¨æ¸²æŸ“æ—¶å°†valueæ”¹ä¸ºä»contextä¸­å–å‡ºçš„å€¼ã€‚123456789101112131415161718192021222324252627282930313233function proxyHoc(WrappedComponent) &#123; return class extends Component &#123; static contextTypes = &#123; model: PropTypes.object, changeModel: PropTypes.func &#125; onChange = (event) =&gt; &#123; const &#123; changeModel &#125; = this.context; const &#123; onChange &#125; = this.props; const &#123; v_model &#125; = this.props; changeModel(v_model, event.target.value); if(typeof onChange === &apos;function&apos;)&#123;onChange(event);&#125; &#125; render() &#123; const &#123; model &#125; = this.context; const &#123; v_model &#125; = this.props; return &lt;WrappedComponent &#123;...this.props&#125; value=&#123;model[v_model]&#125; onChange=&#123;this.onChange&#125; /&gt;; &#125; &#125;&#125;@proxyHocclass Input extends Component &#123; render() &#123; return &lt;input &#123;...this.props&#125;&gt;&lt;/input&gt; &#125;&#125;å¤åˆ¶ä»£ç ä¸Šé¢çš„ä»£ç åªæ˜¯ç®€ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œé™¤äº†inputï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†HOCåº”ç”¨åœ¨selectç­‰å…¶ä»–è¡¨å•ç»„ä»¶ï¼Œç”šè‡³è¿˜å¯ä»¥å°†ä¸Šé¢çš„HOCå…¼å®¹åˆ°spanã€tableç­‰å±•ç¤ºç»„ä»¶ï¼Œè¿™æ ·åšå¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ï¼Œè®©æˆ‘ä»¬çœå»äº†å¾ˆå¤šçŠ¶æ€ç®¡ç†çš„å·¥ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š1234567891011export default class extends Component &#123; render() &#123; return ( &lt;Form &gt; &lt;Input v_model=&quot;name&quot;&gt;&lt;/Input&gt; &lt;Input v_model=&quot;pwd&quot;&gt;&lt;/Input&gt; &lt;/Form&gt; ) &#125;&#125;å¤åˆ¶ä»£ç è¡¨å•æ ¡éªŒåŸºäºä¸Šé¢çš„åŒå‘ç»‘å®šçš„ä¾‹å­ï¼Œæˆ‘ä»¬å†æ¥ä¸€ä¸ªè¡¨å•éªŒè¯å™¨ï¼Œè¡¨å•éªŒè¯å™¨å¯ä»¥åŒ…å«éªŒè¯å‡½æ•°ä»¥åŠæç¤ºä¿¡æ¯ï¼Œå½“éªŒè¯ä¸é€šè¿‡æ—¶ï¼Œå±•ç¤ºé”™è¯¯ä¿¡æ¯ï¼š12345678910111213141516171819202122232425function validateHoc(WrappedComponent) &#123; return class extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; error: &apos;&apos; &#125; &#125; onChange = (event) =&gt; &#123; const &#123; validator &#125; = this.props; if (validator &amp;&amp; typeof validator.func === &apos;function&apos;) &#123; if (!validator.func(event.target.value)) &#123; this.setState(&#123; error: validator.msg &#125;) &#125; else &#123; this.setState(&#123; error: &apos;&apos; &#125;) &#125; &#125; &#125; render() &#123; return &lt;div&gt; &lt;WrappedComponent onChange=&#123;this.onChange&#125; &#123;...this.props&#125; /&gt; &lt;div&gt;&#123;this.state.error || &apos;&apos;&#125;&lt;/div&gt; &lt;/div&gt; &#125; &#125;&#125;å¤åˆ¶ä»£ç 1234567891011const validatorName = &#123; func: (val) =&gt; val &amp;&amp; !isNaN(val), msg: &apos;è¯·è¾“å…¥æ•°å­—&apos;&#125;const validatorPwd = &#123; func: (val) =&gt; val &amp;&amp; val.length &gt; 6, msg: &apos;å¯†ç å¿…é¡»å¤§äº6ä½&apos;&#125;&lt;HOCInput validator=&#123;validatorName&#125; v_model=&quot;name&quot;&gt;&lt;/HOCInput&gt;&lt;HOCInput validator=&#123;validatorPwd&#125; v_model=&quot;pwd&quot;&gt;&lt;/HOCInput&gt;å¤åˆ¶ä»£ç å½“ç„¶ï¼Œè¿˜å¯ä»¥åœ¨Formæäº¤çš„æ—¶å€™åˆ¤æ–­æ‰€æœ‰éªŒè¯å™¨æ˜¯å¦é€šè¿‡ï¼ŒéªŒè¯å™¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæ•°ç»„ç­‰ç­‰ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç è¢«ç®€åŒ–äº†å¾ˆå¤šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å®ç°ã€‚Redux çš„ connectredux ä¸­çš„connectï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªHOCï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„connectå®ç°ï¼š123456789101112131415161718192021222324252627282930313233343536373839export const connect = (mapStateToProps, mapDispatchToProps) =&gt; (WrappedComponent) =&gt; &#123; class Connect extends Component &#123; static contextTypes = &#123; store: PropTypes.object &#125; constructor () &#123; super() this.state = &#123; allProps: &#123;&#125; &#125; &#125; componentWillMount () &#123; const &#123; store &#125; = this.context this._updateProps() store.subscribe(() =&gt; this._updateProps()) &#125; _updateProps () &#123; const &#123; store &#125; = this.context let stateProps = mapStateToProps ? mapStateToProps(store.getState(), this.props): &#123;&#125; let dispatchProps = mapDispatchToProps? mapDispatchToProps(store.dispatch, this.props) : &#123;&#125; this.setState(&#123; allProps: &#123; ...stateProps, ...dispatchProps, ...this.props &#125; &#125;) &#125; render () &#123; return &lt;WrappedComponent &#123;...this.state.allProps&#125; /&gt; &#125; &#125; return Connect&#125;å¤åˆ¶ä»£ç ä»£ç éå¸¸æ¸…æ™°ï¼Œconnectå‡½æ•°å…¶å®å°±åšäº†ä¸€ä»¶äº‹ï¼Œå°†mapStateToPropså’ŒmapDispatchToPropsåˆ†åˆ«è§£æ„åä¼ ç»™åŸç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åŸç»„ä»¶å†…å°±å¯ä»¥ç›´æ¥ç”¨propsè·å–stateä»¥åŠdispatchå‡½æ•°äº†ã€‚ä½¿ç”¨ HOC çš„æ³¨æ„äº‹é¡¹å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´å½“æˆ‘ä»¬åº”ç”¨HOCå»å¢å¼ºå¦ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„ç»„ä»¶å·²ç»ä¸æ˜¯åŸç»„ä»¶äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿ä¸åˆ°åŸç»„ä»¶çš„ä»»ä½•é™æ€å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨HOCçš„ç»“å°¾æ‰‹åŠ¨æ‹·è´ä»–ä»¬ï¼š1234567891011function proxyHOC(WrappedComponent) &#123; class HOCComponent extends Component &#123; render() &#123; return &lt;WrappedComponent &#123;...this.props&#125; /&gt;; &#125; &#125; HOCComponent.staticMethod = WrappedComponent.staticMethod; // ... return HOCComponent;&#125;å¤åˆ¶ä»£ç å¦‚æœåŸç»„ä»¶æœ‰éå¸¸å¤šçš„é™æ€å±æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸ç—›è‹¦çš„ï¼Œè€Œä¸”ä½ éœ€è¦å»äº†è§£éœ€è¦å¢å¼ºçš„æ‰€æœ‰ç»„ä»¶çš„é™æ€å±æ€§æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ hoist-non-react-staticsæ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ‹·è´æ‰€æœ‰éReactçš„é™æ€æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š1234567891011import hoistNonReactStatic from &apos;hoist-non-react-statics&apos;;function proxyHOC(WrappedComponent) &#123; class HOCComponent extends Component &#123; render() &#123; return &lt;WrappedComponent &#123;...this.props&#125; /&gt;; &#125; &#125; hoistNonReactStatic(HOCComponent,WrappedComponent); return HOCComponent;&#125;å¤åˆ¶ä»£ç å‘Šè¯«â€”ä¼ é€’ refsä½¿ç”¨é«˜é˜¶ç»„ä»¶åï¼Œè·å–åˆ°çš„refå®é™…ä¸Šæ˜¯æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œè€ŒéåŸç»„ä»¶ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç”¨åˆ°åŸç»„ä»¶çš„refã€‚é«˜é˜¶ç»„ä»¶å¹¶ä¸èƒ½åƒé€ä¼ propsé‚£æ ·å°†refsé€ä¼ ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å®Œæˆrefçš„ä¼ é€’ï¼š1234567891011121314151617181920function hoc(WrappedComponent) &#123; return class extends Component &#123; getWrappedRef = () =&gt; this.wrappedRef; render() &#123; return &lt;WrappedComponent ref=&#123;ref =&gt; &#123; this.wrappedRef = ref &#125;&#125; &#123;...this.props&#125; /&gt;; &#125; &#125;&#125;@hocclass Input extends Component &#123; render() &#123; return &lt;input&gt;&lt;/input&gt; &#125;&#125;class App extends Component &#123; render() &#123; return ( &lt;Input ref=&#123;ref =&gt; &#123; this.inpitRef = ref.getWrappedRef() &#125;&#125; &gt;&lt;/Input&gt; ); &#125;&#125;å¤åˆ¶ä»£ç React 16.3ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ªforwardRef APIæ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œrefsä¼ é€’ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶ä¸Šè·å–çš„refå°±æ˜¯åŸç»„ä»¶çš„refäº†ï¼Œè€Œä¸éœ€è¦å†æ‰‹åŠ¨ä¼ é€’ï¼Œå¦‚æœä½ çš„Reactç‰ˆæœ¬å¤§äº16.3ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼:123456789101112function hoc(WrappedComponent) &#123; class HOC extends Component &#123; render() &#123; const &#123; forwardedRef, ...props &#125; = this.props; return &lt;WrappedComponent ref=&#123;forwardedRef&#125; &#123;...props&#125; /&gt;; &#125; &#125; return React.forwardRef((props, ref) =&gt; &#123; return &lt;HOC forwardedRef=&#123;ref&#125; &#123;...props&#125; /&gt;; &#125;);&#125;å¤åˆ¶ä»£ç å‘Šè¯«â€”ä¸è¦åœ¨ render æ–¹æ³•å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶React Diffç®—æ³•çš„åŸåˆ™æ˜¯ï¼šä½¿ç”¨ç»„ä»¶æ ‡è¯†ç¡®å®šæ˜¯å¸è½½è¿˜æ˜¯æ›´æ–°ç»„ä»¶å¦‚æœç»„ä»¶çš„å’Œå‰ä¸€æ¬¡æ¸²æŸ“æ—¶æ ‡è¯†æ˜¯ç›¸åŒçš„ï¼Œé€’å½’æ›´æ–°å­ç»„ä»¶å¦‚æœæ ‡è¯†ä¸åŒå¸è½½ç»„ä»¶é‡æ–°æŒ‚è½½æ–°ç»„ä»¶æ¯æ¬¡è°ƒç”¨é«˜é˜¶ç»„ä»¶ç”Ÿæˆçš„éƒ½æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ï¼Œç»„ä»¶çš„å”¯ä¸€æ ‡è¯†å“åº”çš„ä¹Ÿä¼šæ”¹å˜ï¼Œå¦‚æœåœ¨renderæ–¹æ³•è°ƒç”¨äº†é«˜é˜¶ç»„ä»¶ï¼Œè¿™ä¼šå¯¼è‡´ç»„ä»¶æ¯æ¬¡éƒ½ä¼šè¢«å¸è½½åé‡æ–°æŒ‚è½½ã€‚çº¦å®š - ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶å®˜æ–¹æ–‡æ¡£å¯¹é«˜é˜¶ç»„ä»¶çš„è¯´æ˜ï¼šé«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹çº¯å‡½æ•°çš„å®šä¹‰ï¼šå¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚ è¯¥å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡æˆ–æ•°æ®çªå˜ã€‚å¦‚æœæˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶å¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š12InputComponent.prototype.componentWillReceiveProps = function(nextProps) &#123; ... &#125;å¤åˆ¶ä»£ç è¿™æ ·å°±ç ´åäº†æˆ‘ä»¬å¯¹é«˜é˜¶ç»„ä»¶çš„çº¦å®šï¼ŒåŒæ—¶ä¹Ÿæ”¹å˜äº†ä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„åˆè¡·ï¼šæˆ‘ä»¬ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ˜¯ä¸ºäº†å¢å¼ºè€Œéæ”¹å˜åŸç»„ä»¶ã€‚çº¦å®š - é€ä¼ ä¸ç›¸å…³çš„ propsä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»£ç†æ‰€æœ‰çš„propsï¼Œä½†å¾€å¾€ç‰¹å®šçš„HOCåªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªpropsã€‚æˆ‘ä»¬éœ€è¦æŠŠå…¶ä»–ä¸ç›¸å…³çš„propsé€ä¼ ç»™åŸç»„ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š12345678910function visible(WrappedComponent) &#123; return class extends Component &#123; render() &#123; const &#123; visible, ...props &#125; = this.props; if (visible === false) return null; return &lt;WrappedComponent &#123;...props&#125; /&gt;; &#125; &#125;&#125;å¤åˆ¶ä»£ç æˆ‘ä»¬åªä½¿ç”¨visibleå±æ€§æ¥æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºå¯éšè—ï¼ŒæŠŠå…¶ä»–propsé€ä¼ ä¸‹å»ã€‚çº¦å®š - displayNameåœ¨ä½¿ç”¨React Developer Toolsè¿›è¡Œè°ƒè¯•æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†HOCï¼Œè°ƒè¯•ç•Œé¢å¯èƒ½å˜å¾—éå¸¸éš¾ä»¥é˜…è¯»ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š12345678910111213@visibleclass Show extends Component &#123; render() &#123; return &lt;h1&gt;æˆ‘æ˜¯ä¸€ä¸ªæ ‡ç­¾&lt;/h1&gt; &#125;&#125;@visibleclass Title extends Component &#123; render() &#123; return &lt;h1&gt;æˆ‘æ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/h1&gt; &#125;&#125;å¤åˆ¶ä»£ç ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¸ºHOCæŒ‡å®šä¸€ä¸ªdisplayNameï¼Œå®˜æ–¹æ¨èä½¿ç”¨HOCName(WrappedComponentName)ï¼š12static displayName = `Visible($&#123;WrappedComponent.displayName&#125;)`å¤åˆ¶ä»£ç è¿™ä¸ªçº¦å®šå¸®åŠ©ç¡®ä¿é«˜é˜¶ç»„ä»¶æœ€å¤§ç¨‹åº¦çš„çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚ä½¿ç”¨ HOC çš„åŠ¨æœºå›é¡¾ä¸‹ä¸Šæ–‡æåˆ°çš„ Mixin å¸¦æ¥çš„é£é™©ï¼šMixin å¯èƒ½ä¼šç›¸äº’ä¾èµ–ï¼Œç›¸äº’è€¦åˆï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤ä¸åŒçš„Mixinä¸­çš„æ–¹æ³•å¯èƒ½ä¼šç›¸äº’å†²çªMixinéå¸¸å¤šæ—¶ï¼Œç»„ä»¶æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œç”šè‡³è¿˜è¦ä¸ºå…¶åšç›¸å…³å¤„ç†ï¼Œè¿™æ ·ä¼šç»™ä»£ç é€ æˆæ»šé›ªçƒå¼çš„å¤æ‚æ€§è€ŒHOCçš„å‡ºç°å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ï¼šé«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œå„ä¸ªé«˜é˜¶ç»„ä»¶ä¸ä¼šäº’ç›¸ä¾èµ–è€¦åˆé«˜é˜¶ç»„ä»¶ä¹Ÿæœ‰å¯èƒ½é€ æˆå†²çªï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹é¿å…è¿™äº›è¡Œä¸ºé«˜é˜¶ç»„ä»¶å¹¶ä¸å…³å¿ƒæ•°æ®ä½¿ç”¨çš„æ–¹å¼å’ŒåŸå› ï¼Œè€Œè¢«åŒ…è£¹çš„ç»„ä»¶ä¹Ÿä¸å…³å¿ƒæ•°æ®æ¥è‡ªä½•å¤„ã€‚é«˜é˜¶ç»„ä»¶çš„å¢åŠ ä¸ä¼šä¸ºåŸç»„ä»¶å¢åŠ è´Ÿæ‹…HOC çš„ç¼ºé™·HOCéœ€è¦åœ¨åŸç»„ä»¶ä¸Šè¿›è¡ŒåŒ…è£¹æˆ–è€…åµŒå¥—ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨HOCï¼Œå°†ä¼šäº§ç”Ÿéå¸¸å¤šçš„åµŒå¥—ï¼Œè¿™è®©è°ƒè¯•å˜å¾—éå¸¸å›°éš¾ã€‚HOCå¯ä»¥åŠ«æŒpropsï¼Œåœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½é€ æˆå†²çªã€‚HooksHooksæ˜¯React v16.7.0-alphaä¸­åŠ å…¥çš„æ–°ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨classä»¥å¤–ä½¿ç”¨stateå’Œå…¶ä»–Reactç‰¹æ€§ã€‚ä½¿ç”¨Hooksï¼Œä½ å¯ä»¥åœ¨å°†å«æœ‰stateçš„é€»è¾‘ä»ç»„ä»¶ä¸­æŠ½è±¡å‡ºæ¥ï¼Œè¿™å°†å¯ä»¥è®©è¿™äº›é€»è¾‘å®¹æ˜“è¢«æµ‹è¯•ã€‚åŒæ—¶ï¼ŒHookså¯ä»¥å¸®åŠ©ä½ åœ¨ä¸é‡å†™ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨è¿™äº›é€»è¾‘ã€‚æ‰€ä»¥ï¼Œå®ƒä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§å®ç°çŠ¶æ€é€»è¾‘å¤ç”¨çš„æ–¹æ¡ˆã€‚é˜…è¯»ä¸‹é¢çš„ç« èŠ‚ä½¿ç”¨ Hook çš„åŠ¨æœºä½ å¯ä»¥å‘ç°ï¼Œå®ƒå¯ä»¥åŒæ—¶è§£å†³Mixinå’ŒHOCå¸¦æ¥çš„é—®é¢˜ã€‚å®˜æ–¹æä¾›çš„ HooksState Hookæˆ‘ä»¬è¦ä½¿ç”¨classç»„ä»¶å®ç°ä¸€ä¸ªè®¡æ•°å™¨åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™ï¼š1234567891011121314151617export default class Count extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; count: 0 &#125; &#125; render() &#123; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; &#123; this.setState(&#123; count: this.state.count + 1 &#125;) &#125;&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; ) &#125;&#125;å¤åˆ¶ä»£ç é€šè¿‡useStateï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ä¹Ÿèƒ½å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼š123456789101112export default function HookTest() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; &#123; setCount(count + 1); setNumber(number + 1); &#125;&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç useStateæ˜¯ä¸€ä¸ªé’©å­ï¼Œä»–å¯ä»¥ä¸ºå‡½æ•°å¼ç»„ä»¶å¢åŠ ä¸€äº›çŠ¶æ€ï¼Œå¹¶ä¸”æä¾›æ”¹å˜è¿™äº›çŠ¶æ€çš„å‡½æ•°ï¼ŒåŒæ—¶å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä½œä¸ºçŠ¶æ€çš„é»˜è®¤å€¼ã€‚Effect HookEffect Hook å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œä¸€äº›å…·æœ‰ side effectï¼ˆå‰¯ä½œç”¨ï¼‰çš„æ“ä½œå‚æ•°useEffectæ–¹æ³•æ¥æ”¶ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°ï¼šåœ¨ç¬¬ç»„ä»¶ä¸€æ¬¡renderå’Œä¹‹åçš„æ¯æ¬¡updateåè¿è¡Œï¼ŒReactä¿è¯åœ¨DOMå·²ç»æ›´æ–°å®Œæˆä¹‹åæ‰ä¼šè¿è¡Œå›è°ƒã€‚çŠ¶æ€ä¾èµ– (æ•°ç»„)ï¼šå½“é…ç½®äº†çŠ¶æ€ä¾èµ–é¡¹åï¼Œåªæœ‰æ£€æµ‹åˆ°é…ç½®çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ã€‚1234567 useEffect(() =&gt; &#123; // åªè¦ç»„ä»¶renderåå°±ä¼šæ‰§è¡Œ &#125;); useEffect(() =&gt; &#123; // åªæœ‰countæ”¹å˜æ—¶æ‰ä¼šæ‰§è¡Œ &#125;,[count]);å¤åˆ¶ä»£ç å›è°ƒè¿”å›å€¼useEffectçš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå½“é¡µé¢æ¸²æŸ“äº†ä¸‹ä¸€æ¬¡æ›´æ–°çš„ç»“æœåï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡useEffectä¹‹å‰ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¸¸å¸¸ç”¨æ¥å¯¹ä¸Šä¸€æ¬¡è°ƒç”¨useEffectè¿›è¡Œæ¸…ç†ã€‚123456789101112131415161718export default function HookTest() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; console.log(&apos;æ‰§è¡Œ...&apos;, count); return () =&gt; &#123; console.log(&apos;æ¸…ç†...&apos;, count); &#125; &#125;, [count]); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; &#123; setCount(count + 1); setNumber(number + 1); &#125;&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¹¶ç‚¹å‡»å‡ æ¬¡æŒ‰é’®ï¼Œä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼šæ³¨æ„ï¼Œå¦‚æœåŠ ä¸Šæµè§ˆå™¨æ¸²æŸ“çš„æƒ…å†µï¼Œç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š123456789101112 é¡µé¢æ¸²æŸ“...1 æ‰§è¡Œ... 1 é¡µé¢æ¸²æŸ“...2 æ¸…ç†... 1 æ‰§è¡Œ... 2 é¡µé¢æ¸²æŸ“...3 æ¸…ç†... 2 æ‰§è¡Œ... 3 é¡µé¢æ¸²æŸ“...4 æ¸…ç†... 3 æ‰§è¡Œ... 4å¤åˆ¶ä»£ç é‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨æµè§ˆå™¨æ¸²æŸ“å®Œåï¼Œå†æ‰§è¡Œæ¸…ç†çš„æ–¹æ³•è¿˜èƒ½æ‰¾åˆ°ä¸Šæ¬¡çš„stateå‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨useEffectä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™èƒ½ä¿è¯æˆ‘ä»¬ä¸Šä¸€æ¬¡æ‰§è¡Œå‡½æ•°å­˜å‚¨çš„å˜é‡ä¸è¢«é”€æ¯å’Œæ±¡æŸ“ã€‚ä½ å¯ä»¥å°è¯•ä¸‹é¢çš„ä»£ç å¯èƒ½æ›´å¥½ç†è§£1234567891011121314151617181920212223 var flag = 1; var clean; function effect(flag) &#123; return function () &#123; console.log(flag); &#125; &#125; clean = effect(flag); flag = 2; clean(); clean = effect(flag); flag = 3; clean(); clean = effect(flag); // æ‰§è¡Œç»“æœ effect... 1 clean... 1 effect... 2 clean... 2 effect... 3å¤åˆ¶ä»£ç æ¨¡æ‹Ÿ componentDidMountcomponentDidMountç­‰ä»·äºuseEffectçš„å›è°ƒä»…åœ¨é¡µé¢åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œä¸€æ¬¡ï¼Œå½“useEffectçš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„æ—¶å¯ä»¥å®ç°è¿™ä¸ªæ•ˆæœã€‚1234function useDidMount(callback) &#123; useEffect(callback, []);&#125;å¤åˆ¶ä»£ç å®˜æ–¹ä¸æ¨èä¸Šé¢è¿™ç§å†™æ³•ï¼Œå› ä¸ºè¿™æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›é”™è¯¯ã€‚æ¨¡æ‹Ÿ componentWillUnmount1234function useUnMount(callback) &#123; useEffect(() =&gt; callback, []);&#125;å¤åˆ¶ä»£ç ä¸åƒ componentDidMount æˆ–è€… componentDidUpdateï¼ŒuseEffect ä¸­ä½¿ç”¨çš„ effect å¹¶ä¸ä¼šé˜»æ»æµè§ˆå™¨æ¸²æŸ“é¡µé¢ã€‚è¿™è®©ä½ çš„ app çœ‹èµ·æ¥æ›´åŠ æµç•…ã€‚ref Hookä½¿ç”¨useRef Hookï¼Œä½ å¯ä»¥è½»æ¾çš„è·å–åˆ°domçš„refã€‚12345678910111213export default function Input() &#123; const inputEl = useRef(null); const onButtonClick = () =&gt; &#123; inputEl.current.focus(); &#125;; return ( &lt;div&gt; &lt;input ref=&#123;inputEl&#125; type=&quot;text&quot; /&gt; &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç æ³¨æ„useRef()å¹¶ä¸ä»…ä»…å¯ä»¥ç”¨æ¥å½“ä½œè·å–refä½¿ç”¨ï¼Œä½¿ç”¨useRefäº§ç”Ÿçš„refçš„currentå±æ€§æ˜¯å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨å®ƒæ¥ä¿å­˜ä¸€ä¸ªä»»æ„å€¼ã€‚æ¨¡æ‹Ÿ componentDidUpdatecomponentDidUpdateå°±ç›¸å½“äºé™¤å»ç¬¬ä¸€æ¬¡è°ƒç”¨çš„useEffectï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©useRefç”Ÿæˆä¸€ä¸ªæ ‡è¯†ï¼Œæ¥è®°å½•æ˜¯å¦ä¸ºç¬¬ä¸€æ¬¡æ‰§è¡Œï¼š123456789101112function useDidUpdate(callback, prop) &#123; const init = useRef(true); useEffect(() =&gt; &#123; if (init.current) &#123; init.current = false; &#125; else &#123; return callback(); &#125; &#125;, prop);&#125;å¤åˆ¶ä»£ç ä½¿ç”¨ Hook çš„æ³¨æ„äº‹é¡¹ä½¿ç”¨èŒƒå›´åªèƒ½åœ¨Reactå‡½æ•°å¼ç»„ä»¶æˆ–è‡ªå®šä¹‰Hookä¸­ä½¿ç”¨Hookã€‚Hookçš„æå‡ºä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³classç»„ä»¶çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨classç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚å£°æ˜çº¦æŸä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚Hooké€šè¿‡æ•°ç»„å®ç°çš„ï¼Œæ¯æ¬¡useState éƒ½ä¼šæ”¹å˜ä¸‹æ ‡ï¼ŒReactéœ€è¦åˆ©ç”¨è°ƒç”¨é¡ºåºæ¥æ­£ç¡®æ›´æ–°ç›¸åº”çš„çŠ¶æ€ï¼Œå¦‚æœuseState è¢«åŒ…è£¹å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­ï¼Œé‚£æ¯å°±å¯èƒ½ä¼šå¼•èµ·è°ƒç”¨é¡ºåºçš„é”™ä¹±ï¼Œä»è€Œé€ æˆæ„æƒ³ä¸åˆ°çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸ªeslintæ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬é¿å…è¿™äº›é—®é¢˜ã€‚1234567891011121314// å®‰è£…npm install eslint-plugin-react-hooks --save-dev// é…ç½®&#123; &quot;plugins&quot;: [ // ... &quot;react-hooks&quot; ], &quot;rules&quot;: &#123; // ... &quot;react-hooks/rules-of-hooks&quot;: &quot;error&quot; &#125;&#125;å¤åˆ¶ä»£ç è‡ªå®šä¹‰ Hookåƒä¸Šé¢ä»‹ç»çš„HOCå’Œmixinä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„Hookå°†ç»„ä»¶ä¸­ç±»ä¼¼çš„çŠ¶æ€é€»è¾‘æŠ½å–å‡ºæ¥ã€‚è‡ªå®šä¹‰Hookéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æŠŠç›¸åº”éœ€è¦çš„çŠ¶æ€å’Œeffectå°è£…è¿›å»ï¼ŒåŒæ—¶ï¼ŒHookä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥ç›¸äº’å¼•ç”¨çš„ã€‚ä½¿ç”¨useå¼€å¤´å‘½åè‡ªå®šä¹‰Hookï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿eslintè¿›è¡Œæ£€æŸ¥ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹å‡ ä¸ªå…·ä½“çš„Hookå°è£…ï¼šæ—¥å¿—æ‰“ç‚¹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢å°è£…çš„ç”Ÿå‘½å‘¨æœŸHookã€‚1234567891011121314151617const useLogger = (componentName, ...params) =&gt; &#123; useDidMount(() =&gt; &#123; console.log(`$&#123;componentName&#125;åˆå§‹åŒ–`, ...params); &#125;); useUnMount(() =&gt; &#123; console.log(`$&#123;componentName&#125;å¸è½½`, ...params); &#125;) useDidUpdate(() =&gt; &#123; console.log(`$&#123;componentName&#125;æ›´æ–°`, ...params); &#125;);&#125;;function Page1(props)&#123; useLogger(&apos;Page1&apos;,props); return (&lt;div&gt;...&lt;/div&gt;)&#125;å¤åˆ¶ä»£ç ä¿®æ”¹ titleæ ¹æ®ä¸åŒçš„é¡µé¢åç§°ä¿®æ”¹é¡µé¢title:1234567891011121314function useTitle(title) &#123; useEffect( () =&gt; &#123; document.title = title; return () =&gt; (document.title = &quot;ä¸»é¡µ&quot;); &#125;, [title] );&#125;function Page1(props)&#123; useTitle(&apos;Page1&apos;); return (&lt;div&gt;...&lt;/div&gt;)&#125;å¤åˆ¶ä»£ç åŒå‘ç»‘å®šæˆ‘ä»¬å°†è¡¨å•onChangeçš„é€»è¾‘æŠ½å–å‡ºæ¥å°è£…æˆä¸€ä¸ªHookï¼Œè¿™æ ·æ‰€æœ‰éœ€è¦è¿›è¡ŒåŒå‘ç»‘å®šçš„è¡¨å•ç»„ä»¶éƒ½å¯ä»¥è¿›è¡Œå¤ç”¨ï¼š123456789101112131415function useBind(init) &#123; let [value, setValue] = useState(init); let onChange = useCallback(function(event) &#123; setValue(event.currentTarget.value); &#125;, []); return &#123; value, onChange &#125;;&#125;function Page1(props)&#123; let value = useBind(&apos;&apos;); return &lt;input &#123;...value&#125; /&gt;;&#125;å¤åˆ¶ä»£ç å½“ç„¶ï¼Œä½ å¯ä»¥å‘ä¸Šé¢çš„HOCé‚£æ ·ï¼Œç»“åˆcontextå’Œformæ¥å°è£…ä¸€ä¸ªæ›´é€šç”¨çš„åŒå‘ç»‘å®šï¼Œæœ‰å…´è¶£å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸‹ã€‚ä½¿ç”¨ Hook çš„åŠ¨æœºå‡å°‘çŠ¶æ€é€»è¾‘å¤ç”¨çš„é£é™©Hookå’ŒMixinåœ¨ç”¨æ³•ä¸Šæœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯Mixinå¼•å…¥çš„é€»è¾‘å’ŒçŠ¶æ€æ˜¯å¯ä»¥ç›¸äº’è¦†ç›–çš„ï¼Œè€Œå¤šä¸ªHookä¹‹é—´äº’ä¸å½±å“ï¼Œè¿™è®©æˆ‘ä»¬ä¸éœ€è¦åœ¨æŠŠä¸€éƒ¨åˆ†ç²¾åŠ›æ”¾åœ¨é˜²æ­¢é¿å…é€»è¾‘å¤ç”¨çš„å†²çªä¸Šã€‚åœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä½¿ç”¨HOCä¹Ÿæœ‰å¯èƒ½å¸¦æ¥ä¸€å®šå†²çªï¼Œæ¯”å¦‚propsè¦†ç›–ç­‰ç­‰ï¼Œä½¿ç”¨Hookåˆ™å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚é¿å…åœ°ç‹±å¼åµŒå¥—å¤§é‡ä½¿ç”¨HOCçš„æƒ…å†µä¸‹è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—åµŒå¥—å±‚çº§éå¸¸æ·±ï¼Œä½¿ç”¨Hookï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ‰å¹³å¼çš„çŠ¶æ€é€»è¾‘å¤ç”¨ï¼Œè€Œé¿å…äº†å¤§é‡çš„ç»„ä»¶åµŒå¥—ã€‚è®©ç»„ä»¶æ›´å®¹æ˜“ç†è§£åœ¨ä½¿ç”¨classç»„ä»¶æ„å»ºæˆ‘ä»¬çš„ç¨‹åºæ—¶ï¼Œä»–ä»¬å„è‡ªæ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œä¸šåŠ¡é€»è¾‘çš„å¤æ‚ä½¿è¿™äº›ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œå„ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¼šè°ƒç”¨è¶Šæ¥è¶Šå¤šçš„é€»è¾‘ï¼Œè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚ä½¿ç”¨Hookï¼Œå¯ä»¥è®©ä½ æ›´å¤§é™åº¦çš„å°†å…¬ç”¨é€»è¾‘æŠ½ç¦»ï¼Œå°†ä¸€ä¸ªç»„ä»¶åˆ†å‰²æˆæ›´å°çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶åŸºäºç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿›è¡Œåˆ†å‰²ã€‚ä½¿ç”¨å‡½æ•°ä»£æ›¿ classç›¸æ¯”å‡½æ•°ï¼Œç¼–å†™ä¸€ä¸ªclasså¯èƒ½éœ€è¦æŒæ¡æ›´å¤šçš„çŸ¥è¯†ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹ä¹Ÿè¶Šå¤šï¼Œæ¯”å¦‚thisæŒ‡å‘ã€ç»‘å®šäº‹ä»¶ç­‰ç­‰ã€‚å¦å¤–ï¼Œè®¡ç®—æœºç†è§£ä¸€ä¸ªå‡½æ•°æ¯”ç†è§£ä¸€ä¸ªclassæ›´å¿«ã€‚Hooksè®©ä½ å¯ä»¥åœ¨classesä¹‹å¤–ä½¿ç”¨æ›´å¤šReactçš„æ–°ç‰¹æ€§ã€‚ç†æ€§çš„é€‰æ‹©å®é™…ä¸Šï¼ŒHookåœ¨react 16.8.0æ‰æ­£å¼å‘å¸ƒHookç¨³å®šç‰ˆæœ¬ï¼Œç¬”è€…ä¹Ÿè¿˜æœªåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œç›®å‰ç¬”è€…åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨çš„æœ€å¤šçš„æ˜¯HOCã€‚Reactå®˜æ–¹å®Œå…¨æ²¡æœ‰æŠŠclassesä»Reactä¸­ç§»é™¤çš„æ‰“ç®—ï¼Œclassç»„ä»¶å’ŒHookå®Œå…¨å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå®˜æ–¹ä¹Ÿå»ºè®®é¿å…ä»»ä½• â€œå¤§èŒƒå›´é‡æ„â€ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ å–œæ¬¢å®ƒï¼Œå¯ä»¥åœ¨æ–°çš„éå…³é”®æ€§çš„ä»£ç ä¸­ä½¿ç”¨Hookã€‚å°ç»“mixinå·²è¢«æŠ›å¼ƒï¼ŒHOCæ­£å½“å£®å¹´ï¼ŒHookåˆéœ²é”‹èŠ’ï¼Œå‰ç«¯åœˆå°±æ˜¯è¿™æ ·ï¼ŒæŠ€æœ¯è¿­ä»£é€Ÿåº¦éå¸¸ä¹‹å¿«ï¼Œä½†æˆ‘ä»¬åœ¨å­¦ä¹ è¿™äº›çŸ¥è¯†ä¹‹æ—¶ä¸€å®šè¦æ˜ç™½ä¸ºä»€ä¹ˆè¦å­¦ï¼Œå­¦äº†æœ‰æ²¡æœ‰ç”¨ï¼Œè¦ä¸è¦ç”¨ã€‚ä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œè°¢è°¢é˜…è¯»ã€‚æ¨èé˜…è¯»ã€React æ·±å…¥ã€‘setState çš„æ‰§è¡Œæœºåˆ¶ã€React æ·±å…¥ã€‘React äº‹ä»¶æœºåˆ¶]]></content>
  </entry>
  <entry>
    <title><![CDATA[30åˆ†é’Ÿç²¾é€šReact Hooks]]></title>
    <url>%2Farchives%2F66c2.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5be3ea136fb9a049f9121014ä½ è¿˜åœ¨ä¸ºè¯¥ä½¿ç”¨æ— çŠ¶æ€ç»„ä»¶ï¼ˆFunctionï¼‰è¿˜æ˜¯æœ‰çŠ¶æ€ç»„ä»¶ï¼ˆClassï¼‰è€Œçƒ¦æ¼å—ï¼Ÿ â€”â€”æ‹¥æœ‰äº† hooksï¼Œä½ å†ä¹Ÿä¸éœ€è¦å†™ Class äº†ï¼Œä½ çš„æ‰€æœ‰ç»„ä»¶éƒ½å°†æ˜¯ Functionã€‚ä½ è¿˜åœ¨ä¸ºæä¸æ¸…ä½¿ç”¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°è€Œæ—¥å¤œéš¾çœ å—ï¼Ÿ â€”â€”æ‹¥æœ‰äº† Hooksï¼Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å¯ä»¥å…ˆä¸¢ä¸€è¾¹äº†ã€‚ä½ åœ¨è¿˜åœ¨ä¸ºç»„ä»¶ä¸­çš„ this æŒ‡å‘è€Œæ™•å¤´è½¬å‘å—ï¼Ÿ â€”â€”æ—¢ç„¶ Class éƒ½ä¸¢æ‰äº†ï¼Œå“ªé‡Œè¿˜æœ‰ thisï¼Ÿä½ çš„äººç”Ÿç¬¬ä¸€æ¬¡ä¸å†éœ€è¦é¢å¯¹ thisã€‚è¿™æ ·çœ‹æ¥ï¼Œè¯´ React Hooks æ˜¯ä»Šå¹´æœ€åŠ²çˆ†çš„æ–°ç‰¹æ€§çœŸçš„æ¯«ä¸å¤¸å¼ ã€‚å¦‚æœä½ ä¹Ÿå¯¹ react æ„Ÿå…´è¶£ï¼Œæˆ–è€…æ­£åœ¨ä½¿ç”¨ react è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œç­”åº”æˆ‘ï¼Œè¯·ä¸€å®šæŠ½å‡ºè‡³å°‘ 30 åˆ†é’Ÿçš„æ—¶é—´æ¥é˜…è¯»æœ¬æ–‡å¥½å—ï¼Ÿä¸€ä¸ªæœ€ç®€å•çš„ Hooksé¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼š1234567891011121314151617181920class Example extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; count: 0 &#125;; &#125; render() &#123; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; ); &#125;&#125;å¤åˆ¶ä»£ç æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ hooks åçš„ç‰ˆæœ¬ï¼š123456789101112131415import &#123; useState &#125; from &apos;react&apos;;function Example() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ï¼å¯ä»¥çœ‹åˆ°ï¼ŒExampleå˜æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°å´æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆcountï¼‰ï¼ŒåŒæ—¶å®ƒè¿˜å¯ä»¥æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼ˆsetCountï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥è¿™ä¹ˆäº†ä¸å¾—ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ³¨å…¥äº†ä¸€ä¸ª hookâ€“useStateï¼Œå°±æ˜¯è¿™ä¸ª hook è®©æˆ‘ä»¬çš„å‡½æ•°å˜æˆäº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„å‡½æ•°ã€‚é™¤äº†useStateè¿™ä¸ª hook å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåˆ«çš„ hookï¼Œæ¯”å¦‚useEffectæä¾›äº†ç±»ä¼¼äºcomponentDidMountç­‰ç”Ÿå‘½å‘¨æœŸé’©å­çš„åŠŸèƒ½ï¼ŒuseContextæä¾›äº†ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰çš„åŠŸèƒ½ç­‰ç­‰ã€‚Hooks æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥ä¸ºä½ çš„å‡½æ•°å‹ç»„ä»¶ï¼ˆfunction componentï¼‰æ³¨å…¥ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚å’¦ï¼Ÿè¿™å¬èµ·æ¥æœ‰ç‚¹åƒè¢«è¯Ÿç—…çš„ Mixins å•Šï¼Ÿéš¾é“æ˜¯ Mixins è¦åœ¨ react ä¸­æ­»ç°å¤ç‡ƒäº†å—ï¼Ÿå½“ç„¶ä¸ä¼šäº†ï¼Œç­‰ä¼šæˆ‘ä»¬å†æ¥è°ˆä¸¤è€…çš„åŒºåˆ«ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¿™äº› hooks çš„ç›®æ ‡å°±æ˜¯è®©ä½ ä¸å†å†™ classï¼Œè®© function ä¸€ç»Ÿæ±Ÿæ¹–ã€‚React ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª Hooksï¼Ÿæƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼æˆ‘ä»¬éƒ½çŸ¥é“ react éƒ½æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå°†ä¸€ä¸ªé¡µé¢æ‹†æˆä¸€å †ç‹¬ç«‹çš„ï¼Œå¯å¤ç”¨çš„ç»„ä»¶ï¼Œå¹¶ä¸”ç”¨è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµçš„å½¢å¼å°†è¿™äº›ç»„ä»¶ä¸²è”èµ·æ¥ã€‚ä½†å‡å¦‚ä½ åœ¨å¤§å‹çš„å·¥ä½œé¡¹ç›®ä¸­ç”¨ reactï¼Œä½ ä¼šå‘ç°ä½ çš„é¡¹ç›®ä¸­å®é™…ä¸Šå¾ˆå¤š react ç»„ä»¶å†—é•¿ä¸”éš¾ä»¥å¤ç”¨ã€‚å°¤å…¶æ˜¯é‚£äº›å†™æˆ class çš„ç»„ä»¶ï¼Œå®ƒä»¬æœ¬èº«åŒ…å«äº†çŠ¶æ€ï¼ˆstateï¼‰ï¼Œæ‰€ä»¥å¤ç”¨è¿™ç±»ç»„ä»¶å°±å˜å¾—å¾ˆéº»çƒ¦ã€‚é‚£ä¹‹å‰ï¼Œå®˜æ–¹æ¨èæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰å’Œé«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentsï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®è·‘ä¸‹é¢˜ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸¤ç§æ¨¡å¼ã€‚æ¸²æŸ“å±æ€§æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„ prop æ¥ä¼ é€’éœ€è¦åŠ¨æ€æ¸²æŸ“çš„ nodes æˆ–ç»„ä»¶ã€‚å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„DataProviderç»„ä»¶åŒ…å«äº†æ‰€æœ‰è·ŸçŠ¶æ€ç›¸å…³çš„ä»£ç ï¼Œè€ŒCatç»„ä»¶åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„å±•ç¤ºå‹ç»„ä»¶ï¼Œè¿™æ ·ä¸€æ¥DataProviderå°±å¯ä»¥å•ç‹¬å¤ç”¨äº†ã€‚123456789101112131415161718192021import Cat from &apos;components/cat&apos;class DataProvider extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; target: &apos;Zac&apos; &#125;; &#125; render() &#123; return ( &lt;div&gt; &#123;this.props.render(this.state)&#125; &lt;/div&gt; ) &#125;&#125;&lt;DataProvider render=&#123;data =&gt; ( &lt;Cat target=&#123;data.target&#125; /&gt;)&#125;/&gt;å¤åˆ¶ä»£ç è™½ç„¶è¿™ä¸ªæ¨¡å¼å« Render Propsï¼Œä½†ä¸æ˜¯è¯´éç”¨ä¸€ä¸ªå« render çš„ props ä¸å¯ï¼Œä¹ æƒ¯ä¸Šå¤§å®¶æ›´å¸¸å†™æˆä¸‹é¢è¿™ç§ï¼š1234567...&lt;DataProvider&gt; &#123;data =&gt; ( &lt;Cat target=&#123;data.target&#125; /&gt; )&#125;&lt;/DataProvider&gt;å¤åˆ¶ä»£ç é«˜é˜¶ç»„ä»¶è¿™ä¸ªæ¦‚å¿µå°±æ›´å¥½ç†è§£äº†ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç»è¿‡ä¸€ç³»åˆ—åŠ å·¥åï¼Œæœ€åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚çœ‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼ŒwithUserå‡½æ•°å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å…·æœ‰äº†å®ƒæä¾›çš„è·å–ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½ã€‚12345678910111213const withUser = WrappedComponent =&gt; &#123; const user = sessionStorage.getItem(&quot;user&quot;); return props =&gt; &lt;WrappedComponent user=&#123;user&#125; &#123;...props&#125; /&gt;;&#125;;const UserPage = props =&gt; ( &lt;div class=&quot;user-container&quot;&gt; &lt;p&gt;My name is &#123;props.user&#125;!&lt;/p&gt; &lt;/div&gt;);export default withUser(UserPage);å¤åˆ¶ä»£ç ä»¥ä¸Šè¿™ä¸¤ç§æ¨¡å¼çœ‹ä¸Šå»éƒ½æŒºä¸é”™çš„ï¼Œå¾ˆå¤šåº“ä¹Ÿè¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ React Routerã€‚ä½†æˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸¤ç§æ¨¡å¼ï¼Œä¼šå‘ç°å®ƒä»¬ä¼šå¢åŠ æˆ‘ä»¬ä»£ç çš„å±‚çº§å…³ç³»ã€‚æœ€ç›´è§‚çš„ä½“ç°ï¼Œæ‰“å¼€ devtool çœ‹çœ‹ä½ çš„ç»„ä»¶å±‚çº§åµŒå¥—æ˜¯ä¸æ˜¯å¾ˆå¤¸å¼ å§ã€‚è¿™æ—¶å€™å†å›è¿‡å¤´çœ‹æˆ‘ä»¬ä¸Šä¸€èŠ‚ç»™å‡ºçš„ hooks ä¾‹å­ï¼Œæ˜¯ä¸æ˜¯ç®€æ´å¤šäº†ï¼Œæ²¡æœ‰å¤šä½™çš„å±‚çº§åµŒå¥—ã€‚æŠŠå„ç§æƒ³è¦çš„åŠŸèƒ½å†™æˆä¸€ä¸ªä¸€ä¸ªå¯å¤ç”¨çš„è‡ªå®šä¹‰ hookï¼Œå½“ä½ çš„ç»„ä»¶æƒ³ç”¨ä»€ä¹ˆåŠŸèƒ½æ—¶ï¼Œç›´æ¥åœ¨ç»„ä»¶é‡Œè°ƒç”¨è¿™ä¸ª hook å³å¯ã€‚ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼æˆ‘ä»¬é€šå¸¸å¸Œæœ›ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…ï¼Œä½†æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œé€šå¸¸åŒæ—¶åšäº†å¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨componentDidMountä¸­å‘èµ· ajax è¯·æ±‚è·å–æ•°æ®ï¼Œç»‘å®šä¸€äº›äº‹ä»¶ç›‘å¬ç­‰ç­‰ã€‚åŒæ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦åœ¨componentDidUpdateåšä¸€éåŒæ ·çš„äº‹æƒ…ã€‚å½“é¡¹ç›®å˜å¤æ‚åï¼Œè¿™ä¸€å—çš„ä»£ç ä¹Ÿå˜å¾—ä¸é‚£ä¹ˆç›´è§‚ã€‚classes çœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼æˆ‘ä»¬ç”¨ class æ¥åˆ›å»º react ç»„ä»¶æ—¶ï¼Œè¿˜æœ‰ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå°±æ˜¯ this çš„æŒ‡å‘é—®é¢˜ã€‚ä¸ºäº†ä¿è¯ this çš„æŒ‡å‘æ­£ç¡®ï¼Œæˆ‘ä»¬è¦ç»å¸¸å†™è¿™æ ·çš„ä»£ç ï¼šthis.handleClick = this.handleClick.bind(this)ï¼Œæˆ–è€…æ˜¯è¿™æ ·çš„ä»£ç ï¼š&lt;button onClick={() =&gt; this.handleClick(e)}&gt;ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸å°å¿ƒå¿˜äº†ç»‘å®š thisï¼Œå„ç§ bug å°±éšä¹‹è€Œæ¥ï¼Œå¾ˆéº»çƒ¦ã€‚è¿˜æœ‰ä¸€ä»¶è®©æˆ‘å¾ˆè‹¦æ¼çš„äº‹æƒ…ã€‚æˆ‘åœ¨ä¹‹å‰çš„ react ç³»åˆ—æ–‡ç« å½“ä¸­æ›¾ç»è¯´è¿‡ï¼Œå°½å¯èƒ½æŠŠä½ çš„ç»„ä»¶å†™æˆæ— çŠ¶æ€ç»„ä»¶çš„å½¢å¼ï¼Œå› ä¸ºå®ƒä»¬æ›´æ–¹ä¾¿å¤ç”¨ï¼Œå¯ç‹¬ç«‹æµ‹è¯•ã€‚ç„¶è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨ function å†™äº†ä¸€ä¸ªç®€æ´å®Œç¾çš„æ— çŠ¶æ€ç»„ä»¶ï¼Œåæ¥å› ä¸ºéœ€æ±‚å˜åŠ¨è¿™ä¸ªç»„ä»¶å¿…é¡»å¾—æœ‰è‡ªå·±çš„ stateï¼Œæˆ‘ä»¬åˆå¾—å¾ˆéº»çƒ¦çš„æŠŠ function æ”¹æˆ classã€‚åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒHooks ä¾¿æ¨ªç©ºå‡ºä¸–äº†ï¼ä»€ä¹ˆæ˜¯ State Hooksï¼Ÿå›åˆ°ä¸€å¼€å§‹æˆ‘ä»¬ç”¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ†è§£æ¥çœ‹åˆ°åº• state hooks åšäº†ä»€ä¹ˆï¼š123456789101112131415import &#123; useState &#125; from &apos;react&apos;;function Example() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡12345import &#123; useState &#125; from &apos;react&apos;;function Example() &#123; const [count, setCount] = useState(0);å¤åˆ¶ä»£ç useStateæ˜¯ react è‡ªå¸¦çš„ä¸€ä¸ª hook å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å£°æ˜çŠ¶æ€å˜é‡ã€‚useStateè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯æˆ‘ä»¬çš„çŠ¶æ€åˆå§‹å€¼ï¼ˆinitial stateï¼‰ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬[0]é¡¹æ˜¯å½“å‰å½“å‰çš„çŠ¶æ€å€¼ï¼Œç¬¬[1]é¡¹æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬åšçš„äº‹æƒ…å…¶å®å°±æ˜¯ï¼Œå£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ countï¼ŒæŠŠå®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥æ›´æ”¹ count çš„å‡½æ•° setCountã€‚ä¸Šé¢è¿™ç§è¡¨è¾¾å½¢å¼ï¼Œæ˜¯å€Ÿç”¨äº† es6 çš„æ•°ç»„è§£æ„ï¼ˆarray destructuringï¼‰ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚ä¸æ¸…æ¥šè¿™ç§ç”¨æ³•çš„å¯ä»¥å…ˆå»çœ‹ä¸‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  30 åˆ†é’ŸæŒæ¡ ES6/ES2015 æ ¸å¿ƒå†…å®¹ï¼ˆä¸Šï¼‰ã€‚å¦‚æœä¸ç”¨æ•°ç»„è§£æ„çš„è¯ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚å®é™…ä¸Šæ•°ç»„è§£æ„æ˜¯ä¸€ä»¶å¼€é”€å¾ˆå¤§çš„äº‹æƒ…ï¼Œç”¨ä¸‹é¢è¿™ç§å†™æ³•ï¼Œæˆ–è€…æ”¹ç”¨å¯¹è±¡è§£æ„ï¼Œæ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚å…·ä½“å¯ä»¥å»è¿™ç¯‡æ–‡ç« çš„åˆ†æ Array destructuring for multi-value returns (in light of React hooks)ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§å®˜æ–¹æ¨èä½¿ç”¨æ•°ç»„è§£æ„å°±å¥½ã€‚1234let _useState = useState(0);let count = _useState[0];let setCount = _useState[1];å¤åˆ¶ä»£ç è¯»å–çŠ¶æ€å€¼12&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;å¤åˆ¶ä»£ç æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€ count å°±æ˜¯ä¸€ä¸ªå•çº¯çš„å˜é‡è€Œå·²ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦å†™æˆ{this.state.count}è¿™æ ·äº†ã€‚æ›´æ–°çŠ¶æ€1234 &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt;å¤åˆ¶ä»£ç å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ setCount å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¿®æ”¹è¿‡çš„æ–°çŠ¶æ€å€¼ã€‚æ¥ä¸‹æ¥çš„äº‹æƒ…å°±äº¤ç»™ react äº†ï¼Œreact å°†ä¼šé‡æ–°æ¸²æŸ“æˆ‘ä»¬çš„ Example ç»„ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æ›´æ–°åçš„æ–°çš„çŠ¶æ€ï¼Œå³ count=1ã€‚è¿™é‡Œæˆ‘ä»¬è¦åœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼ŒExample æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå®ƒå¯ä»¥è®°ä½ä¹‹å‰çš„çŠ¶æ€ï¼Ÿä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜è¿™é‡Œæˆ‘ä»¬å°±å‘ç°äº†é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼Œå½“å‡½æ•°è¿è¡Œå®Œæˆåï¼Œè¿™ä¸ªå˜é‡ä¹Ÿå°±é”€æ¯äº†ï¼ˆè¿™é‡Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘é—­åŒ…ç­‰æƒ…å†µï¼‰ï¼Œæ¯”å¦‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š123456789function add(n) &#123; const result = 0; return result + 1;&#125;add(1); //1add(1); //1å¤åˆ¶ä»£ç ä¸ç®¡æˆ‘ä»¬åå¤è°ƒç”¨ add å‡½æ•°å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ 1ã€‚å› ä¸ºæ¯ä¸€æ¬¡æˆ‘ä»¬è°ƒç”¨ add æ—¶ï¼Œresult å˜é‡éƒ½æ˜¯ä»åˆå§‹å€¼ 0 å¼€å§‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆä¸Šé¢çš„ Example å‡½æ•°æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‹¿çš„ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œçš„çŠ¶æ€å€¼ä½œä¸ºåˆå§‹å€¼ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ˜¯ react å¸®æˆ‘ä»¬è®°ä½çš„ã€‚è‡³äº react æ˜¯ç”¨ä»€ä¹ˆæœºåˆ¶è®°ä½çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ€è€ƒä¸€ä¸‹ã€‚å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿé¦–å…ˆï¼ŒuseState æ˜¯å¯ä»¥å¤šæ¬¡è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å†™ï¼š12345function ExampleWithManyStates() &#123; const [age, setAge] = useState(42); const [fruit, setFruit] = useState(&apos;banana&apos;); const [todos, setTodos] = useState([&#123; text: &apos;Learn Hooks&apos; &#125;]);å¤åˆ¶ä»£ç å…¶æ¬¡ï¼ŒuseState æ¥æ”¶çš„åˆå§‹å€¼æ²¡æœ‰è§„å®šä¸€å®šè¦æ˜¯ string/number/boolean è¿™ç§ç®€å•æ•°æ®ç±»å‹ï¼Œå®ƒå®Œå…¨å¯ä»¥æ¥æ”¶å¯¹è±¡æˆ–è€…æ•°ç»„ä½œä¸ºå‚æ•°ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œä¹‹å‰æˆ‘ä»¬çš„this.setStateåšçš„æ˜¯åˆå¹¶çŠ¶æ€åè¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œè€ŒuseStateæ˜¯ç›´æ¥æ›¿æ¢è€çŠ¶æ€åè¿”å›æ–°çŠ¶æ€ã€‚æœ€åï¼Œreact ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª useReducer çš„ hookï¼Œå¦‚æœä½ æ›´å–œæ¬¢ redux å¼çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„è¯ã€‚ä» ExampleWithManyStates å‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒuseState æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬çœ‹ hook çš„ â€œå½¢æ€â€ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¹‹å‰è¢«å®˜æ–¹å¦å®šæ‰çš„ Mixins è¿™ç§æ–¹æ¡ˆï¼Œéƒ½æ˜¯æä¾›ä¸€ç§â€œæ’æ‹”å¼çš„åŠŸèƒ½æ³¨å…¥â€ çš„èƒ½åŠ›ã€‚è€Œ mixins ä¹‹æ‰€ä»¥è¢«å¦å®šï¼Œæ˜¯å› ä¸º Mixins æœºåˆ¶æ˜¯è®©å¤šä¸ª Mixins å…±äº«ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ç©ºé—´ï¼Œè¿™æ ·å°±å¾ˆéš¾ç¡®ä¿ä¸åŒ Mixins ä¾èµ–çš„çŠ¶æ€ä¸å‘ç”Ÿå†²çªã€‚è€Œç°åœ¨æˆ‘ä»¬çš„ hookï¼Œä¸€æ–¹é¢å®ƒæ˜¯ç›´æ¥ç”¨åœ¨ function å½“ä¸­ï¼Œè€Œä¸æ˜¯ classï¼›å¦ä¸€æ–¹é¢æ¯ä¸€ä¸ª hook éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸åŒç»„ä»¶è°ƒç”¨åŒä¸€ä¸ª hook ä¹Ÿèƒ½ä¿è¯å„è‡ªçŠ¶æ€çš„ç‹¬ç«‹æ€§ã€‚è¿™å°±æ˜¯ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«äº†ã€‚react æ˜¯æ€ä¹ˆä¿è¯å¤šä¸ª useState çš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿè¿˜æ˜¯çœ‹ä¸Šé¢ç»™å‡ºçš„ ExampleWithManyStates ä¾‹å­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸‰æ¬¡ useStateï¼Œæ¯æ¬¡æˆ‘ä»¬ä¼ çš„å‚æ•°åªæ˜¯ä¸€ä¸ªå€¼ï¼ˆå¦‚ 42ï¼Œâ€˜bananaâ€™ï¼‰ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å‘Šè¯‰ react è¿™äº›å€¼å¯¹åº”çš„ key æ˜¯å“ªä¸ªï¼Œé‚£ react æ˜¯æ€ä¹ˆä¿è¯è¿™ä¸‰ä¸ª useState æ‰¾åˆ°å®ƒå¯¹åº”çš„ state å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œreact æ˜¯æ ¹æ® useState å‡ºç°çš„é¡ºåºæ¥å®šçš„ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼š12345678910 //ç¬¬ä¸€æ¬¡æ¸²æŸ“ useState(42); //å°†ageåˆå§‹åŒ–ä¸º42 useState(&apos;banana&apos;); //å°†fruitåˆå§‹åŒ–ä¸ºbanana useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //... //ç¬¬äºŒæ¬¡æ¸²æŸ“ useState(42); //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰ useState(&apos;banana&apos;); //è¯»å–çŠ¶æ€å˜é‡fruitçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°bananaç›´æ¥è¢«å¿½ç•¥ï¼‰ useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //...å¤åˆ¶ä»£ç å‡å¦‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š1234567891011let showFruit = true;function ExampleWithManyStates() &#123; const [age, setAge] = useState(42); if(showFruit) &#123; const [fruit, setFruit] = useState(&apos;banana&apos;); showFruit = false; &#125; const [todos, setTodos] = useState([&#123; text: &apos;Learn Hooks&apos; &#125;]);å¤åˆ¶ä»£ç è¿™æ ·ä¸€æ¥ï¼Œ12345678910 //ç¬¬ä¸€æ¬¡æ¸²æŸ“ useState(42); //å°†ageåˆå§‹åŒ–ä¸º42 useState(&apos;banana&apos;); //å°†fruitåˆå§‹åŒ–ä¸ºbanana useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //... //ç¬¬äºŒæ¬¡æ¸²æŸ“ useState(42); //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰ // useState(&apos;banana&apos;); useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //è¯»å–åˆ°çš„å´æ˜¯çŠ¶æ€å˜é‡fruitçš„å€¼ï¼Œå¯¼è‡´æŠ¥é”™å¤åˆ¶ä»£ç é‰´äºæ­¤ï¼Œreact è§„å®šæˆ‘ä»¬å¿…é¡»æŠŠ hooks å†™åœ¨å‡½æ•°çš„æœ€å¤–å±‚ï¼Œä¸èƒ½å†™åœ¨ ifelse ç­‰æ¡ä»¶è¯­å¥å½“ä¸­ï¼Œæ¥ç¡®ä¿ hooks çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚ä»€ä¹ˆæ˜¯ Effect Hooks?æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çš„ä¾‹å­ä¸­å¢åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼š123456789101112131415161718192021import &#123; useState, useEffect &#125; from &apos;react&apos;;function Example() &#123; const [count, setCount] = useState(0); // ç±»ä¼¼äºcomponentDidMount å’Œ componentDidUpdate: useEffect(() =&gt; &#123; // æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜ document.title = `You clicked $&#123;count&#125; times`; &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¤åˆ¶ä»£ç æˆ‘ä»¬å¯¹æ¯”ç€çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ hooksï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå†™ï¼Ÿ1234567891011121314151617181920212223242526272829class Example extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; count: 0 &#125;; &#125; componentDidMount() &#123; document.title = `You clicked $&#123;this.state.count&#125; times`; &#125; componentDidUpdate() &#123; document.title = `You clicked $&#123;this.state.count&#125; times`; &#125; render() &#123; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; ); &#125;&#125;å¤åˆ¶ä»£ç æˆ‘ä»¬å†™çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œé€šå¸¸ä¼šäº§ç”Ÿå¾ˆå¤šçš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼Œæ¯”å¦‚å‘èµ· ajax è¯·æ±‚è·å–æ•°æ®ï¼Œæ·»åŠ ä¸€äº›ç›‘å¬çš„æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œï¼Œæ‰‹åŠ¨ä¿®æ”¹ dom ç­‰ç­‰ã€‚æˆ‘ä»¬ä¹‹å‰éƒ½æŠŠè¿™äº›å‰¯ä½œç”¨çš„å‡½æ•°å†™åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°é’©å­é‡Œï¼Œæ¯”å¦‚ componentDidMountï¼ŒcomponentDidUpdate å’Œ componentWillUnmountã€‚è€Œç°åœ¨çš„ useEffect å°±ç›¸å½“ä¸è¿™äº›å£°æ˜å‘¨æœŸå‡½æ•°é’©å­çš„é›†åˆä½“ã€‚å®ƒä»¥ä¸€æŠµä¸‰ã€‚åŒæ—¶ï¼Œç”±äºå‰æ–‡æ‰€è¯´ hooks å¯ä»¥åå¤å¤šæ¬¡ä½¿ç”¨ï¼Œç›¸äº’ç‹¬ç«‹ã€‚æ‰€ä»¥æˆ‘ä»¬åˆç†çš„åšæ³•æ˜¯ï¼Œç»™æ¯ä¸€ä¸ªå‰¯ä½œç”¨ä¸€ä¸ªå•ç‹¬çš„ useEffect é’©å­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›å‰¯ä½œç”¨ä¸å†ä¸€è‚¡è„‘å †åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œï¼Œä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ã€‚useEffect åšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å†æ¢³ç†ä¸€éä¸‹é¢ä»£ç çš„é€»è¾‘ï¼š1234567function Example() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; document.title = `You clicked $&#123;count&#125; times`; &#125;);å¤åˆ¶ä»£ç é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡countï¼Œå°†å®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ã€‚ç„¶åæˆ‘ä»¬å‘Šè¯‰ reactï¼Œæˆ‘ä»¬çš„è¿™ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ã€‚æˆ‘ä»¬ç»™useEffecthook ä¼ äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çš„å‰¯ä½œç”¨æ˜¯è°ƒç”¨ browser API æ¥ä¿®æ”¹æ–‡æ¡£æ ‡é¢˜ã€‚å½“ react è¦æ¸²æŸ“æˆ‘ä»¬çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šå…ˆè®°ä½æˆ‘ä»¬ç”¨åˆ°çš„å‰¯ä½œç”¨ã€‚ç­‰ react æ›´æ–°äº† DOM ä¹‹åï¼Œå®ƒå†ä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°ã€‚è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š ç¬¬ä¸€ï¼Œreact é¦–æ¬¡æ¸²æŸ“å’Œä¹‹åçš„æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ä¸€éä¼ ç»™ useEffect çš„å‡½æ•°ã€‚è€Œä¹‹å‰æˆ‘ä»¬è¦ç”¨ä¸¤ä¸ªå£°æ˜å‘¨æœŸå‡½æ•°æ¥åˆ†åˆ«è¡¨ç¤ºé¦–æ¬¡æ¸²æŸ“ï¼ˆcomponentDidMountï¼‰ï¼Œå’Œä¹‹åçš„æ›´æ–°å¯¼è‡´çš„é‡æ–°æ¸²æŸ“ï¼ˆcomponentDidUpdateï¼‰ã€‚ç¬¬äºŒï¼ŒuseEffect ä¸­å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¸ä¼šé˜»ç¢æµè§ˆå™¨æ›´æ–°è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè€Œä¹‹å‰çš„ componentDidMount æˆ– componentDidUpdate ä¸­çš„ä»£ç åˆ™æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚è¿™ç§å®‰æ’å¯¹å¤§å¤šæ•°å‰¯ä½œç”¨è¯´éƒ½æ˜¯åˆç†çš„ï¼Œä½†æœ‰çš„æƒ…å†µé™¤å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å…ˆæ ¹æ® DOM è®¡ç®—å‡ºæŸä¸ªå…ƒç´ çš„å°ºå¯¸å†é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¸Œæœ›è¿™æ¬¡é‡æ–°æ¸²æŸ“æ˜¯åŒæ­¥å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåœ¨æµè§ˆå™¨çœŸçš„å»ç»˜åˆ¶è¿™ä¸ªé¡µé¢å‰å‘ç”Ÿã€‚useEffect æ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨è¿™ç§åœºæ™¯å¾ˆå¸¸è§ï¼Œå½“æˆ‘ä»¬åœ¨ componentDidMount é‡Œæ·»åŠ äº†ä¸€ä¸ªæ³¨å†Œï¼Œæˆ‘ä»¬å¾—é©¬ä¸Šåœ¨ componentWillUnmount ä¸­ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶è¢«æ³¨é”€ä¹‹å‰æ¸…é™¤æ‰æˆ‘ä»¬æ·»åŠ çš„æ³¨å†Œï¼Œå¦åˆ™å†…å­˜æ³„æ¼çš„é—®é¢˜å°±å‡ºç°äº†ã€‚æ€ä¹ˆæ¸…é™¤å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¼ ç»™ useEffect çš„å‰¯ä½œç”¨å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å³å¯ã€‚è¿™ä¸ªæ–°çš„å‡½æ•°å°†ä¼šåœ¨ç»„ä»¶ä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚è¿™ç§æ¨¡å¼åœ¨ä¸€äº› pubsub æ¨¡å¼çš„å®ç°ä¸­å¾ˆå¸¸è§ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š1234567891011121314151617181920212223import &#123; useState, useEffect &#125; from &apos;react&apos;;function FriendStatus(props) &#123; const [isOnline, setIsOnline] = useState(null); function handleStatusChange(status) &#123; setIsOnline(status.isOnline); &#125; useEffect(() =&gt; &#123; ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange); // ä¸€å®šæ³¨æ„ä¸‹è¿™ä¸ªé¡ºåºï¼šå‘Šè¯‰reactåœ¨ä¸‹æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼ŒåŒæ—¶æ˜¯ä¸‹æ¬¡è°ƒç”¨ChatAPI.subscribeToFriendStatusä¹‹å‰æ‰§è¡Œcleanup return function cleanup() &#123; ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange); &#125;; &#125;); if (isOnline === null) &#123; return &apos;Loading...&apos;; &#125; return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;&#125;å¤åˆ¶ä»£ç è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹éœ€è¦é‡è§†ï¼è¿™ç§è§£ç»‘çš„æ¨¡å¼è·Ÿ componentWillUnmount ä¸ä¸€æ ·ã€‚componentWillUnmount åªä¼šåœ¨ç»„ä»¶è¢«é”€æ¯å‰æ‰§è¡Œä¸€æ¬¡è€Œå·²ï¼Œè€Œ useEffect é‡Œçš„å‡½æ•°ï¼Œæ¯æ¬¡ç»„ä»¶æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œä¸€éï¼ŒåŒ…æ‹¬å‰¯ä½œç”¨å‡½æ•°è¿”å›çš„è¿™ä¸ªæ¸…ç†å‡½æ•°ä¹Ÿä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªé—®é¢˜ã€‚ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä»¥å‰çš„æ¨¡å¼ï¼š1234567891011121314 componentDidMount() &#123; ChatAPI.subscribeToFriendStatus( this.props.friend.id, this.handleStatusChange ); &#125; componentWillUnmount() &#123; ChatAPI.unsubscribeFromFriendStatus( this.props.friend.id, this.handleStatusChange ); &#125;å¤åˆ¶ä»£ç å¾ˆæ¸…é™¤ï¼Œæˆ‘ä»¬åœ¨ componentDidMount æ³¨å†Œï¼Œå†åœ¨ componentWillUnmount æ¸…é™¤æ³¨å†Œã€‚ä½†å‡å¦‚è¿™æ—¶å€™props.friend.idå˜äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸å¾—ä¸å†æ·»åŠ ä¸€ä¸ª componentDidUpdate æ¥å¤„ç†è¿™ç§æƒ…å†µï¼š123456789101112131415... componentDidUpdate(prevProps) &#123; // å…ˆæŠŠä¸Šä¸€ä¸ªfriend.idè§£ç»‘ ChatAPI.unsubscribeFromFriendStatus( prevProps.friend.id, this.handleStatusChange ); // å†é‡æ–°æ³¨å†Œæ–°ä½†friend.id ChatAPI.subscribeToFriendStatus( this.props.friend.id, this.handleStatusChange ); &#125;...å¤åˆ¶ä»£ç çœ‹åˆ°äº†å—ï¼Ÿå¾ˆç¹çï¼Œè€Œæˆ‘ä»¬ä½† useEffect åˆ™æ²¡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°åéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š1234567891.é¡µé¢é¦–æ¬¡æ¸²æŸ“2.æ›¿friend.id=1çš„æœ‹å‹æ³¨å†Œ3.çªç„¶friend.idå˜æˆäº†24.é¡µé¢é‡æ–°æ¸²æŸ“5.æ¸…é™¤friend.id=1çš„ç»‘å®š6.æ›¿friend.id=2çš„æœ‹å‹æ³¨å†Œ...å¤åˆ¶ä»£ç æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°æŒ‰ç…§ä¸Šä¸€èŠ‚çš„æ€è·¯ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½è¦æ‰§è¡Œä¸€éè¿™äº›å‰¯ä½œç”¨å‡½æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸ç»æµçš„ã€‚æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„è®¡ç®—å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç»™ useEffect ä¼ ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥å‘Šè¯‰ react åªæœ‰å½“è¿™ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œæˆ‘ä»¬ä¼ çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚1234useEffect(() =&gt; &#123; document.title = `You clicked $&#123;count&#125; times`;&#125;, [count]); // åªæœ‰å½“countçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ`document.title`è¿™ä¸€å¥å¤åˆ¶ä»£ç å½“æˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ ä¸€ä¸ªç©ºæ•°ç»„ [] æ—¶ï¼Œå…¶å®å°±ç›¸å½“äºåªåœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯ componentDidMount åŠ  componentWillUnmount çš„æ¨¡å¼ã€‚ä¸è¿‡è¿™ç§ç”¨æ³•å¯èƒ½å¸¦æ¥ bugï¼Œå°‘ç”¨ã€‚è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„ Effect Hooks?é™¤äº†ä¸Šæ–‡é‡ç‚¹ä»‹ç»çš„ useState å’Œ useEffectï¼Œreact è¿˜ç»™æˆ‘ä»¬æä¾›æ¥å¾ˆå¤šæœ‰ç”¨çš„ hooksï¼šuseContext useReducer useCallback useMemo useRef useImperativeMethods useMutationEffect useLayoutEffectæˆ‘ä¸å†ä¸€ä¸€ä»‹ç»ï¼Œå¤§å®¶è‡ªè¡Œå»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚æ€ä¹ˆå†™è‡ªå®šä¹‰çš„ Effect Hooks?ä¸ºä»€ä¹ˆè¦è‡ªå·±å»å†™ä¸€ä¸ª Effect Hooks? è¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠå¯ä»¥å¤ç”¨çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªä¸ªå¯ä»¥éšæ„æ’æ‹”çš„ â€œæ’é”€â€ï¼Œå“ªä¸ªç»„ä»¶è¦ç”¨æ¥ï¼Œæˆ‘å°±æ’è¿›å“ªä¸ªç»„ä»¶é‡Œï¼Œso easyï¼çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œä½ å°±æ˜ç™½äº†ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢å†™çš„ FriendStatus ç»„ä»¶ä¸­åˆ¤æ–­æœ‹å‹æ˜¯å¦åœ¨çº¿çš„åŠŸèƒ½æŠ½å‡ºæ¥ï¼Œæ–°å»ºä¸€ä¸ª useFriendStatus çš„ hook ä¸“é—¨ç”¨æ¥åˆ¤æ–­æŸä¸ª id æ˜¯å¦åœ¨çº¿ã€‚12345678910111213141516171819import &#123; useState, useEffect &#125; from &apos;react&apos;;function useFriendStatus(friendID) &#123; const [isOnline, setIsOnline] = useState(null); function handleStatusChange(status) &#123; setIsOnline(status.isOnline); &#125; useEffect(() =&gt; &#123; ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange); &#125;; &#125;); return isOnline;&#125;å¤åˆ¶ä»£ç è¿™æ—¶å€™ FriendStatus ç»„ä»¶å°±å¯ä»¥ç®€å†™ä¸ºï¼š123456789function FriendStatus(props) &#123; const isOnline = useFriendStatus(props.friend.id); if (isOnline === null) &#123; return &apos;Loading...&apos;; &#125; return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;&#125;å¤åˆ¶ä»£ç ç®€ç›´ Perfectï¼å‡å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆæœ‰ä¸€ä¸ªæœ‹å‹åˆ—è¡¨ä¹Ÿéœ€è¦æ˜¾ç¤ºæ˜¯å¦åœ¨çº¿çš„ä¿¡æ¯ï¼š12345678910function FriendListItem(props) &#123; const isOnline = useFriendStatus(props.friend.id); return ( &lt;li style=&#123;&#123; color: isOnline ? &apos;green&apos; : &apos;black&apos; &#125;&#125;&gt; &#123;props.friend.name&#125; &lt;/li&gt; );&#125;å¤åˆ¶ä»£ç ç®€ç›´ Fabulous!ç»“å°¾ä¸çŸ¥é“ä½ é˜…è¯»å®Œæ•´ç¯‡æ–‡ç« çš„æ„Ÿå—å¦‚ä½•ï¼Œæˆ–è€…å¯¹ hooks æœ‰ä»»ä½•è§’åº¦çš„çœ‹æ³•å’Œæ€è€ƒéƒ½æ¬¢è¿åœ¨è¯„è®ºåŒºä¸€èµ·è®¨è®ºã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[Git è®¾ç½®ä»£ç†å’Œå–æ¶ˆä»£ç†]]></title>
    <url>%2Farchives%2Fa16d.html</url>
    <content type="text"><![CDATA[å¦‚æœä»£ç†ç±»å‹æ˜¯ socks5 è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ï¼š12git config --global http.proxy socks5://127.0.0.1:1080git config --global https.proxy socks5://127.0.0.1:1080å¦‚æœæ˜¯æ™®é€šçš„ http/https è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ï¼š12git config --global https.proxy http://127.0.0.1:1080git config --global https.proxy https://127.0.0.1:1080å–æ¶ˆä»£ç†è®¾ç½®ï¼š12git config --global --unset http.proxygit config --global --unset https.proxy]]></content>
  </entry>
  <entry>
    <title><![CDATA[æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘]]></title>
    <url>%2Farchives%2F6df4.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://juejin.im/post/5d045350f265da1b695d5bf2æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« ğŸ™ã€‚React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®ä¹Ÿé€‚ç”¨äºå…¶ä»–è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œè¿™ä¸‰ä¸ªæ–¹å‘åˆ†åˆ«æ˜¯:å‡å°‘è®¡ç®—çš„é‡ã€‚ -&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ æˆ–è€… é™ä½ç»„ä»¶æ¸²æŸ“çš„å¤æ‚åº¦åˆ©ç”¨ç¼“å­˜ã€‚-&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯å¦‚ä½•é¿å…é‡æ–°æ¸²æŸ“ï¼Œåˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ memo æ–¹å¼æ¥é¿å…ç»„ä»¶é‡æ–°æ¸²æŸ“ç²¾ç¡®é‡æ–°è®¡ç®—çš„èŒƒå›´ã€‚ å¯¹åº”åˆ° React ä¸­å°±æ˜¯ç»‘å®šç»„ä»¶å’ŒçŠ¶æ€å…³ç³», ç²¾ç¡®åˆ¤æ–­æ›´æ–°çš„â€™æ—¶æœºâ€™å’Œâ€™èŒƒå›´â€™. åªé‡æ–°æ¸²æŸ“â€™è„â€™çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´é™ä½æ¸²æŸ“èŒƒå›´ç›®å½•å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ / é™ä½æ¸²æŸ“è®¡ç®—é‡ (å¤æ‚åº¦)0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆé¿å…é‡æ–°æ¸²æŸ“0ï¸âƒ£ ç®€åŒ– props1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨2ï¸âƒ£ ä¸å¯å˜æ•°æ®3ï¸âƒ£ ç®€åŒ– state4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹ç²¾ç»†åŒ–æ¸²æŸ“0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Contextæ‰©å±•å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ / é™ä½æ¸²æŸ“è®¡ç®—é‡ (å¤æ‚åº¦)é¦–å…ˆä»è®¡ç®—çš„é‡ä¸Šä¸‹åŠŸå¤«ï¼Œå‡å°‘èŠ‚ç‚¹æ¸²æŸ“çš„æ•°é‡æˆ–è€…é™ä½æ¸²æŸ“çš„è®¡ç®—é‡å¯ä»¥æ˜¾è‘—çš„æé«˜ç»„ä»¶æ¸²æŸ“æ€§èƒ½ã€‚0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—æ¯”å¦‚ä¸è¦åœ¨æ¸²æŸ“å‡½æ•° (render) ä¸­è¿›è¡Œæ•°ç»„æ’åºã€æ•°æ®è½¬æ¢ã€è®¢é˜…äº‹ä»¶ã€åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ç­‰ç­‰. æ¸²æŸ“å‡½æ•°ä¸­ä¸åº”è¯¥æ”¾ç½®å¤ªå¤šå‰¯ä½œç”¨1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—æˆ‘ä»¬å›¢é˜Ÿæ˜¯é‡åº¦çš„ styled-components ç”¨æˆ·ï¼Œå…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦è¿™ä¸ªç©æ„ï¼Œæ¯”å¦‚çº¯é™æ€çš„æ ·å¼è§„åˆ™ï¼Œä»¥åŠéœ€è¦é‡åº¦æ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ã€‚é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œå¦å¤–ä¸€ä¸ªå›°æ‰°æˆ‘ä»¬çš„æ˜¯å®ƒå¸¦æ¥çš„èŠ‚ç‚¹åµŒå¥—åœ°ç‹± (å¦‚ä¸Šå›¾)ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç†æ€§åœ°é€‰æ‹©ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ä½¿ç”¨åŸç”Ÿçš„ CSSï¼Œå‡å°‘ React è¿è¡Œæ—¶çš„è´Ÿæ‹….ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶ / RenderProps å¯¼è‡´çš„ã€‚æ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯â€˜åªæœ‰åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ xxxâ€™ã€‚ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶ / RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨è™šæ‹Ÿåˆ—è¡¨æ˜¯å¸¸è§çš„â€˜é•¿åˆ—è¡¨â€™å’Œâ€™å¤æ‚ç»„ä»¶æ ‘â€™ä¼˜åŒ–æ–¹å¼ï¼Œå®ƒä¼˜åŒ–çš„æœ¬è´¨å°±æ˜¯å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚è™šæ‹Ÿåˆ—è¡¨åªæ¸²æŸ“å½“å‰è§†å£å¯è§å…ƒç´ :è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“æ€§èƒ½å¯¹æ¯”:è™šæ‹Ÿåˆ—è¡¨å¸¸ç”¨äºä»¥ä¸‹ç»„ä»¶åœºæ™¯:æ— é™æ»šåŠ¨åˆ—è¡¨ï¼Œgrid, è¡¨æ ¼ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼Œspreadsheetsæ— é™åˆ‡æ¢çš„æ—¥å†æˆ–è½®æ’­å›¾å¤§æ•°æ®é‡æˆ–æ— é™åµŒå¥—çš„æ ‘èŠå¤©çª—ï¼Œæ•°æ®æµ (feed), æ—¶é—´è½´ç­‰ç­‰ç›¸å…³ç»„ä»¶æ–¹æ¡ˆ:react-virtualizedreact-window æ›´è½»é‡çš„ react-virtualized, åŒå‡ºä¸€ä¸ªä½œè€…æ›´å¤šæ‰©å±•ï¼šCreating more efficient React views with windowingRendering large lists with react-window3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“æƒ°æ€§æ¸²æŸ“çš„åˆè¡·æœ¬è´¨ä¸Šå’Œè™šè¡¨ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªåœ¨å¿…è¦æ—¶æ‰å»æ¸²æŸ“å¯¹åº”çš„èŠ‚ç‚¹ã€‚ä¸¾ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸¸ç”¨ Tab ç»„ä»¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸€å¼€å§‹å°±å°†æ‰€æœ‰ Tab çš„ panel éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œæ˜¯ç­‰åˆ°è¯¥ Tab è¢«æ¿€æ´»æ—¶æ‰å»æƒ°æ€§æ¸²æŸ“ã€‚è¿˜æœ‰å¾ˆå¤šåœºæ™¯ä¼šç”¨åˆ°æƒ°æ€§æ¸²æŸ“ï¼Œä¾‹å¦‚æ ‘å½¢é€‰æ‹©å™¨ï¼Œæ¨¡æ€å¼¹çª—ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼ŒæŠ˜å ç»„ä»¶ç­‰ç­‰ã€‚è¿™é‡Œå°±ä¸ä¸¾å…·ä½“çš„ä»£ç ä¾‹å­äº†ï¼Œç•™ç»™è¯»è€…å»æ€è€ƒ.4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆå¦‚å›¾ (å›¾ç‰‡æ¥æºäº THE PERFORMANCE OF STYLED REACT COMPONENTS), è¿™ä¸ªå›¾ç‰‡æ˜¯ 17 å¹´çš„äº†ï¼Œä½†æ˜¯å¤§æŠµçš„è¶‹åŠ¿è¿˜æ˜¯è¿™æ ·ã€‚æ‰€ä»¥åœ¨æ ·å¼è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼šCSS &gt; å¤§éƒ¨åˆ†CSS-in-js &gt; inline styleé¿å…é‡æ–°æ¸²æŸ“å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ä¹Ÿæ˜¯ React ç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹å‘. ä¸ºäº†é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“éœ€è¦åœ¨åšåˆ°ä¸¤ç‚¹:ä¿è¯ç»„ä»¶çº¯ç²¹æ€§ã€‚å³æ§åˆ¶ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œå¦‚æœç»„ä»¶æœ‰å‰¯ä½œç”¨åˆ™æ— æ³•å®‰å…¨åœ°ç¼“å­˜æ¸²æŸ“ç»“æœé€šè¿‡shouldComponentUpdateç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¥æ¯”å¯¹ state å’Œ props, ç¡®å®šæ˜¯å¦è¦é‡æ–°æ¸²æŸ“ã€‚å¯¹äºå‡½æ•°ç»„ä»¶å¯ä»¥ä½¿ç”¨React.memoåŒ…è£…å¦å¤–è¿™äº›æªæ–½ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ›´å®¹æ˜“åœ°ä¼˜åŒ–ç»„ä»¶é‡æ–°æ¸²æŸ“:0ï¸âƒ£ ç®€åŒ– propsâ‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£. â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“shallowCompareæ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•.ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, ä¸ºäº†åˆ¤æ–­åˆ—è¡¨é¡¹æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œè¿™é‡Œä¼ å…¥äº†ä¸€ä¸ªå½“å‰æ¿€æ´»çš„ id:è¿™æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´» id å˜åŠ¨ï¼Œæ‰€æœ‰åˆ—è¡¨é¡¹éƒ½ä¼šé‡æ–°åˆ·æ–°. æ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼activedè¿™æ ·çš„å¸ƒå°”å€¼ prop. actived ç°åœ¨åªæœ‰ä¸¤ç§å˜åŠ¨æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´æ¿€æ´» id çš„å˜åŠ¨ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“.ç®€åŒ–çš„ props æ›´å®¹æ˜“ç†è§£, ä¸”å¯ä»¥æé«˜ç»„ä»¶ç¼“å­˜çš„å‘½ä¸­ç‡1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨â‘ é¿å…ä½¿ç”¨ç®­å¤´å‡½æ•°å½¢å¼çš„äº‹ä»¶å¤„ç†å™¨, ä¾‹å¦‚:12&lt;ComplexComponent onClick=&#123;evt =&gt; onClick(evt.id)&#125; otherProps=&#123;values&#125; /&gt;å¤åˆ¶ä»£ç å‡è®¾ ComplexComponent æ˜¯ä¸€ä¸ªå¤æ‚çš„ PureComponent, è¿™é‡Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå…¶å®æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¼šå¯¼è‡´ ComplexComponent å§‹ç»ˆä¼šè¢«é‡æ–°æ¸²æŸ“.æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å®ä¾‹æ–¹æ³•:123456789class MyComponent extends Component &#123; render() &#123; &lt;ComplexComponent onClick=&#123;this.handleClick&#125; otherProps=&#123;values&#125; /&gt;; &#125; handleClick = () =&gt; &#123; /*...*/ &#125;;&#125;å¤åˆ¶ä»£ç â‘¡ å³ä½¿ç°åœ¨ä½¿ç”¨hooksï¼Œæˆ‘ä¾ç„¶ä¼šä½¿ç”¨useCallbackæ¥åŒ…è£…äº‹ä»¶å¤„ç†å™¨ï¼Œå°½é‡ç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªé™æ€çš„å‡½æ•°:123456const handleClick = useCallback(() =&gt; &#123; /*...*/&#125;, []);return &lt;ComplexComponent onClick=&#123;handleClick&#125; otherProps=&#123;values&#125; /&gt;;å¤åˆ¶ä»£ç ä½†æ˜¯å¦‚æœuseCallbackä¾èµ–äºå¾ˆå¤šçŠ¶æ€ï¼Œä½ çš„useCallbackå¯èƒ½ä¼šå˜æˆè¿™æ ·:12345const handleClick = useCallback(() =&gt; &#123; /*...*/ // ğŸ¤­&#125;, [foo, bar, baz, bazz, bazzzz]);å¤åˆ¶ä»£ç è¿™ç§å†™æ³•å®åœ¨è®©äººéš¾ä»¥æ¥å—ï¼Œè¿™æ—¶å€™è°è¿˜ç®¡ä»€ä¹ˆå‡½æ•°å¼éå‡½æ•°å¼çš„ã€‚æˆ‘æ˜¯è¿™æ ·å¤„ç†çš„:123456789101112131415161718function useRefProps&lt;T&gt;(props: T) &#123; const ref = useRef &lt; T &gt; props; // æ¯æ¬¡æ¸²æŸ“æ›´æ–°props useEffect(() =&gt; &#123; ref.current = props; &#125;);&#125;function MyComp(props) &#123; const propsRef = useRefProps(props); // ç°åœ¨handleClickæ˜¯å§‹ç»ˆä¸å˜çš„ const handleClick = useCallback(() =&gt; &#123; const &#123; foo, bar, baz, bazz, bazzzz &#125; = propsRef.current; // do something &#125;, []);&#125;å¤åˆ¶ä»£ç â‘¢è®¾è®¡æ›´æ–¹ä¾¿å¤„ç†çš„ Event Props. æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè¢«é€¼çš„ä¸å¾—ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨ï¼š123456&lt;List&gt; &#123;list.map(i =&gt; ( &lt;Item key=&#123;i.id&#125; onClick=&#123;() =&gt; handleDelete(i.id)&#125; value=&#123;i.value&#125; /&gt; ))&#125;&lt;/List&gt;å¤åˆ¶ä»£ç ä¸Šé¢çš„ onClick æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼Œå®ƒæ²¡æœ‰æºå¸¦ä»»ä½•ä¿¡æ¯æ¥æ ‡è¯†äº‹ä»¶æ¥æºï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ä½¿ç”¨é—­åŒ…å½¢å¼ï¼Œæ›´å¥½çš„è®¾è®¡å¯èƒ½æ˜¯è¿™æ ·çš„:12345678910111213// onClickä¼ é€’äº‹ä»¶æ¥æºä¿¡æ¯const handleDelete = useCallback((id: string) =&gt; &#123; /*åˆ é™¤æ“ä½œ*/&#125;, []);return ( &lt;List&gt; &#123;list.map(i =&gt; ( &lt;Item key=&#123;i.id&#125; id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt; ))&#125; &lt;/List&gt;);å¤åˆ¶ä»£ç å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–è€… DOM ç»„ä»¶å‘¢? å®åœ¨ä¸è¡Œï¼Œçœ‹èƒ½ä¸èƒ½ä¼ é€’data-*å±æ€§:12345678910111213const handleDelete = useCallback(event =&gt; &#123; const id = event.dataset.id; /*åˆ é™¤æ“ä½œ*/&#125;, []);return ( &lt;ul&gt; &#123;list.map(i =&gt; ( &lt;li key=&#123;i.id&#125; data-id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt; ))&#125; &lt;/ul&gt;);å¤åˆ¶ä»£ç 2ï¸âƒ£ ä¸å¯å˜æ•°æ®ä¸å¯å˜æ•°æ®å¯ä»¥è®©çŠ¶æ€å˜å¾—å¯é¢„æµ‹ï¼Œä¹Ÿè®© shouldComponentUpdate â€˜æµ…æ¯”è¾ƒâ€™å˜å¾—æ›´å¯é å’Œé«˜æ•ˆ. ç¬”è€…åœ¨ React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 04 - ç»„ä»¶çš„æ€ç»´ä»‹ç»è¿‡ä¸å¯å˜æ•°æ®ï¼Œæœ‰å…´è¶£è¯»è€…å¯ä»¥çœ‹çœ‹.ç›¸å…³çš„å·¥å…·æœ‰ Immutable.jsã€Immerã€immutability-helper ä»¥åŠ seamless-immutableã€‚3ï¸âƒ£ ç®€åŒ– stateä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ”¾åœ¨ç»„ä»¶çš„ state ä¸­. ä¾‹å¦‚ç¼“å­˜æ•°æ®ã€‚æŒ‰ç…§æˆ‘çš„åŸåˆ™æ˜¯ï¼šå¦‚æœéœ€è¦ç»„ä»¶å“åº”å®ƒçš„å˜åŠ¨, æˆ–è€…éœ€è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­çš„æ•°æ®æ‰åº”è¯¥æ”¾åˆ° state ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å˜åŠ¨å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“.4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹å°½ç®¡ hooks å‡ºæ¥åï¼Œrecompose å®£ç§°ä¸å†æ›´æ–°äº†ï¼Œä½†è¿˜æ˜¯ä¸å½±å“æˆ‘ä»¬ä½¿ç”¨ recompose æ¥æ§åˆ¶shouldComponentUpdateæ–¹æ³•, æ¯”å¦‚å®ƒæä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥ç²¾ç»†æ§åˆ¶åº”è¯¥æ¯”è¾ƒå“ªäº› props:1234567 /* ç›¸å½“äºReact.memo */ pure() /* è‡ªå®šä¹‰æ¯”è¾ƒ */ shouldUpdate(test: (props: Object, nextProps: Object) =&gt; boolean): HigherOrderComponent /* åªæ¯”è¾ƒæŒ‡å®škey */ onlyUpdateForKeys( propKeys: Array&lt;string&gt;): HigherOrderComponentå¤åˆ¶ä»£ç å…¶å®è¿˜å¯ä»¥å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¯”å¦‚omitUpdateForKeyså¿½ç•¥æ¯”å¯¹æŸäº› key.ç²¾ç»†åŒ–æ¸²æŸ“æ‰€è°“ç²¾ç»†åŒ–æ¸²æŸ“æŒ‡çš„æ˜¯åªæœ‰ä¸€ä¸ªæ•°æ®æ¥æºå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“, æ¯”å¦‚è¯´ A åªä¾èµ–äº a æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰åœ¨ a æ•°æ®å˜åŠ¨æ—¶æ‰æ¸²æŸ“ A, å…¶ä»–çŠ¶æ€å˜åŒ–ä¸åº”è¯¥å½±å“ç»„ä»¶ Aã€‚Vue å’Œ Mobx å®£ç§°è‡ªå·±æ€§èƒ½å¥½çš„ä¸€éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬çš„â€™å“åº”å¼ç³»ç»Ÿâ€™, å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€äº›â€˜å“åº”å¼æ•°æ®â€™ï¼Œå½“è¿™äº›å“åº”æ•°æ®å˜åŠ¨æ—¶ï¼Œä¾èµ–è¿™äº›å“åº”å¼æ•°æ®è§†å›¾å°±ä¼šé‡æ–°æ¸²æŸ“. æ¥çœ‹çœ‹ Vue å®˜æ–¹æ˜¯å¦‚ä½•æè¿°çš„:0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå“åº”å¼æ•°æ®å¯ä»¥å®ç°è§†å›¾ç²¾ç»†åŒ–çš„æ¸²æŸ“, ä½†å®ƒè¿˜æ˜¯ä¸èƒ½é¿å…å¼€å‘è€…å†™å‡ºä½æ•ˆçš„ç¨‹åº. æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºç»„ä»¶è¿èƒŒâ€˜å•ä¸€èŒè´£â€™.ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰ä¸€ä¸ª MyComponent ç»„ä»¶ï¼Œä¾èµ–äº Aã€Bã€C ä¸‰ä¸ªæ•°æ®æºï¼Œæ¥æ„å»ºä¸€ä¸ª vdom æ ‘ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨åªè¦ Aã€Bã€C ä»»æ„ä¸€ä¸ªå˜åŠ¨ï¼Œé‚£ä¹ˆ MyComponent æ•´ä¸ªå°±ä¼šé‡æ–°æ¸²æŸ“:æ›´å¥½çš„åšæ³•æ˜¯è®©ç»„ä»¶çš„èŒè´£æ›´å•ä¸€ï¼Œç²¾ç»†åŒ–åœ°ä¾èµ–å“åº”å¼æ•°æ®ï¼Œæˆ–è€…è¯´å¯¹å“åº”å¼æ•°æ®è¿›è¡Œâ€˜éš”ç¦»â€™. å¦‚ä¸‹å›¾, Aã€Bã€C éƒ½æŠ½å–å„è‡ªçš„ç»„ä»¶ä¸­äº†ï¼Œç°åœ¨ A å˜åŠ¨åªä¼šæ¸²æŸ“ A ç»„ä»¶æœ¬èº«ï¼Œè€Œä¸ä¼šå½±å“çˆ¶ç»„ä»¶å’Œ Bã€C ç»„ä»¶:ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œåˆ—è¡¨æ¸²æŸ“:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import React from &apos;react&apos;;import &#123; observable &#125; from &apos;mobx&apos;;import &#123; observer &#125; from &apos;mobx-react-lite&apos;;const initialList = [];for (let i = 0; i &lt; 10; i++) &#123; initialList.push(&#123; id: i, name: `name-$&#123;i&#125;`, value: 0 &#125;);&#125;const store = observable(&#123; list: initialList,&#125;);export const List = observer(() =&gt; &#123; const list = store.list; console.log(&apos;Listæ¸²æŸ“&apos;); return ( &lt;div class&gt; &lt;ul&gt; &#123;list.map((i, idx) =&gt; ( &lt;div class key=&#123;i.id&#125;&gt; &#123;/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */&#125; &#123;console.log(&apos;render&apos;, i.id)&#125; &lt;span class&gt;&#123;i.name&#125; &lt;/span&gt; &lt;span class&gt;&#123;i.value&#125; &lt;/span&gt; &lt;button class onClick=&#123;() =&gt; &#123; i.value++; console.log(&apos;é€’å¢&apos;); &#125;&#125; &gt; é€’å¢ &lt;/button&gt; &lt;button class onClick=&#123;() =&gt; &#123; if (idx &lt; list.length - 1) &#123; console.log(&apos;ç§»ä½&apos;); let t = list[idx]; list[idx] = list[idx + 1]; list[idx + 1] = t; &#125; &#125;&#125; &gt; ä¸‹ç§» &lt;/button&gt; &lt;/div&gt; ))&#125; &lt;/ul&gt; &lt;/div&gt; );&#125;);å¤åˆ¶ä»£ç ä¸Šè¿°çš„ä¾‹å­æ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜çš„ï¼Œå•ä¸ª list-item çš„é€’å¢å’Œç§»ä½éƒ½ä¼šå¯¼è‡´æ•´ä¸ªåˆ—è¡¨çš„é‡æ–°æ¸²æŸ“:åŸå› å¤§æ¦‚èƒ½çŒœå‡ºæ¥å§? å¯¹äº Vue æˆ–è€… Mobx æ¥è¯´ï¼Œä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†çš„ä¸Šä¸‹æ–‡ã€‚ä¸Šé¢ List ç»„ä»¶æ¸²æŸ“å‡½æ•°å†…â€™è®¿é—®â€™äº†æ‰€æœ‰çš„åˆ—è¡¨é¡¹æ•°æ®ï¼Œé‚£ä¹ˆ Vue æˆ– Mobx å°±ä¼šè®¤ä¸ºä½ è¿™ä¸ªç»„ä»¶ä¾èµ–äºæ‰€æœ‰çš„åˆ—è¡¨é¡¹ï¼Œè¿™æ ·å°±å¯¼è‡´ï¼Œåªè¦ä»»æ„ä¸€ä¸ªåˆ—è¡¨é¡¹çš„å±æ€§å€¼å˜åŠ¨å°±ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ª List ç»„ä»¶ã€‚è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ•°æ®éš”ç¦»æŠ½å–åˆ°å•ä¸€èŒè´£çš„ç»„ä»¶ä¸­ã€‚å¯¹äº Vue æˆ– Mobx æ¥è¯´ï¼Œè¶Šç»†ç²’åº¦çš„ç»„ä»¶ï¼Œå¯ä»¥æ”¶è·æ›´é«˜çš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœ:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950export const ListItem = observer(props =&gt; &#123; const &#123; item, onShiftDown &#125; = props; return ( &lt;div class&gt; &#123;console.log(&apos;render&apos;, item.id)&#125; &#123;/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */&#125; &lt;span class&gt;&#123;item.name&#125; &lt;/span&gt; &lt;span class&gt;&#123;item.value&#125; &lt;/span&gt; &lt;button class onClick=&#123;() =&gt; &#123; item.value++; console.log(&apos;é€’å¢&apos;); &#125;&#125; &gt; é€’å¢ &lt;/button&gt; &lt;button class onClick=&#123;() =&gt; onShiftDown(item)&#125;&gt; ä¸‹ç§» &lt;/button&gt; &lt;/div&gt; );&#125;);export const List = observer(() =&gt; &#123; const list = store.list; const handleShiftDown = useCallback(item =&gt; &#123; const idx = list.findIndex(i =&gt; i.id === item.id); if (idx !== -1 &amp;&amp; idx &lt; list.length - 1) &#123; console.log(&apos;ç§»ä½&apos;); let t = list[idx]; list[idx] = list[idx + 1]; list[idx + 1] = t; &#125; // eslint-disable-next-line react-hooks/exhaustive-deps &#125;, []); console.log(&apos;List æ¸²æŸ“&apos;); return ( &lt;div class&gt; &lt;ul&gt; &#123;list.map((i, idx) =&gt; ( &lt;ListItem key=&#123;i.id&#125; item=&#123;i&#125; onShiftDown=&#123;handleShiftDown&#125; /&gt; ))&#125; &lt;/ul&gt; &lt;/div&gt; );&#125;);å¤åˆ¶ä»£ç æ•ˆæœå¾ˆæ˜æ˜¾, list-item é€’å¢åªä¼šé‡æ–°æ¸²æŸ“æœ¬èº«; è€Œç§»ä½åªä¼šé‡æ–°æ¸²æŸ“ Listï¼Œ å› ä¸ºåˆ—è¡¨é¡¹æ²¡æœ‰å˜åŠ¨, æ‰€ä»¥ä¸‹çº§ list-item ä¹Ÿä¸éœ€è¦é‡æ–°æ¸²æŸ“:1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Contextå…¶å® Context çš„ç”¨æ³•å’Œå“åº”å¼æ•°æ®æ­£å¥½ç›¸åã€‚ç¬”è€…ä¹Ÿçœ‹è¿‡ä¸å°‘æ»¥ç”¨ Context API çš„ä¾‹å­, è¯´åˆ°åº•è¿˜æ˜¯æ²¡æœ‰å¤„ç†å¥½â€˜çŠ¶æ€çš„ä½œç”¨åŸŸé—®é¢˜â€™.é¦–å…ˆè¦ç†è§£ Context API çš„æ›´æ–°ç‰¹ç‚¹ï¼Œå®ƒæ˜¯å¯ä»¥ç©¿é€React.memoæˆ–è€…shouldComponentUpdateçš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate.è¿™ä¸ªå’Œ Mobx å’Œ Vue çš„å“åº”å¼ç³»ç»Ÿä¸åŒï¼ŒContext API å¹¶ä¸èƒ½ç»†ç²’åº¦åœ°æ£€æµ‹å“ªäº›ç»„ä»¶ä¾èµ–å“ªäº›çŠ¶æ€ï¼Œæ‰€ä»¥è¯´ä¸ŠèŠ‚æåˆ°çš„â€˜ç²¾ç»†åŒ–æ¸²æŸ“â€™ç»„ä»¶æ¨¡å¼ï¼Œåœ¨ Context è¿™é‡Œå°±æˆä¸ºäº†â€˜åæ¨¡å¼â€™.æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ Context API è¦éµå¾ªä¸€ä¸‹åŸåˆ™:æ˜ç¡®çŠ¶æ€ä½œç”¨åŸŸ, Context åªæ”¾ç½®å¿…è¦çš„ï¼Œå…³é”®çš„ï¼Œè¢«å¤§å¤šæ•°ç»„ä»¶æ‰€å…±äº«çš„çŠ¶æ€ã€‚æ¯”è¾ƒå…¸å‹çš„æ˜¯é‰´æƒçŠ¶æ€ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­:æ‰©å±•ï¼šContext å…¶å®æœ‰ä¸ªå®éªŒæ€§æˆ–è€…è¯´éå…¬å¼€çš„é€‰é¡¹observedBits, å¯ä»¥ç”¨äºæ§åˆ¶ ContextConsumer æ˜¯å¦éœ€è¦æ›´æ–°. è¯¦ç»†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  &lt;ObservedBits: React Context çš„ç§˜å¯†åŠŸèƒ½ &gt;. ä¸è¿‡ä¸æ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ª API ä¹Ÿæ¯”è¾ƒéš¾ç”¨ï¼Œä¸å¦‚ç›´æ¥ä¸Š mobxã€‚ç²—ç²’åº¦åœ°è®¢é˜… Contextå¦‚ä¸‹å›¾. ç»†ç²’åº¦çš„ Context è®¢é˜…ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“, æ‰€ä»¥è¿™é‡Œæ¨èç²—ç²’åº¦çš„è®¢é˜…. æ¯”å¦‚åœ¨çˆ¶çº§è®¢é˜… Contextï¼Œç„¶åå†é€šè¿‡ props ä¼ é€’ç»™ä¸‹çº§ã€‚å¦å¤–ç¨‹å¢¨ Morgan åœ¨é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“ä¸€æ–‡ä¸­ä¹Ÿæåˆ° ContextAPI çš„ä¸€ä¸ªé™·é˜±:123456789&lt;Context.Provider value=&#123;&#123; theme: this.state.theme, switchTheme: this.switchTheme &#125;&#125;&gt; &lt;div class&gt; &lt;Header /&gt; &lt;Content /&gt; &lt;/div&gt;&lt;/Context.Provider&gt;å¤åˆ¶ä»£ç ä¸Šé¢çš„ç»„ä»¶ä¼šåœ¨ state å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œè‡³äºä¸ºä»€ä¹ˆç•™ç»™è¯»è€…å»æ€è€ƒã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¸ä¼šè£¸éœ²åœ°ä½¿ç”¨ Context.Provider, è€Œæ˜¯å°è£…ä¸ºç‹¬ç«‹çš„ Provider ç»„ä»¶:1234567891011121314export function ThemeProvider(props) &#123; const [theme, switchTheme] = useState(redTheme); return ( &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt; &#123;props.children&#125; &lt;/Context.Provider&gt; );&#125;// é¡ºä¾¿æš´éœ²useTheme, è®©å¤–éƒ¨å¿…é¡»ç›´æ¥ä½¿ç”¨Contextexport function useTheme() &#123; return useContext(Context);&#125;å¤åˆ¶ä»£ç ç°åœ¨ theme å˜åŠ¨å°±ä¸ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå› ä¸º props.children ç”±å¤–éƒ¨ä¼ é€’è¿›æ¥ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ã€‚å…¶å®ä¸Šé¢çš„ä»£ç è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¯”è¾ƒéš¾å‘ç°çš„é™·é˜± (å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰æåˆ°):1234567891011export function ThemeProvider(props) &#123; const [theme, switchTheme] = useState(redTheme); return ( &#123;/* ğŸ‘‡ ğŸ’£è¿™é‡Œæ¯ä¸€æ¬¡æ¸²æŸ“ThemeProvider, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„value(å³ä½¿themeå’ŒswitchThemeæ²¡æœ‰å˜åŠ¨), ä»è€Œå¯¼è‡´å¼ºåˆ¶æ¸²æŸ“æ‰€æœ‰ä¾èµ–è¯¥Contextçš„ç»„ä»¶ */&#125; &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt; &#123;props.children&#125; &lt;/Context.Provider&gt; );&#125;å¤åˆ¶ä»£ç æ‰€ä»¥ä¼ é€’ç»™ Context çš„ value æœ€å¥½åšä¸€ä¸‹ç¼“å­˜:123456export function ThemeProvider(props) &#123; const [theme, switchTheme] = useState(redTheme); const value = useMemo(() =&gt; (&#123; theme, switchTheme &#125;), [theme]); return &lt;Context.Provider value=&#123;value&#125;&gt;&#123;props.children&#125;&lt;/Context.Provider&gt;;&#125;å¤åˆ¶ä»£ç æ‰©å±•Optimizing Performance React å®˜æ–¹æ–‡æ¡£ï¼Œæœ€å¥½çš„æ•™ç¨‹, åˆ©ç”¨å¥½ React çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚Twitter Lite and High Performance React Progressive Web Apps at Scale çœ‹çœ‹ Twitter å¦‚ä½•ä¼˜åŒ–çš„]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾è¯»ã€ŠFunction VS Class ç»„ä»¶ã€‹]]></title>
    <url>%2Farchives%2Fecb7.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://zhuanlan.zhihu.com/p/59558396å¼•è¨€ä¸ºä»€ä¹ˆè¦äº†è§£ Function å†™æ³•çš„ç»„ä»¶å‘¢ï¼Ÿå› ä¸ºå®ƒæ­£åœ¨å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚é‚£ä¹ˆ React ä¸­ Function Component ä¸ Class Component æœ‰ä½•ä¸åŒï¼Ÿhow-are-function-components-different-from-classes è¿™ç¯‡æ–‡ç« å¸¦æ¥äº†ä¸€ä¸ªç‹¬ç‰¹çš„è§†è§’ã€‚é¡ºå¸¦ä¸€æï¼Œä»¥åä¼šç”¨ Function Component ä»£æ›¿ Stateless Component çš„è¯´æ³•ï¼ŒåŸå› æ˜¯ï¼šè‡ªä» Hooks å‡ºç°ï¼Œå‡½æ•°å¼ç»„ä»¶åŠŸèƒ½åœ¨ä¸æ–­ä¸°å¯Œï¼Œå‡½æ•°å¼ç»„ä»¶ä¸å†éœ€è¦å¼ºè°ƒå…¶æ— çŠ¶æ€ç‰¹æ€§ï¼Œå› æ­¤å« Function Component æ›´ä¸ºæ°å½“ã€‚æ¦‚è¿°åŸæ–‡äº‹å…ˆç”³æ˜ï¼šå¹¶æ²¡æœ‰å¯¹ Function ä¸ Classes è¿›è¡Œä¼˜åŠ£å¯¹æ¯”ï¼Œè€Œä»…ä»…è¿›è¡Œç‰¹æ€§å¯¹æ¯”ï¼Œæ‰€ä»¥ä¸æ¥å—ä»»ä½•åæ§½ã€‚è¿™ä¸¤ç§å†™æ³•æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œæ€§èƒ½å·®è·ä¹Ÿå‡ ä¹å¯ä»¥å¿½ç•¥ï¼Œè€Œä¸” React ä¼šé•¿æœŸæ”¯æŒè¿™ä¸¤ç§å†™æ³•ã€‚Capture propså¯¹æ¯”ä¸‹é¢ä¸¤æ®µä»£ç ã€‚Class Component:12345678910111213class ProfilePage extends React.Component &#123; showMessage = () =&gt; &#123; alert(&quot;Followed &quot; + this.props.user); &#125;; handleClick = () =&gt; &#123; setTimeout(this.showMessage, 3000); &#125;; render() &#123; return &lt;button onClick=&#123;this.handleClick&#125;&gt;Follow&lt;/button&gt;; &#125;&#125;Function Component:1234567891011function ProfilePage(props) &#123; const showMessage = () =&gt; &#123; alert(&quot;Followed &quot; + props.user); &#125;; const handleClick = () =&gt; &#123; setTimeout(showMessage, 3000); &#125;; return &lt;button onClick=&#123;handleClick&#125;&gt;Follow&lt;/button&gt;;&#125;ï¼ˆåœ¨çº¿ Demoï¼‰è¿™ä¸¤ä¸ªç»„ä»¶éƒ½æè¿°äº†åŒä¸€ä¸ªé€»è¾‘ï¼šç‚¹å‡»æŒ‰é’® 3 ç§’å alert çˆ¶çº§ä¼ å…¥çš„ç”¨æˆ·åã€‚å¦‚ä¸‹çˆ¶çº§ç»„ä»¶çš„è°ƒç”¨æ–¹å¼ï¼š12&lt;ProfilePageFunction user=&#123;this.state.user&#125; /&gt;&lt;ProfilePageClass user=&#123;this.state.user&#125; /&gt;é‚£ä¹ˆå½“ç‚¹å‡»æŒ‰é’®åçš„ 3 ç§’å†…ï¼Œçˆ¶çº§ä¿®æ”¹äº† this.state.userï¼Œå¼¹å‡ºçš„ç”¨æˆ·åæ˜¯ä¿®æ”¹å‰çš„è¿˜æ˜¯ä¿®æ”¹åçš„å‘¢ï¼ŸClass Component å±•ç¤ºçš„æ˜¯ä¿®æ”¹åçš„å€¼ï¼š&lt;img src=â€https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.gifâ€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€950â€data-rawheight=â€351â€data-thumbnail=â€https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.jpgâ€œwidth=â€950â€data-original=â€https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_r.jpgâ€œ/&gt;Function Component å±•ç¤ºçš„æ˜¯ä¿®æ”¹å‰çš„å€¼ï¼š&lt;img src=â€https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.gifâ€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€901â€data-rawheight=â€293â€data-thumbnail=â€https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.jpgâ€œwidth=â€901â€data-original=â€https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_r.jpgâ€œ/&gt;é‚£ä¹ˆ React æ–‡æ¡£ä¸­æè¿°çš„ props ä¸æ˜¯ä¸å¯å˜ï¼ˆImmutableï¼‰ æ•°æ®å—ï¼Ÿä¸ºå•¥åœ¨è¿è¡Œæ—¶è¿˜ä¼šå‘ç”Ÿå˜åŒ–å‘¢ï¼ŸåŸå› åœ¨äºï¼Œè™½ç„¶ props ä¸å¯å˜ï¼Œæ˜¯ this åœ¨ Class Component ä¸­æ˜¯å¯å˜çš„ï¼Œå› æ­¤ this.props çš„è°ƒç”¨ä¼šå¯¼è‡´æ¯æ¬¡éƒ½è®¿é—®æœ€æ–°çš„ propsã€‚è€Œ Function Component ä¸å­˜åœ¨ this.props çš„è¯­æ³•ï¼Œå› æ­¤ props æ€»æ˜¯ä¸å¯å˜çš„ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œç¬”è€…è¡¥å……ä¸€äº›ä»£ç æ³¨è§£ï¼šFunction Component:123456function ProfilePage(props) &#123; setTimeout(() =&gt; &#123; // å°±ç®—çˆ¶ç»„ä»¶ reRenderï¼Œè¿™é‡Œæ‹¿åˆ°çš„ props ä¹Ÿæ˜¯åˆå§‹çš„ console.log(props); &#125;, 3000);&#125;Class Component:123456789class ProfilePage extends React.Component &#123; render() &#123; setTimeout(() =&gt; &#123; // å¦‚æœçˆ¶ç»„ä»¶ reRenderï¼Œthis.props æ‹¿åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°çš„ã€‚ // å¹¶ä¸æ˜¯ props å˜äº†ï¼Œè€Œæ˜¯ this.props æŒ‡å‘äº†æ–°çš„ propsï¼Œæ—§çš„ props æ‰¾ä¸åˆ°äº† console.log(this.props); &#125;, 3000); &#125;&#125;å¦‚æœå¸Œæœ›åœ¨ Class Component æ•è·ç¬æ—¶ Propsï¼Œå¯ä»¥ï¼š const props = this.props;ï¼Œä½†è¿™æ ·çš„ä»£ç å¾ˆè¹©è„šï¼Œæ‰€ä»¥å¦‚æœå¸Œæœ›æ‹¿åˆ°ç¨³å®šçš„ propsï¼Œä½¿ç”¨ Function Component æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚Hooks ä¹Ÿå…·æœ‰ capture value ç‰¹æ€§çœ‹ä¸‹é¢çš„ä»£ç ï¼š12345678910111213141516171819202122function MessageThread() &#123; const [message, setMessage] = useState(&quot;&quot;); const showMessage = () =&gt; &#123; alert(&quot;You said: &quot; + message); &#125;; const handleSendClick = () =&gt; &#123; setTimeout(showMessage, 3000); &#125;; const handleMessageChange = e =&gt; &#123; setMessage(e.target.value); &#125;; return ( &lt;&gt; &lt;input value=&#123;message&#125; onChange=&#123;handleMessageChange&#125; /&gt; &lt;button onClick=&#123;handleSendClick&#125;&gt;Send&lt;/button&gt; &lt;/&gt; );&#125;ï¼ˆåœ¨çº¿ Demoï¼‰åœ¨ç‚¹å‡» Send æŒ‰é’®åï¼Œå†æ¬¡ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼ï¼Œ3 ç§’åçš„è¾“å‡ºä¾ç„¶æ˜¯ ç‚¹å‡»å‰è¾“å…¥æ¡†çš„å€¼ã€‚è¿™è¯´æ˜ Hooks åŒæ ·å…·æœ‰ capture value çš„ç‰¹æ€§ã€‚åˆ©ç”¨ useRef å¯ä»¥è§„é¿ capture value ç‰¹æ€§ï¼š123456789101112131415function MessageThread() &#123; const latestMessage = useRef(&quot;&quot;); const showMessage = () =&gt; &#123; alert(&quot;You said: &quot; + latestMessage.current); &#125;; const handleSendClick = () =&gt; &#123; setTimeout(showMessage, 3000); &#125;; const handleMessageChange = e =&gt; &#123; latestMessage.current = e.target.value; &#125;;&#125;åªè¦å°†èµ‹å€¼ä¸å–å€¼çš„å¯¹è±¡å˜æˆ useRefï¼Œè€Œä¸æ˜¯ useStateï¼Œå°±å¯ä»¥èº²è¿‡ capture value ç‰¹æ€§ï¼Œåœ¨ 3 ç§’åå¾—åˆ°æœ€æ–°çš„å€¼ã€‚è¿™è¯´æ˜äº†åˆ©ç”¨ Function Component + Hooks å¯ä»¥å®ç° Class Component åšä¸åˆ°çš„ capture propsã€capture valueï¼Œè€Œä¸” React å®˜æ–¹ä¹Ÿæ¨è æ–°çš„ä»£ç ä½¿ç”¨ Hooks ç¼–å†™ã€‚ç²¾è¯»åŸæ–‡ how-are-function-components-different-from-classes ä»ä¸€ä¸ªä¾§é¢è®²è¿°äº† Function Component ä¸ Class Component çš„ä¸åŒç‚¹ï¼Œä¹‹æ‰€ä»¥å°† Function Component ä¸ Class Component ç›¸æå¹¶è®ºï¼Œå‡ ä¹éƒ½è¦å½’åŠŸäº Hooks API çš„å‡ºç°ï¼Œæœ‰äº† Hooksï¼ŒFunction Component çš„èƒ½åŠ›æ‰å¾—ä»¥å‘ Class Component çœ‹é½ã€‚å…³äº React Hooksï¼Œä¹‹å‰çš„ä¸¤ç¯‡ç²¾è¯»åˆ†åˆ«æœ‰è¿‡ä»‹ç»ï¼šç²¾è¯»ã€ŠReact Hooksã€‹ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹ä½†æ˜¯ï¼Œè™½ç„¶ Hook å·²ç»å‘å¸ƒäº†ç¨³å®šç‰ˆæœ¬ï¼Œä½†å‘¨è¾¹ç”Ÿæ€è·Ÿè¿›è¿˜éœ€è¦æ—¶é—´ï¼ˆæ¯”å¦‚ useRouterï¼‰ã€æœ€ä½³å®è·µæ•´ç†è¿˜éœ€è¦æ—¶é—´ï¼Œå› æ­¤ä¸å»ºè®®é‡æ„è€ä»£ç ã€‚ä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ Function Componentï¼Œå»ºè®®æ—¶å¸¸ä¸ Class Component çš„åŠŸèƒ½åšå¯¹æ¯”ï¼Œæ–¹ä¾¿ç†è§£å’Œè®°å¿†ã€‚ä¸‹é¢æ•´ç†ä¸€äº›å¸¸è§çš„ Function Component é—®é¢˜ï¼šéå¸¸å»ºè®®å®Œæ•´é˜…è¯» React Hooks FAQã€‚æ€ä¹ˆæ›¿ä»£ shouldComponentUpdateè¯´å®è¯ï¼ŒFunction Component æ›¿ä»£ shouldComponentUpdate çš„æ–¹æ¡ˆå¹¶æ²¡æœ‰ Class Component ä¼˜é›…ï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼š123const Button = React.memo(props =&gt; &#123; // your component&#125;);æˆ–è€…åœ¨çˆ¶çº§å°±ç›´æ¥ç”Ÿæˆä¸€ä¸ªè‡ªå¸¦ memo çš„å­å…ƒç´ ï¼š123456789101112function Parent(&#123; a, b &#125;) &#123; // Only re-rendered if `a` changes: const child1 = useMemo(() =&gt; &lt;Child1 a=&#123;a&#125; /&gt;, [a]); // Only re-rendered if `b` changes: const child2 = useMemo(() =&gt; &lt;Child2 b=&#123;b&#125; /&gt;, [b]); return ( &lt;&gt; &#123;child1&#125; &#123;child2&#125; &lt;/&gt; );&#125;ç›¸æ¯”ä¹‹ä¸‹ï¼ŒClass Component çš„å†™æ³•é€šå¸¸æ˜¯ï¼š1class Button extends React.PureComponent &#123;&#125;è¿™æ ·å°±è‡ªå¸¦äº† shallowEqual çš„ shouldComponentUpdateã€‚æ€ä¹ˆæ›¿ä»£ componentDidUpdateç”±äº useEffect æ¯æ¬¡ Render éƒ½ä¼šæ‰§è¡Œï¼Œå› æ­¤éœ€è¦æ¨¡æ‹Ÿä¸€ä¸ª useUpdate å‡½æ•°ï¼š12345678const mounting = useRef(true);useEffect(() =&gt; &#123; if (mounting.current) &#123; mounting.current = false; &#125; else &#123; fn(); &#125;&#125;);æ›´å¤šå¯ä»¥æŸ¥çœ‹ ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹æ€ä¹ˆæ›¿ä»£ forceUpdateReact å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸€ç§æ–¹æ¡ˆï¼š12345const [ignored, forceUpdate] = useReducer(x =&gt; x + 1, 0);function handleClick() &#123; forceUpdate();&#125;æ¯æ¬¡æ‰§è¡Œ dispatch æ—¶ï¼Œåªè¦ state å˜åŒ–å°±ä¼šè§¦å‘ç»„ä»¶æ›´æ–°ã€‚å½“ç„¶ useState ä¹ŸåŒæ ·å¯ä»¥æ¨¡æ‹Ÿï¼š1const useUpdate = () =&gt; useState(0)[1];æˆ‘ä»¬çŸ¥é“ useState ä¸‹æ ‡ä¸º 1 çš„é¡¹æ˜¯ç”¨æ¥æ›´æ–°æ•°æ®çš„ï¼Œè€Œä¸”å°±ç®—æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œè°ƒç”¨äº†ä¹Ÿä¼šåˆ·æ–°ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›ä¸€ä¸ªæ²¡æœ‰ä¿®æ”¹æ•°å€¼çš„ setValueï¼Œè¿™æ ·å®ƒçš„åŠŸèƒ½å°±ä»…å‰©ä¸‹åˆ·æ–°ç»„ä»¶äº†ã€‚æ›´å¤šå¯ä»¥æŸ¥çœ‹ ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹state æ‹†åˆ†è¿‡å¤šuseState ç›®å‰çš„ä¸€ç§å®è·µï¼Œæ˜¯å°†å˜é‡åæ‰“å¹³ï¼Œè€Œéåƒ Class Component ä¸€æ ·å†™åœ¨ä¸€ä¸ª State å¯¹è±¡é‡Œï¼š1234567891011121314151617class ClassComponent extends React.PureComponent &#123; state = &#123; left: 0, top: 0, width: 100, height: 100 &#125;;&#125;// VSfunction FunctionComponent &#123; const [left,setLeft] = useState(0) const [top,setTop] = useState(0) const [width,setWidth] = useState(100) const [height,setHeight] = useState(100)&#125;å®é™…ä¸Šåœ¨ Function Component ä¸­ä¹Ÿå¯ä»¥èšåˆç®¡ç† Stateï¼š12345678function FunctionComponent() &#123; const [state, setState] = useState(&#123; left: 0, top: 0, width: 100, height: 100 &#125;);&#125;åªæ˜¯æ›´æ–°çš„æ—¶å€™ï¼Œä¸å†ä¼šè‡ªåŠ¨ mergeï¼Œè€Œéœ€è¦ä½¿ç”¨ ...state è¯­æ³•ï¼š1setState(state =&gt; (&#123; ...state, left: e.pageX, top: e.pageY &#125;));å¯ä»¥çœ‹åˆ°ï¼Œæ›´å°‘çš„é»‘é­”æ³•ï¼Œæ›´å¯é¢„æœŸçš„ç»“æœã€‚è·å–ä¸Šä¸€ä¸ª propsè™½ç„¶ä¸æ€ä¹ˆå¸¸ç”¨ï¼Œä½†æ˜¯æ¯•ç«Ÿ Class Component å¯ä»¥é€šè¿‡ componentWillReceiveProps æ‹¿åˆ° previousProps ä¸ nextPropsï¼Œå¯¹äº Function Componentï¼Œæœ€å¥½é€šè¿‡è‡ªå®šä¹‰ Hooks æ–¹å¼æ‹¿åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€ï¼š1234567891011121314151617function Counter() &#123; const [count, setCount] = useState(0); const prevCount = usePrevious(count); return ( &lt;h1&gt; Now: &#123;count&#125;, before: &#123;prevCount&#125; &lt;/h1&gt; );&#125;function usePrevious(value) &#123; const ref = useRef(); useEffect(() =&gt; &#123; ref.current = value; &#125;); return ref.current;&#125;é€šè¿‡ useEffect åœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åå†æ‰§è¡Œçš„ç‰¹æ€§ï¼Œå†åˆ©ç”¨ useRef çš„å¯å˜ç‰¹æ€§ï¼Œè®© usePrevious çš„è¿”å›å€¼æ˜¯ â€œä¸Šä¸€æ¬¡â€ Render æ—¶çš„ã€‚å¯è§ï¼Œåˆç†è¿ç”¨ useEffect useRefï¼Œå¯ä»¥åšè®¸å¤šäº‹æƒ…ï¼Œè€Œä¸”å°è£…æˆ CustomHook åä½¿ç”¨èµ·æ¥ä»ç„¶å¾ˆæ–¹ä¾¿ã€‚æœªæ¥ usePrevious å¯èƒ½æˆä¸ºå®˜æ–¹ Hooks ä¹‹ä¸€ã€‚æ€§èƒ½æ³¨æ„äº‹é¡¹useState å‡½æ•°çš„å‚æ•°è™½ç„¶æ˜¯åˆå§‹å€¼ï¼Œä½†ç”±äºæ•´ä¸ªå‡½æ•°éƒ½æ˜¯ Renderï¼Œå› æ­¤æ¯æ¬¡åˆå§‹åŒ–éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœåˆå§‹å€¼è®¡ç®—éå¸¸æ¶ˆè€—æ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨å‡½æ•°ä¼ å…¥ï¼Œè¿™æ ·åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼š123function FunctionComponent(props) &#123; const [rows, setRows] = useState(() =&gt; createRows(props.count));&#125;useRef ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ï¼Œéœ€è¦å†™ä¸€äº›å†—ä½™çš„å‡½åˆ¤å®šæ˜¯å¦è¿›è¡Œè¿‡åˆå§‹åŒ–ã€‚æŒæ¡äº†è¿™äº›ï¼ŒFunction Component ä½¿ç”¨èµ·æ¥ä¸ Class Component å°±å‡ ä¹æ²¡æœ‰å·®åˆ«äº†ï¼æ€»ç»“Function Component åŠŸèƒ½å·²ç»å¯ä»¥ä¸ Class Component åª²ç¾äº†ï¼Œä½†ç›®å‰æœ€ä½³å®è·µæ¯”è¾ƒé›¶æ•£ï¼Œå®˜æ–¹æ–‡æ¡£æ¨èçš„ä¸€äº›è§£å†³æ€è·¯ç”šè‡³ä¸æ¯”ç¤¾åŒºç¬¬ä¸‰æ–¹åº“çš„æ›´å¥½ï¼Œå¯ä»¥é¢„æ–™åˆ°ï¼ŒClass Component çš„åŠŸèƒ½ä¼šè¢«äº”èŠ±å…«é—¨çš„å®ç°å‡ºæ¥ï¼Œé‚£äº›æ²¡æœ‰è¢«æ”¶çº³è¿›å®˜æ–¹çš„ Hooks ä¹çœ‹ä¸Šå»å¯èƒ½ä¼šçœ¼èŠ±ç¼­ä¹±ã€‚æ€»ä¹‹é€‰æ‹©äº† Function Component å°±åŒæ—¶é€‰æ‹©äº†å‡½æ•°å¼çš„å¥½ä¸åã€‚å¥½å¤„æ˜¯åŠŸèƒ½å¼ºå¤§ï¼Œå‡ ä¹å¯ä»¥æ¨¡æ‹Ÿå‡ºä»»ä½•æƒ³è¦çš„åŠŸèƒ½ï¼Œåå¤„æ˜¯ç”±äºå¯ä»¥çµæ´»ç»„åˆï¼Œå¦‚æœè‡ªå®šä¹‰ Hooks å‘½åå’Œå®ç°ä¸å¤Ÿæ ‡å‡†ï¼Œå‡½æ•°ä¸å‡½æ•°ä¹‹é—´å¯¹æ¥çš„æ²Ÿé€šæˆæœ¬ä¼šæ›´å¤§ã€‚è®¨è®ºåœ°å€æ˜¯ï¼šç²¾è¯»ã€ŠStateless VS Class ç»„ä»¶ã€‹ Â· Issue #137 Â· dt-fe/weeklyå¦‚æœä½ æƒ³å‚ä¸è®¨è®ºï¼Œè¯· ç‚¹å‡»è¿™é‡Œï¼Œæ¯å‘¨éƒ½æœ‰æ–°çš„ä¸»é¢˜ï¼Œå‘¨æœ«æˆ–å‘¨ä¸€å‘å¸ƒã€‚å‰ç«¯ç²¾è¯» - å¸®ä½ ç­›é€‰é è°±çš„å†…å®¹ã€‚å…³æ³¨ å‰ç«¯ç²¾è¯»å¾®ä¿¡å…¬ä¼—å·&lt;img src=â€https://pic3.zhimg.com/v2-d817340c54185469ec4df17c0938742e_b.jpgâ€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€258â€data-rawheight=â€258â€width=â€258â€/&gt;special SponsorsDevOps å…¨æµç¨‹å¹³å°ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½ - éå•†ç”¨ - éè¡ç”Ÿ - ä¿æŒç½²åï¼ˆåˆ›æ„å…±äº« 3.0 è®¸å¯è¯ï¼‰å†™ä¸‹ä½ çš„è¯„è®ºâ€¦åœ¨çº¿ Demo æŒ‚äº†~ä¿®å¤äº†class çš„è¿™ä¸ª bug Dan å¥½åƒæè¿‡ ç”¨ const {XXX} = this.props å¯ä»¥è§£å†³ä½ åœ¨æ–‡ä¸­å¥½åƒæäº† æˆ‘æ²¡ä»”ç»†çœ‹ ä¸å¥½æ„æ€é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ hooksâ€¦ç”Ÿå‘½åœ¨äºä¸æ¯æˆ‘è§‰å¾—é‚£æ®µ props immutable è§£é‡Šçš„æ˜¯ä¸æ˜¯æœ‰ç‚¹æ­§ä¹‰ã€‚ã€‚æ¯”å¦‚ï¼Œinstance çš„ this æ˜¯å¯å˜çš„ï¼Œthis åœ¨å®Œæ•´çš„ç»„ä»¶å£°æ˜å‘¨æœŸé‡Œå¹¶ä¸ä¼šä¿®æ”¹å•Šï¼Œåªæ˜¯ this ä¸Šçš„ props å¯èƒ½ä¼šä¿®æ”¹æŒ‡å‘ã€‚ç„¶åã€‚ä¸‹æ–‡ç”¨ setTimeout è¿™æ®µè¡¨è¾¾çš„å…¶å®æ˜¯é—­åŒ…é’ˆå¯¹å˜é‡çš„æ•è·å§ï¼Œè¿™ä¸ªå’Œæ˜¯ä¸æ˜¯ immutable å…³ç³»å¹¶ä¸å¤§å§ ï¼ˆæˆ‘è§‰å¾—è¿™é‡Œå®Œå…¨å°±æ˜¯é—­åŒ…çš„é—®é¢˜ï¼‰ï¼Ÿ]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>React Hooks</tag>
        <tag>Reactç»„ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šç°ä»£ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜]]></title>
    <url>%2Farchives%2F35c4.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/ç½‘ç»œæµè§ˆå™¨å¾ˆå¯èƒ½æ˜¯ä½¿ç”¨æœ€å¹¿çš„è½¯ä»¶ã€‚åœ¨è¿™ç¯‡å…¥é—¨æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šä»‹ç»å®ƒä»¬çš„å¹•åå·¥ä½œåŸç†ã€‚æˆ‘ä»¬ä¼šäº†è§£åˆ°ï¼Œä»æ‚¨åœ¨åœ°å€æ è¾“å…¥ google.com ç›´åˆ°æ‚¨åœ¨æµè§ˆå™¨å±å¹•ä¸Šçœ‹åˆ° Google é¦–é¡µçš„æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†äº›ä»€ä¹ˆã€‚æˆ‘ä»¬è¦è®¨è®ºçš„æµè§ˆå™¨ç›®å‰ä½¿ç”¨çš„ä¸»æµæµè§ˆå™¨æœ‰äº”ä¸ªï¼šInternet Explorerã€Firefoxã€Safariã€Chrome æµè§ˆå™¨å’Œ Operaã€‚æœ¬æ–‡ä¸­ä»¥å¼€æ”¾æºä»£ç æµè§ˆå™¨ä¸ºä¾‹ï¼Œå³ Firefoxã€Chrome æµè§ˆå™¨å’Œ Safariï¼ˆéƒ¨åˆ†å¼€æºï¼‰ã€‚æ ¹æ® StatCounter æµè§ˆå™¨ç»Ÿè®¡æ•°æ®ï¼Œç›®å‰ï¼ˆ2011 å¹´ 8 æœˆï¼‰Firefoxã€Safari å’Œ Chrome æµè§ˆå™¨çš„æ€»å¸‚åœºå æœ‰ç‡å°†è¿‘ 60%ã€‚ç”±æ­¤å¯è§ï¼Œå¦‚ä»Šå¼€æ”¾æºä»£ç æµè§ˆå™¨åœ¨æµè§ˆå™¨å¸‚åœºä¸­å æ®äº†éå¸¸åšå®çš„éƒ¨åˆ†ã€‚æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨æµè§ˆå™¨çª—å£ä¸­å±•ç¤ºæ‚¨é€‰æ‹©çš„ç½‘ç»œèµ„æºã€‚è¿™é‡Œæ‰€è¯´çš„èµ„æºä¸€èˆ¬æ˜¯æŒ‡ HTML æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ˜¯ PDFã€å›¾ç‰‡æˆ–å…¶ä»–çš„ç±»å‹ã€‚èµ„æºçš„ä½ç½®ç”±ç”¨æˆ·ä½¿ç”¨ URIï¼ˆç»Ÿä¸€èµ„æºæ ‡ç¤ºç¬¦ï¼‰æŒ‡å®šã€‚æµè§ˆå™¨è§£é‡Šå¹¶æ˜¾ç¤º HTML æ–‡ä»¶çš„æ–¹å¼æ˜¯åœ¨ HTML å’Œ CSS è§„èŒƒä¸­æŒ‡å®šçš„ã€‚è¿™äº›è§„èŒƒç”±ç½‘ç»œæ ‡å‡†åŒ–ç»„ç»‡ W3Cï¼ˆä¸‡ç»´ç½‘è”ç›Ÿï¼‰è¿›è¡Œç»´æŠ¤ã€‚å¤šå¹´ä»¥æ¥ï¼Œå„æµè§ˆå™¨éƒ½æ²¡æœ‰å®Œå…¨éµä»è¿™äº›è§„èŒƒï¼ŒåŒæ—¶è¿˜åœ¨å¼€å‘è‡ªå·±ç‹¬æœ‰çš„æ‰©å±•ç¨‹åºï¼Œè¿™ç»™ç½‘ç»œå¼€å‘äººå‘˜å¸¦æ¥äº†ä¸¥é‡çš„å…¼å®¹æ€§é—®é¢˜ã€‚å¦‚ä»Šï¼Œå¤§å¤šæ•°çš„æµè§ˆå™¨éƒ½æ˜¯æˆ–å¤šæˆ–å°‘åœ°éµä»è§„èŒƒã€‚æµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢æœ‰å¾ˆå¤šå½¼æ­¤ç›¸åŒçš„å…ƒç´ ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šç”¨æ¥è¾“å…¥ URI çš„åœ°å€æ å‰è¿›å’Œåé€€æŒ‰é’®ä¹¦ç­¾è®¾ç½®é€‰é¡¹ç”¨äºåˆ·æ–°å’Œåœæ­¢åŠ è½½å½“å‰æ–‡æ¡£çš„åˆ·æ–°å’Œåœæ­¢æŒ‰é’®ç”¨äºè¿”å›ä¸»é¡µçš„ä¸»é¡µæŒ‰é’®å¥‡æ€ªçš„æ˜¯ï¼Œæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¹¶æ²¡æœ‰ä»»ä½•æ­£å¼çš„è§„èŒƒï¼Œè¿™æ˜¯å¤šå¹´æ¥çš„æœ€ä½³å®è·µè‡ªç„¶å‘å±•ä»¥åŠå½¼æ­¤ä¹‹é—´ç›¸äº’æ¨¡ä»¿çš„ç»“æœã€‚HTML5 ä¹Ÿæ²¡æœ‰å®šä¹‰æµè§ˆå™¨å¿…é¡»å…·æœ‰çš„ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼Œä½†åˆ—å‡ºäº†ä¸€äº›é€šç”¨çš„å…ƒç´ ï¼Œä¾‹å¦‚åœ°å€æ ã€çŠ¶æ€æ å’Œå·¥å…·æ ç­‰ã€‚å½“ç„¶ï¼Œå„æµè§ˆå™¨ä¹Ÿå¯ä»¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Firefox çš„ä¸‹è½½ç®¡ç†å™¨ã€‚æµè§ˆå™¨çš„é«˜å±‚ç»“æ„æµè§ˆå™¨çš„ä¸»è¦ç»„ä»¶ä¸º (1.1)ï¼šç”¨æˆ·ç•Œé¢ - åŒ…æ‹¬åœ°å€æ ã€å‰è¿› / åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚æµè§ˆå™¨å¼•æ“ - åœ¨ç”¨æˆ·ç•Œé¢å’Œå‘ˆç°å¼•æ“ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚å‘ˆç°å¼•æ“ - è´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯ HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æ HTML å’Œ CSS å†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ç½‘ç»œ - ç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚ç”¨æˆ·ç•Œé¢åç«¯ - ç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚JavaScript è§£é‡Šå™¨ã€‚ç”¨äºè§£æå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚æ•°æ®å­˜å‚¨ã€‚è¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚ Cookieã€‚æ–°çš„ HTML è§„èŒƒ (HTML5) å®šä¹‰äº† â€œç½‘ç»œæ•°æ®åº“â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ï¼ˆä½†æ˜¯è½»ä¾¿ï¼‰çš„æµè§ˆå™¨å†…æ•°æ®åº“ã€‚ å›¾ï¼šæµè§ˆå™¨çš„ä¸»è¦ç»„ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå’Œå¤§å¤šæ•°æµè§ˆå™¨ä¸åŒï¼ŒChrome æµè§ˆå™¨çš„æ¯ä¸ªæ ‡ç­¾é¡µéƒ½åˆ†åˆ«å¯¹åº”ä¸€ä¸ªå‘ˆç°å¼•æ“å®ä¾‹ã€‚æ¯ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚å‘ˆç°å¼•æ“å‘ˆç°å¼•æ“çš„ä½œç”¨å˜›â€¦ å½“ç„¶å°±æ˜¯ â€œå‘ˆç°â€ äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨æµè§ˆå™¨çš„å±å¹•ä¸Šæ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ˆç°å¼•æ“å¯æ˜¾ç¤º HTML å’Œ XML æ–‡æ¡£ä¸å›¾ç‰‡ã€‚é€šè¿‡æ’ä»¶ï¼ˆæˆ–æµè§ˆå™¨æ‰©å±•ç¨‹åºï¼‰ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºå…¶ä»–ç±»å‹çš„å†…å®¹ï¼›ä¾‹å¦‚ï¼Œä½¿ç”¨ PDF æŸ¥çœ‹å™¨æ’ä»¶å°±èƒ½æ˜¾ç¤º PDF æ–‡æ¡£ã€‚ä½†æ˜¯åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†é›†ä¸­ä»‹ç»å…¶ä¸»è¦ç”¨é€”ï¼šæ˜¾ç¤ºä½¿ç”¨ CSS æ ¼å¼åŒ–çš„ HTML å†…å®¹å’Œå›¾ç‰‡ã€‚å‘ˆç°å¼•æ“æœ¬æ–‡æ‰€è®¨è®ºçš„æµè§ˆå™¨ï¼ˆFirefoxã€Chrome æµè§ˆå™¨å’Œ Safariï¼‰æ˜¯åŸºäºä¸¤ç§å‘ˆç°å¼•æ“æ„å»ºçš„ã€‚Firefox ä½¿ç”¨çš„æ˜¯ Geckoï¼Œè¿™æ˜¯ Mozilla å…¬å¸ â€œè‡ªåˆ¶â€ çš„å‘ˆç°å¼•æ“ã€‚è€Œ Safari å’Œ Chrome æµè§ˆå™¨ä½¿ç”¨çš„éƒ½æ˜¯ WebKitã€‚WebKit æ˜¯ä¸€ç§å¼€æ”¾æºä»£ç å‘ˆç°å¼•æ“ï¼Œèµ·åˆç”¨äº Linux å¹³å°ï¼Œéšåç”± Apple å…¬å¸è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œæ”¯æŒè‹¹æœæœºå’Œ Windowsã€‚æœ‰å…³è¯¦æƒ…ï¼Œè¯·å‚é˜… webkit.orgã€‚ä¸»æµç¨‹å‘ˆç°å¼•æ“ä¸€å¼€å§‹ä¼šä»ç½‘ç»œå±‚è·å–è¯·æ±‚æ–‡æ¡£çš„å†…å®¹ï¼Œå†…å®¹çš„å¤§å°ä¸€èˆ¬é™åˆ¶åœ¨ 8000 ä¸ªå—ä»¥å†…ã€‚ç„¶åè¿›è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„åŸºæœ¬æµç¨‹ï¼š å›¾ï¼šå‘ˆç°å¼•æ“çš„åŸºæœ¬æµç¨‹ã€‚å‘ˆç°å¼•æ“å°†å¼€å§‹è§£æ HTML æ–‡æ¡£ï¼Œå¹¶å°†å„æ ‡è®°é€ä¸ªè½¬åŒ–æˆ â€œå†…å®¹æ ‘â€ ä¸Šçš„ DOM èŠ‚ç‚¹ã€‚åŒæ—¶ä¹Ÿä¼šè§£æå¤–éƒ¨ CSS æ–‡ä»¶ä»¥åŠæ ·å¼å…ƒç´ ä¸­çš„æ ·å¼æ•°æ®ã€‚HTML ä¸­è¿™äº›å¸¦æœ‰è§†è§‰æŒ‡ä»¤çš„æ ·å¼ä¿¡æ¯å°†ç”¨äºåˆ›å»ºå¦ä¸€ä¸ªæ ‘ç»“æ„ï¼šå‘ˆç°æ ‘ã€‚å‘ˆç°æ ‘åŒ…å«å¤šä¸ªå¸¦æœ‰è§†è§‰å±æ€§ï¼ˆå¦‚é¢œè‰²å’Œå°ºå¯¸ï¼‰çš„çŸ©å½¢ã€‚è¿™äº›çŸ©å½¢çš„æ’åˆ—é¡ºåºå°±æ˜¯å®ƒä»¬å°†åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„é¡ºåºã€‚å‘ˆç°æ ‘æ„å»ºå®Œæ¯•ä¹‹åï¼Œè¿›å…¥ â€œå¸ƒå±€â€ å¤„ç†é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªåº”å‡ºç°åœ¨å±å¹•ä¸Šçš„ç¡®åˆ‡åæ ‡ã€‚ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯ç»˜åˆ¶ - å‘ˆç°å¼•æ“ä¼šéå†å‘ˆç°æ ‘ï¼Œç”±ç”¨æˆ·ç•Œé¢åç«¯å±‚å°†æ¯ä¸ªèŠ‚ç‚¹ç»˜åˆ¶å‡ºæ¥ã€‚éœ€è¦ç€é‡æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ã€‚ä¸ºè¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå‘ˆç°å¼•æ“ä¼šåŠ›æ±‚å°½å¿«å°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒä¸å¿…ç­‰åˆ°æ•´ä¸ª HTML æ–‡æ¡£è§£æå®Œæ¯•ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ„å»ºå‘ˆç°æ ‘å’Œè®¾ç½®å¸ƒå±€ã€‚åœ¨ä¸æ–­æ¥æ”¶å’Œå¤„ç†æ¥è‡ªç½‘ç»œçš„å…¶ä½™å†…å®¹çš„åŒæ—¶ï¼Œå‘ˆç°å¼•æ“ä¼šå°†éƒ¨åˆ†å†…å®¹è§£æå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚ä¸»æµç¨‹ç¤ºä¾‹ å›¾ï¼šWebKit ä¸»æµç¨‹ å›¾ï¼šMozilla çš„ Gecko å‘ˆç°å¼•æ“ä¸»æµç¨‹ (3.6)ä»å›¾ 3 å’Œå›¾ 4 å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶ WebKit å’Œ Gecko ä½¿ç”¨çš„æœ¯è¯­ç•¥æœ‰ä¸åŒï¼Œä½†æ•´ä½“æµç¨‹æ˜¯åŸºæœ¬ç›¸åŒçš„ã€‚Gecko å°†è§†è§‰æ ¼å¼åŒ–å…ƒç´ ç»„æˆçš„æ ‘ç§°ä¸º â€œæ¡†æ¶æ ‘â€ã€‚æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚WebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯â€œå‘ˆç°æ ‘â€ï¼Œå®ƒç”±â€œå‘ˆç°å¯¹è±¡â€ ç»„æˆã€‚å¯¹äºå…ƒç´ çš„æ”¾ç½®ï¼ŒWebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯ â€œå¸ƒå±€â€ï¼Œè€Œ Gecko ç§°ä¹‹ä¸ºâ€œé‡æ’â€ã€‚å¯¹äºè¿æ¥ DOM èŠ‚ç‚¹å’Œå¯è§†åŒ–ä¿¡æ¯ä»è€Œåˆ›å»ºå‘ˆç°æ ‘çš„è¿‡ç¨‹ï¼ŒWebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯â€œé™„åŠ â€ã€‚æœ‰ä¸€ä¸ªç»†å¾®çš„éè¯­ä¹‰å·®åˆ«ï¼Œå°±æ˜¯ Gecko åœ¨ HTML ä¸ DOM æ ‘ä¹‹é—´è¿˜æœ‰ä¸€ä¸ªç§°ä¸ºâ€œå†…å®¹æ§½â€ çš„å±‚ï¼Œç”¨äºç”Ÿæˆ DOM å…ƒç´ ã€‚æˆ‘ä»¬ä¼šé€ä¸€è®ºè¿°æµç¨‹ä¸­çš„æ¯ä¸€éƒ¨åˆ†ï¼šè§£æ - ç»¼è¿°è§£ææ˜¯å‘ˆç°å¼•æ“ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬è¦æ›´æ·±å…¥åœ°è®²è§£ã€‚é¦–å…ˆï¼Œæ¥ä»‹ç»ä¸€ä¸‹è§£æã€‚è§£ææ–‡æ¡£æ˜¯æŒ‡å°†æ–‡æ¡£è½¬åŒ–æˆä¸ºæœ‰æ„ä¹‰çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å¯è®©ä»£ç ç†è§£å’Œä½¿ç”¨çš„ç»“æ„ã€‚è§£æå¾—åˆ°çš„ç»“æœé€šå¸¸æ˜¯ä»£è¡¨äº†æ–‡æ¡£ç»“æ„çš„èŠ‚ç‚¹æ ‘ï¼Œå®ƒç§°ä½œè§£ææ ‘æˆ–è€…è¯­æ³•æ ‘ã€‚ç¤ºä¾‹ - è§£æ 2 + 3 - 1 è¿™ä¸ªè¡¨è¾¾å¼ï¼Œä¼šè¿”å›ä¸‹é¢çš„æ ‘ï¼š å›¾ï¼šæ•°å­¦è¡¨è¾¾å¼æ ‘èŠ‚ç‚¹è¯­æ³•è§£ææ˜¯ä»¥æ–‡æ¡£æ‰€éµå¾ªçš„è¯­æ³•è§„åˆ™ï¼ˆç¼–å†™æ–‡æ¡£æ‰€ç”¨çš„è¯­è¨€æˆ–æ ¼å¼ï¼‰ä¸ºåŸºç¡€çš„ã€‚æ‰€æœ‰å¯ä»¥è§£æçš„æ ¼å¼éƒ½å¿…é¡»å¯¹åº”ç¡®å®šçš„è¯­æ³•ï¼ˆç”±è¯æ±‡å’Œè¯­æ³•è§„åˆ™æ„æˆï¼‰ã€‚è¿™ç§°ä¸ºä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ã€‚äººç±»è¯­è¨€å¹¶ä¸å±äºè¿™æ ·çš„è¯­è¨€ï¼Œå› æ­¤æ— æ³•ç”¨å¸¸è§„çš„è§£ææŠ€æœ¯è¿›è¡Œè§£æã€‚è§£æå™¨å’Œè¯æ³•åˆ†æå™¨çš„ç»„åˆè§£æçš„è¿‡ç¨‹å¯ä»¥åˆ†æˆä¸¤ä¸ªå­è¿‡ç¨‹ï¼šè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚è¯æ³•åˆ†ææ˜¯å°†è¾“å…¥å†…å®¹åˆ†å‰²æˆå¤§é‡æ ‡è®°çš„è¿‡ç¨‹ã€‚æ ‡è®°æ˜¯è¯­è¨€ä¸­çš„è¯æ±‡ï¼Œå³æ„æˆå†…å®¹çš„å•ä½ã€‚åœ¨äººç±»è¯­è¨€ä¸­ï¼Œå®ƒç›¸å½“äºè¯­è¨€å­—å…¸ä¸­çš„å•è¯ã€‚è¯­æ³•åˆ†ææ˜¯åº”ç”¨è¯­è¨€çš„è¯­æ³•è§„åˆ™çš„è¿‡ç¨‹ã€‚è§£æå™¨é€šå¸¸å°†è§£æå·¥ä½œåˆ†ç»™ä»¥ä¸‹ä¸¤ä¸ªç»„ä»¶æ¥å¤„ç†ï¼šè¯æ³•åˆ†æå™¨ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºæ ‡è®°ç”Ÿæˆå™¨ï¼‰ï¼Œè´Ÿè´£å°†è¾“å…¥å†…å®¹åˆ†è§£æˆä¸€ä¸ªä¸ªæœ‰æ•ˆæ ‡è®°ï¼›è€Œè§£æå™¨è´Ÿè´£æ ¹æ®è¯­è¨€çš„è¯­æ³•è§„åˆ™åˆ†ææ–‡æ¡£çš„ç»“æ„ï¼Œä»è€Œæ„å»ºè§£ææ ‘ã€‚è¯æ³•åˆ†æå™¨çŸ¥é“å¦‚ä½•å°†æ— å…³çš„å­—ç¬¦ï¼ˆæ¯”å¦‚ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼‰åˆ†ç¦»å‡ºæ¥ã€‚ å›¾ï¼šä»æºæ–‡æ¡£åˆ°è§£ææ ‘è§£ææ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ã€‚é€šå¸¸ï¼Œè§£æå™¨ä¼šå‘è¯æ³•åˆ†æå™¨è¯·æ±‚ä¸€ä¸ªæ–°æ ‡è®°ï¼Œå¹¶å°è¯•å°†å…¶ä¸æŸæ¡è¯­æ³•è§„åˆ™è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœå‘ç°äº†åŒ¹é…è§„åˆ™ï¼Œè§£æå™¨ä¼šå°†ä¸€ä¸ªå¯¹åº”äºè¯¥æ ‡è®°çš„èŠ‚ç‚¹æ·»åŠ åˆ°è§£ææ ‘ä¸­ï¼Œç„¶åç»§ç»­è¯·æ±‚ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚å¦‚æœæ²¡æœ‰è§„åˆ™å¯ä»¥åŒ¹é…ï¼Œè§£æå™¨å°±ä¼šå°†æ ‡è®°å­˜å‚¨åˆ°å†…éƒ¨ï¼Œå¹¶ç»§ç»­è¯·æ±‚æ ‡è®°ï¼Œç›´è‡³æ‰¾åˆ°å¯ä¸æ‰€æœ‰å†…éƒ¨å­˜å‚¨çš„æ ‡è®°åŒ¹é…çš„è§„åˆ™ã€‚å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•åŒ¹é…è§„åˆ™ï¼Œè§£æå™¨å°±ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ã€‚è¿™æ„å‘³ç€æ–‡æ¡£æ— æ•ˆï¼ŒåŒ…å«è¯­æ³•é”™è¯¯ã€‚ç¿»è¯‘å¾ˆå¤šæ—¶å€™ï¼Œè§£ææ ‘è¿˜ä¸æ˜¯æœ€ç»ˆäº§å“ã€‚è§£æé€šå¸¸æ˜¯åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œè€Œç¿»è¯‘æ˜¯æŒ‡å°†è¾“å…¥æ–‡æ¡£è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ã€‚ç¼–è¯‘å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚ç¼–è¯‘å™¨å¯å°†æºä»£ç ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œå…·ä½“è¿‡ç¨‹æ˜¯é¦–å…ˆå°†æºä»£ç è§£ææˆè§£ææ ‘ï¼Œç„¶åå°†è§£ææ ‘ç¿»è¯‘æˆæœºå™¨ä»£ç æ–‡æ¡£ã€‚ å›¾ï¼šç¼–è¯‘æµç¨‹è§£æç¤ºä¾‹åœ¨å›¾ 5 ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼å»ºç«‹äº†è§£ææ ‘ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯•ç€å®šä¹‰ä¸€ä¸ªç®€å•çš„æ•°å­¦è¯­è¨€ï¼Œç”¨æ¥æ¼”ç¤ºè§£æçš„è¿‡ç¨‹ã€‚è¯æ±‡ï¼šæˆ‘ä»¬ç”¨çš„è¯­è¨€å¯åŒ…å«æ•´æ•°ã€åŠ å·å’Œå‡å·ã€‚è¯­æ³•ï¼šæ„æˆè¯­è¨€çš„è¯­æ³•å•ä½æ˜¯è¡¨è¾¾å¼ã€é¡¹å’Œè¿ç®—ç¬¦ã€‚æˆ‘ä»¬ç”¨çš„è¯­è¨€å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼çš„å®šä¹‰æ˜¯ï¼šä¸€ä¸ª â€œé¡¹â€ æ¥ä¸€ä¸ªâ€œè¿ç®—ç¬¦â€ï¼Œç„¶åå†æ¥ä¸€ä¸ªâ€œé¡¹â€ã€‚è¿ç®—ç¬¦æ˜¯åŠ å·æˆ–å‡å·ã€‚é¡¹æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–ä¸€ä¸ªè¡¨è¾¾å¼ã€‚è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹ 2 + 3 - 1ã€‚åŒ¹é…è¯­æ³•è§„åˆ™çš„ç¬¬ä¸€ä¸ªå­ä¸²æ˜¯ 2ï¼Œè€Œæ ¹æ®ç¬¬ 5 æ¡è¯­æ³•è§„åˆ™ï¼Œè¿™æ˜¯ä¸€ä¸ªé¡¹ã€‚åŒ¹é…è¯­æ³•è§„åˆ™çš„ç¬¬äºŒä¸ªå­ä¸²æ˜¯ 2 + 3ï¼Œè€Œæ ¹æ®ç¬¬ 3 æ¡è§„åˆ™ï¼ˆä¸€ä¸ªé¡¹æ¥ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç„¶åå†æ¥ä¸€ä¸ªé¡¹ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹å·²ç»åˆ°äº†è¾“å…¥çš„ç»“æŸã€‚2 + 3 - 1 æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“ 2 + 3 æ˜¯ä¸€ä¸ªé¡¹ï¼Œè¿™æ ·å°±ç¬¦åˆ â€œä¸€ä¸ªé¡¹æ¥ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç„¶åå†æ¥ä¸€ä¸ªé¡¹â€ çš„è§„åˆ™ã€‚2 + + ä¸ä¸ä»»ä½•è§„åˆ™åŒ¹é…ï¼Œå› æ­¤æ˜¯æ— æ•ˆçš„è¾“å…¥ã€‚è¯æ±‡å’Œè¯­æ³•çš„æ­£å¼å®šä¹‰è¯æ±‡é€šå¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹è¯­è¨€å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š123INTEGER :0|[1-9][0-9]*PLUS : +MINUS: -æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™é‡Œç”¨æ­£åˆ™è¡¨è¾¾å¼ç»™å‡ºäº†æ•´æ•°çš„å®šä¹‰ã€‚è¯­æ³•é€šå¸¸ä½¿ç”¨ä¸€ç§ç§°ä¸º BNF çš„æ ¼å¼æ¥å®šä¹‰ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹è¯­è¨€å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š123expression := term operation termoperation := PLUS | MINUSterm := INTEGER | expressionä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚æœè¯­è¨€çš„è¯­æ³•æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼Œå°±å¯ä»¥ç”±å¸¸è§„è§£æå™¨è¿›è¡Œè§£æã€‚ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•çš„ç›´è§‚å®šä¹‰å°±æ˜¯å¯ä»¥å®Œå…¨ç”¨ BNF æ ¼å¼è¡¨è¾¾çš„è¯­æ³•ã€‚æœ‰å…³æ­£å¼å®šä¹‰ï¼Œè¯·å‚é˜…å…³äºä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•çš„ç»´åŸºç™¾ç§‘æ–‡ç« ã€‚è§£æå™¨ç±»å‹æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹çš„è§£æå™¨ï¼šè‡ªä¸Šè€Œä¸‹è§£æå™¨å’Œè‡ªä¸‹è€Œä¸Šè§£æå™¨ã€‚ç›´è§‚åœ°æ¥è¯´ï¼Œè‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ä»è¯­æ³•çš„é«˜å±‚ç»“æ„å‡ºå‘ï¼Œå°è¯•ä»ä¸­æ‰¾åˆ°åŒ¹é…çš„ç»“æ„ã€‚è€Œè‡ªä¸‹è€Œä¸Šçš„è§£æå™¨ä»ä½å±‚è§„åˆ™å‡ºå‘ï¼Œå°†è¾“å…¥å†…å®¹é€æ­¥è½¬åŒ–ä¸ºè¯­æ³•è§„åˆ™ï¼Œç›´è‡³æ»¡è¶³é«˜å±‚è§„åˆ™ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ç§è§£æå™¨ä¼šå¦‚ä½•è§£ææˆ‘ä»¬çš„ç¤ºä¾‹ï¼šè‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ä¼šä»é«˜å±‚çš„è§„åˆ™å¼€å§‹ï¼šé¦–å…ˆå°† 2 + 3 æ ‡è¯†ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç„¶åå°† 2 + 3 - 1 æ ‡è¯†ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆæ ‡è¯†è¡¨è¾¾å¼çš„è¿‡ç¨‹æ¶‰åŠåˆ°åŒ¹é…å…¶ä»–è§„åˆ™ï¼Œä½†æ˜¯èµ·ç‚¹æ˜¯æœ€é«˜çº§åˆ«çš„è§„åˆ™ï¼‰ã€‚è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨å°†æ‰«æè¾“å…¥å†…å®¹ï¼Œæ‰¾åˆ°åŒ¹é…çš„è§„åˆ™åï¼Œå°†åŒ¹é…çš„è¾“å…¥å†…å®¹æ›¿æ¢æˆè§„åˆ™ã€‚å¦‚æ­¤ç»§ç»­æ›¿æ¢ï¼Œç›´åˆ°è¾“å…¥å†…å®¹çš„ç»“å°¾ã€‚éƒ¨åˆ†åŒ¹é…çš„è¡¨è¾¾å¼ä¿å­˜åœ¨è§£æå™¨çš„å †æ ˆä¸­ã€‚å †æ ˆè¾“å…¥2 + 3 - 1é¡¹+ 3 - 1é¡¹è¿ç®—3 - 1è¡¨è¾¾å¼- 1è¡¨è¾¾å¼è¿ç®—ç¬¦1è¡¨è¾¾å¼è¿™ç§è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨ç§°ä¸ºç§»ä½å½’çº¦è§£æå™¨ï¼Œå› ä¸ºè¾“å…¥åœ¨å‘å³ç§»ä½ï¼ˆè®¾æƒ³æœ‰ä¸€ä¸ªæŒ‡é’ˆä»è¾“å…¥å†…å®¹çš„å¼€å¤´ç§»åŠ¨åˆ°ç»“å°¾ï¼‰ï¼Œå¹¶ä¸”é€æ¸å½’çº¦åˆ°è¯­æ³•è§„åˆ™ä¸Šã€‚è‡ªåŠ¨ç”Ÿæˆè§£æå™¨æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨ç”Ÿæˆè§£æå™¨ï¼Œå®ƒä»¬ç§°ä¸ºè§£æå™¨ç”Ÿæˆå™¨ã€‚æ‚¨åªè¦å‘å…¶æä¾›æ‚¨æ‰€ç”¨è¯­è¨€çš„è¯­æ³•ï¼ˆè¯æ±‡å’Œè¯­æ³•è§„åˆ™ï¼‰ï¼Œå®ƒå°±ä¼šç”Ÿæˆç›¸åº”çš„è§£æå™¨ã€‚åˆ›å»ºè§£æå™¨éœ€è¦å¯¹è§£ææœ‰æ·±åˆ»ç†è§£ï¼Œè€Œäººå·¥åˆ›å»ºå¹¶ä¼˜åŒ–è§£æå™¨å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œæ‰€ä»¥è§£æå™¨ç”Ÿæˆå™¨æ˜¯éå¸¸å®ç”¨çš„ã€‚WebKit ä½¿ç”¨äº†ä¸¤ç§éå¸¸æœ‰åçš„è§£æå™¨ç”Ÿæˆå™¨ï¼šç”¨äºåˆ›å»ºè¯æ³•åˆ†æå™¨çš„ Flex ä»¥åŠç”¨äºåˆ›å»ºè§£æå™¨çš„ Bisonï¼ˆæ‚¨ä¹Ÿå¯èƒ½é‡åˆ° Lex å’Œ Yacc è¿™æ ·çš„åˆ«åï¼‰ã€‚Flex çš„è¾“å…¥æ˜¯åŒ…å«æ ‡è®°çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„æ–‡ä»¶ã€‚Bison çš„è¾“å…¥æ˜¯é‡‡ç”¨ BNF æ ¼å¼çš„è¯­è¨€è¯­æ³•è§„åˆ™ã€‚HTML è§£æå™¨HTML è§£æå™¨çš„ä»»åŠ¡æ˜¯å°† HTML æ ‡è®°è§£ææˆè§£ææ ‘ã€‚HTML è¯­æ³•å®šä¹‰HTML çš„è¯æ±‡å’Œè¯­æ³•åœ¨ W3C ç»„ç»‡åˆ›å»ºçš„è§„èŒƒä¸­è¿›è¡Œäº†å®šä¹‰ã€‚å½“å‰çš„ç‰ˆæœ¬æ˜¯ HTML4ï¼ŒHTML5 æ­£åœ¨å¤„ç†è¿‡ç¨‹ä¸­ã€‚éä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•æ­£å¦‚æˆ‘ä»¬åœ¨è§£æè¿‡ç¨‹çš„ç®€ä»‹ä¸­å·²ç»äº†è§£åˆ°çš„ï¼Œè¯­æ³•å¯ä»¥ç”¨ BNF ç­‰æ ¼å¼è¿›è¡Œæ­£å¼å®šä¹‰ã€‚å¾ˆé—æ†¾ï¼Œæ‰€æœ‰çš„å¸¸è§„è§£æå™¨éƒ½ä¸é€‚ç”¨äº HTMLï¼ˆæˆ‘å¹¶ä¸æ˜¯å¼€ç©ç¬‘ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºè§£æ CSS å’Œ JavaScriptï¼‰ã€‚HTML å¹¶ä¸èƒ½å¾ˆå®¹æ˜“åœ°ç”¨è§£æå™¨æ‰€éœ€çš„ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•æ¥å®šä¹‰ã€‚æœ‰ä¸€ç§å¯ä»¥å®šä¹‰ HTML çš„æ­£è§„æ ¼å¼ï¼šDTDï¼ˆDocument Type Definitionï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰ï¼Œä½†å®ƒä¸æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ã€‚è¿™åˆçœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼šHTML å’Œ XML éå¸¸ç›¸ä¼¼ã€‚æœ‰å¾ˆå¤š XML è§£æå™¨å¯ä»¥ä½¿ç”¨ã€‚HTML å­˜åœ¨ä¸€ä¸ª XML å˜ä½“ (XHTML)ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«å‘¢ï¼ŸåŒºåˆ«åœ¨äº HTML çš„å¤„ç†æ›´ä¸º â€œå®½å®¹â€ï¼Œå®ƒå…è®¸æ‚¨çœç•¥æŸäº›éšå¼æ·»åŠ çš„æ ‡è®°ï¼Œæœ‰æ—¶è¿˜èƒ½çœç•¥ä¸€äº›èµ·å§‹æˆ–è€…ç»“æŸæ ‡è®°ç­‰ç­‰ã€‚å’Œ XML ä¸¥æ ¼çš„è¯­æ³•ä¸åŒï¼ŒHTML æ•´ä½“æ¥çœ‹æ˜¯ä¸€ç§â€œè½¯æ€§â€ çš„è¯­æ³•ã€‚æ˜¾ç„¶ï¼Œè¿™ç§çœ‹ä¸Šå»ç»†å¾®çš„å·®åˆ«å®é™…ä¸Šå´å¸¦æ¥äº†å·¨å¤§çš„å½±å“ã€‚ä¸€æ–¹é¢ï¼Œè¿™æ˜¯ HTML å¦‚æ­¤æµè¡Œçš„åŸå› ï¼šå®ƒèƒ½åŒ…å®¹æ‚¨çš„é”™è¯¯ï¼Œç®€åŒ–ç½‘ç»œå¼€å‘ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆéš¾ç¼–å†™æ­£å¼çš„è¯­æ³•ã€‚æ¦‚æ‹¬åœ°è¯´ï¼ŒHTML æ— æ³•å¾ˆå®¹æ˜“åœ°é€šè¿‡å¸¸è§„è§£æå™¨è§£æï¼ˆå› ä¸ºå®ƒçš„è¯­æ³•ä¸æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼‰ï¼Œä¹Ÿæ— æ³•é€šè¿‡ XML è§£æå™¨æ¥è§£æã€‚HTML DTDHTML çš„å®šä¹‰é‡‡ç”¨äº† DTD æ ¼å¼ã€‚æ­¤æ ¼å¼å¯ç”¨äºå®šä¹‰ SGML æ—çš„è¯­è¨€ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰å…è®¸ä½¿ç”¨çš„å…ƒç´ åŠå…¶å±æ€§å’Œå±‚æ¬¡ç»“æ„çš„å®šä¹‰ã€‚å¦‚ä¸Šæ–‡æ‰€è¿°ï¼ŒHTML DTD æ— æ³•æ„æˆä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ã€‚DTD å­˜åœ¨ä¸€äº›å˜ä½“ã€‚ä¸¥æ ¼æ¨¡å¼å®Œå…¨éµå®ˆ HTML è§„èŒƒï¼Œè€Œå…¶ä»–æ¨¡å¼å¯æ”¯æŒä»¥å‰çš„æµè§ˆå™¨æ‰€ä½¿ç”¨çš„æ ‡è®°ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ç¡®ä¿å‘ä¸‹å…¼å®¹ä¸€äº›æ—©æœŸç‰ˆæœ¬çš„å†…å®¹ã€‚æœ€æ–°çš„ä¸¥æ ¼æ¨¡å¼ DTD å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šwww.w3.org/TR/html4/strict.dtdDOMè§£æå™¨çš„è¾“å‡º â€œè§£ææ ‘â€ æ˜¯ç”± DOM å…ƒç´ å’Œå±æ€§èŠ‚ç‚¹æ„æˆçš„æ ‘ç»“æ„ã€‚DOM æ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (Document Object Model) çš„ç¼©å†™ã€‚å®ƒæ˜¯ HTML æ–‡æ¡£çš„å¯¹è±¡è¡¨ç¤ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤–éƒ¨å†…å®¹ï¼ˆä¾‹å¦‚ JavaScriptï¼‰ä¸ HTML å…ƒç´ ä¹‹é—´çš„æ¥å£ã€‚è§£ææ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯ â€œDocumentâ€ å¯¹è±¡ã€‚DOM ä¸æ ‡è®°ä¹‹é—´å‡ ä¹æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µæ ‡è®°ï¼š12345678&lt;html&gt; &lt;body&gt; &lt;p&gt; Hello World &lt;/p&gt; &lt;div&gt; &lt;img src=&quot;example.png&quot;/&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;å¯ç¿»è¯‘æˆå¦‚ä¸‹çš„ DOM æ ‘ï¼š å›¾ï¼šç¤ºä¾‹æ ‡è®°çš„ DOM æ ‘å’Œ HTML ä¸€æ ·ï¼ŒDOM ä¹Ÿæ˜¯ç”± W3C ç»„ç»‡æŒ‡å®šçš„ã€‚è¯·å‚è§ www.w3.org/DOM/DOMTRã€‚è¿™æ˜¯å…³äºæ–‡æ¡£æ“ä½œçš„é€šç”¨è§„èŒƒã€‚å…¶ä¸­ä¸€ä¸ªç‰¹å®šæ¨¡å—æè¿°é’ˆå¯¹ HTML çš„å…ƒç´ ã€‚HTML çš„å®šä¹‰å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šwww.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/idl-definitions.htmlã€‚æˆ‘æ‰€è¯´çš„æ ‘åŒ…å« DOM èŠ‚ç‚¹ï¼ŒæŒ‡çš„æ˜¯æ ‘æ˜¯ç”±å®ç°äº†æŸä¸ª DOM æ¥å£çš„å…ƒç´ æ„æˆçš„ã€‚æµè§ˆå™¨åœ¨å…·ä½“çš„å®ç°ä¸­ä¼šæœ‰ä¸€äº›ä¾›å†…éƒ¨ä½¿ç”¨çš„å…¶ä»–å±æ€§ã€‚è§£æç®—æ³•æˆ‘ä»¬åœ¨ä¹‹å‰ç« èŠ‚å·²ç»è¯´è¿‡ï¼ŒHTML æ— æ³•ç”¨å¸¸è§„çš„è‡ªä¸Šè€Œä¸‹æˆ–è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨è¿›è¡Œè§£æã€‚åŸå› åœ¨äºï¼šè¯­è¨€çš„å®½å®¹æœ¬è´¨ã€‚æµè§ˆå™¨å†æ¥å¯¹ä¸€äº›å¸¸è§çš„æ— æ•ˆ HTML ç”¨æ³•é‡‡å–åŒ…å®¹æ€åº¦ã€‚è§£æè¿‡ç¨‹éœ€è¦ä¸æ–­åœ°åå¤ã€‚æºå†…å®¹åœ¨è§£æè¿‡ç¨‹ä¸­é€šå¸¸ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯åœ¨ HTML ä¸­ï¼Œè„šæœ¬æ ‡è®°å¦‚æœåŒ…å« document.writeï¼Œå°±ä¼šæ·»åŠ é¢å¤–çš„æ ‡è®°ï¼Œè¿™æ ·è§£æè¿‡ç¨‹å®é™…ä¸Šå°±æ›´æ”¹äº†è¾“å…¥å†…å®¹ã€‚ç”±äºä¸èƒ½ä½¿ç”¨å¸¸è§„çš„è§£ææŠ€æœ¯ï¼Œæµè§ˆå™¨å°±åˆ›å»ºäº†è‡ªå®šä¹‰çš„è§£æå™¨æ¥è§£æ HTMLã€‚HTML5 è§„èŒƒè¯¦ç»†åœ°æè¿°äº†è§£æç®—æ³•ã€‚æ­¤ç®—æ³•ç”±ä¸¤ä¸ªé˜¶æ®µç»„æˆï¼šæ ‡è®°åŒ–å’Œæ ‘æ„å»ºã€‚æ ‡è®°åŒ–æ˜¯è¯æ³•åˆ†æè¿‡ç¨‹ï¼Œå°†è¾“å…¥å†…å®¹è§£ææˆå¤šä¸ªæ ‡è®°ã€‚HTML æ ‡è®°åŒ…æ‹¬èµ·å§‹æ ‡è®°ã€ç»“æŸæ ‡è®°ã€å±æ€§åç§°å’Œå±æ€§å€¼ã€‚æ ‡è®°ç”Ÿæˆå™¨è¯†åˆ«æ ‡è®°ï¼Œä¼ é€’ç»™æ ‘æ„é€ å™¨ï¼Œç„¶åæ¥å—ä¸‹ä¸€ä¸ªå­—ç¬¦ä»¥è¯†åˆ«ä¸‹ä¸€ä¸ªæ ‡è®°ï¼›å¦‚æ­¤åå¤ç›´åˆ°è¾“å…¥çš„ç»“æŸã€‚ å›¾ï¼šHTML è§£ææµç¨‹ï¼ˆæ‘˜è‡ª HTML5 è§„èŒƒï¼‰æ ‡è®°åŒ–ç®—æ³•è¯¥ç®—æ³•çš„è¾“å‡ºç»“æœæ˜¯ HTML æ ‡è®°ã€‚è¯¥ç®—æ³•ä½¿ç”¨çŠ¶æ€æœºæ¥è¡¨ç¤ºã€‚æ¯ä¸€ä¸ªçŠ¶æ€æ¥æ”¶æ¥è‡ªè¾“å…¥ä¿¡æ¯æµçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¹¶æ ¹æ®è¿™äº›å­—ç¬¦æ›´æ–°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å½“å‰çš„æ ‡è®°åŒ–çŠ¶æ€å’Œæ ‘ç»“æ„çŠ¶æ€ä¼šå½±å“è¿›å…¥ä¸‹ä¸€çŠ¶æ€çš„å†³å®šã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿æ¥æ”¶çš„å­—ç¬¦ç›¸åŒï¼Œå¯¹äºä¸‹ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œå…·ä½“å–å†³äºå½“å‰çš„çŠ¶æ€ã€‚è¯¥ç®—æ³•ç›¸å½“å¤æ‚ï¼Œæ— æ³•åœ¨æ­¤è¯¦è¿°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥å¸®åŠ©å¤§å®¶ç†è§£å…¶åŸç†ã€‚åŸºæœ¬ç¤ºä¾‹ - å°†ä¸‹é¢çš„ HTML ä»£ç æ ‡è®°åŒ–ï¼š12345&lt;html&gt; &lt;body&gt; Hello world &lt;/body&gt;&lt;/html&gt;åˆå§‹çŠ¶æ€æ˜¯æ•°æ®çŠ¶æ€ã€‚é‡åˆ°å­—ç¬¦ &lt; æ—¶ï¼ŒçŠ¶æ€æ›´æ”¹ä¸º â€œæ ‡è®°æ‰“å¼€çŠ¶æ€â€ã€‚æ¥æ”¶ä¸€ä¸ª a-z å­—ç¬¦ä¼šåˆ›å»º â€œèµ·å§‹æ ‡è®°â€ï¼ŒçŠ¶æ€æ›´æ”¹ä¸º â€œæ ‡è®°åç§°çŠ¶æ€â€ã€‚è¿™ä¸ªçŠ¶æ€ä¼šä¸€ç›´ä¿æŒåˆ°æ¥æ”¶ &gt; å­—ç¬¦ã€‚åœ¨æ­¤æœŸé—´æ¥æ”¶çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¼šé™„åŠ åˆ°æ–°çš„æ ‡è®°åç§°ä¸Šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ ‡è®°æ˜¯ html æ ‡è®°ã€‚é‡åˆ° &gt; æ ‡è®°æ—¶ï¼Œä¼šå‘é€å½“å‰çš„æ ‡è®°ï¼ŒçŠ¶æ€æ”¹å› â€œæ•°æ®çŠ¶æ€â€ã€‚&lt;body&gt; æ ‡è®°ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚ç›®å‰ html å’Œ body æ ‡è®°å‡å·²å‘å‡ºã€‚ç°åœ¨æˆ‘ä»¬å›åˆ° â€œæ•°æ®çŠ¶æ€â€ã€‚æ¥æ”¶åˆ° Hello world ä¸­çš„ H å­—ç¬¦æ—¶ï¼Œå°†åˆ›å»ºå¹¶å‘é€å­—ç¬¦æ ‡è®°ï¼Œç›´åˆ°æ¥æ”¶ &lt;/body&gt; ä¸­çš„ &lt;ã€‚æˆ‘ä»¬å°†ä¸º Hello world ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½å‘é€ä¸€ä¸ªå­—ç¬¦æ ‡è®°ã€‚ç°åœ¨æˆ‘ä»¬å›åˆ° â€œæ ‡è®°æ‰“å¼€çŠ¶æ€â€ã€‚æ¥æ”¶ä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦ / æ—¶ï¼Œä¼šåˆ›å»º end tag token å¹¶æ”¹ä¸º â€œæ ‡è®°åç§°çŠ¶æ€â€ã€‚æˆ‘ä»¬ä¼šå†æ¬¡ä¿æŒè¿™ä¸ªçŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶ &gt;ã€‚ç„¶åå°†å‘é€æ–°çš„æ ‡è®°ï¼Œå¹¶å›åˆ° â€œæ•°æ®çŠ¶æ€â€ã€‚&lt;/html&gt; è¾“å…¥ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚ å›¾ï¼šå¯¹ç¤ºä¾‹è¾“å…¥è¿›è¡Œæ ‡è®°åŒ–æ ‘æ„å»ºç®—æ³•åœ¨åˆ›å»ºè§£æå™¨çš„åŒæ—¶ï¼Œä¹Ÿä¼šåˆ›å»º Document å¯¹è±¡ã€‚åœ¨æ ‘æ„å»ºé˜¶æ®µï¼Œä»¥ Document ä¸ºæ ¹èŠ‚ç‚¹çš„ DOM æ ‘ä¹Ÿä¼šä¸æ–­è¿›è¡Œä¿®æ”¹ï¼Œå‘å…¶ä¸­æ·»åŠ å„ç§å…ƒç´ ã€‚æ ‡è®°ç”Ÿæˆå™¨å‘é€çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”±æ ‘æ„å»ºå™¨è¿›è¡Œå¤„ç†ã€‚è§„èŒƒä¸­å®šä¹‰äº†æ¯ä¸ªæ ‡è®°æ‰€å¯¹åº”çš„ DOM å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ä¼šåœ¨æ¥æ”¶åˆ°ç›¸åº”çš„æ ‡è®°æ—¶åˆ›å»ºã€‚è¿™äº›å…ƒç´ ä¸ä»…ä¼šæ·»åŠ åˆ° DOM æ ‘ä¸­ï¼Œè¿˜ä¼šæ·»åŠ åˆ°å¼€æ”¾å…ƒç´ çš„å †æ ˆä¸­ã€‚æ­¤å †æ ˆç”¨äºçº æ­£åµŒå¥—é”™è¯¯å’Œå¤„ç†æœªå…³é—­çš„æ ‡è®°ã€‚å…¶ç®—æ³•ä¹Ÿå¯ä»¥ç”¨çŠ¶æ€æœºæ¥æè¿°ã€‚è¿™äº›çŠ¶æ€ç§°ä¸º â€œæ’å…¥æ¨¡å¼â€ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¤ºä¾‹è¾“å…¥çš„æ ‘æ„å»ºè¿‡ç¨‹ï¼š12345&lt;html&gt; &lt;body&gt; Hello world &lt;/body&gt;&lt;/html&gt;æ ‘æ„å»ºé˜¶æ®µçš„è¾“å…¥æ˜¯ä¸€ä¸ªæ¥è‡ªæ ‡è®°åŒ–é˜¶æ®µçš„æ ‡è®°åºåˆ—ã€‚ç¬¬ä¸€ä¸ªæ¨¡å¼æ˜¯ â€œinitial modeâ€ã€‚æ¥æ”¶ HTML æ ‡è®°åè½¬ä¸º â€œbefore htmlâ€ æ¨¡å¼ï¼Œå¹¶åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹é‡æ–°å¤„ç†æ­¤æ ‡è®°ã€‚è¿™æ ·ä¼šåˆ›å»ºä¸€ä¸ª HTMLHtmlElement å…ƒç´ ï¼Œå¹¶å°†å…¶é™„åŠ åˆ° Document æ ¹å¯¹è±¡ä¸Šã€‚ç„¶åçŠ¶æ€å°†æ”¹ä¸º â€œbefore headâ€ã€‚æ­¤æ—¶æˆ‘ä»¬æ¥æ”¶ â€œbodyâ€ æ ‡è®°ã€‚å³ä½¿æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ²¡æœ‰ â€œheadâ€ æ ‡è®°ï¼Œç³»ç»Ÿä¹Ÿä¼šéšå¼åˆ›å»ºä¸€ä¸ª HTMLHeadElementï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ ‘ä¸­ã€‚ç°åœ¨æˆ‘ä»¬è¿›å…¥äº† â€œin headâ€ æ¨¡å¼ï¼Œç„¶åè½¬å…¥ â€œafter headâ€ æ¨¡å¼ã€‚ç³»ç»Ÿå¯¹ body æ ‡è®°è¿›è¡Œé‡æ–°å¤„ç†ï¼Œåˆ›å»ºå¹¶æ’å…¥ HTMLBodyElementï¼ŒåŒæ—¶æ¨¡å¼è½¬å˜ä¸º â€œin bodyâ€ã€‚ç°åœ¨ï¼Œæ¥æ”¶ç”± â€œHello worldâ€ å­—ç¬¦ä¸²ç”Ÿæˆçš„ä¸€ç³»åˆ—å­—ç¬¦æ ‡è®°ã€‚æ¥æ”¶ç¬¬ä¸€ä¸ªå­—ç¬¦æ—¶ä¼šåˆ›å»ºå¹¶æ’å…¥ â€œTextâ€ èŠ‚ç‚¹ï¼Œè€Œå…¶ä»–å­—ç¬¦ä¹Ÿå°†é™„åŠ åˆ°è¯¥èŠ‚ç‚¹ã€‚æ¥æ”¶ body ç»“æŸæ ‡è®°ä¼šè§¦å‘ â€œafter bodyâ€ æ¨¡å¼ã€‚ç°åœ¨æˆ‘ä»¬å°†æ¥æ”¶ HTML ç»“æŸæ ‡è®°ï¼Œç„¶åè¿›å…¥ â€œafter after bodyâ€ æ¨¡å¼ã€‚æ¥æ”¶åˆ°æ–‡ä»¶ç»“æŸæ ‡è®°åï¼Œè§£æè¿‡ç¨‹å°±æ­¤ç»“æŸã€‚ å›¾ï¼šç¤ºä¾‹ HTML çš„æ ‘æ„å»ºè§£æç»“æŸåçš„æ“ä½œåœ¨æ­¤é˜¶æ®µï¼Œæµè§ˆå™¨ä¼šå°†æ–‡æ¡£æ ‡æ³¨ä¸ºäº¤äº’çŠ¶æ€ï¼Œå¹¶å¼€å§‹è§£æé‚£äº›å¤„äº â€œdeferredâ€ æ¨¡å¼çš„è„šæœ¬ï¼Œä¹Ÿå°±æ˜¯é‚£äº›åº”åœ¨æ–‡æ¡£è§£æå®Œæˆåæ‰æ‰§è¡Œçš„è„šæœ¬ã€‚ç„¶åï¼Œæ–‡æ¡£çŠ¶æ€å°†è®¾ç½®ä¸º â€œå®Œæˆâ€ï¼Œä¸€ä¸ªâ€œåŠ è½½â€ äº‹ä»¶å°†éšä¹‹è§¦å‘ã€‚æ‚¨å¯ä»¥åœ¨ HTML5 è§„èŒƒä¸­æŸ¥çœ‹æ ‡è®°åŒ–å’Œæ ‘æ„å»ºçš„å®Œæ•´ç®—æ³•æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶æ‚¨åœ¨æµè§ˆ HTML ç½‘é¡µæ—¶ä»æ¥ä¸ä¼šçœ‹åˆ° â€œè¯­æ³•æ— æ•ˆâ€ çš„é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¼šçº æ­£ä»»ä½•æ— æ•ˆå†…å®¹ï¼Œç„¶åç»§ç»­å·¥ä½œã€‚ä»¥ä¸‹é¢çš„ HTML ä»£ç ä¸ºä¾‹ï¼š123456789&lt;html&gt; &lt;mytag&gt; &lt;/mytag&gt; &lt;div&gt; &lt;p&gt; &lt;/div&gt; Really lousy HTML &lt;/p&gt;&lt;/html&gt;åœ¨è¿™é‡Œï¼Œæˆ‘å·²ç»è¿åäº†å¾ˆå¤šè¯­æ³•è§„åˆ™ï¼ˆâ€œmytagâ€ä¸æ˜¯æ ‡å‡†çš„æ ‡è®°ï¼Œâ€œpâ€å’Œ â€œdivâ€ å…ƒç´ ä¹‹é—´çš„åµŒå¥—æœ‰è¯¯ç­‰ç­‰ï¼‰ï¼Œä½†æ˜¯æµè§ˆå™¨ä»ç„¶ä¼šæ­£ç¡®åœ°æ˜¾ç¤ºè¿™äº›å†…å®¹ï¼Œå¹¶ä¸”æ¯«æ— æ€¨è¨€ã€‚å› ä¸ºæœ‰å¤§é‡çš„è§£æå™¨ä»£ç ä¼šçº æ­£ HTML ç½‘é¡µä½œè€…çš„é”™è¯¯ã€‚ä¸åŒæµè§ˆå™¨çš„é”™è¯¯å¤„ç†æœºåˆ¶ç›¸å½“ä¸€è‡´ï¼Œä½†ä»¤äººç§°å¥‡çš„æ˜¯ï¼Œè¿™ç§æœºåˆ¶å¹¶ä¸æ˜¯ HTML å½“å‰è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å’Œä¹¦ç­¾ç®¡ç†ä»¥åŠå‰è¿› / åé€€æŒ‰é’®ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯æµè§ˆå™¨åœ¨å¤šå¹´å‘å±•ä¸­çš„äº§ç‰©ã€‚å¾ˆå¤šç½‘ç«™éƒ½æ™®éå­˜åœ¨ç€ä¸€äº›å·²çŸ¥çš„æ— æ•ˆ HTML ç»“æ„ï¼Œæ¯ä¸€ç§æµè§ˆå™¨éƒ½ä¼šå°è¯•é€šè¿‡å’Œå…¶ä»–æµè§ˆå™¨ä¸€æ ·çš„æ–¹å¼æ¥ä¿®å¤è¿™äº›æ— æ•ˆç»“æ„ã€‚HTML5 è§„èŒƒå®šä¹‰äº†ä¸€éƒ¨åˆ†è¿™æ ·çš„è¦æ±‚ã€‚WebKit åœ¨ HTML è§£æå™¨ç±»çš„å¼€å¤´æ³¨é‡Šä¸­å¯¹æ­¤åšäº†å¾ˆå¥½çš„æ¦‚æ‹¬ã€‚è§£æå™¨å¯¹æ ‡è®°åŒ–è¾“å…¥å†…å®¹è¿›è¡Œè§£æï¼Œä»¥æ„å»ºæ–‡æ¡£æ ‘ã€‚å¦‚æœæ–‡æ¡£çš„æ ¼å¼æ­£ç¡®ï¼Œå°±ç›´æ¥è¿›è¡Œè§£æã€‚é—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¤„ç†å¾ˆå¤šæ ¼å¼é”™è¯¯çš„ HTML æ–‡æ¡£ï¼Œæ‰€ä»¥è§£æå™¨å¿…é¡»å…·å¤‡ä¸€å®šçš„å®¹é”™æ€§ã€‚æˆ‘ä»¬è‡³å°‘è¦èƒ½å¤Ÿå¤„ç†ä»¥ä¸‹é”™è¯¯æƒ…å†µï¼šæ˜æ˜¾ä¸èƒ½åœ¨æŸäº›å¤–éƒ¨æ ‡è®°ä¸­æ·»åŠ çš„å…ƒç´ ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å…³é—­æ‰€æœ‰æ ‡è®°ï¼Œç›´åˆ°å‡ºç°ç¦æ­¢æ·»åŠ çš„å…ƒç´ ï¼Œç„¶åå†åŠ å…¥è¯¥å…ƒç´ ã€‚æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ·»åŠ çš„å…ƒç´ ã€‚è¿™å¾ˆå¯èƒ½æ˜¯ç½‘é¡µä½œè€…å¿˜è®°æ·»åŠ äº†å…¶ä¸­çš„ä¸€äº›æ ‡è®°ï¼ˆæˆ–è€…å…¶ä¸­çš„æ ‡è®°æ˜¯å¯é€‰çš„ï¼‰ã€‚è¿™äº›æ ‡ç­¾å¯èƒ½åŒ…æ‹¬ï¼šHTML HEAD BODY TBODY TR TD LIï¼ˆè¿˜æœ‰é—æ¼çš„å—ï¼Ÿï¼‰ã€‚å‘ inline å…ƒç´ å†…æ·»åŠ  block å…ƒç´ ã€‚å…³é—­æ‰€æœ‰ inline å…ƒç´ ï¼Œç›´åˆ°å‡ºç°ä¸‹ä¸€ä¸ªè¾ƒé«˜çº§çš„ block å…ƒç´ ã€‚å¦‚æœè¿™æ ·ä»ç„¶æ— æ•ˆï¼Œå¯å…³é—­æ‰€æœ‰å…ƒç´ ï¼Œç›´åˆ°å¯ä»¥æ·»åŠ å…ƒç´ ä¸ºæ­¢ï¼Œæˆ–è€…å¿½ç•¥è¯¥æ ‡è®°ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº› WebKit å®¹é”™çš„ç¤ºä¾‹ï¼šä½¿ç”¨äº†è€Œä¸æ˜¯æœ‰äº›ç½‘ç«™ä½¿ç”¨äº†è€Œä¸æ˜¯ã€‚ä¸ºäº†ä¸ IE å’Œ Firefox å…¼å®¹ï¼ŒWebKit å°†å…¶ä¸åšåŒæ ·çš„å¤„ç†ã€‚ä»£ç å¦‚ä¸‹ï¼š1234if (t-&gt;isCloseTag(brTag) &amp;&amp; m_document-&gt;inCompatMode()) &#123; reportError(MalformedBRError); t-&gt;beginTag = true;&#125;è¯·æ³¨æ„ï¼Œé”™è¯¯å¤„ç†æ˜¯åœ¨å†…éƒ¨è¿›è¡Œçš„ï¼Œç”¨æˆ·å¹¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹ã€‚ç¦»æ•£è¡¨æ ¼ç¦»æ•£è¡¨æ ¼æ˜¯æŒ‡ä½äºå…¶ä»–è¡¨æ ¼å†…å®¹ä¸­ï¼Œä½†åˆä¸åœ¨ä»»ä½•ä¸€ä¸ªå•å…ƒæ ¼å†…çš„è¡¨æ ¼ã€‚æ¯”å¦‚ä»¥ä¸‹çš„ç¤ºä¾‹ï¼š123456&lt;table&gt; &lt;table&gt; &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt; &lt;/table&gt; &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;WebKit ä¼šå°†å…¶å±‚æ¬¡ç»“æ„æ›´æ”¹ä¸ºä¸¤ä¸ªåŒçº§è¡¨æ ¼ï¼š123456&lt;table&gt; &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;table&gt; &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;ä»£ç å¦‚ä¸‹ï¼š12if (m_inStrayTableContent &amp;&amp; localName == tableTag) popBlock(tableTag);WebKit ä½¿ç”¨ä¸€ä¸ªå †æ ˆæ¥ä¿å­˜å½“å‰çš„å…ƒç´ å†…å®¹ï¼Œå®ƒä¼šä»å¤–éƒ¨è¡¨æ ¼çš„å †æ ˆä¸­å¼¹å‡ºå†…éƒ¨è¡¨æ ¼ã€‚ç°åœ¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ ¼å°±å˜æˆäº†åŒçº§å…³ç³»ã€‚åµŒå¥—çš„è¡¨å•å…ƒç´ å¦‚æœç”¨æˆ·åœ¨ä¸€ä¸ªè¡¨å•å…ƒç´ ä¸­åˆæ”¾å…¥äº†å¦ä¸€ä¸ªè¡¨å•ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè¡¨å•å°†è¢«å¿½ç•¥ã€‚ä»£ç å¦‚ä¸‹ï¼š123if (!m_currentFormElement) &#123; m_currentFormElement = new HTMLFormElement(formTag, m_document);&#125;è¿‡äºå¤æ‚çš„æ ‡è®°å±‚æ¬¡ç»“æ„ä»£ç çš„æ³¨é‡Šå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ã€‚123456789bool HTMLParser::allowNestedRedundantTag(const AtomicString&amp; tagName)&#123;unsigned i = 0;for (HTMLStackElem* curr = m_blockStack; i &lt; cMaxRedundantTagDepth &amp;&amp; curr &amp;&amp; curr-&gt;tagName == tagName; curr = curr-&gt;next, i++) &#123; &#125;return i != cMaxRedundantTagDepth;&#125;æ”¾é”™ä½ç½®çš„ html æˆ–è€… body ç»“æŸæ ‡è®°åŒæ ·ï¼Œä»£ç çš„æ³¨é‡Šå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ã€‚æ”¯æŒæ ¼å¼éå¸¸ç³Ÿç³•çš„ HTML ä»£ç ã€‚æˆ‘ä»¬ä»ä¸å…³é—­ body æ ‡è®°ï¼Œå› ä¸ºä¸€äº›æ„šè ¢çš„ç½‘é¡µä¼šåœ¨å®é™…æ–‡æ¡£ç»“æŸä¹‹å‰å°±å…³é—­ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨ end() æ¥æ‰§è¡Œå…³é—­æ“ä½œã€‚12if (t-&gt;tagName == htmlTag || t-&gt;tagName == bodyTag ) return;æ‰€ä»¥ç½‘é¡µä½œè€…éœ€è¦æ³¨æ„ï¼Œé™¤éæ‚¨æƒ³ä½œä¸ºåé¢æ•™æå‡ºç°åœ¨ WebKit å®¹é”™ä»£ç æ®µçš„ç¤ºä¾‹ä¸­ï¼Œå¦åˆ™è¿˜è¯·ç¼–å†™æ ¼å¼æ­£ç¡®çš„ HTML ä»£ç ã€‚CSS è§£æè¿˜è®°å¾—ç®€ä»‹ä¸­è§£æçš„æ¦‚å¿µå—ï¼Ÿå’Œ HTML ä¸åŒï¼ŒCSS æ˜¯ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ç®€ä»‹ä¸­æè¿°çš„å„ç§è§£æå™¨è¿›è¡Œè§£æã€‚äº‹å®ä¸Šï¼ŒCSS è§„èŒƒå®šä¹‰äº† CSS çš„è¯æ³•å’Œè¯­æ³•ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç¤ºä¾‹ï¼šè¯æ³•è¯­æ³•ï¼ˆè¯æ±‡ï¼‰æ˜¯é’ˆå¯¹å„ä¸ªæ ‡è®°ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ï¼š1234567comment \/\*[^*]*\*+([^/*][^*]*\*+)*\/num [0-9]+|[0-9]*&quot;.&quot;[0-9]+nonascii [\200-\377]nmstart [_a-z]|&#123;nonascii&#125;|&#123;escape&#125;nmchar [_a-z0-9-]|&#123;nonascii&#125;|&#123;escape&#125;name &#123;nmchar&#125;+ident &#123;nmstart&#125;&#123;nmchar&#125;*â€œidentâ€æ˜¯æ ‡è¯†ç¬¦ (identifier) çš„ç¼©å†™ï¼Œæ¯”å¦‚ç±»åã€‚â€œnameâ€æ˜¯å…ƒç´ çš„ IDï¼ˆé€šè¿‡ â€œ#â€ æ¥å¼•ç”¨ï¼‰ã€‚è¯­æ³•æ˜¯é‡‡ç”¨ BNF æ ¼å¼æè¿°çš„ã€‚123456789101112131415161718192021222324ruleset : selector [ &apos;,&apos; S* selector ]* &apos;&#123;&apos; S* declaration [ &apos;;&apos; S* declaration ]* &apos;&#125;&apos; S* ;selector : simple_selector [ combinator selector | S+ [ combinator? selector ]? ]? ;simple_selector : element_name [ HASH | class | attrib | pseudo ]* | [ HASH | class | attrib | pseudo ]+ ;class : &apos;.&apos; IDENT ;element_name : IDENT | &apos;*&apos; ;attrib : &apos;[&apos; S* IDENT S* [ [ &apos;=&apos; | INCLUDES | DASHMATCH ] S* [ IDENT | STRING ] S* ] &apos;]&apos; ;pseudo : &apos;:&apos; [ IDENT | FUNCTION S* [IDENT S*] &apos;)&apos; ] ;è§£é‡Šï¼šè¿™æ˜¯ä¸€ä¸ªè§„åˆ™é›†çš„ç»“æ„ï¼š1234div.error , a.error &#123; color:red; font-weight:bold;&#125;div.error å’Œ a.error æ˜¯é€‰æ‹©å™¨ã€‚å¤§æ‹¬å·å†…çš„éƒ¨åˆ†åŒ…å«äº†ç”±æ­¤è§„åˆ™é›†åº”ç”¨çš„è§„åˆ™ã€‚æ­¤ç»“æ„çš„æ­£å¼å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š1234ruleset : selector [ &apos;,&apos; S* selector ]* &apos;&#123;&apos; S* declaration [ &apos;;&apos; S* declaration ]* &apos;&#125;&apos; S* ;è¿™è¡¨ç¤ºä¸€ä¸ªè§„åˆ™é›†å°±æ˜¯ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæˆ–è€…ç”±é€—å·å’Œç©ºæ ¼ï¼ˆS è¡¨ç¤ºç©ºæ ¼ï¼‰åˆ†éš”çš„å¤šä¸ªï¼ˆæ•°é‡å¯é€‰ï¼‰é€‰æ‹©å™¨ã€‚è§„åˆ™é›†åŒ…å«äº†å¤§æ‹¬å·ï¼Œä»¥åŠå…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆæ•°é‡å¯é€‰ï¼‰ç”±åˆ†å·åˆ†éš”çš„å£°æ˜ã€‚â€œå£°æ˜â€å’Œ â€œé€‰æ‹©å™¨â€ å°†ç”±ä¸‹é¢çš„ BNF æ ¼å¼å®šä¹‰ã€‚WebKit CSS è§£æå™¨WebKit ä½¿ç”¨ Flex å’Œ Bison è§£æå™¨ç”Ÿæˆå™¨ï¼Œé€šè¿‡ CSS è¯­æ³•æ–‡ä»¶è‡ªåŠ¨åˆ›å»ºè§£æå™¨ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨è§£æå™¨ç®€ä»‹ä¸­æ‰€è¯´ï¼ŒBison ä¼šåˆ›å»ºè‡ªä¸‹è€Œä¸Šçš„ç§»ä½å½’çº¦è§£æå™¨ã€‚Firefox ä½¿ç”¨çš„æ˜¯äººå·¥ç¼–å†™çš„è‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ã€‚è¿™ä¸¤ç§è§£æå™¨éƒ½ä¼šå°† CSS æ–‡ä»¶è§£ææˆ StyleSheet å¯¹è±¡ï¼Œä¸”æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å« CSS è§„åˆ™ã€‚CSS è§„åˆ™å¯¹è±¡åˆ™åŒ…å«é€‰æ‹©å™¨å’Œå£°æ˜å¯¹è±¡ï¼Œä»¥åŠå…¶ä»–ä¸ CSS è¯­æ³•å¯¹åº”çš„å¯¹è±¡ã€‚ å›¾ï¼šè§£æ CSSå¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåºè„šæœ¬ç½‘ç»œçš„æ¨¡å‹æ˜¯åŒæ­¥çš„ã€‚ç½‘é¡µä½œè€…å¸Œæœ›è§£æå™¨é‡åˆ° &lt;script&gt; æ ‡è®°æ—¶ç«‹å³è§£æå¹¶æ‰§è¡Œè„šæœ¬ã€‚æ–‡æ¡£çš„è§£æå°†åœæ­¢ï¼Œç›´åˆ°è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœè„šæœ¬æ˜¯å¤–éƒ¨çš„ï¼Œé‚£ä¹ˆè§£æè¿‡ç¨‹ä¼šåœæ­¢ï¼Œç›´åˆ°ä»ç½‘ç»œåŒæ­¥æŠ“å–èµ„æºå®Œæˆåå†ç»§ç»­ã€‚æ­¤æ¨¡å‹å·²ç»ä½¿ç”¨äº†å¤šå¹´ï¼Œä¹Ÿåœ¨ HTML4 å’Œ HTML5 è§„èŒƒä¸­è¿›è¡Œäº†æŒ‡å®šã€‚ä½œè€…ä¹Ÿå¯ä»¥å°†è„šæœ¬æ ‡æ³¨ä¸º â€œdeferâ€ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœæ­¢æ–‡æ¡£è§£æï¼Œè€Œæ˜¯ç­‰åˆ°è§£æç»“æŸæ‰æ‰§è¡Œã€‚HTML5 å¢åŠ äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯å°†è„šæœ¬æ ‡è®°ä¸ºå¼‚æ­¥ï¼Œä»¥ä¾¿ç”±å…¶ä»–çº¿ç¨‹è§£æå’Œæ‰§è¡Œã€‚é¢„è§£æWebKit å’Œ Firefox éƒ½è¿›è¡Œäº†è¿™é¡¹ä¼˜åŒ–ã€‚åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè§£ææ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‰¾å‡ºå¹¶åŠ è½½éœ€è¦é€šè¿‡ç½‘ç»œåŠ è½½çš„å…¶ä»–èµ„æºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œèµ„æºå¯ä»¥åœ¨å¹¶è¡Œè¿æ¥ä¸ŠåŠ è½½ï¼Œä»è€Œæé«˜æ€»ä½“é€Ÿåº¦ã€‚è¯·æ³¨æ„ï¼Œé¢„è§£æå™¨ä¸ä¼šä¿®æ”¹ DOM æ ‘ï¼Œè€Œæ˜¯å°†è¿™é¡¹å·¥ä½œäº¤ç”±ä¸»è§£æå™¨å¤„ç†ï¼›é¢„è§£æå™¨åªä¼šè§£æå¤–éƒ¨èµ„æºï¼ˆä¾‹å¦‚å¤–éƒ¨è„šæœ¬ã€æ ·å¼è¡¨å’Œå›¾ç‰‡ï¼‰çš„å¼•ç”¨ã€‚æ ·å¼è¡¨å¦ä¸€æ–¹é¢ï¼Œæ ·å¼è¡¨æœ‰ç€ä¸åŒçš„æ¨¡å‹ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œåº”ç”¨æ ·å¼è¡¨ä¸ä¼šæ›´æ”¹ DOM æ ‘ï¼Œå› æ­¤ä¼¼ä¹æ²¡æœ‰å¿…è¦ç­‰å¾…æ ·å¼è¡¨å¹¶åœæ­¢æ–‡æ¡£è§£æã€‚ä½†è¿™æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è„šæœ¬åœ¨æ–‡æ¡£è§£æé˜¶æ®µä¼šè¯·æ±‚æ ·å¼ä¿¡æ¯ã€‚å¦‚æœå½“æ—¶è¿˜æ²¡æœ‰åŠ è½½å’Œè§£ææ ·å¼ï¼Œè„šæœ¬å°±ä¼šè·å¾—é”™è¯¯çš„å›å¤ï¼Œè¿™æ ·æ˜¾ç„¶ä¼šäº§ç”Ÿå¾ˆå¤šé—®é¢˜ã€‚è¿™çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªéå…¸å‹æ¡ˆä¾‹ï¼Œä½†äº‹å®ä¸Šéå¸¸æ™®éã€‚Firefox åœ¨æ ·å¼è¡¨åŠ è½½å’Œè§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šç¦æ­¢æ‰€æœ‰è„šæœ¬ã€‚è€Œå¯¹äº WebKit è€Œè¨€ï¼Œä»…å½“è„šæœ¬å°è¯•è®¿é—®çš„æ ·å¼å±æ€§å¯èƒ½å—å°šæœªåŠ è½½çš„æ ·å¼è¡¨å½±å“æ—¶ï¼Œå®ƒæ‰ä¼šç¦æ­¢è¯¥è„šæœ¬ã€‚å‘ˆç°æ ‘æ„å»ºåœ¨ DOM æ ‘æ„å»ºçš„åŒæ—¶ï¼Œæµè§ˆå™¨è¿˜ä¼šæ„å»ºå¦ä¸€ä¸ªæ ‘ç»“æ„ï¼šå‘ˆç°æ ‘ã€‚è¿™æ˜¯ç”±å¯è§†åŒ–å…ƒç´ æŒ‰ç…§å…¶æ˜¾ç¤ºé¡ºåºè€Œç»„æˆçš„æ ‘ï¼Œä¹Ÿæ˜¯æ–‡æ¡£çš„å¯è§†åŒ–è¡¨ç¤ºã€‚å®ƒçš„ä½œç”¨æ˜¯è®©æ‚¨æŒ‰ç…§æ­£ç¡®çš„é¡ºåºç»˜åˆ¶å†…å®¹ã€‚Firefox å°†å‘ˆç°æ ‘ä¸­çš„å…ƒç´ ç§°ä¸º â€œæ¡†æ¶â€ã€‚WebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯å‘ˆç°å™¨æˆ–å‘ˆç°å¯¹è±¡ã€‚å‘ˆç°å™¨çŸ¥é“å¦‚ä½•å¸ƒå±€å¹¶å°†è‡ªèº«åŠå…¶å­å…ƒç´ ç»˜åˆ¶å‡ºæ¥ã€‚WebKits RenderObject ç±»æ˜¯æ‰€æœ‰å‘ˆç°å™¨çš„åŸºç±»ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š12345678class RenderObject&#123; virtual void layout(); virtual void paint(PaintInfo); virtual void rect repaintRect(); Node* node; //the DOM node RenderStyle* style; // the computed style RenderLayer* containgLayer; //the containing z-index layer&#125;æ¯ä¸€ä¸ªå‘ˆç°å™¨éƒ½ä»£è¡¨äº†ä¸€ä¸ªçŸ©å½¢çš„åŒºåŸŸï¼Œé€šå¸¸å¯¹åº”äºç›¸å…³èŠ‚ç‚¹çš„ CSS æ¡†ï¼Œè¿™ä¸€ç‚¹åœ¨ CSS2 è§„èŒƒä¸­æœ‰æ‰€æè¿°ã€‚å®ƒåŒ…å«è¯¸å¦‚å®½åº¦ã€é«˜åº¦å’Œä½ç½®ç­‰å‡ ä½•ä¿¡æ¯ã€‚æ¡†çš„ç±»å‹ä¼šå—åˆ°ä¸èŠ‚ç‚¹ç›¸å…³çš„ â€œdisplayâ€ æ ·å¼å±æ€§çš„å½±å“ï¼ˆè¯·å‚é˜…æ ·å¼è®¡ç®—ç« èŠ‚ï¼‰ã€‚ä¸‹é¢è¿™æ®µ WebKit ä»£ç æè¿°äº†æ ¹æ® display å±æ€§çš„ä¸åŒï¼Œé’ˆå¯¹åŒä¸€ä¸ª DOM èŠ‚ç‚¹åº”åˆ›å»ºä»€ä¹ˆç±»å‹çš„å‘ˆç°å™¨ã€‚123456789101112131415161718192021222324252627RenderObject* RenderObject::createObject(Node* node, RenderStyle* style)&#123; Document* doc = node-&gt;document(); RenderArena* arena = doc-&gt;renderArena(); ... RenderObject* o = 0; switch (style-&gt;display()) &#123; case NONE: break; case INLINE: o = new (arena) RenderInline(node); break; case BLOCK: o = new (arena) RenderBlock(node); break; case INLINE_BLOCK: o = new (arena) RenderBlock(node); break; case LIST_ITEM: o = new (arena) RenderListItem(node); break; ... &#125; return o;&#125;å…ƒç´ ç±»å‹ä¹Ÿæ˜¯è€ƒè™‘å› ç´ ä¹‹ä¸€ï¼Œä¾‹å¦‚è¡¨å•æ§ä»¶å’Œè¡¨æ ¼éƒ½å¯¹åº”ç‰¹æ®Šçš„æ¡†æ¶ã€‚åœ¨ WebKit ä¸­ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ éœ€è¦åˆ›å»ºç‰¹æ®Šçš„å‘ˆç°å™¨ï¼Œå°±ä¼šæ›¿æ¢ createRenderer æ–¹æ³•ã€‚å‘ˆç°å™¨æ‰€æŒ‡å‘çš„æ ·å¼å¯¹è±¡ä¸­åŒ…å«äº†ä¸€äº›å’Œå‡ ä½•æ— å…³çš„ä¿¡æ¯ã€‚å‘ˆç°æ ‘å’Œ DOM æ ‘çš„å…³ç³»å‘ˆç°å™¨æ˜¯å’Œ DOM å…ƒç´ ç›¸å¯¹åº”çš„ï¼Œä½†å¹¶éä¸€ä¸€å¯¹åº”ã€‚éå¯è§†åŒ–çš„ DOM å…ƒç´ ä¸ä¼šæ’å…¥å‘ˆç°æ ‘ä¸­ï¼Œä¾‹å¦‚ â€œheadâ€ å…ƒç´ ã€‚å¦‚æœå…ƒç´ çš„ display å±æ€§å€¼ä¸º â€œnoneâ€ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šæ˜¾ç¤ºåœ¨å‘ˆç°æ ‘ä¸­ï¼ˆä½†æ˜¯ visibility å±æ€§å€¼ä¸ºâ€œhiddenâ€ çš„å…ƒç´ ä»ä¼šæ˜¾ç¤ºï¼‰ã€‚æœ‰ä¸€äº› DOM å…ƒç´ å¯¹åº”å¤šä¸ªå¯è§†åŒ–å¯¹è±¡ã€‚å®ƒä»¬å¾€å¾€æ˜¯å…·æœ‰å¤æ‚ç»“æ„çš„å…ƒç´ ï¼Œæ— æ³•ç”¨å•ä¸€çš„çŸ©å½¢æ¥æè¿°ã€‚ä¾‹å¦‚ï¼Œâ€œselectâ€ å…ƒç´ æœ‰ 3 ä¸ªå‘ˆç°å™¨ï¼šä¸€ä¸ªç”¨äºæ˜¾ç¤ºåŒºåŸŸï¼Œä¸€ä¸ªç”¨äºä¸‹æ‹‰åˆ—è¡¨æ¡†ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºæŒ‰é’®ã€‚å¦‚æœç”±äºå®½åº¦ä¸å¤Ÿï¼Œæ–‡æœ¬æ— æ³•åœ¨ä¸€è¡Œä¸­æ˜¾ç¤ºè€Œåˆ†ä¸ºå¤šè¡Œï¼Œé‚£ä¹ˆæ–°çš„è¡Œä¹Ÿä¼šä½œä¸ºæ–°çš„å‘ˆç°å™¨è€Œæ·»åŠ ã€‚å¦ä¸€ä¸ªå…³äºå¤šå‘ˆç°å™¨çš„ä¾‹å­æ˜¯æ ¼å¼æ— æ•ˆçš„ HTMLã€‚æ ¹æ® CSS è§„èŒƒï¼Œinline å…ƒç´ åªèƒ½åŒ…å« block å…ƒç´ æˆ– inline å…ƒç´ ä¸­çš„ä¸€ç§ã€‚å¦‚æœå‡ºç°äº†æ··åˆå†…å®¹ï¼Œåˆ™åº”åˆ›å»ºåŒ¿åçš„ block å‘ˆç°å™¨ï¼Œä»¥åŒ…è£¹ inline å…ƒç´ ã€‚æœ‰ä¸€äº›å‘ˆç°å¯¹è±¡å¯¹åº”äº DOM èŠ‚ç‚¹ï¼Œä½†åœ¨æ ‘ä¸­æ‰€åœ¨çš„ä½ç½®ä¸ DOM èŠ‚ç‚¹ä¸åŒã€‚æµ®åŠ¨å®šä½å’Œç»å¯¹å®šä½çš„å…ƒç´ å°±æ˜¯è¿™æ ·ï¼Œå®ƒä»¬å¤„äºæ­£å¸¸çš„æµç¨‹ä¹‹å¤–ï¼Œæ”¾ç½®åœ¨æ ‘ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œå¹¶æ˜ å°„åˆ°çœŸæ­£çš„æ¡†æ¶ï¼Œè€Œæ”¾åœ¨åŸä½çš„æ˜¯å ä½æ¡†æ¶ã€‚ å›¾ï¼šå‘ˆç°æ ‘åŠå…¶å¯¹åº”çš„ DOM æ ‘ (3.1)ã€‚åˆå§‹å®¹å™¨ block ä¸º â€œviewportâ€ï¼Œè€Œåœ¨ WebKit ä¸­åˆ™ä¸ºâ€œRenderViewâ€ å¯¹è±¡ã€‚æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹åœ¨ Firefox ä¸­ï¼Œç³»ç»Ÿä¼šé’ˆå¯¹ DOM æ›´æ–°æ³¨å†Œå±•ç¤ºå±‚ï¼Œä½œä¸ºä¾¦å¬å™¨ã€‚å±•ç¤ºå±‚å°†æ¡†æ¶åˆ›å»ºå·¥ä½œå§”æ‰˜ç»™ FrameConstructorï¼Œç”±è¯¥æ„é€ å™¨è§£ææ ·å¼ï¼ˆè¯·å‚é˜…æ ·å¼è®¡ç®—ï¼‰å¹¶åˆ›å»ºæ¡†æ¶ã€‚åœ¨ WebKit ä¸­ï¼Œè§£ææ ·å¼å’Œåˆ›å»ºå‘ˆç°å™¨çš„è¿‡ç¨‹ç§°ä¸º â€œé™„åŠ â€ã€‚æ¯ä¸ª DOM èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªâ€œattachâ€ æ–¹æ³•ã€‚é™„åŠ æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œå°†èŠ‚ç‚¹æ’å…¥ DOM æ ‘éœ€è¦è°ƒç”¨æ–°çš„èŠ‚ç‚¹ â€œattachâ€ æ–¹æ³•ã€‚å¤„ç† html å’Œ body æ ‡è®°å°±ä¼šæ„å»ºå‘ˆç°æ ‘æ ¹èŠ‚ç‚¹ã€‚è¿™ä¸ªæ ¹èŠ‚ç‚¹å‘ˆç°å¯¹è±¡å¯¹åº”äº CSS è§„èŒƒä¸­æ‰€è¯´çš„å®¹å™¨ blockï¼Œè¿™æ˜¯æœ€ä¸Šå±‚çš„ blockï¼ŒåŒ…å«äº†å…¶ä»–æ‰€æœ‰ blockã€‚å®ƒçš„å°ºå¯¸å°±æ˜¯è§†å£ï¼Œå³æµè§ˆå™¨çª—å£æ˜¾ç¤ºåŒºåŸŸçš„å°ºå¯¸ã€‚Firefox ç§°ä¹‹ä¸º ViewPortFrameï¼Œè€Œ WebKit ç§°ä¹‹ä¸º RenderViewã€‚è¿™å°±æ˜¯æ–‡æ¡£æ‰€æŒ‡å‘çš„å‘ˆç°å¯¹è±¡ã€‚å‘ˆç°æ ‘çš„å…¶ä½™éƒ¨åˆ†ä»¥ DOM æ ‘èŠ‚ç‚¹æ’å…¥çš„å½¢å¼æ¥æ„å»ºã€‚è¯·å‚é˜…å…³äºå¤„ç†æ¨¡å‹çš„ CSS2 è§„èŒƒã€‚æ ·å¼è®¡ç®—æ„å»ºå‘ˆç°æ ‘æ—¶ï¼Œéœ€è¦è®¡ç®—æ¯ä¸€ä¸ªå‘ˆç°å¯¹è±¡çš„å¯è§†åŒ–å±æ€§ã€‚è¿™æ˜¯é€šè¿‡è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æ ·å¼å±æ€§æ¥å®Œæˆçš„ã€‚æ ·å¼åŒ…æ‹¬æ¥è‡ªå„ç§æ¥æºçš„æ ·å¼è¡¨ã€inline æ ·å¼å…ƒç´ å’Œ HTML ä¸­çš„å¯è§†åŒ–å±æ€§ï¼ˆä¾‹å¦‚ â€œbgcolorâ€ å±æ€§ï¼‰ã€‚å…¶ä¸­åè€…å°†ç»è¿‡è½¬åŒ–ä»¥åŒ¹é… CSS æ ·å¼å±æ€§ã€‚æ ·å¼è¡¨çš„æ¥æºåŒ…æ‹¬æµè§ˆå™¨çš„é»˜è®¤æ ·å¼è¡¨ã€ç”±ç½‘é¡µä½œè€…æä¾›çš„æ ·å¼è¡¨ä»¥åŠç”±æµè§ˆå™¨ç”¨æˆ·æä¾›çš„ç”¨æˆ·æ ·å¼è¡¨ï¼ˆæµè§ˆå™¨å…è®¸æ‚¨å®šä¹‰è‡ªå·±å–œæ¬¢çš„æ ·å¼ã€‚ä»¥ Firefox ä¸ºä¾‹ï¼Œç”¨æˆ·å¯ä»¥å°†è‡ªå·±å–œæ¬¢çš„æ ·å¼è¡¨æ”¾åœ¨ â€œFirefox Profileâ€ æ–‡ä»¶å¤¹ä¸‹ï¼‰ã€‚æ ·å¼è®¡ç®—å­˜åœ¨ä»¥ä¸‹éš¾ç‚¹ï¼šæ ·å¼æ•°æ®æ˜¯ä¸€ä¸ªè¶…å¤§çš„ç»“æ„ï¼Œå­˜å‚¨äº†æ— æ•°çš„æ ·å¼å±æ€§ï¼Œè¿™å¯èƒ½é€ æˆå†…å­˜é—®é¢˜ã€‚å¦‚æœä¸è¿›è¡Œä¼˜åŒ–ï¼Œä¸ºæ¯ä¸€ä¸ªå…ƒç´ æŸ¥æ‰¾åŒ¹é…çš„è§„åˆ™ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚è¦ä¸ºæ¯ä¸€ä¸ªå…ƒç´ éå†æ•´ä¸ªè§„åˆ™åˆ—è¡¨æ¥å¯»æ‰¾åŒ¹é…è§„åˆ™ï¼Œè¿™æ˜¯ä¸€é¡¹æµ©å¤§çš„å·¥ç¨‹ã€‚é€‰æ‹©å™¨ä¼šå…·æœ‰å¾ˆå¤æ‚çš„ç»“æ„ï¼Œè¿™å°±ä¼šå¯¼è‡´æŸä¸ªåŒ¹é…è¿‡ç¨‹ä¸€å¼€å§‹çœ‹èµ·æ¥å¾ˆå¯èƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æœ€ç»ˆå‘ç°å…¶å®æ˜¯å¾’åŠ³çš„ï¼Œå¿…é¡»å°è¯•å…¶ä»–åŒ¹é…è·¯å¾„ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç»„åˆé€‰æ‹©å™¨ï¼š123div div div div&#123; ...&#125;è¿™æ„å‘³ç€è§„åˆ™é€‚ç”¨äºä½œä¸º 3 ä¸ª div å…ƒç´ çš„å­ä»£çš„ `&lt;div&gt;`ã€‚å¦‚æœæ‚¨è¦æ£€æŸ¥è§„åˆ™æ˜¯å¦é€‚ç”¨äºæŸä¸ªæŒ‡å®šçš„ `&lt;div&gt;` å…ƒç´ ï¼Œåº”é€‰æ‹©æ ‘ä¸Šçš„ä¸€æ¡å‘ä¸Šè·¯å¾„è¿›è¡Œæ£€æŸ¥ã€‚æ‚¨å¯èƒ½éœ€è¦å‘ä¸Šéå†èŠ‚ç‚¹æ ‘ï¼Œç»“æœå‘ç°åªæœ‰ä¸¤ä¸ª divï¼Œè€Œä¸”è§„åˆ™å¹¶ä¸é€‚ç”¨ã€‚ç„¶åï¼Œæ‚¨å¿…é¡»å°è¯•æ ‘ä¸­çš„å…¶ä»–è·¯å¾„ã€‚ åº”ç”¨è§„åˆ™æ¶‰åŠåˆ°ç›¸å½“å¤æ‚çš„å±‚å è§„åˆ™ï¼ˆç”¨äºå®šä¹‰è¿™äº›è§„åˆ™çš„å±‚æ¬¡ï¼‰ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™äº›é—®é¢˜çš„ï¼šå…±äº«æ ·å¼æ•°æ®WebKit èŠ‚ç‚¹ä¼šå¼•ç”¨æ ·å¼å¯¹è±¡ (RenderStyle)ã€‚è¿™äº›å¯¹è±¡åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”±ä¸åŒèŠ‚ç‚¹å…±äº«ã€‚è¿™äº›èŠ‚ç‚¹æ˜¯åŒçº§å…³ç³»ï¼Œå¹¶ä¸”ï¼šè¿™äº›å…ƒç´ å¿…é¡»å¤„äºç›¸åŒçš„é¼ æ ‡çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œä¸å…è®¸å…¶ä¸­ä¸€ä¸ªæ˜¯ â€œ:hoverâ€ çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªä¸æ˜¯ï¼‰ä»»ä½•å…ƒç´ éƒ½æ²¡æœ‰ IDæ ‡è®°åç§°åº”åŒ¹é…ç±»å±æ€§åº”åŒ¹é…æ˜ å°„å±æ€§çš„é›†åˆå¿…é¡»æ˜¯å®Œå…¨ç›¸åŒçš„é“¾æ¥çŠ¶æ€å¿…é¡»åŒ¹é…ç„¦ç‚¹çŠ¶æ€å¿…é¡»åŒ¹é…ä»»ä½•å…ƒç´ éƒ½ä¸åº”å—å±æ€§é€‰æ‹©å™¨çš„å½±å“ï¼Œè¿™é‡Œæ‰€è¯´çš„ â€œå½±å“â€ æ˜¯æŒ‡åœ¨é€‰æ‹©å™¨ä¸­çš„ä»»ä½•ä½ç½®æœ‰ä»»ä½•ä½¿ç”¨äº†å±æ€§é€‰æ‹©å™¨çš„é€‰æ‹©å™¨åŒ¹é…å…ƒç´ ä¸­ä¸èƒ½æœ‰ä»»ä½• inline æ ·å¼å±æ€§ä¸èƒ½ä½¿ç”¨ä»»ä½•åŒçº§é€‰æ‹©å™¨ã€‚WebCore åœ¨é‡åˆ°ä»»ä½•åŒçº§é€‰æ‹©å™¨æ—¶ï¼Œåªä¼šå¼•å‘ä¸€ä¸ªå…¨å±€å¼€å…³ï¼Œå¹¶åœç”¨æ•´ä¸ªæ–‡æ¡£çš„æ ·å¼å…±äº«ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚è¿™åŒ…æ‹¬ + é€‰æ‹©å™¨ä»¥åŠ :first-child å’Œ :last-child ç­‰é€‰æ‹©å™¨ã€‚Firefox è§„åˆ™æ ‘ä¸ºäº†ç®€åŒ–æ ·å¼è®¡ç®—ï¼ŒFirefox è¿˜é‡‡ç”¨äº†å¦å¤–ä¸¤ç§æ ‘ï¼šè§„åˆ™æ ‘å’Œæ ·å¼ä¸Šä¸‹æ–‡æ ‘ã€‚WebKit ä¹Ÿæœ‰æ ·å¼å¯¹è±¡ï¼Œä½†å®ƒä»¬ä¸æ˜¯ä¿å­˜åœ¨ç±»ä¼¼æ ·å¼ä¸Šä¸‹æ–‡æ ‘è¿™æ ·çš„æ ‘ç»“æ„ä¸­ï¼Œåªæ˜¯ç”± DOM èŠ‚ç‚¹æŒ‡å‘æ­¤ç±»å¯¹è±¡çš„ç›¸å…³æ ·å¼ã€‚ å›¾ï¼šFirefox æ ·å¼ä¸Šä¸‹æ–‡æ ‘ (2.2)æ ·å¼ä¸Šä¸‹æ–‡åŒ…å«ç«¯å€¼ã€‚è¦è®¡ç®—å‡ºè¿™äº›å€¼ï¼Œåº”æŒ‰ç…§æ­£ç¡®é¡ºåºåº”ç”¨æ‰€æœ‰çš„åŒ¹é…è§„åˆ™ï¼Œå¹¶å°†å…¶ä»é€»è¾‘å€¼è½¬åŒ–ä¸ºå…·ä½“çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé€»è¾‘å€¼æ˜¯å±å¹•å¤§å°çš„ç™¾åˆ†æ¯”ï¼Œåˆ™éœ€è¦æ¢ç®—æˆç»å¯¹çš„å•ä½ã€‚è§„åˆ™æ ‘çš„ç‚¹å­çœŸçš„å¾ˆå·§å¦™ï¼Œå®ƒä½¿å¾—èŠ‚ç‚¹ä¹‹é—´å¯ä»¥å…±äº«è¿™äº›å€¼ï¼Œä»¥é¿å…é‡å¤è®¡ç®—ï¼Œè¿˜å¯ä»¥èŠ‚çº¦ç©ºé—´ã€‚æ‰€æœ‰åŒ¹é…çš„è§„åˆ™éƒ½å­˜å‚¨åœ¨æ ‘ä¸­ã€‚è·¯å¾„ä¸­çš„åº•å±‚èŠ‚ç‚¹æ‹¥æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚è§„åˆ™æ ‘åŒ…å«äº†æ‰€æœ‰å·²çŸ¥è§„åˆ™åŒ¹é…çš„è·¯å¾„ã€‚è§„åˆ™çš„å­˜å‚¨æ˜¯å»¶è¿Ÿè¿›è¡Œçš„ã€‚è§„åˆ™æ ‘ä¸ä¼šåœ¨å¼€å§‹çš„æ—¶å€™å°±ä¸ºæ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ï¼Œè€Œæ˜¯åªæœ‰å½“æŸä¸ªèŠ‚ç‚¹æ ·å¼éœ€è¦è¿›è¡Œè®¡ç®—æ—¶ï¼Œæ‰ä¼šå‘è§„åˆ™æ ‘æ·»åŠ è®¡ç®—çš„è·¯å¾„ã€‚è¿™ä¸ªæƒ³æ³•ç›¸å½“äºå°†è§„åˆ™æ ‘è·¯å¾„è§†ä¸ºè¯å…¸ä¸­çš„å•è¯ã€‚å¦‚æœæˆ‘ä»¬å·²ç»è®¡ç®—å‡ºå¦‚ä¸‹çš„è§„åˆ™æ ‘ï¼šå‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºå†…å®¹æ ‘ä¸­çš„å¦ä¸€ä¸ªå…ƒç´ åŒ¹é…è§„åˆ™ï¼Œå¹¶ä¸”æ‰¾åˆ°åŒ¹é…è·¯å¾„æ˜¯ B - E - Iï¼ˆæŒ‰ç…§æ­¤é¡ºåºï¼‰ã€‚ç”±äºæˆ‘ä»¬åœ¨æ ‘ä¸­å·²ç»è®¡ç®—å‡ºäº†è·¯å¾„ A - B - E - I - Lï¼Œå› æ­¤å°±å·²ç»æœ‰äº†æ­¤è·¯å¾„ï¼Œè¿™å°±å‡å°‘äº†ç°åœ¨æ‰€éœ€çš„å·¥ä½œé‡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è§„åˆ™æ ‘å¦‚ä½•å¸®åŠ©æˆ‘ä»¬å‡å°‘å·¥ä½œã€‚ç»“æ„åˆ’åˆ†æ ·å¼ä¸Šä¸‹æ–‡å¯åˆ†å‰²æˆå¤šä¸ªç»“æ„ã€‚è¿™äº›ç»“æ„ä½“åŒ…å«äº†ç‰¹å®šç±»åˆ«ï¼ˆå¦‚ border æˆ– colorï¼‰çš„æ ·å¼ä¿¡æ¯ã€‚ç»“æ„ä¸­çš„å±æ€§éƒ½æ˜¯ç»§æ‰¿çš„æˆ–éç»§æ‰¿çš„ã€‚ç»§æ‰¿å±æ€§å¦‚æœæœªç”±å…ƒç´ å®šä¹‰ï¼Œåˆ™ç»§æ‰¿è‡ªå…¶çˆ¶ä»£ã€‚éç»§æ‰¿å±æ€§ï¼ˆä¹Ÿç§°ä¸º â€œé‡ç½®â€ å±æ€§ï¼‰å¦‚æœæœªè¿›è¡Œå®šä¹‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚è§„åˆ™æ ‘é€šè¿‡ç¼“å­˜æ•´ä¸ªç»“æ„ï¼ˆåŒ…å«è®¡ç®—å‡ºçš„ç«¯å€¼ï¼‰ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚è¿™ä¸€æƒ³æ³•å‡å®šåº•å±‚èŠ‚ç‚¹æ²¡æœ‰æä¾›ç»“æ„çš„å®šä¹‰ï¼Œåˆ™å¯ä½¿ç”¨ä¸Šå±‚èŠ‚ç‚¹ä¸­çš„ç¼“å­˜ç»“æ„ã€‚ä½¿ç”¨è§„åˆ™æ ‘è®¡ç®—æ ·å¼ä¸Šä¸‹æ–‡åœ¨è®¡ç®—æŸä¸ªç‰¹å®šå…ƒç´ çš„æ ·å¼ä¸Šä¸‹æ–‡æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—è§„åˆ™æ ‘ä¸­çš„å¯¹åº”è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨ç°æœ‰çš„è·¯å¾„ã€‚ç„¶åæˆ‘ä»¬æ²¿æ­¤è·¯å¾„åº”ç”¨è§„åˆ™ï¼Œåœ¨æ–°çš„æ ·å¼ä¸Šä¸‹æ–‡ä¸­å¡«å……ç»“æ„ã€‚æˆ‘ä»¬ä»è·¯å¾„ä¸­æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„åº•å±‚èŠ‚ç‚¹ï¼ˆé€šå¸¸ä¹Ÿæ˜¯æœ€ç‰¹æ®Šçš„é€‰æ‹©å™¨ï¼‰å¼€å§‹ï¼Œå¹¶å‘ä¸Šéå†è§„åˆ™æ ‘ï¼Œç›´åˆ°ç»“æ„å¡«å……å®Œæ¯•ã€‚å¦‚æœè¯¥è§„åˆ™èŠ‚ç‚¹å¯¹äºæ­¤ç»“æ„æ²¡æœ‰ä»»ä½•è§„èŒƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®ç°æ›´å¥½çš„ä¼˜åŒ–ï¼šå¯»æ‰¾è·¯å¾„æ›´ä¸Šå±‚çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°åæŒ‡å®šå®Œæ•´çš„è§„èŒƒå¹¶æŒ‡å‘ç›¸å…³èŠ‚ç‚¹å³å¯ã€‚è¿™æ˜¯æœ€å¥½çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå› ä¸ºæ•´ä¸ªç»“æ„éƒ½èƒ½å…±äº«ã€‚è¿™å¯ä»¥å‡å°‘ç«¯å€¼çš„è®¡ç®—é‡å¹¶èŠ‚çº¦å†…å­˜ã€‚å¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†éƒ¨åˆ†å®šä¹‰ï¼Œå°±ä¼šå‘ä¸Šéå†è§„åˆ™æ ‘ï¼Œç›´åˆ°ç»“æ„å¡«å……å®Œæ¯•ã€‚å¦‚æœæˆ‘ä»¬æ‰¾ä¸åˆ°ç»“æ„çš„ä»»ä½•å®šä¹‰ï¼Œé‚£ä¹ˆå‡å¦‚è¯¥ç»“æ„æ˜¯ â€œç»§æ‰¿â€ ç±»å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­æŒ‡å‘çˆ¶ä»£çš„ç»“æ„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å…±äº«ç»“æ„ã€‚å¦‚æœæ˜¯ reset ç±»å‹çš„ç»“æ„ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚å¦‚æœæœ€ç‰¹æ®Šçš„èŠ‚ç‚¹ç¡®å®æ·»åŠ äº†å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¦å¤–è¿›è¡Œä¸€äº›è®¡ç®—ï¼Œä»¥ä¾¿å°†è¿™äº›å€¼è½¬åŒ–æˆå®é™…å€¼ã€‚ç„¶åæˆ‘ä»¬å°†ç»“æœç¼“å­˜åœ¨æ ‘èŠ‚ç‚¹ä¸­ï¼Œä¾›å­ä»£ä½¿ç”¨ã€‚å¦‚æœæŸä¸ªå…ƒç´ ä¸å…¶åŒçº§å…ƒç´ éƒ½æŒ‡å‘åŒä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬å°±å¯ä»¥å…±äº«æ•´ä¸ªæ ·å¼ä¸Šä¸‹æ–‡ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹ HTML ä»£ç ï¼š123456789101112&lt;html&gt; &lt;body&gt; &lt;div&gt; &lt;p&gt; this is a &lt;span&gt; big error &lt;/span&gt; this is also a &lt;span&gt; very big error&lt;/span&gt; error &lt;/p&gt; &lt;/div&gt; &lt;div&gt;another error&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;è¿˜æœ‰å¦‚ä¸‹è§„åˆ™ï¼š123456789101112div &#123;margin:5px;color:black&#125;.err &#123;color:red&#125;.big &#123;margin-top:3px&#125;div span &#123;margin-bottom:4px&#125;#div1 &#123;color:blue&#125;#div2 &#123;color:green&#125;div &#123;margin:5px;color:black&#125;.err &#123;color:red&#125;.big &#123;margin-top:3px&#125;div span &#123;margin-bottom:4px&#125;#div1 &#123;color:blue&#125;#div2 &#123;color:green&#125;ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬åªéœ€è¦å¡«å……ä¸¤ä¸ªç»“æ„ï¼šcolor ç»“æ„å’Œ margin ç»“æ„ã€‚color ç»“æ„åªåŒ…å«ä¸€ä¸ªæˆå‘˜ï¼ˆå³ â€œcolorâ€ï¼‰ï¼Œè€Œ margin ç»“æ„åŒ…å«å››æ¡è¾¹ã€‚å½¢æˆçš„è§„åˆ™æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆèŠ‚ç‚¹çš„æ ‡è®°æ–¹å¼ä¸º â€œèŠ‚ç‚¹å : æŒ‡å‘çš„è§„åˆ™åºå·â€ï¼‰ï¼š å›¾ï¼šè§„åˆ™æ ‘ä¸Šä¸‹æ–‡æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆèŠ‚ç‚¹å : æŒ‡å‘çš„è§„åˆ™èŠ‚ç‚¹ï¼‰ï¼š å›¾ï¼šä¸Šä¸‹æ–‡æ ‘å‡è®¾æˆ‘ä»¬è§£æ HTML æ—¶é‡åˆ°äº†ç¬¬äºŒä¸ªæ ‡è®°ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ­¤èŠ‚ç‚¹åˆ›å»ºæ ·å¼ä¸Šä¸‹æ–‡ï¼Œå¹¶å¡«å……å…¶æ ·å¼ç»“æ„ã€‚ç»è¿‡è§„åˆ™åŒ¹é…ï¼Œæˆ‘ä»¬å‘ç°è¯¥çš„åŒ¹é…è§„åˆ™æ˜¯ç¬¬ 1ã€2 å’Œ 6 æ¡ã€‚è¿™æ„å‘³ç€è§„åˆ™æ ‘ä¸­å·²æœ‰ä¸€æ¡è·¯å¾„å¯ä¾›æˆ‘ä»¬çš„å…ƒç´ ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦å†ä¸ºå…¶æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ä»¥åŒ¹é…ç¬¬ 6 æ¡è§„åˆ™ï¼ˆè§„åˆ™æ ‘ä¸­çš„ F èŠ‚ç‚¹ï¼‰ã€‚æˆ‘ä»¬å°†åˆ›å»ºæ ·å¼ä¸Šä¸‹æ–‡å¹¶å°†å…¶æ”¾å…¥ä¸Šä¸‹æ–‡æ ‘ä¸­ã€‚æ–°çš„æ ·å¼ä¸Šä¸‹æ–‡å°†æŒ‡å‘è§„åˆ™æ ‘ä¸­çš„ F èŠ‚ç‚¹ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å¡«å……æ ·å¼ç»“æ„ã€‚é¦–å…ˆè¦å¡«å……çš„æ˜¯ margin ç»“æ„ã€‚ç”±äºæœ€åçš„è§„åˆ™èŠ‚ç‚¹ (F) å¹¶æ²¡æœ‰æ·»åŠ åˆ° margin ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šæº¯è§„åˆ™æ ‘ï¼Œç›´è‡³æ‰¾åˆ°åœ¨å…ˆå‰èŠ‚ç‚¹æ’å…¥ä¸­è®¡ç®—è¿‡çš„ç¼“å­˜ç»“æ„ï¼Œç„¶åä½¿ç”¨è¯¥ç»“æ„ã€‚æˆ‘ä»¬ä¼šåœ¨æŒ‡å®š margin è§„åˆ™çš„æœ€ä¸Šå±‚èŠ‚ç‚¹ï¼ˆå³ B èŠ‚ç‚¹ï¼‰ä¸Šæ‰¾åˆ°è¯¥ç»“æ„ã€‚æˆ‘ä»¬å·²ç»æœ‰äº† color ç»“æ„çš„å®šä¹‰ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ç¼“å­˜çš„ç»“æ„ã€‚ç”±äº color æœ‰ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬æ— éœ€ä¸Šæº¯è§„åˆ™æ ‘ä»¥å¡«å……å…¶ä»–å±æ€§ã€‚æˆ‘ä»¬å°†è®¡ç®—ç«¯å€¼ï¼ˆå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸º RGB ç­‰ï¼‰å¹¶åœ¨æ­¤èŠ‚ç‚¹ä¸Šç¼“å­˜ç»è¿‡è®¡ç®—çš„ç»“æ„ã€‚ç¬¬äºŒä¸ª å…ƒç´ å¤„ç†èµ·æ¥æ›´åŠ ç®€å•ã€‚æˆ‘ä»¬å°†åŒ¹é…è§„åˆ™ï¼Œæœ€ç»ˆå‘ç°å®ƒå’Œä¹‹å‰çš„ span ä¸€æ ·æŒ‡å‘è§„åˆ™ Gã€‚ç”±äºæˆ‘ä»¬æ‰¾åˆ°äº†æŒ‡å‘åŒä¸€èŠ‚ç‚¹çš„åŒçº§ï¼Œå°±å¯ä»¥å…±äº«æ•´ä¸ªæ ·å¼ä¸Šä¸‹æ–‡äº†ï¼Œåªéœ€æŒ‡å‘ä¹‹å‰ span çš„ä¸Šä¸‹æ–‡å³å¯ã€‚å¯¹äºåŒ…å«äº†ç»§æ‰¿è‡ªçˆ¶ä»£çš„è§„åˆ™çš„ç»“æ„ï¼Œç¼“å­˜æ˜¯åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­è¿›è¡Œçš„ï¼ˆäº‹å®ä¸Š color å±æ€§æ˜¯ç»§æ‰¿çš„ï¼Œä½†æ˜¯ Firefox å°†å…¶è§†ä¸º reset å±æ€§ï¼Œå¹¶ç¼“å­˜åˆ°è§„åˆ™æ ‘ä¸Šï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ®µè½ä¸­æ·»åŠ  font è§„åˆ™ï¼š1p &#123;font-family:Verdana;font size:10px;font-weight:bold&#125;é‚£ä¹ˆï¼Œè¯¥æ®µè½å…ƒç´ ä½œä¸ºä¸Šä¸‹æ–‡æ ‘ä¸­çš„ div çš„å­ä»£ï¼Œå°±ä¼šå…±äº«ä¸å…¶çˆ¶ä»£ç›¸åŒçš„ font ç»“æ„ï¼ˆå‰ææ˜¯è¯¥æ®µè½æ²¡æœ‰æŒ‡å®š font è§„åˆ™ï¼‰ã€‚åœ¨ WebKit ä¸­æ²¡æœ‰è§„åˆ™æ ‘ï¼Œå› æ­¤ä¼šå¯¹åŒ¹é…çš„å£°æ˜éå† 4 æ¬¡ã€‚é¦–å…ˆåº”ç”¨éé‡è¦é«˜ä¼˜å…ˆçº§çš„å±æ€§ï¼ˆç”±äºä½œä¸ºå…¶ä»–å±æ€§çš„ä¾æ®è€Œåº”é¦–å…ˆåº”ç”¨çš„å±æ€§ï¼Œä¾‹å¦‚ displayï¼‰ï¼Œæ¥ç€æ˜¯é«˜ä¼˜å…ˆçº§é‡è¦è§„åˆ™ï¼Œç„¶åæ˜¯æ™®é€šä¼˜å…ˆçº§éé‡è¦è§„åˆ™ï¼Œæœ€åæ˜¯æ™®é€šä¼˜å…ˆçº§é‡è¦è§„åˆ™ã€‚è¿™æ„å‘³ç€å¤šæ¬¡å‡ºç°çš„å±æ€§ä¼šæ ¹æ®æ­£ç¡®çš„å±‚å é¡ºåºè¿›è¡Œè§£æã€‚æœ€åå‡ºç°çš„æœ€ç»ˆç”Ÿæ•ˆã€‚å› æ­¤æ¦‚æ‹¬æ¥è¯´ï¼Œå…±äº«æ ·å¼å¯¹è±¡ï¼ˆæ•´ä¸ªå¯¹è±¡æˆ–è€…å¯¹è±¡ä¸­çš„éƒ¨åˆ†ç»“æ„ï¼‰å¯ä»¥è§£å†³é—®é¢˜ 1 å’Œé—®é¢˜ 3ã€‚Firefox è§„åˆ™æ ‘è¿˜æœ‰åŠ©äºæŒ‰ç…§æ­£ç¡®çš„é¡ºåºåº”ç”¨å±æ€§ã€‚å¯¹è§„åˆ™è¿›è¡Œå¤„ç†ä»¥ç®€åŒ–åŒ¹é…æ ·å¼è§„åˆ™æœ‰ä¸€äº›æ¥æºï¼šå¤–éƒ¨æ ·å¼è¡¨æˆ–æ ·å¼å…ƒç´ ä¸­çš„ CSS è§„åˆ™1p &#123;color:blue&#125;inline æ ·å¼å±æ€§åŠç±»ä¼¼å†…å®¹1&lt;p /&gt;HTML å¯è§†åŒ–å±æ€§ï¼ˆæ˜ å°„åˆ°ç›¸å…³çš„æ ·å¼è§„åˆ™ï¼‰1&lt;p bgcolor=&quot;blue&quot; /&gt;åä¸¤ç§å¾ˆå®¹æ˜“å’Œå…ƒç´ è¿›è¡ŒåŒ¹é…ï¼Œå› ä¸ºå…ƒç´ æ‹¥æœ‰æ ·å¼å±æ€§ï¼Œè€Œä¸” HTML å±æ€§å¯ä»¥ä½¿ç”¨å…ƒç´ ä½œä¸ºé”®å€¼è¿›è¡Œæ˜ å°„ã€‚æˆ‘ä»¬ä¹‹å‰åœ¨ç¬¬ 2 ä¸ªé—®é¢˜ä¸­æåˆ°è¿‡ï¼ŒCSS è§„åˆ™åŒ¹é…å¯èƒ½æ¯”è¾ƒæ£˜æ‰‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸€éš¾é¢˜ï¼Œå¯ä»¥å¯¹ CSS è§„åˆ™è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä»¥ä¾¿è®¿é—®ã€‚æ ·å¼è¡¨è§£æå®Œæ¯•åï¼Œç³»ç»Ÿä¼šæ ¹æ®é€‰æ‹©å™¨å°† CSS è§„åˆ™æ·»åŠ åˆ°æŸä¸ªå“ˆå¸Œè¡¨ä¸­ã€‚è¿™äº›å“ˆå¸Œè¡¨çš„é€‰æ‹©å™¨å„ä¸ç›¸åŒï¼ŒåŒ…æ‹¬ IDã€ç±»åç§°ã€æ ‡è®°åç§°ç­‰ï¼Œè¿˜æœ‰ä¸€ç§é€šç”¨å“ˆå¸Œè¡¨ï¼Œé€‚åˆä¸å±äºä¸Šè¿°ç±»åˆ«çš„è§„åˆ™ã€‚å¦‚æœé€‰æ‹©å™¨æ˜¯ IDï¼Œè§„åˆ™å°±ä¼šæ·»åŠ åˆ° ID è¡¨ä¸­ï¼›å¦‚æœé€‰æ‹©å™¨æ˜¯ç±»ï¼Œè§„åˆ™å°±ä¼šæ·»åŠ åˆ°ç±»è¡¨ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™ç§å¤„ç†å¯ä»¥å¤§å¤§ç®€åŒ–è§„åˆ™åŒ¹é…ã€‚æˆ‘ä»¬æ— éœ€æŸ¥çœ‹æ¯ä¸€æ¡å£°æ˜ï¼Œåªè¦ä»å“ˆå¸Œè¡¨ä¸­æå–å…ƒç´ çš„ç›¸å…³è§„åˆ™å³å¯ã€‚è¿™ç§ä¼˜åŒ–æ–¹æ³•å¯æ’é™¤æ‰ 95% ä»¥ä¸Šè§„åˆ™ï¼Œå› æ­¤åœ¨åŒ¹é…è¿‡ç¨‹ä¸­æ ¹æœ¬å°±ä¸ç”¨è€ƒè™‘è¿™äº›è§„åˆ™äº† (4.1)ã€‚æˆ‘ä»¬ä»¥å¦‚ä¸‹çš„æ ·å¼è§„åˆ™ä¸ºä¾‹ï¼š123p.error &#123;color:red&#125;#messageDiv &#123;height:50px&#125;div &#123;margin:5px&#125;ç¬¬ä¸€æ¡è§„åˆ™å°†æ’å…¥ç±»è¡¨ï¼Œç¬¬äºŒæ¡å°†æ’å…¥ ID è¡¨ï¼Œè€Œç¬¬ä¸‰æ¡å°†æ’å…¥æ ‡è®°è¡¨ã€‚å¯¹äºä¸‹é¢çš„ HTML ä»£ç æ®µï¼š12&lt;p&gt;an error occurred &lt;/p&gt;&lt;div&gt;this is a message&lt;/div&gt;æˆ‘ä»¬é¦–å…ˆä¼šä¸º p å…ƒç´ å¯»æ‰¾åŒ¹é…çš„è§„åˆ™ã€‚ç±»è¡¨ä¸­æœ‰ä¸€ä¸ª â€œerrorâ€ é”®ï¼Œåœ¨ä¸‹é¢å¯ä»¥æ‰¾åˆ° â€œp.errorâ€ çš„è§„åˆ™ã€‚div å…ƒç´ åœ¨ ID è¡¨ï¼ˆé”®ä¸º IDï¼‰å’Œæ ‡è®°è¡¨ä¸­æœ‰ç›¸å…³çš„è§„åˆ™ã€‚å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ‰¾å‡ºå“ªäº›æ ¹æ®é”®æå–çš„è§„åˆ™æ˜¯çœŸæ­£åŒ¹é…çš„äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ div çš„å¯¹åº”è§„åˆ™å¦‚ä¸‹ï¼š1table div &#123;margin:5px&#125;è¿™æ¡è§„åˆ™ä»ç„¶ä¼šä»æ ‡è®°è¡¨ä¸­æå–å‡ºæ¥ï¼Œå› ä¸ºé”®æ˜¯æœ€å³è¾¹çš„é€‰æ‹©å™¨ï¼Œä½†è¿™æ¡è§„åˆ™å¹¶ä¸åŒ¹é…æˆ‘ä»¬çš„ div å…ƒç´ ï¼Œå› ä¸º div æ²¡æœ‰ table ç¥–å…ˆã€‚WebKit å’Œ Firefox éƒ½è¿›è¡Œäº†è¿™ä¸€å¤„ç†ã€‚ä»¥æ­£ç¡®çš„å±‚å é¡ºåºåº”ç”¨è§„åˆ™æ ·å¼å¯¹è±¡å…·æœ‰ä¸æ¯ä¸ªå¯è§†åŒ–å±æ€§ä¸€ä¸€å¯¹åº”çš„å±æ€§ï¼ˆå‡ä¸º CSS å±æ€§ä½†æ›´ä¸ºé€šç”¨ï¼‰ã€‚å¦‚æœæŸä¸ªå±æ€§æœªç”±ä»»ä½•åŒ¹é…è§„åˆ™æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆéƒ¨åˆ†å±æ€§å°±å¯ç”±çˆ¶ä»£å…ƒç´ æ ·å¼å¯¹è±¡ç»§æ‰¿ã€‚å…¶ä»–å±æ€§å…·æœ‰é»˜è®¤å€¼ã€‚å¦‚æœå®šä¹‰ä¸æ­¢ä¸€ä¸ªï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œéœ€è¦é€šè¿‡å±‚å é¡ºåºæ¥è§£å†³ã€‚æ ·å¼è¡¨å±‚å é¡ºåºæŸä¸ªæ ·å¼å±æ€§çš„å£°æ˜å¯èƒ½ä¼šå‡ºç°åœ¨å¤šä¸ªæ ·å¼è¡¨ä¸­ï¼Œä¹Ÿå¯èƒ½åœ¨åŒä¸€ä¸ªæ ·å¼è¡¨ä¸­å‡ºç°å¤šæ¬¡ã€‚è¿™æ„å‘³ç€åº”ç”¨è§„åˆ™çš„é¡ºåºæä¸ºé‡è¦ã€‚è¿™ç§°ä¸º â€œå±‚å â€ é¡ºåºã€‚æ ¹æ® CSS2 è§„èŒƒï¼Œå±‚å çš„é¡ºåºä¸ºï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼šæµè§ˆå™¨å£°æ˜ç”¨æˆ·æ™®é€šå£°æ˜ä½œè€…æ™®é€šå£°æ˜ä½œè€…é‡è¦å£°æ˜ç”¨æˆ·é‡è¦å£°æ˜æµè§ˆå™¨å£°æ˜æ˜¯é‡è¦ç¨‹åº¦æœ€ä½çš„ï¼Œè€Œç”¨æˆ·åªæœ‰å°†è¯¥å£°æ˜æ ‡è®°ä¸º â€œé‡è¦â€ æ‰å¯ä»¥æ›¿æ¢ç½‘é¡µä½œè€…çš„å£°æ˜ã€‚åŒæ ·é¡ºåºçš„å£°æ˜ä¼šæ ¹æ®ç‰¹å¼‚æ€§è¿›è¡Œæ’åºï¼Œç„¶åå†æ˜¯å…¶æŒ‡å®šé¡ºåºã€‚HTML å¯è§†åŒ–å±æ€§ä¼šè½¬æ¢æˆåŒ¹é…çš„ CSS å£°æ˜ã€‚å®ƒä»¬è¢«è§†ä¸ºä½ä¼˜å…ˆçº§çš„ç½‘é¡µä½œè€…è§„åˆ™ã€‚ç‰¹å¼‚æ€§é€‰æ‹©å™¨çš„ç‰¹å¼‚æ€§ç”± CSS2 è§„èŒƒå®šä¹‰å¦‚ä¸‹ï¼šå¦‚æœå£°æ˜æ¥è‡ªäº â€œstyleâ€ å±æ€§ï¼Œè€Œä¸æ˜¯å¸¦æœ‰é€‰æ‹©å™¨çš„è§„åˆ™ï¼Œåˆ™è®°ä¸º 1ï¼Œå¦åˆ™è®°ä¸º 0 (= a)è®°ä¸ºé€‰æ‹©å™¨ä¸­ ID å±æ€§çš„ä¸ªæ•° (= b)è®°ä¸ºé€‰æ‹©å™¨ä¸­å…¶ä»–å±æ€§å’Œä¼ªç±»çš„ä¸ªæ•° (= c)è®°ä¸ºé€‰æ‹©å™¨ä¸­å…ƒç´ åç§°å’Œä¼ªå…ƒç´ çš„ä¸ªæ•° (= d)å°†å››ä¸ªæ•°å­—æŒ‰ a-b-c-d è¿™æ ·è¿æ¥èµ·æ¥ï¼ˆä½äºå¤§æ•°è¿›åˆ¶çš„æ•°å­—ç³»ç»Ÿä¸­ï¼‰ï¼Œæ„æˆç‰¹å¼‚æ€§ã€‚æ‚¨ä½¿ç”¨çš„è¿›åˆ¶å–å†³äºä¸Šè¿°ç±»åˆ«ä¸­çš„æœ€é«˜è®¡æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ a=14ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ã€‚å¦‚æœ a=17ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨åä¸ƒè¿›åˆ¶ï¼›å½“ç„¶ä¸å¤ªå¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼Œé™¤éæ˜¯å­˜åœ¨å¦‚ä¸‹çš„é€‰æ‹©å™¨ï¼šhtml body div div p â€¦ï¼ˆåœ¨é€‰æ‹©å™¨ä¸­å‡ºç°äº† 17 ä¸ªæ ‡è®°ï¼Œè¿™æ ·çš„å¯èƒ½æ€§æä½ï¼‰ã€‚ä¸€äº›ç¤ºä¾‹ï¼š12345678910* &#123;&#125; /* a=0 b=0 c=0 d=0 -&gt; specificity = 0,0,0,0 */li &#123;&#125; /* a=0 b=0 c=0 d=1 -&gt; specificity = 0,0,0,1 */li:first-line &#123;&#125; /* a=0 b=0 c=0 d=2 -&gt; specificity = 0,0,0,2 */ul li &#123;&#125; /* a=0 b=0 c=0 d=2 -&gt; specificity = 0,0,0,2 */ul ol+li &#123;&#125; /* a=0 b=0 c=0 d=3 -&gt; specificity = 0,0,0,3 */h1 + *[rel=up]&#123;&#125; /* a=0 b=0 c=1 d=1 -&gt; specificity = 0,0,1,1 */ul ol li.red &#123;&#125; /* a=0 b=0 c=1 d=3 -&gt; specificity = 0,0,1,3 */li.red.level &#123;&#125; /* a=0 b=0 c=2 d=1 -&gt; specificity = 0,0,2,1 */#x34y &#123;&#125; /* a=0 b=1 c=0 d=0 -&gt; specificity = 0,1,0,0 */ /* a=1 b=0 c=0 d=0 -&gt; specificity = 1,0,0,0 */è§„åˆ™æ’åºæ‰¾åˆ°åŒ¹é…çš„è§„åˆ™ä¹‹åï¼Œåº”æ ¹æ®çº§è”é¡ºåºå°†å…¶æ’åºã€‚WebKit å¯¹äºè¾ƒå°çš„åˆ—è¡¨ä¼šä½¿ç”¨å†’æ³¡æ’åºï¼Œè€Œå¯¹è¾ƒå¤§çš„åˆ—è¡¨åˆ™ä½¿ç”¨å½’å¹¶æ’åºã€‚å¯¹äºä»¥ä¸‹è§„åˆ™ï¼ŒWebKit é€šè¿‡æ›¿æ¢ â€œ&gt;â€ è¿ç®—ç¬¦æ¥å®ç°æ’åºï¼š123456static bool operator &gt;(CSSRuleData&amp; r1, CSSRuleData&amp; r2)&#123; int spec1 = r1.selector()-&gt;specificity(); int spec2 = r2.selector()-&gt;specificity(); return (spec1 == spec2) : r1.position() &gt; r2.position() : spec1 &gt; spec2;&#125;æ¸è¿›å¼å¤„ç†WebKit ä½¿ç”¨ä¸€ä¸ªæ ‡è®°æ¥è¡¨ç¤ºæ˜¯å¦æ‰€æœ‰çš„é¡¶çº§æ ·å¼è¡¨ï¼ˆåŒ…æ‹¬ @importsï¼‰å‡å·²åŠ è½½å®Œæ¯•ã€‚å¦‚æœåœ¨é™„åŠ è¿‡ç¨‹ä¸­å°šæœªå®Œå…¨åŠ è½½æ ·å¼ï¼Œåˆ™ä½¿ç”¨å ä½ç¬¦ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸­è¿›è¡Œæ ‡æ³¨ï¼Œç­‰æ ·å¼è¡¨åŠ è½½å®Œæ¯•åå†é‡æ–°è®¡ç®—ã€‚å¸ƒå±€å‘ˆç°å™¨åœ¨åˆ›å»ºå®Œæˆå¹¶æ·»åŠ åˆ°å‘ˆç°æ ‘æ—¶ï¼Œå¹¶ä¸åŒ…å«ä½ç½®å’Œå¤§å°ä¿¡æ¯ã€‚è®¡ç®—è¿™äº›å€¼çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€æˆ–é‡æ’ã€‚HTML é‡‡ç”¨åŸºäºæµçš„å¸ƒå±€æ¨¡å‹ï¼Œè¿™æ„å‘³ç€å¤§å¤šæ•°æƒ…å†µä¸‹åªè¦ä¸€æ¬¡éå†å°±èƒ½è®¡ç®—å‡ºå‡ ä½•ä¿¡æ¯ã€‚å¤„äºæµä¸­é åä½ç½®å…ƒç´ é€šå¸¸ä¸ä¼šå½±å“é å‰ä½ç½®å…ƒç´ çš„å‡ ä½•ç‰¹å¾ï¼Œå› æ­¤å¸ƒå±€å¯ä»¥æŒ‰ä»å·¦è‡³å³ã€ä»ä¸Šè‡³ä¸‹çš„é¡ºåºéå†æ–‡æ¡£ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–æƒ…å†µï¼Œæ¯”å¦‚ HTML è¡¨æ ¼çš„è®¡ç®—å°±éœ€è¦ä¸æ­¢ä¸€æ¬¡çš„éå† (3.5)ã€‚åæ ‡ç³»æ˜¯ç›¸å¯¹äºæ ¹æ¡†æ¶è€Œå»ºç«‹çš„ï¼Œä½¿ç”¨çš„æ˜¯ä¸Šåæ ‡å’Œå·¦åæ ‡ã€‚å¸ƒå±€æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚å®ƒä»æ ¹å‘ˆç°å™¨ï¼ˆå¯¹åº”äº HTML æ–‡æ¡£çš„ &lt;html&gt; å…ƒç´ ï¼‰å¼€å§‹ï¼Œç„¶åé€’å½’éå†éƒ¨åˆ†æˆ–æ‰€æœ‰çš„æ¡†æ¶å±‚æ¬¡ç»“æ„ï¼Œä¸ºæ¯ä¸€ä¸ªéœ€è¦è®¡ç®—çš„å‘ˆç°å™¨è®¡ç®—å‡ ä½•ä¿¡æ¯ã€‚æ ¹å‘ˆç°å™¨çš„ä½ç½®å·¦è¾¹æ˜¯ 0,0ï¼Œå…¶å°ºå¯¸ä¸ºè§†å£ï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨çª—å£çš„å¯è§åŒºåŸŸï¼‰ã€‚æ‰€æœ‰çš„å‘ˆç°å™¨éƒ½æœ‰ä¸€ä¸ª â€œlayoutâ€ æˆ–è€… â€œreflowâ€ æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªå‘ˆç°å™¨éƒ½ä¼šè°ƒç”¨å…¶éœ€è¦è¿›è¡Œå¸ƒå±€çš„å­ä»£çš„ layout æ–¹æ³•ã€‚Dirty ä½ç³»ç»Ÿä¸ºé¿å…å¯¹æ‰€æœ‰ç»†å°æ›´æ”¹éƒ½è¿›è¡Œæ•´ä½“å¸ƒå±€ï¼Œæµè§ˆå™¨é‡‡ç”¨äº†ä¸€ç§ â€œdirty ä½â€ ç³»ç»Ÿã€‚å¦‚æœæŸä¸ªå‘ˆç°å™¨å‘ç”Ÿäº†æ›´æ”¹ï¼Œæˆ–è€…å°†è‡ªèº«åŠå…¶å­ä»£æ ‡æ³¨ä¸ºâ€œdirtyâ€ï¼Œåˆ™éœ€è¦è¿›è¡Œå¸ƒå±€ã€‚æœ‰ä¸¤ç§æ ‡è®°ï¼šâ€œdirtyâ€å’Œ â€œchildren are dirtyâ€ã€‚â€œchildren are dirtyâ€ è¡¨ç¤ºå°½ç®¡å‘ˆç°å™¨è‡ªèº«æ²¡æœ‰å˜åŒ–ï¼Œä½†å®ƒè‡³å°‘æœ‰ä¸€ä¸ªå­ä»£éœ€è¦å¸ƒå±€ã€‚å…¨å±€å¸ƒå±€å’Œå¢é‡å¸ƒå±€å…¨å±€å¸ƒå±€æ˜¯æŒ‡è§¦å‘äº†æ•´ä¸ªå‘ˆç°æ ‘èŒƒå›´çš„å¸ƒå±€ï¼Œè§¦å‘åŸå› å¯èƒ½åŒ…æ‹¬ï¼šå½±å“æ‰€æœ‰å‘ˆç°å™¨çš„å…¨å±€æ ·å¼æ›´æ”¹ï¼Œä¾‹å¦‚å­—ä½“å¤§å°æ›´æ”¹ã€‚å±å¹•å¤§å°è°ƒæ•´ã€‚å¸ƒå±€å¯ä»¥é‡‡ç”¨å¢é‡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åªå¯¹ dirty å‘ˆç°å™¨è¿›è¡Œå¸ƒå±€ï¼ˆè¿™æ ·å¯èƒ½å­˜åœ¨éœ€è¦è¿›è¡Œé¢å¤–å¸ƒå±€çš„å¼Šç«¯ï¼‰ã€‚å½“å‘ˆç°å™¨ä¸º dirty æ—¶ï¼Œä¼šå¼‚æ­¥è§¦å‘å¢é‡å¸ƒå±€ã€‚ä¾‹å¦‚ï¼Œå½“æ¥è‡ªç½‘ç»œçš„é¢å¤–å†…å®¹æ·»åŠ åˆ° DOM æ ‘ä¹‹åï¼Œæ–°çš„å‘ˆç°å™¨é™„åŠ åˆ°äº†å‘ˆç°æ ‘ä¸­ã€‚ å›¾ï¼šå¢é‡å¸ƒå±€ - åªæœ‰ dirty å‘ˆç°å™¨åŠå…¶å­ä»£è¿›è¡Œå¸ƒå±€ (3.6)ã€‚å¼‚æ­¥å¸ƒå±€å’ŒåŒæ­¥å¸ƒå±€å¢é‡å¸ƒå±€æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚Firefox å°†å¢é‡å¸ƒå±€çš„ â€œreflow å‘½ä»¤â€ åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œè°ƒåº¦ç¨‹åºä¼šè§¦å‘è¿™äº›å‘½ä»¤çš„æ‰¹é‡æ‰§è¡Œã€‚WebKit ä¹Ÿæœ‰ç”¨äºæ‰§è¡Œå¢é‡å¸ƒå±€çš„è®¡æ—¶å™¨ï¼šå¯¹å‘ˆç°æ ‘è¿›è¡Œéå†ï¼Œå¹¶å¯¹ dirty å‘ˆç°å™¨è¿›è¡Œå¸ƒå±€ã€‚è¯·æ±‚æ ·å¼ä¿¡æ¯ï¼ˆä¾‹å¦‚ â€œoffsetHeightâ€ï¼‰çš„è„šæœ¬å¯åŒæ­¥è§¦å‘å¢é‡å¸ƒå±€ã€‚å…¨å±€å¸ƒå±€å¾€å¾€æ˜¯åŒæ­¥è§¦å‘çš„ã€‚æœ‰æ—¶ï¼Œå½“åˆå§‹å¸ƒå±€å®Œæˆä¹‹åï¼Œå¦‚æœä¸€äº›å±æ€§ï¼ˆå¦‚æ»šåŠ¨ä½ç½®ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œå¸ƒå±€å°±ä¼šä½œä¸ºå›è°ƒè€Œè§¦å‘ã€‚ä¼˜åŒ–å¦‚æœå¸ƒå±€æ˜¯ç”± â€œå¤§å°è°ƒæ•´â€ æˆ–å‘ˆç°å™¨çš„ä½ç½®ï¼ˆè€Œéå¤§å°ï¼‰æ”¹å˜è€Œè§¦å‘çš„ï¼Œé‚£ä¹ˆå¯ä»¥ä»ç¼“å­˜ä¸­è·å–å‘ˆç°å™¨çš„å¤§å°ï¼Œè€Œæ— éœ€é‡æ–°è®¡ç®—ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªå­æ ‘è¿›è¡Œäº†ä¿®æ”¹ï¼Œå› æ­¤æ— éœ€ä»æ ¹èŠ‚ç‚¹å¼€å§‹å¸ƒå±€ã€‚è¿™é€‚ç”¨äºåœ¨æœ¬åœ°è¿›è¡Œæ›´æ”¹è€Œä¸å½±å“å‘¨å›´å…ƒç´ çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨æ–‡æœ¬å­—æ®µä¸­æ’å…¥æ–‡æœ¬ï¼ˆå¦åˆ™æ¯æ¬¡é”®ç›˜è¾“å…¥éƒ½å°†è§¦å‘ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å¸ƒå±€ï¼‰ã€‚å¸ƒå±€å¤„ç†å¸ƒå±€é€šå¸¸å…·æœ‰ä»¥ä¸‹æ¨¡å¼ï¼šçˆ¶å‘ˆç°å™¨ç¡®å®šè‡ªå·±çš„å®½åº¦ã€‚çˆ¶å‘ˆç°å™¨ä¾æ¬¡å¤„ç†å­å‘ˆç°å™¨ï¼Œå¹¶ä¸”ï¼šæ”¾ç½®å­å‘ˆç°å™¨ï¼ˆè®¾ç½® x,y åæ ‡ï¼‰ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œè°ƒç”¨å­å‘ˆç°å™¨çš„å¸ƒå±€ï¼ˆå¦‚æœå­å‘ˆç°å™¨æ˜¯ dirty çš„ï¼Œæˆ–è€…è¿™æ˜¯å…¨å±€å¸ƒå±€ï¼Œæˆ–å‡ºäºå…¶ä»–æŸäº›åŸå› ï¼‰ï¼Œè¿™ä¼šè®¡ç®—å­å‘ˆç°å™¨çš„é«˜åº¦ã€‚çˆ¶å‘ˆç°å™¨æ ¹æ®å­å‘ˆç°å™¨çš„ç´¯åŠ é«˜åº¦ä»¥åŠè¾¹è·å’Œè¡¥ç™½çš„é«˜åº¦æ¥è®¾ç½®è‡ªèº«é«˜åº¦ï¼Œæ­¤å€¼ä¹Ÿå¯ä¾›çˆ¶å‘ˆç°å™¨çš„çˆ¶å‘ˆç°å™¨ä½¿ç”¨ã€‚å°†å…¶ dirty ä½è®¾ç½®ä¸º falseã€‚Firefox ä½¿ç”¨ â€œstateâ€ å¯¹è±¡ (nsHTMLReflowState) ä½œä¸ºå¸ƒå±€çš„å‚æ•°ï¼ˆç§°ä¸ºâ€œreflowâ€ï¼‰ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬äº†çˆ¶å‘ˆç°å™¨çš„å®½åº¦ã€‚Firefox å¸ƒå±€çš„è¾“å‡ºä¸º â€œmetricsâ€ å¯¹è±¡ (nsHTMLReflowMetrics)ï¼Œå…¶åŒ…å«è®¡ç®—å¾—å‡ºçš„å‘ˆç°å™¨é«˜åº¦ã€‚å®½åº¦è®¡ç®—å‘ˆç°å™¨å®½åº¦æ˜¯æ ¹æ®å®¹å™¨å—çš„å®½åº¦ã€å‘ˆç°å™¨æ ·å¼ä¸­çš„ â€œwidthâ€ å±æ€§ä»¥åŠè¾¹è·å’Œè¾¹æ¡†è®¡ç®—å¾—å‡ºçš„ã€‚ä¾‹å¦‚ä»¥ä¸‹ div çš„å®½åº¦ï¼š1&lt;div/&gt;å°†ç”± WebKit è®¡ç®—å¦‚ä¸‹ï¼ˆBenderBox ç±»ï¼ŒcalcWidth æ–¹æ³•ï¼‰ï¼šå®¹å™¨çš„å®½åº¦å–å®¹å™¨çš„ availableWidth å’Œ 0 ä¸­çš„è¾ƒå¤§å€¼ã€‚availableWidth åœ¨æœ¬ä¾‹ä¸­ç›¸å½“äº contentWidthï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š1clientWidth() - paddingLeft() - paddingRight()clientWidth å’Œ clientHeight è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨ï¼ˆé™¤å»è¾¹æ¡†å’Œæ»šåŠ¨æ¡ï¼‰ã€‚ å…ƒç´ çš„å®½åº¦æ˜¯ â€œwidthâ€ æ ·å¼å±æ€§ã€‚å®ƒä¼šæ ¹æ®å®¹å™¨å®½åº¦çš„ç™¾åˆ†æ¯”è®¡ç®—å¾—å‡ºä¸€ä¸ªç»å¯¹å€¼ã€‚ç„¶ååŠ ä¸Šæ°´å¹³æ–¹å‘çš„è¾¹æ¡†å’Œè¡¥ç™½ã€‚ç°åœ¨è®¡ç®—å¾—å‡ºçš„æ˜¯ â€œpreferred widthâ€ã€‚ç„¶åéœ€è¦è®¡ç®—æœ€å°å®½åº¦å’Œæœ€å¤§å®½åº¦ã€‚å¦‚æœé¦–é€‰å®½åº¦å¤§äºæœ€å¤§å®½åº¦ï¼Œé‚£ä¹ˆåº”ä½¿ç”¨æœ€å¤§å®½åº¦ã€‚å¦‚æœé¦–é€‰å®½åº¦å°äºæœ€å°å®½åº¦ï¼ˆæœ€å°çš„ä¸å¯ç ´å¼€å•ä½ï¼‰ï¼Œé‚£ä¹ˆåº”ä½¿ç”¨æœ€å°å®½åº¦ã€‚è¿™äº›å€¼ä¼šç¼“å­˜èµ·æ¥ï¼Œä»¥ç”¨äºéœ€è¦å¸ƒå±€è€Œå®½åº¦ä¸å˜çš„æƒ…å†µã€‚æ¢è¡Œå¦‚æœå‘ˆç°å™¨åœ¨å¸ƒå±€è¿‡ç¨‹ä¸­éœ€è¦æ¢è¡Œï¼Œä¼šç«‹å³åœæ­¢å¸ƒå±€ï¼Œå¹¶å‘ŠçŸ¥å…¶çˆ¶ä»£éœ€è¦æ¢è¡Œã€‚çˆ¶ä»£ä¼šåˆ›å»ºé¢å¤–çš„å‘ˆç°å™¨ï¼Œå¹¶å¯¹å…¶è°ƒç”¨å¸ƒå±€ã€‚ç»˜åˆ¶åœ¨ç»˜åˆ¶é˜¶æ®µï¼Œç³»ç»Ÿä¼šéå†å‘ˆç°æ ‘ï¼Œå¹¶è°ƒç”¨å‘ˆç°å™¨çš„ â€œpaintâ€ æ–¹æ³•ï¼Œå°†å‘ˆç°å™¨çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ç»˜åˆ¶å·¥ä½œæ˜¯ä½¿ç”¨ç”¨æˆ·ç•Œé¢åŸºç¡€ç»„ä»¶å®Œæˆçš„ã€‚å…¨å±€ç»˜åˆ¶å’Œå¢é‡ç»˜åˆ¶å’Œå¸ƒå±€ä¸€æ ·ï¼Œç»˜åˆ¶ä¹Ÿåˆ†ä¸ºå…¨å±€ï¼ˆç»˜åˆ¶æ•´ä¸ªå‘ˆç°æ ‘ï¼‰å’Œå¢é‡ä¸¤ç§ã€‚åœ¨å¢é‡ç»˜åˆ¶ä¸­ï¼Œéƒ¨åˆ†å‘ˆç°å™¨å‘ç”Ÿäº†æ›´æ”¹ï¼Œä½†æ˜¯ä¸ä¼šå½±å“æ•´ä¸ªæ ‘ã€‚æ›´æ”¹åçš„å‘ˆç°å™¨å°†å…¶åœ¨å±å¹•ä¸Šå¯¹åº”çš„çŸ©å½¢åŒºåŸŸè®¾ä¸ºæ— æ•ˆï¼Œè¿™å¯¼è‡´ OS å°†å…¶è§†ä¸ºä¸€å— â€œdirty åŒºåŸŸâ€ï¼Œå¹¶ç”Ÿæˆâ€œpaintâ€ äº‹ä»¶ã€‚OS ä¼šå¾ˆå·§å¦™åœ°å°†å¤šä¸ªåŒºåŸŸåˆå¹¶æˆä¸€ä¸ªã€‚åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œæƒ…å†µè¦æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸º Chrome æµè§ˆå™¨çš„å‘ˆç°å™¨ä¸åœ¨ä¸»è¿›ç¨‹ä¸Šã€‚Chrome æµè§ˆå™¨ä¼šåœ¨æŸç§ç¨‹åº¦ä¸Šæ¨¡æ‹Ÿ OS çš„è¡Œä¸ºã€‚å±•ç¤ºå±‚ä¼šä¾¦å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶å°†æ¶ˆæ¯å§”æ‰˜ç»™å‘ˆç°æ ¹èŠ‚ç‚¹ã€‚ç„¶åéå†å‘ˆç°æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸å…³çš„å‘ˆç°å™¨ï¼Œè¯¥å‘ˆç°å™¨ä¼šé‡æ–°ç»˜åˆ¶è‡ªå·±ï¼ˆé€šå¸¸ä¹ŸåŒ…æ‹¬å…¶å­ä»£ï¼‰ã€‚ç»˜åˆ¶é¡ºåºCSS2 è§„èŒƒå®šä¹‰äº†ç»˜åˆ¶æµç¨‹çš„é¡ºåºã€‚ç»˜åˆ¶çš„é¡ºåºå…¶å®å°±æ˜¯å…ƒç´ è¿›å…¥å †æ ˆæ ·å¼ä¸Šä¸‹æ–‡çš„é¡ºåºã€‚è¿™äº›å †æ ˆä¼šä»åå¾€å‰ç»˜åˆ¶ï¼Œå› æ­¤è¿™æ ·çš„é¡ºåºä¼šå½±å“ç»˜åˆ¶ã€‚å—å‘ˆç°å™¨çš„å †æ ˆé¡ºåºå¦‚ä¸‹ï¼šèƒŒæ™¯é¢œè‰²èƒŒæ™¯å›¾ç‰‡è¾¹æ¡†å­ä»£è½®å»“Firefox æ˜¾ç¤ºåˆ—è¡¨Firefox éå†æ•´ä¸ªå‘ˆç°æ ‘ï¼Œä¸ºç»˜åˆ¶çš„çŸ©å½¢å»ºç«‹ä¸€ä¸ªæ˜¾ç¤ºåˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æŒ‰ç…§æ­£ç¡®çš„ç»˜åˆ¶é¡ºåºï¼ˆå…ˆæ˜¯å‘ˆç°å™¨çš„èƒŒæ™¯ï¼Œç„¶åæ˜¯è¾¹æ¡†ç­‰ç­‰ï¼‰åŒ…å«äº†ä¸çŸ©å½¢ç›¸å…³çš„å‘ˆç°å™¨ã€‚è¿™æ ·ç­‰åˆ°é‡æ–°ç»˜åˆ¶çš„æ—¶å€™ï¼Œåªéœ€éå†ä¸€æ¬¡å‘ˆç°æ ‘ï¼Œè€Œä¸ç”¨å¤šæ¬¡éå†ï¼ˆç»˜åˆ¶æ‰€æœ‰èƒŒæ™¯ï¼Œç„¶åç»˜åˆ¶æ‰€æœ‰å›¾ç‰‡ï¼Œå†ç»˜åˆ¶æ‰€æœ‰è¾¹æ¡†ç­‰ç­‰ï¼‰ã€‚Firefox å¯¹æ­¤è¿‡ç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¸æ·»åŠ éšè—çš„å…ƒç´ ï¼Œä¾‹å¦‚è¢«ä¸é€æ˜å…ƒç´ å®Œå…¨é®æŒ¡ä½çš„å…ƒç´ ã€‚WebKit çŸ©å½¢å­˜å‚¨åœ¨é‡æ–°ç»˜åˆ¶ä¹‹å‰ï¼ŒWebKit ä¼šå°†åŸæ¥çš„çŸ©å½¢å¦å­˜ä¸ºä¸€å¼ ä½å›¾ï¼Œç„¶ååªç»˜åˆ¶æ–°æ—§çŸ©å½¢ä¹‹é—´çš„å·®å¼‚éƒ¨åˆ†ã€‚åŠ¨æ€å˜åŒ–åœ¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨ä¼šå°½å¯èƒ½åšå‡ºæœ€å°çš„å“åº”ã€‚å› æ­¤ï¼Œå…ƒç´ çš„é¢œè‰²æ”¹å˜åï¼Œåªä¼šå¯¹è¯¥å…ƒç´ è¿›è¡Œé‡ç»˜ã€‚å…ƒç´ çš„ä½ç½®æ”¹å˜åï¼Œåªä¼šå¯¹è¯¥å…ƒç´ åŠå…¶å­å…ƒç´ ï¼ˆå¯èƒ½è¿˜æœ‰åŒçº§å…ƒç´ ï¼‰è¿›è¡Œå¸ƒå±€å’Œé‡ç»˜ã€‚æ·»åŠ  DOM èŠ‚ç‚¹åï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œå¸ƒå±€å’Œé‡ç»˜ã€‚ä¸€äº›é‡å¤§å˜åŒ–ï¼ˆä¾‹å¦‚å¢å¤§ â€œhtmlâ€ å…ƒç´ çš„å­—ä½“ï¼‰ä¼šå¯¼è‡´ç¼“å­˜æ— æ•ˆï¼Œä½¿å¾—æ•´ä¸ªå‘ˆç°æ ‘éƒ½ä¼šè¿›è¡Œé‡æ–°å¸ƒå±€å’Œç»˜åˆ¶ã€‚å‘ˆç°å¼•æ“çš„çº¿ç¨‹å‘ˆç°å¼•æ“é‡‡ç”¨äº†å•çº¿ç¨‹ã€‚å‡ ä¹æ‰€æœ‰æ“ä½œï¼ˆé™¤äº†ç½‘ç»œæ“ä½œï¼‰éƒ½æ˜¯åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œçš„ã€‚åœ¨ Firefox å’Œ Safari ä¸­ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯æµè§ˆå™¨çš„ä¸»çº¿ç¨‹ã€‚è€Œåœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œè¯¥çº¿ç¨‹æ˜¯æ ‡ç­¾è¿›ç¨‹çš„ä¸»çº¿ç¨‹ã€‚ç½‘ç»œæ“ä½œå¯ç”±å¤šä¸ªå¹¶è¡Œçº¿ç¨‹æ‰§è¡Œã€‚å¹¶è¡Œè¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼ˆé€šå¸¸ä¸º 2 è‡³ 6 ä¸ªï¼Œä»¥ Firefox 3 ä¸ºä¾‹æ˜¯ 6 ä¸ªï¼‰ã€‚äº‹ä»¶å¾ªç¯æµè§ˆå™¨çš„ä¸»çº¿ç¨‹æ˜¯äº‹ä»¶å¾ªç¯ã€‚å®ƒæ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæ°¸è¿œå¤„äºæ¥å—å¤„ç†çŠ¶æ€ï¼Œå¹¶ç­‰å¾…äº‹ä»¶ï¼ˆå¦‚å¸ƒå±€å’Œç»˜åˆ¶äº‹ä»¶ï¼‰å‘ç”Ÿï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚è¿™æ˜¯ Firefox ä¸­å…³äºä¸»äº‹ä»¶å¾ªç¯çš„ä»£ç ï¼š12while (!mExiting) NS_ProcessNextEvent(thread);CSS2 å¯è§†åŒ–æ¨¡å‹ç”»å¸ƒæ ¹æ® CSS2 è§„èŒƒï¼Œâ€œç”»å¸ƒâ€ è¿™ä¸€æœ¯è¯­æ˜¯æŒ‡ â€œç”¨æ¥å‘ˆç°æ ¼å¼åŒ–ç»“æ„çš„ç©ºé—´â€ï¼Œä¹Ÿå°±æ˜¯ä¾›æµè§ˆå™¨ç»˜åˆ¶å†…å®¹çš„åŒºåŸŸã€‚ç”»å¸ƒçš„ç©ºé—´å°ºå¯¸å¤§å°æ˜¯æ— é™çš„ï¼Œä½†æ˜¯æµè§ˆå™¨ä¼šæ ¹æ®è§†å£çš„å°ºå¯¸é€‰æ‹©ä¸€ä¸ªåˆå§‹å®½åº¦ã€‚æ ¹æ® www.w3.org/TR/CSS2/zindex.htmlï¼Œç”»å¸ƒå¦‚æœåŒ…å«åœ¨å…¶ä»–ç”»å¸ƒå†…ï¼Œå°±æ˜¯é€æ˜çš„ï¼›å¦åˆ™ä¼šç”±æµè§ˆå™¨æŒ‡å®šä¸€ç§é¢œè‰²ã€‚CSS æ¡†æ¨¡å‹CSS æ¡†æ¨¡å‹æè¿°çš„æ˜¯é’ˆå¯¹æ–‡æ¡£æ ‘ä¸­çš„å…ƒç´ è€Œç”Ÿæˆï¼Œå¹¶æ ¹æ®å¯è§†åŒ–æ ¼å¼æ¨¡å‹è¿›è¡Œå¸ƒå±€çš„çŸ©å½¢æ¡†ã€‚æ¯ä¸ªæ¡†éƒ½æœ‰ä¸€ä¸ªå†…å®¹åŒºåŸŸï¼ˆä¾‹å¦‚æ–‡æœ¬ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œè¿˜æœ‰å¯é€‰çš„å‘¨å›´è¡¥ç™½ã€è¾¹æ¡†å’Œè¾¹è·åŒºåŸŸã€‚ å›¾ï¼šCSS2 æ¡†æ¨¡å‹æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”Ÿæˆ 0..n ä¸ªè¿™æ ·çš„æ¡†ã€‚æ‰€æœ‰å…ƒç´ éƒ½æœ‰ä¸€ä¸ª â€œdisplayâ€ å±æ€§ï¼Œå†³å®šäº†å®ƒä»¬æ‰€å¯¹åº”ç”Ÿæˆçš„æ¡†ç±»å‹ã€‚ç¤ºä¾‹ï¼š123block - generates a block box.inline - generates one or more inline boxes.none - no box is generated.é»˜è®¤å€¼æ˜¯ inlineï¼Œä½†æ˜¯æµè§ˆå™¨æ ·å¼è¡¨è®¾ç½®äº†å…¶ä»–é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œâ€œdivâ€ å…ƒç´ çš„ display å±æ€§é»˜è®¤å€¼æ˜¯ blockã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°é»˜è®¤æ ·å¼è¡¨ç¤ºä¾‹ï¼šwww.w3.org/TR/CSS2/sample.htmlå®šä½æ–¹æ¡ˆæœ‰ä¸‰ç§å®šä½æ–¹æ¡ˆï¼šæ™®é€šï¼šæ ¹æ®å¯¹è±¡åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®è¿›è¡Œå®šä½ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è±¡åœ¨å‘ˆç°æ ‘ä¸­çš„ä½ç½®å’Œå®ƒåœ¨ DOM æ ‘ä¸­çš„ä½ç½®ç›¸ä¼¼ï¼Œå¹¶æ ¹æ®å…¶æ¡†ç±»å‹å’Œå°ºå¯¸è¿›è¡Œå¸ƒå±€ã€‚æµ®åŠ¨ï¼šå¯¹è±¡å…ˆæŒ‰ç…§æ™®é€šæµè¿›è¡Œå¸ƒå±€ï¼Œç„¶åå°½å¯èƒ½åœ°å‘å·¦æˆ–å‘å³ç§»åŠ¨ã€‚ç»å¯¹ï¼šå¯¹è±¡åœ¨å‘ˆç°æ ‘ä¸­çš„ä½ç½®å’Œå®ƒåœ¨ DOM æ ‘ä¸­çš„ä½ç½®ä¸åŒã€‚å®šä½æ–¹æ¡ˆæ˜¯ç”± â€œpositionâ€ å±æ€§å’Œ â€œfloatâ€ å±æ€§è®¾ç½®çš„ã€‚å¦‚æœå€¼æ˜¯ static å’Œ relativeï¼Œå°±æ˜¯æ™®é€šæµå¦‚æœå€¼æ˜¯ absolute å’Œ fixedï¼Œå°±æ˜¯ç»å¯¹å®šä½static å®šä½æ— éœ€å®šä¹‰ä½ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤å®šä½ã€‚å¯¹äºå…¶ä»–æ–¹æ¡ˆï¼Œç½‘é¡µä½œè€…éœ€è¦æŒ‡å®šä½ç½®ï¼štopã€bottomã€leftã€rightã€‚æ¡†çš„å¸ƒå±€æ–¹å¼æ˜¯ç”±ä»¥ä¸‹å› ç´ å†³å®šçš„ï¼šæ¡†ç±»å‹æ¡†å°ºå¯¸å®šä½æ–¹æ¡ˆå¤–éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚å›¾ç‰‡å¤§å°å’Œå±å¹•å¤§å°æ¡†ç±»å‹block æ¡†ï¼šå½¢æˆä¸€ä¸ª blockï¼Œåœ¨æµè§ˆå™¨çª—å£ä¸­æ‹¥æœ‰å…¶è‡ªå·±çš„çŸ©å½¢åŒºåŸŸã€‚ å›¾ï¼šblock æ¡†inline æ¡†ï¼šæ²¡æœ‰è‡ªå·±çš„ blockï¼Œä½†æ˜¯ä½äºå®¹å™¨ block å†…ã€‚ å›¾ï¼šinline æ¡†block é‡‡ç”¨çš„æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‚ç›´æ ¼å¼ï¼Œè€Œ inline é‡‡ç”¨çš„æ˜¯æ°´å¹³æ ¼å¼ã€‚ å›¾ï¼šblock å’Œ inline æ ¼å¼inline æ¡†æ”¾ç½®åœ¨è¡Œä¸­æˆ– â€œè¡Œæ¡†â€ ä¸­ã€‚è¿™äº›è¡Œè‡³å°‘å’Œæœ€é«˜çš„æ¡†ä¸€æ ·é«˜ï¼Œè¿˜å¯ä»¥æ›´é«˜ï¼Œå½“æ¡†æ ¹æ® â€œåº•çº¿â€ å¯¹é½æ—¶ï¼Œè¿™æ„å‘³ç€å…ƒç´ çš„åº•éƒ¨éœ€è¦æ ¹æ®å…¶ä»–æ¡†ä¸­éåº•éƒ¨çš„ä½ç½®å¯¹é½ã€‚å¦‚æœå®¹å™¨çš„å®½åº¦ä¸å¤Ÿï¼Œinline å…ƒç´ å°±ä¼šåˆ†ä¸ºå¤šè¡Œæ”¾ç½®ã€‚åœ¨æ®µè½ä¸­ç»å¸¸å‘ç”Ÿè¿™ç§æƒ…å†µã€‚ å›¾ï¼šè¡Œå®šä½ç›¸å¯¹ç›¸å¯¹å®šä½ï¼šå…ˆæŒ‰ç…§æ™®é€šæ–¹å¼å®šä½ï¼Œç„¶åæ ¹æ®æ‰€éœ€åç§»é‡è¿›è¡Œç§»åŠ¨ã€‚ å›¾ï¼šç›¸å¯¹å®šä½æµ®åŠ¨æµ®åŠ¨æ¡†ä¼šç§»åŠ¨åˆ°è¡Œçš„å·¦è¾¹æˆ–å³è¾¹ã€‚æœ‰è¶£çš„ç‰¹å¾åœ¨äºï¼Œå…¶ä»–æ¡†ä¼šæµ®åŠ¨åœ¨å®ƒçš„å‘¨å›´ã€‚ä¸‹é¢è¿™æ®µ HTML ä»£ç ï¼š1234&lt;p&gt; &lt;img src=&quot;images/image.gif&quot; width=&quot;100&quot; height=&quot;100&quot;&gt; Lorem ipsum dolor sit amet, consectetuer...&lt;/p&gt;æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š å›¾ï¼šæµ®åŠ¨ç»å¯¹å®šä½å’Œå›ºå®šå®šä½è¿™ç§å¸ƒå±€æ˜¯å‡†ç¡®å®šä¹‰çš„ï¼Œä¸æ™®é€šæµæ— å…³ã€‚å…ƒç´ ä¸å‚ä¸æ™®é€šæµã€‚å°ºå¯¸æ˜¯ç›¸å¯¹äºå®¹å™¨è€Œè¨€çš„ã€‚åœ¨å›ºå®šå®šä½ä¸­ï¼Œå®¹å™¨å°±æ˜¯å¯è§†åŒºåŸŸã€‚ å›¾ï¼šå›ºå®šå®šä½è¯·æ³¨æ„ï¼Œå³ä½¿åœ¨æ–‡æ¡£æ»šåŠ¨æ—¶ï¼Œå›ºå®šæ¡†ä¹Ÿä¸ä¼šç§»åŠ¨ã€‚åˆ†å±‚å±•ç¤ºè¿™æ˜¯ç”± z-index CSS å±æ€§æŒ‡å®šçš„ã€‚å®ƒä»£è¡¨äº†æ¡†çš„ç¬¬ä¸‰ä¸ªç»´åº¦ï¼Œä¹Ÿå°±æ˜¯æ²¿ â€œz è½´â€ æ–¹å‘çš„ä½ç½®ã€‚è¿™äº›æ¡†åˆ†æ•£åˆ°å¤šä¸ªå †æ ˆï¼ˆç§°ä¸ºå †æ ˆä¸Šä¸‹æ–‡ï¼‰ä¸­ã€‚åœ¨æ¯ä¸€ä¸ªå †æ ˆä¸­ï¼Œä¼šé¦–å…ˆç»˜åˆ¶åé¢çš„å…ƒç´ ï¼Œç„¶ååœ¨é¡¶éƒ¨ç»˜åˆ¶å‰é¢çš„å…ƒç´ ï¼Œä»¥ä¾¿æ›´é è¿‘ç”¨æˆ·ã€‚å¦‚æœå‡ºç°é‡å ï¼Œæ–°ç»˜åˆ¶çš„å…ƒç´ å°±ä¼šè¦†ç›–ä¹‹å‰çš„å…ƒç´ ã€‚å †æ ˆæ˜¯æŒ‰ç…§ z-index å±æ€§è¿›è¡Œæ’åºçš„ã€‚å…·æœ‰ â€œz-indexâ€ å±æ€§çš„æ¡†å½¢æˆäº†æœ¬åœ°å †æ ˆã€‚è§†å£å…·æœ‰å¤–éƒ¨å †æ ˆã€‚ç¤ºä¾‹ï¼š12345678910111213141516&lt;style type=&quot;text/css&quot;&gt; div &#123; position: absolute; left: 2in; top: 2in; &#125;&lt;/style&gt;&lt;p&gt; &lt;div &gt; &lt;/div&gt; &lt;div &gt; &lt;/div&gt; &lt;/p&gt;ç»“æœå¦‚ä¸‹ï¼š å›¾ï¼šå›ºå®šå®šä½è™½ç„¶çº¢è‰² div åœ¨æ ‡è®°ä¸­çš„ä½ç½®æ¯”ç»¿è‰² div é å‰ï¼ˆæŒ‰ç†åº”è¯¥åœ¨å¸¸è§„æµç¨‹ä¸­ä¼˜å…ˆç»˜åˆ¶ï¼‰ï¼Œä½†æ˜¯ z-index å±æ€§çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› æ­¤å®ƒç§»åŠ¨åˆ°äº†æ ¹æ¡†æ‰€ä¿æŒçš„å †æ ˆä¸­æ›´é å‰çš„ä½ç½®ã€‚å‚è€ƒèµ„æ–™æµè§ˆå™¨æ¶æ„Grosskurth, Alan. A Reference Architecture for Web Browsers (pdf)Gupta, Vineet. How Browsers Work - Part 1 - Architectureè§£æAho, Sethi, Ullman, Compilers: Principles, Techniques, and Toolsï¼ˆå³ â€œDragon bookâ€ï¼‰, Addison-Wesley, 1986Rick Jelliffe. The Bold and the Beautiful: two new drafts for HTML 5.FirefoxL. David Baron, Faster HTML and CSS: Layout Engine Internals for Web Developers.L. David Baron, Faster HTML and CSS: Layout Engine Internals for Web Developersï¼ˆGoogle æŠ€æœ¯è®¿è°ˆè§†é¢‘ï¼‰L. David Baron, Mozillaâ€™s Layout EngineL. David Baron, Mozilla Style System DocumentationChris Waterson, Notes on HTML ReflowChris Waterson, Gecko OverviewAlexander Larsson, The life of an HTML HTTP requestWebKitDavid Hyatt, Implementing CSSï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰David Hyatt, An Overview of WebCoreDavid Hyatt, WebCore RenderingDavid Hyatt, The FOUC ProblemW3C è§„èŒƒHTML 4.01 è§„èŒƒW3C HTML5 è§„èŒƒå±‚å æ ·å¼è¡¨ç¬¬ 2 çº§ç¬¬ 1 æ¬¡ä¿®æ”¹ (CSS 2.1) è§„èŒƒæµè§ˆå™¨æ„å»ºè¯´æ˜Firefox. https://developer.mozilla.org/en/Build_DocumentationWebKit. http://webkit.org/building/build.html]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åä¸ªæ¡ˆä¾‹å­¦ä¼š React Hooks]]></title>
    <url>%2Farchives%2Fcca6.html</url>
    <content type="text"><![CDATA[åŸæ–‡åœ°å€åä¸ªæ¡ˆä¾‹å­¦ä¼š React Hookså‰è¨€åœ¨ React çš„ä¸–ç•Œä¸­ï¼Œæœ‰å®¹å™¨ç»„ä»¶å’Œ UI ç»„ä»¶ä¹‹åˆ†ï¼Œåœ¨ React Hooks å‡ºç°ä¹‹å‰ï¼ŒUI ç»„ä»¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°ï¼Œæ— çŠ¶æ€ç»„ä»¶æ¥å±•ç¤º UIï¼Œè€Œå¯¹äºå®¹å™¨ç»„ä»¶ï¼Œå‡½æ•°ç»„ä»¶å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œæˆ‘ä»¬ä¾èµ–äºç±»ç»„ä»¶æ¥è·å–æ•°æ®ï¼Œå¤„ç†æ•°æ®ï¼Œå¹¶å‘ä¸‹ä¼ é€’å‚æ•°ç»™ UI ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä½¿ç”¨ React Hooks ç›¸æ¯”äºä»å‰çš„ç±»ç»„ä»¶æœ‰ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼šä»£ç å¯è¯»æ€§æ›´å¼ºï¼ŒåŸæœ¬åŒä¸€å—åŠŸèƒ½çš„ä»£ç é€»è¾‘è¢«æ‹†åˆ†åœ¨äº†ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ï¼Œå®¹æ˜“ä½¿å¼€å‘è€…ä¸åˆ©äºç»´æŠ¤å’Œè¿­ä»£ï¼Œé€šè¿‡ React Hooks å¯ä»¥å°†åŠŸèƒ½ä»£ç èšåˆï¼Œæ–¹ä¾¿é˜…è¯»ç»´æŠ¤ç»„ä»¶æ ‘å±‚çº§å˜æµ…ï¼Œåœ¨åŸæœ¬çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ HOC/render props ç­‰æ–¹å¼æ¥å¤ç”¨ç»„ä»¶çš„çŠ¶æ€ï¼Œå¢å¼ºåŠŸèƒ½ç­‰ï¼Œæ— ç–‘å¢åŠ äº†ç»„ä»¶æ ‘å±‚æ•°åŠæ¸²æŸ“ï¼Œè€Œåœ¨ React Hooks ä¸­ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡å¼ºå¤§çš„è‡ªå®šä¹‰çš„ Hooks æ¥å®ç°React åœ¨ v16.8 çš„ç‰ˆæœ¬ä¸­æ¨å‡ºäº† React Hooks æ–°ç‰¹æ€§ï¼Œè™½ç„¶ç¤¾åŒºè¿˜æ²¡æœ‰æœ€ä½³å®è·µå¦‚ä½•åŸºäº React Hooks æ¥æ‰“é€ å¤æ‚åº”ç”¨(è‡³å°‘æˆ‘è¿˜æ²¡æœ‰)ï¼Œå‡­å€Ÿç€é˜…è¯»ç¤¾åŒºä¸­å¤§é‡çš„å…³äºè¿™æ–¹é¢çš„æ–‡ç« ï¼Œä¸‹é¢æˆ‘å°†é€šè¿‡åä¸ªæ¡ˆä¾‹æ¥å¸®åŠ©ä½ è®¤è¯†ç†è§£å¹¶å¯ä»¥ç†Ÿç»ƒè¿ç”¨ React Hooks å¤§éƒ¨åˆ†ç‰¹æ€§ã€‚useState ä¿å­˜ç»„ä»¶çŠ¶æ€åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ this.state æ¥ä¿å­˜ç»„ä»¶çŠ¶æ€ï¼Œå¹¶å¯¹å…¶ä¿®æ”¹è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç®€å•çš„è®¡æ•°å™¨ç»„ä»¶ï¼Œå¾ˆå¥½è¯ é‡Šäº†ç±»ç»„ä»¶å¦‚ä½•è¿è¡Œï¼šåœ¨çº¿ Demo1234567891011121314151617181920import React from "react";class App extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; count: 0, name: "alife" &#125;; &#125; render() &#123; const &#123; count &#125; = this.state; return ( &lt;div&gt; Count: &#123;count&#125; &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: count + 1 &#125;)&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: count - 1 &#125;)&#125;&gt;-&lt;/button&gt; &lt;/div&gt; ); &#125;&#125;ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ç»„ä»¶å°±å®Œæˆäº†ï¼Œè€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œç”±äºæ²¡æœ‰ this è¿™ä¸ªé»‘é­”æ³•ï¼ŒReact é€šè¿‡ useState æ¥å¸®æˆ‘ä»¬ä¿å­˜ç»„ä»¶çš„çŠ¶æ€ã€‚åœ¨çº¿ Demo1234567891011121314import React, &#123; useState &#125; from "react";function App() &#123; const [obj, setObject] = useState(&#123; count: 0, name: "alife" &#125;); return ( &lt;div className="App"&gt; Count: &#123;obj.count&#125; &lt;button onClick=&#123;() =&gt; setObject(&#123; ...obj, count: obj.count + 1 &#125;)&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;() =&gt; setObject(&#123; ...obj, count: obj.count - 1 &#125;)&#125;&gt;-&lt;/button&gt; &lt;/div&gt; );&#125;é€šè¿‡ä¼ å…¥ useState å‚æ•°åè¿”å›ä¸€ä¸ªå¸¦æœ‰é»˜è®¤çŠ¶æ€å’Œæ”¹å˜çŠ¶æ€å‡½æ•°çš„æ•°ç»„ã€‚é€šè¿‡ä¼ å…¥æ–°çŠ¶æ€ç»™å‡½æ•°æ¥æ”¹å˜åŸæœ¬çš„çŠ¶æ€å€¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ useState ä¸å¸®åŠ©ä½ å¤„ç†çŠ¶æ€ï¼Œç›¸è¾ƒäº setState éè¦†ç›–å¼æ›´æ–°çŠ¶æ€ï¼ŒuseState è¦†ç›–å¼æ›´æ–°çŠ¶æ€ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±å¤„ç†é€»è¾‘ã€‚(ä»£ç å¦‚ä¸Š)ä¼¼ä¹æœ‰ä¸ª useState åï¼Œå‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€äº†ï¼Œä½†ä»…ä»…æ˜¯è¿™æ ·å®Œå…¨ä¸å¤Ÿã€‚useEffect å¤„ç†å‰¯ä½œç”¨å‡½æ•°ç»„ä»¶èƒ½ä¿å­˜çŠ¶æ€ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥è¯·æ±‚ï¼Œå‰¯ä½œç”¨çš„æ“ä½œè¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥ React æä¾›äº† useEffect æ¥å¸®åŠ©å¼€å‘è€…å¤„ç†å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œåœ¨ä»‹ç»æ–° API ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç±»ç»„ä»¶æ˜¯æ€ä¹ˆåšçš„ï¼šåœ¨çº¿ Demo1234567891011121314151617181920212223242526272829303132import React, &#123; Component &#125; from "react";class App extends Component &#123; state = &#123; count: 1 &#125;; componentDidMount() &#123; const &#123; count &#125; = this.state; document.title = "componentDidMount" + count; this.timer = setInterval(() =&gt; &#123; this.setState((&#123; count &#125;) =&gt; (&#123; count: count + 1 &#125;)); &#125;, 1000); &#125; componentDidUpdate() &#123; const &#123; count &#125; = this.state; document.title = "componentDidMount" + count; &#125; componentWillUnmount() &#123; document.title = "componentWillUnmount"; clearInterval(this.timer); &#125; render() &#123; const &#123; count &#125; = this.state; return ( &lt;div&gt; Count:&#123;count&#125; &lt;button onClick=&#123;() =&gt; clearInterval(this.timer)&#125;&gt;clear&lt;/button&gt; &lt;/div&gt; ); &#125;&#125;åœ¨ä¾‹å­ä¸­ï¼Œç»„ä»¶æ¯éš”ä¸€ç§’æ›´æ–°ç»„ä»¶çŠ¶æ€ï¼Œå¹¶ä¸”æ¯æ¬¡è§¦å‘æ›´æ–°éƒ½ä¼šè§¦å‘ document.title çš„æ›´æ–°(å‰¯ä½œç”¨)ï¼Œè€Œåœ¨ç»„ä»¶å¸è½½æ—¶ä¿®æ”¹ document.titleï¼ˆç±»ä¼¼äºæ¸…é™¤ï¼‰ä»ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›é‡å¤çš„åŠŸèƒ½å¼€å‘è€…éœ€è¦åœ¨ componentDidMount å’Œ componentDidUpdate é‡å¤ç¼–å†™ï¼Œè€Œå¦‚æœä½¿ç”¨ useEffect åˆ™å®Œå…¨ä¸ä¸€æ ·ã€‚åœ¨çº¿ Demo123456789101112131415161718192021222324import React, &#123; useState, useEffect &#125; from "react";let timer = null;function App() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; document.title = "componentDidMount" + count; &#125;,[count]); useEffect(() =&gt; &#123; timer = setInterval(() =&gt; &#123; setCount(prevCount =&gt; prevCount + 1); &#125;, 1000); return () =&gt; &#123; document.title = "componentWillUnmount"; clearInterval(timer); &#125;; &#125;, []); return ( &lt;div&gt; Count: &#123;count&#125; &lt;button onClick=&#123;() =&gt; clearInterval(timer)&#125;&gt;clear&lt;/button&gt; &lt;/div&gt; );&#125;æˆ‘ä»¬ä½¿ç”¨ useEffect é‡å†™äº†ä¸Šé¢çš„ä¾‹å­ï¼ŒuseEffect ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥åšä¸€äº›å‰¯ä½œç”¨æ¯”å¦‚å¼‚æ­¥è¯·æ±‚ï¼Œä¿®æ”¹å¤–éƒ¨å‚æ•°ç­‰è¡Œä¸ºï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªæ•°ç»„ï¼Œå¦‚æœæ•°ç»„ä¸­çš„å€¼æ‰ä¼šè§¦å‘ useEffect ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å‡½æ•°ã€‚è¿”å›å€¼(å¦‚æœæœ‰)åˆ™åœ¨ç»„ä»¶é”€æ¯æˆ–è€…è°ƒç”¨å‡½æ•°å‰è°ƒç”¨ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ª useEffect ä¸­ï¼Œç†è§£èµ·æ¥å°±æ˜¯ä¸€æ—¦ count å€¼å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¿®æ”¹ documen.title å€¼è€Œç¬¬äºŒä¸ª useEffect ä¸­æ•°ç»„æ²¡æœ‰ä¼ å€¼ï¼Œä»£è¡¨ä¸ç›‘å¬ä»»ä½•å‚æ•°å˜åŒ–ï¼Œå³åªæœ‰åœ¨ç»„ä»¶åˆå§‹åŒ–æˆ–é”€æ¯çš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼Œç”¨æ¥ä»£æ›¿ componentDidMount å’Œ componentWillUnmountåŸºäºè¿™ä¸ªå¼ºå¤§ Hooksï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå°è£…å‡ºå…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ¯”å¦‚ componentDidUpdate ä»£ç ååˆ†ç®€å•1234567891011function useUpdate(fn) &#123; // useRef åˆ›å»ºä¸€ä¸ªå¼•ç”¨ const mounting = useRef(true); useEffect(() =&gt; &#123; if (mounting.current) &#123; mounting.current = false; &#125; else &#123; fn(); &#125; &#125;);&#125;ç°åœ¨æˆ‘ä»¬æœ‰äº† useState ç®¡ç†çŠ¶æ€ï¼ŒuseEffect å¤„ç†å‰¯ä½œç”¨ï¼Œå¼‚æ­¥é€»è¾‘ï¼Œå­¦ä¼šè¿™ä¸¤æ‹›è¶³ä»¥åº”å¯¹å¤§éƒ¨åˆ†ç±»ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ã€‚useContext å‡å°‘ç»„ä»¶å±‚çº§ä¸Šé¢ä»‹ç»äº† useStateã€useEffect è¿™ä¸¤ä¸ªæœ€åŸºæœ¬çš„ APIï¼Œæ¥ä¸‹æ¥ä»‹ç»çš„ useContext æ˜¯ React å¸®ä½ å°è£…å¥½çš„ï¼Œç”¨æ¥å¤„ç†å¤šå±‚çº§ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œåœ¨ä»¥å‰ç»„ä»¶æ ‘ç§ï¼Œè·¨å±‚çº§ç¥–å…ˆç»„ä»¶æƒ³è¦ç»™å­™å­ç»„ä»¶ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œé™¤äº†ä¸€å±‚å±‚ props å¾€ä¸‹é€ä¼ ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ React Context API æ¥å¸®æˆ‘ä»¬åšè¿™ä»¶äº‹ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šåœ¨çº¿ Demo1234567891011121314const &#123; Provider, Consumer &#125; = React.createContext(null);function Bar() &#123; return &lt;Consumer&gt;&#123;color =&gt; &lt;div&gt;&#123;color&#125;&lt;/div&gt;&#125;&lt;/Consumer&gt;;&#125;function Foo() &#123; return &lt;Bar /&gt;;&#125;function App() &#123; return ( &lt;Provider value=&#123;"grey"&#125;&gt; &lt;Foo /&gt; &lt;/Provider&gt; );&#125;é€šè¿‡ React createContext çš„è¯­æ³•ï¼Œåœ¨ APP ç»„ä»¶ä¸­å¯ä»¥è·¨è¿‡ Foo ç»„ä»¶ç»™ Bar ä¼ é€’æ•°æ®ã€‚è€Œåœ¨ React Hooks ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ useContext è¿›è¡Œæ”¹é€ ã€‚åœ¨çº¿ Demo123456789101112131415const colorContext = React.createContext("gray");function Bar() &#123; const color = useContext(colorContext); return &lt;div&gt;&#123;color&#125;&lt;/div&gt;;&#125;function Foo() &#123; return &lt;Bar /&gt;;&#125;function App() &#123; return ( &lt;colorContext.Provider value=&#123;"red"&#125;&gt; &lt;Foo /&gt; &lt;/colorContext.Provider&gt; );&#125;ä¼ é€’ç»™ useContext çš„æ˜¯ context è€Œä¸æ˜¯ consumerï¼Œè¿”å›å€¼å³æ˜¯æƒ³è¦é€ä¼ çš„æ•°æ®äº†ã€‚ç”¨æ³•å¾ˆç®€å•ï¼Œä½¿ç”¨ useContext å¯ä»¥è§£å†³ Consumer å¤šçŠ¶æ€åµŒå¥—çš„é—®é¢˜ã€‚å‚è€ƒä¾‹å­123456789101112131415function HeaderBar() &#123; return ( &lt;CurrentUser.Consumer&gt; &#123;user =&gt; &lt;Notifications.Consumer&gt; &#123;notifications =&gt; &lt;header&gt; Welcome back, &#123;user.name&#125;! You have &#123;notifications.length&#125; notifications. &lt;/header&gt; &#125; &#125; &lt;/CurrentUser.Consumer&gt; );&#125;è€Œä½¿ç”¨ useContext åˆ™å˜å¾—ååˆ†ç®€æ´ï¼Œå¯è¯»æ€§æ›´å¼ºä¸”ä¸ä¼šå¢åŠ ç»„ä»¶æ ‘æ·±åº¦ã€‚12345678910function HeaderBar() &#123; const user = useContext(CurrentUser); const notifications = useContext(Notifications); return ( &lt;header&gt; Welcome back, &#123;user.name&#125;! You have &#123;notifications.length&#125; notifications. &lt;/header&gt; );&#125;useReduceruseReducer è¿™ä¸ª Hooks åœ¨ä½¿ç”¨ä¸Šå‡ ä¹è·Ÿ Redux/React-Redux ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€ç¼ºå°‘çš„å°±æ˜¯æ— æ³•ä½¿ç”¨ redux æä¾›çš„ä¸­é—´ä»¶ã€‚æˆ‘ä»¬å°†ä¸Šè¿°çš„è®¡æ—¶å™¨ç»„ä»¶æ”¹å†™ä¸º useReducerï¼Œåœ¨çº¿ Demo12345678910111213141516171819202122232425262728import React, &#123; useReducer &#125; from "react";const initialState = &#123; count: 0&#125;;function reducer(state, action) &#123; switch (action.type) &#123; case "increment": return &#123; count: state.count + action.payload &#125;; case "decrement": return &#123; count: state.count - action.payload &#125;; default: throw new Error(); &#125;&#125;function App() &#123; const [state, dispatch] = useReducer(reducer, initialState); return ( &lt;&gt; Count: &#123;state.count&#125; &lt;button onClick=&#123;() =&gt; dispatch(&#123; type: "increment", payload: 5 &#125;)&#125;&gt; + &lt;/button&gt; &lt;button onClick=&#123;() =&gt; dispatch(&#123; type: "decrement", payload: 5 &#125;)&#125;&gt; - &lt;/button&gt; &lt;/&gt; );&#125;ç”¨æ³•è·Ÿ Redux åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç®—æ˜¯æä¾›ä¸€ä¸ª mini çš„ Redux ç‰ˆæœ¬ã€‚useCallback è®°å¿†å‡½æ•°åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çŠ¯ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š1234567class App &#123; render() &#123; return &lt;div&gt; &lt;SomeComponent style=&#123;&#123; fontSize: 14 &#125;&#125; doSomething=&#123; () =&gt; &#123; console.log('do something'); &#125;&#125; /&gt; &lt;/div&gt;; &#125;&#125;è¿™æ ·å†™æœ‰ä»€ä¹ˆåå¤„å‘¢ï¼Ÿä¸€æ—¦ App ç»„ä»¶çš„ props æˆ–è€…çŠ¶æ€æ”¹å˜äº†å°±ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå³ä½¿è·Ÿ SomeComponent ç»„ä»¶ä¸ç›¸å…³ï¼Œç”±äºæ¯æ¬¡ render éƒ½ä¼šäº§ç”Ÿæ–°çš„ style å’Œ doSomethingï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ SomeComponent é‡æ–°æ¸²æŸ“ï¼Œå€˜è‹¥ SomeComponent æ˜¯ä¸€ä¸ªå¤§å‹çš„ç»„ä»¶æ ‘ï¼Œè¿™æ ·çš„ Virtual Dom çš„æ¯”è¾ƒæ˜¾ç„¶æ˜¯å¾ˆæµªè´¹çš„ï¼Œè§£å†³çš„åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†å‚æ•°æŠ½ç¦»æˆå˜é‡ã€‚1234567891011const fontSizeStyle = &#123; fontSize: 14 &#125;;class App &#123; doSomething = () =&gt; &#123; console.log('do something'); &#125; render() &#123; return &lt;div&gt; &lt;SomeComponent style=&#123;fontSizeStyle&#125; doSomething=&#123; this.doSomething &#125; /&gt; &lt;/div&gt;; &#125;&#125;åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ this è¿™ä¸ªå¯¹è±¡æ¥å­˜å‚¨å‡½æ•°ï¼Œè€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­æ²¡åŠæ³•è¿›è¡ŒæŒ‚è½½äº†ã€‚æ‰€ä»¥å‡½æ•°ç»„ä»¶åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™å¦‚æœæœ‰ä¼ é€’å‡½æ•°çš„è¯éƒ½ä¼šé‡æ¸²æŸ“å­ç»„ä»¶ã€‚123456function App() &#123; const handleClick = () =&gt; &#123; console.log('Click happened'); &#125; return &lt;SomeComponent onClick=&#123;handleClick&#125;&gt;Click Me&lt;/SomeComponent&gt;;&#125;è€Œæœ‰äº† useCallback å°±ä¸ä¸€æ ·äº†ï¼Œä½ å¯ä»¥é€šè¿‡ useCallback è·å¾—ä¸€ä¸ªè®°å¿†åçš„å‡½æ•°ã€‚123456function App() &#123; const memoizedHandleClick = useCallback(() =&gt; &#123; console.log('Click happened') &#125;, []); // ç©ºæ•°ç»„ä»£è¡¨æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹è¯¥å‡½æ•°éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ return &lt;SomeComponent onClick=&#123;memoizedHandleClick&#125;&gt;Click Me&lt;/SomeComponent&gt;;&#125;è€è§„çŸ©ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ä¸€æ—¦å€¼æˆ–è€…å¼•ç”¨å‘ç”Ÿæ”¹å˜ï¼ŒuseCallback å°±ä¼šé‡æ–°è¿”å›ä¸€ä¸ªæ–°çš„è®°å¿†å‡½æ•°æä¾›ç»™åé¢è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·åªè¦å­ç»„ä»¶ç»§æ‰¿äº† PureComponent æˆ–è€…ä½¿ç”¨ React.memo å°±å¯ä»¥æœ‰æ•ˆé¿å…ä¸å¿…è¦çš„ VDOM æ¸²æŸ“ã€‚useMemo è®°å¿†ç»„ä»¶useCallback çš„åŠŸèƒ½å®Œå…¨å¯ä»¥ç”± useMemo æ‰€å–ä»£ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä½¿ç”¨ useMemo è¿”å›ä¸€ä¸ªè®°å¿†å‡½æ•°ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚1useCallback(fn, inputs) is equivalent to useMemo(() =&gt; fn, inputs).æ‰€ä»¥å‰é¢ä½¿ç”¨ useCallback çš„ä¾‹å­å¯ä»¥ä½¿ç”¨ useMemo è¿›è¡Œæ”¹å†™ï¼š123456function App() &#123; const memoizedHandleClick = useMemo(() =&gt; () =&gt; &#123; console.log('Click happened') &#125;, []); // ç©ºæ•°ç»„ä»£è¡¨æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹è¯¥å‡½æ•°éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜ return &lt;SomeComponent onClick=&#123;memoizedHandleClick&#125;&gt;Click Me&lt;/SomeComponent&gt;;&#125;å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼šuseCallback ä¸ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œè€Œæ˜¯å°†å®ƒè¿”å›ç»™ä½ ï¼Œè€Œ useMemo ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å¹¶ä¸”å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›ç»™ä½ ã€‚æ‰€ä»¥åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥è¿”å› handleClick æ¥è¾¾åˆ°å­˜å‚¨å‡½æ•°çš„ç›®çš„ã€‚æ‰€ä»¥ useCallback å¸¸ç”¨è®°å¿†äº‹ä»¶å‡½æ•°ï¼Œç”Ÿæˆè®°å¿†åçš„äº‹ä»¶å‡½æ•°å¹¶ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ã€‚è€Œ useMemo æ›´é€‚åˆç»è¿‡å‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚è®°å¿†ç»„ä»¶ã€‚123456789101112function Parent(&#123; a, b &#125;) &#123; // Only re-rendered if `a` changes: const child1 = useMemo(() =&gt; &lt;Child1 a=&#123;a&#125; /&gt;, [a]); // Only re-rendered if `b` changes: const child2 = useMemo(() =&gt; &lt;Child2 b=&#123;b&#125; /&gt;, [b]); return ( &lt;&gt; &#123;child1&#125; &#123;child2&#125; &lt;/&gt; )&#125;å½“ a/b æ”¹å˜æ—¶ï¼Œchild1/child2 æ‰ä¼šé‡æ–°æ¸²æŸ“ã€‚ä»ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåªæœ‰åœ¨ç¬¬äºŒä¸ªå‚æ•°æ•°ç»„çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ã€‚useRef ä¿å­˜å¼•ç”¨å€¼useRef è·Ÿ createRef ç±»ä¼¼ï¼Œéƒ½å¯ä»¥ç”¨æ¥ç”Ÿæˆå¯¹ DOM å¯¹è±¡çš„å¼•ç”¨ï¼Œçœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼šåœ¨çº¿ Demo1234567891011121314151617181920import React, &#123; useState, useRef &#125; from "react";function App() &#123; let [name, setName] = useState("Nate"); let nameRef = useRef(); const submitButton = () =&gt; &#123; setName(nameRef.current.value); &#125;; return ( &lt;div className="App"&gt; &lt;p&gt;&#123;name&#125;&lt;/p&gt; &lt;div&gt; &lt;input ref=&#123;nameRef&#125; type="text" /&gt; &lt;button type="button" onClick=&#123;submitButton&#125;&gt; Submit &lt;/button&gt; &lt;/div&gt; &lt;/div&gt; );&#125;useRef è¿”å›çš„å€¼ä¼ é€’ç»™ç»„ä»¶æˆ–è€… DOM çš„ ref å±æ€§ï¼Œå°±å¯ä»¥é€šè¿‡ ref.current å€¼è®¿é—®ç»„ä»¶æˆ–çœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥å¯¹ DOM è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç›‘å¬äº‹ä»¶ç­‰ç­‰ã€‚å½“ç„¶ useRef è¿œæ¯”ä½ æƒ³è±¡ä¸­çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼ŒuseRef çš„åŠŸèƒ½æœ‰ç‚¹åƒç±»å±æ€§ï¼Œæˆ–è€…è¯´æ‚¨æƒ³è¦åœ¨ç»„ä»¶ä¸­è®°å½•ä¸€äº›å€¼ï¼Œå¹¶ä¸”è¿™äº›å€¼åœ¨ç¨åå¯ä»¥æ›´æ”¹ã€‚åˆ©ç”¨ useRef å°±å¯ä»¥ç»•è¿‡ Capture Value çš„ç‰¹æ€§ã€‚å¯ä»¥è®¤ä¸º ref åœ¨æ‰€æœ‰ Render è¿‡ç¨‹ä¸­ä¿æŒç€å”¯ä¸€å¼•ç”¨ï¼Œå› æ­¤æ‰€æœ‰å¯¹ ref çš„èµ‹å€¼æˆ–å–å€¼ï¼Œæ‹¿åˆ°çš„éƒ½åªæœ‰ä¸€ä¸ªæœ€ç»ˆçŠ¶æ€ï¼Œè€Œä¸ä¼šåœ¨æ¯ä¸ª Render é—´å­˜åœ¨éš”ç¦»ã€‚å‚è€ƒä¾‹å­ï¼šç²¾è¯»ã€ŠFunction VS Class ç»„ä»¶ã€‹React Hooks ä¸­å­˜åœ¨ Capture Value çš„ç‰¹æ€§ï¼šåœ¨çº¿ Demo12345678910111213141516171819202122function MessageThread() &#123; const [message, setMessage] = useState(""); const showMessage = () =&gt; &#123; alert("You said: " + message); &#125;; const handleSendClick = () =&gt; &#123; setTimeout(showMessage, 3000); &#125;; const handleMessageChange = e =&gt; &#123; setMessage(e.target.value); &#125;; return ( &lt;&gt; &lt;input value=&#123;message&#125; onChange=&#123;handleMessageChange&#125; /&gt; &lt;button onClick=&#123;handleSendClick&#125;&gt;Send&lt;/button&gt; &lt;/&gt; );&#125;åœ¨ç‚¹å‡» Send æŒ‰é’®åï¼Œå†æ¬¡ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼ï¼Œ3 ç§’åçš„è¾“å‡ºä¾ç„¶æ˜¯ç‚¹å‡»å‰è¾“å…¥æ¡†çš„å€¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ capture value çš„ç‰¹æ€§ã€‚è€Œåœ¨ç±»ç»„ä»¶ä¸­ 3 ç§’åè¾“å‡ºçš„å°±æ˜¯ä¿®æ”¹åçš„å€¼ï¼Œå› ä¸ºè¿™æ—¶å€™ message æ˜¯æŒ‚è½½åœ¨ this å˜é‡ä¸Šï¼Œå®ƒä¿ç•™çš„æ˜¯ä¸€ä¸ªå¼•ç”¨å€¼ï¼Œå¯¹ this å±æ€§çš„è®¿é—®éƒ½ä¼šè·å–åˆ°æœ€æ–°çš„å€¼ã€‚è®²åˆ°è¿™é‡Œä½ åº”è¯¥å°±æ˜ç™½äº†ï¼ŒuseRef åˆ›å»ºä¸€ä¸ªå¼•ç”¨ï¼Œå°±å¯ä»¥æœ‰æ•ˆè§„é¿ React Hooks ä¸­ Capture Value ç‰¹æ€§ã€‚123456789101112131415function MessageThread() &#123; const latestMessage = useRef(""); const showMessage = () =&gt; &#123; alert("You said: " + latestMessage.current); &#125;; const handleSendClick = () =&gt; &#123; setTimeout(showMessage, 3000); &#125;; const handleMessageChange = e =&gt; &#123; latestMessage.current = e.target.value; &#125;;&#125;åªè¦å°†èµ‹å€¼ä¸å–å€¼çš„å¯¹è±¡å˜æˆ useRefï¼Œè€Œä¸æ˜¯ useStateï¼Œå°±å¯ä»¥èº²è¿‡ capture value ç‰¹æ€§ï¼Œåœ¨ 3 ç§’åå¾—åˆ°æœ€æ–°çš„å€¼ã€‚useImperativeHandle é€ä¼  Refé€šè¿‡ useImperativeHandle ç”¨äºè®©çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶å†…çš„ç´¢å¼• åœ¨çº¿ Demo123456789101112131415161718import React, &#123; useRef, useEffect, useImperativeHandle, forwardRef &#125; from "react";function ChildInputComponent(props, ref) &#123; const inputRef = useRef(null); useImperativeHandle(ref, () =&gt; inputRef.current); return &lt;input type="text" name="child input" ref=&#123;inputRef&#125; /&gt;;&#125;const ChildInput = forwardRef(ChildInputComponent);function App() &#123; const inputRef = useRef(null); useEffect(() =&gt; &#123; inputRef.current.focus(); &#125;, []); return ( &lt;div&gt; &lt;ChildInput ref=&#123;inputRef&#125; /&gt; &lt;/div&gt; );&#125;é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒApp ç»„ä»¶å¯ä»¥è·å¾—å­ç»„ä»¶çš„ input çš„ DOM èŠ‚ç‚¹ã€‚useLayoutEffect åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½¿ç”¨ useEffect å°±å¯ä»¥å¸®æˆ‘ä»¬å¤„ç†ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åŒæ­¥è°ƒç”¨ä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¯¹ DOM çš„æ“ä½œï¼Œå°±éœ€è¦ä½¿ç”¨ useLayoutEffectï¼ŒuseLayoutEffect ä¸­çš„å‰¯ä½œç”¨ä¼šåœ¨ DOM æ›´æ–°ä¹‹ååŒæ­¥æ‰§è¡Œã€‚åœ¨çº¿ Demo1234567891011121314151617181920function App() &#123; const [width, setWidth] = useState(0); useLayoutEffect(() =&gt; &#123; const title = document.querySelector("#title"); const titleWidth = title.getBoundingClientRect().width; console.log("useLayoutEffect"); if (width !== titleWidth) &#123; setWidth(titleWidth); &#125; &#125;); useEffect(() =&gt; &#123; console.log("useEffect"); &#125;); return ( &lt;div&gt; &lt;h1 id="title"&gt;hello&lt;/h1&gt; &lt;h2&gt;&#123;width&#125;&lt;/h2&gt; &lt;/div&gt; );&#125;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒuseLayoutEffect ä¼šåœ¨ renderï¼ŒDOM æ›´æ–°ä¹‹ååŒæ­¥è§¦å‘å‡½æ•°ï¼Œä¼šä¼˜äº useEffect å¼‚æ­¥è§¦å‘å‡½æ•°ã€‚React Hooks ä¸è¶³å°½ç®¡æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä¾‹å­çœ‹åˆ° React Hooks çš„å¼ºå¤§ä¹‹å¤„ï¼Œä¼¼ä¹ç±»ç»„ä»¶å®Œå…¨éƒ½å¯ä»¥ä½¿ç”¨ React Hooks é‡å†™ã€‚ä½†æ˜¯å½“ä¸‹ v16.8 çš„ç‰ˆæœ¬ä¸­ï¼Œè¿˜æ— æ³•å®ç° getSnapshotBeforeUpdate å’Œ componentDidCatch è¿™ä¸¤ä¸ªåœ¨ç±»ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å®˜æ–¹ä¹Ÿè®¡åˆ’åœ¨ä¸ä¹…çš„å°†æ¥åœ¨ React Hooks è¿›è¡Œå®ç°ã€‚]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
        <category>React Hooks</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>React Hooks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JS Iframeä¸çˆ¶çº§é¡µé¢é€šä¿¡åŠIE9å…¼å®¹æ€§]]></title>
    <url>%2Farchives%2Fd4bd.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://www.cnblogs.com/haosit/p/11301350.htmlä¸€ã€ postMessagewindow.postMessage() æ–¹æ³•å®‰å…¨åœ°å¯ç”¨ Window å¯¹è±¡ä¹‹é—´çš„è·¨æºé€šä¿¡ï¼›ä¾‹å¦‚ï¼Œåœ¨é¡µé¢å’Œå®ƒäº§ç”Ÿçš„å¼¹å‡ºçª—å£ä¹‹é—´ï¼Œæˆ–è€…åœ¨é¡µé¢å’ŒåµŒå…¥å…¶ä¸­çš„ iframe ä¹‹é—´ã€‚äºŒã€è¯­æ³•otherWindow.postMessage(message, targetOrigin, [transfer]);otherWindowï¼šæ˜¯æ¥æ”¶å¯¹è±¡çš„çª—ä½“å¼•ç”¨ï¼Œä¾‹å¦‚ï¼šå­çª—ä½“ (iframe) å¯¹çˆ¶çº§çª—ä½“çš„å¼•ç”¨ â€œwindow.parentâ€ æˆ–è€…å…¶ä»– Iframe çš„å¼•ç”¨ â€œWindow.frames + ç´¢å¼•å€¼(å‘½åæˆ–æ•°å­—)â€messageï¼šå°†è¦å‘é€åˆ°å…¶ä»– window çš„æ•°æ®ã€‚åœ¨ IE9 ä»¥ä¸‹çš„æµè§ˆå™¨, message ä¸æ”¯æŒ JSON å¯¹è±¡ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹targetOriginï¼šé€šè¿‡çª—å£çš„ origin å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸² â€œ*â€ï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ª URIã€‚åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡çª—å£çš„åè®®ã€ä¸»æœºåœ°å€æˆ–ç«¯å£è¿™ä¸‰è€…çš„ä»»æ„ä¸€é¡¹ä¸åŒ¹é… targetOrigin æä¾›çš„å€¼ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸ä¼šè¢«å‘é€ï¼›åªæœ‰ä¸‰è€…å®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«å‘é€ã€‚transferï¼šæ˜¯ä¸€ä¸²å’Œ message åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡. è¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒã€‚ä¸‰ã€åº”ç”¨å­çª—ä½“å’Œçˆ¶çª—ä½“ä¹‹é—´çš„é€šä¿¡1. parent.htmlï¼šæ·»åŠ æœ‰ Iframe(childIframe.html) é¡µé¢ï¼Œå¹¶ç›‘å¬ message äº‹ä»¶12345678910111213141516171819202122&lt;html&gt;&lt;head&gt; &lt;meta charset=&quot;utf-8&quot; /&gt; &lt;meta /&gt; &lt;title&gt;&lt;/title&gt; &lt;style&gt; iframe&#123; border:none; width:100%; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;parent&lt;/h1&gt; &lt;iframe src=&quot;childiframe.html&quot;&gt;&lt;/iframe&gt; &lt;script&gt; window.addEventListener(&quot;message&quot;, function (message) &#123; alert(JSON.stringify(message.data)); &#125;); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;2. childIframe.htmlï¼šç›´æ¥å‘ parent å‘é€ä¸€æ¡æ¶ˆæ¯1234567891011121314&lt;html&gt;&lt;head&gt; &lt;meta charset=&quot;utf-8&quot; /&gt; &lt;meta /&gt; &lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;childIframe&lt;/h1&gt; &lt;script&gt; window.parent.postMessage(&#123;type:&quot;open&quot;,url:&quot;iframe.html&quot;&#125;,&quot;*&quot;); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;3. IE9 - å…¼å®¹é—®é¢˜ï¼šIE9 åŠä»¥ä¸‹çš„æµè§ˆå™¨, message ä¸æ”¯æŒ JSON å¯¹è±¡ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚å‘é€æ—¶å°† JSON è½¬æ¢ä¸ºå­—ç¬¦ä¸²1window.parent.postMessage(JSON.stringify(&#123; type: &quot;open&quot;, url: &quot;iframe.html&quot; &#125;), &quot;*&quot;);IE9 è¿˜æ˜¯ IE8 ä¸å…¼å®¹ addEventListener å’Œ â€œmessageâ€ ç›‘å¬æ–¹æ³•å’Œäº‹ä»¶ï¼Œå…¼å®¹åŠæ³•12345678910//IE8,IE9å…¼å®¹æ–¹æ³•if (window.attachEvent) &#123; window.attachEvent(&apos;onmessage&apos;, function (message) &#123; console.log(JSON.parse(message.data)); &#125;);&#125; else &#123; window.addEventListener(&apos;message&apos;, function (message) &#123; console.log(JSON.parse(message.data)); &#125;);&#125;]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>Iframe</category>
      </categories>
      <tags>
        <tag>JS</tag>
        <tag>Iframe</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[A Complete Guide to useEffect]]></title>
    <url>%2Farchives%2F6387.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://overreacted.io/a-complete-guide-to-useeffect/You wrote a few components with Hooks. Maybe even a small app. Youâ€™re mostly satisfied. Youâ€™re comfortable with the API and picked up a few tricks along the way. You even made some custom Hooks to extract repetitive logic (300 lines gone!) and showed it off to your colleagues. â€œGreat jobâ€, they said.But sometimes when you useEffect, the pieces donâ€™t quite fit together. You have a nagging feeling that youâ€™re missing something. It seems similar to class lifecyclesâ€¦ but is it really? You find yourself asking questions like:ğŸ¤” How do I replicate componentDidMount with useEffect?ğŸ¤” How do I correctly fetch data inside useEffect? What is []?ğŸ¤” Do I need to specify functions as effect dependencies or not?ğŸ¤” Why do I sometimes get an infinite refetching loop?ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?When I just started using Hooks, I was confused by all of those questions too. Even when writing the initial docs, I didnâ€™t have a firm grasp on some of the subtleties. Iâ€™ve since had a few â€œahaâ€ moments that I want to share with you. This deep dive will make the answers to these questions look obvious to you.To see the answers, we need to take a step back. The goal of this article isnâ€™t to give you a list of bullet point recipes. Itâ€™s to help you truly â€œgrokâ€ useEffect. There wonâ€™t be much to learn. In fact, weâ€™ll spend most of our time _un_learning.Itâ€™s only after I stopped looking at the useEffect Hook through the prism of the familiar class lifecycle methods that everything came together for me.â€œUnlearn what you have learned.â€ â€” YodaThis article assumes that youâ€™re somewhat familiar with useEffect API.Itâ€™s also really long. Itâ€™s like a mini-book. Thatâ€™s just my preferred format. But I wrote a TLDR just below if youâ€™re in a rush or donâ€™t really care.If youâ€™re not comfortable with deep dives, you might want to wait until these explanations appear elsewhere. Just like when React came out in 2013, it will take some time for people to recognize a different mental model and teach it.TLDRHereâ€™s a quick TLDR if you donâ€™t want to read the whole thing. If some parts donâ€™t make sense, you can scroll down until you find something related.Feel free to skip it if you plan to read the whole post. Iâ€™ll link to it at the end.ğŸ¤” Question: How do I replicate componentDidMount with useEffect?While you can useEffect(fn, []), itâ€™s not an exact equivalent. Unlike componentDidMount, it will capture props and state. So even inside the callbacks, youâ€™ll see the initial props and state. If you want to see â€œlatestâ€ something, you can write it to a ref. But thereâ€™s usually a simpler way to structure the code so that you donâ€™t have to. Keep in mind that the mental model for effects is different from componentDidMount and other lifecycles, and trying to find their exact equivalents may confuse you more than help. To get productive, you need to â€œthink in effectsâ€, and their mental model is closer to implementing synchronization than to responding to lifecycle events.ğŸ¤” Question: How do I correctly fetch data inside useEffect? What is []?This article is a good primer on data fetching with useEffect. Make sure to read it to the end! Itâ€™s not as long as this one. [] means the effect doesnâ€™t use any value that participates in React data flow, and is for that reason safe to apply once. It is also a common source of bugs when the value actually _is_ used. Youâ€™ll need to learn a few strategies (primarily useReducer and useCallback) that can remove the need for a dependency instead of incorrectly omitting it.ğŸ¤” Question: Do I need to specify functions as effect dependencies or not?The recommendation is to hoist functions that donâ€™t need props or state outside of your component, and pull the ones that are used only by an effect inside of that effect. If after that your effect still ends up using functions in the render scope (including function from props), wrap them into useCallback where theyâ€™re defined, and repeat the process. Why does it matter? Functions can â€œseeâ€ values from props and state â€” so they participate in the data flow. Thereâ€™s a more detailed answer in our FAQ.ğŸ¤” Question: Why do I sometimes get an infinite refetching loop?This can happen if youâ€™re doing data fetching in an effect without the second dependencies argument. Without it, effects run after every render â€” and setting the state will trigger the effects again. An infinite loop may also happen if you specify a value that always changes in the dependency array. You can tell which one by removing them one by one. However, removing a dependency you use (or blindly specifying []) is usually the wrong fix. Instead, fix the problem at its source. For example, functions can cause this problem, and putting them inside effects, hoisting them out, or wrapping them with useCallback helps. To avoid recreating objects, useMemo can serve a similar purpose.ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?Effects always â€œseeâ€ props and state from the render they were defined in. That helps prevent bugs but in some cases can be annoying. For those cases, you can explicitly maintain some value in a mutable ref (the linked article explains it at the end). If you think youâ€™re seeing some props or state from an old render but donâ€™t expect it, you probably missed some dependencies. Try using the lint rule to train yourself to see them. A few days, and itâ€™ll be like a second nature to you. See also this answer in our FAQ.I hope this TLDR was helpful! Otherwise, letâ€™s go.Each Render Has Its Own Props and StateBefore we can talk about effects, we need to talk about rendering.Hereâ€™s a counter. Look at the highlighted line closely:1234567891011function Counter() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;What does it mean? Does count somehow â€œwatchâ€ changes to our state and update automatically? That might be a useful first intuition when you learn React but itâ€™s not an accurate mental model.In this example, count is just a number. Itâ€™s not a magic â€œdata bindingâ€, a â€œwatcherâ€, a â€œproxyâ€, or anything else. Itâ€™s a good old number like this one:123const count = 42;&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;The first time our component renders, the count variable we get from useState() is 0. When we call setCount(1), React calls our component again. This time, count will be 1. And so on:12345678910111213141516171819function Counter() &#123; const count = 0; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;function Counter() &#123; const count = 1; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;function Counter() &#123; const count = 2; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;Whenever we update the state, React calls our component. Each render result â€œseesâ€ its own counter state value which is a constant inside our function.So this line doesnâ€™t do any special data binding:1&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;It only embeds a number value into the render output. That number is provided by React. When we setCount, React calls our component again with a different count value. Then React updates the DOM to match our latest render output.The key takeaway is that the count constant inside any particular render doesnâ€™t change over time. Itâ€™s our component thatâ€™s called again â€” and each render â€œseesâ€ its own count value thatâ€™s isolated between renders.(For an in-depth overview of this process, check out my post React as a UI Runtime.)Each Render Has Its Own Event HandlersSo far so good. What about event handlers?Look at this example. It shows an alert with the count after three seconds:12345678910111213function Counter() &#123; const [count, setCount] = useState(0); function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;button onClick=&#123;handleAlertClick&#125;&gt; Show alert &lt;/button&gt; &lt;/div&gt; );&#125;Letâ€™s say I do this sequence of steps:Increment the counter to 3Press â€œShow alertâ€Increment it to 5 before the timeout firesWhat do you expect the alert to show? Will it show 5 â€” which is the counter state at the time of the alert? Or will it show 3 â€” the state when I clicked?spoilers aheadGo ahead and try it yourself!If the behavior doesnâ€™t quite make sense to you, imagine a more practical example: a chat app with the current recipient ID in the state, and a Send button. This article explores the reasons in depth but the correct answer is 3.The alert will â€œcaptureâ€ the state at the time I clicked the button.(There are ways to implement the other behavior too but Iâ€™ll be focusing on the default case for now. When building a mental model, itâ€™s important that we distinguish the â€œpath of least resistanceâ€ from the opt-in escape hatches.)But how does it work?Weâ€™ve discussed that the count value is constant for every particular call to our function. Itâ€™s worth emphasizing this â€” our function gets called many times (once per each render), but every one of those times the count value inside of it is constant and set to a particular value (state for that render).This is not specific to React â€” regular functions work in a similar way:1234567891011121314function sayHi(person) &#123; const name = person.name; setTimeout(() =&gt; &#123; alert(&apos;Hello, &apos; + name); &#125;, 3000);&#125;let someone = &#123;name: &apos;Dan&apos;&#125;;sayHi(someone);someone = &#123;name: &apos;Yuzhi&apos;&#125;;sayHi(someone);someone = &#123;name: &apos;Dominic&apos;&#125;;sayHi(someone);In this example, the outer someone variable is reassigned several times. (Just like somewhere in React, the current component state can change.) However, inside sayHi, there is a local name constant that is associated with a person from a particular call. That constant is local, so itâ€™s isolated between the calls! As a result, when the timeouts fire, each alert â€œremembersâ€ its own name.This explains how our event handler captures the count at the time of the click. If we apply the same substitution principle, each render â€œseesâ€ its own count:12345678910111213141516171819202122232425262728293031function Counter() &#123; const count = 0; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;function Counter() &#123; const count = 1; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;function Counter() &#123; const count = 2; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;So effectively, each render returns its own â€œversionâ€ of handleAlertClick. Each of those versions â€œremembersâ€ its own count:12345678910111213141516171819202122232425262728293031function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 0); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 1); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 2); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;This is why in this demo event handlers â€œbelongâ€ to a particular render, and when you click, it keeps using the counter state from that render.Inside any particular render, props and state forever stay the same. But if props and state are isolated between renders, so are any values using them (including the event handlers). They also â€œbelongâ€ to a particular render. So even async functions inside an event handler will â€œseeâ€ the same count value.Side note: I inlined concrete count values right into handleAlertClick functions above. This mental substitution is safe because count canâ€™t possibly change within a particular render. Itâ€™s declared as a const and is a number. It would be safe to think the same way about other values like objects too, but only if we agree to avoid mutating state. Calling setSomething(newObj) with a newly created object instead of mutating it is fine because state belonging to previous renders is intact.Each Render Has Its Own EffectsThis was supposed to be a post about effects but we still havenâ€™t talked about effects yet! Weâ€™ll rectify this now. Turns out, effects arenâ€™t really any different.Letâ€™s go back to an example from the docs:12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; document.title = `You clicked $&#123;count&#125; times`; &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;Hereâ€™s a question for you: how does the effect read the latest count state?Maybe, thereâ€™s some kind of â€œdata bindingâ€ or â€œwatchingâ€ that makes count update live inside the effect function? Maybe count is a mutable variable that React sets inside our component so that our effect always sees the latest value?Nope.We already know that count is constant within a particular component render. Event handlers â€œseeâ€ the count state from the render that they â€œbelongâ€ to because count is a variable in their scope. The same is true for effects!Itâ€™s not the count variable that somehow changes inside an â€œunchangingâ€ effect. Itâ€™s the effect function itself thatâ€™s different on every render.Each version â€œseesâ€ the count value from the render that it â€œbelongsâ€ to:12345678910111213141516171819202122function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;0&#125; times`; &#125; ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;1&#125; times`; &#125; ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;2&#125; times`; &#125; ); &#125;React remembers the effect function you provided, and runs it after flushing changes to the DOM and letting the browser paint the screen.So even if we speak of a single conceptual effect here (updating the document title), it is represented by a different function on every render â€” and each effect function â€œseesâ€ props and state from the particular render it â€œbelongsâ€ to.Conceptually, you can imagine effects are a part of the render result.Strictly saying, theyâ€™re not (in order to allow Hook composition without clumsy syntax or runtime overhead). But in the mental model weâ€™re building up, effect functions belong to a particular render in the same way that event handlers do.To make sure we have a solid understanding, letâ€™s recap our first render:React: Give me the UI when the state is 0.Your component:Hereâ€™s the render result: &lt;p&gt;You clicked 0 times&lt;/p&gt;.Also remember to run this effect after youâ€™re done: () =&gt; { document.title = &#39;You clicked 0 times&#39; }.React: Sure. Updating the UI. Hey browser, Iâ€™m adding some stuff to the DOM.Browser: Cool, I painted it to the screen.React: OK, now Iâ€™m going to run the effect you gave me.Running () =&gt; { document.title = &#39;You clicked 0 times&#39; }.Now letâ€™s recap what happens after we click:Your component: Hey React, set my state to 1.React: Give me the UI for when the state is 1.Your component:Hereâ€™s the render result: &lt;p&gt;You clicked 1 times&lt;/p&gt;.Also remember to run this effect after youâ€™re done: () =&gt; { document.title = &#39;You clicked 1 times&#39; }.React: Sure. Updating the UI. Hey browser, Iâ€™ve changed the DOM.Browser: Cool, I painted your changes to the screen.React: OK, now Iâ€™ll run the effect that belongs to the render I just did.Running () =&gt; { document.title = &#39;You clicked 1 times&#39; }.Each Render Has Its Ownâ€¦ EverythingWe know now that effects run after every render, are conceptually a part of the component output, and â€œseeâ€ the props and state from that particular render.Letâ€™s try a thought experiment. Consider this code:12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;count&#125; times`); &#125;, 3000); &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;If I click several times with a small delay, what is the log going to look like?spoilers aheadYou might think this is a gotcha and the end result is unintuitive. Itâ€™s not! Weâ€™re going to see a sequence of logs â€” each one belonging to a particular render and thus with its own count value. You can try it yourself:You may think: â€œOf course thatâ€™s how it works! How else could it work?â€Well, thatâ€™s not how this.state works in classes. Itâ€™s easy to make the mistake of thinking that this class implementation is equivalent:12345componentDidUpdate() &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;this.state.count&#125; times`); &#125;, 3000);&#125;However, this.state.count always points at the latest count rather than the one belonging to a particular render. So youâ€™ll see 5 logged each time instead:I think itâ€™s ironic that Hooks rely so much on JavaScript closures, and yet itâ€™s the class implementation that suffers from the canonical wrong-value-in-a-timeout confusion thatâ€™s often associated with closures. This is because the actual source of the confusion in this example is the mutation (React mutates this.state in classes to point to the latest state) and not closures themselves.Closures are great when the values you close over never change. That makes them easy to think about because youâ€™re essentially referring to constants. And as we discussed, props and state never change within a particular render. By the way, we can fix the class versionâ€¦ by using a closure.Swimming Against the TideAt this point itâ€™s important that we call it out explicitly: every function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.So these two examples are equivalent:1234567function Example(props) &#123; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(props.counter); &#125;, 1000); &#125;); &#125;1234567function Example(props) &#123; const counter = props.counter; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(counter); &#125;, 1000); &#125;); &#125;It doesnâ€™t matter whether you read from props or state â€œearlyâ€ inside of your component. Theyâ€™re not going to change! Inside the scope of a single render, props and state stay the same. (Destructuring props makes this more obvious.)Of course, sometimes you want to read the latest rather than captured value inside some callback defined in an effect. The easiest way to do it is by using refs, as described in the last section of this article.Be aware that when you want to read the future props or state from a function in a past render, youâ€™re swimming against the tide. Itâ€™s not wrong (and in some cases necessary) but it might look less â€œcleanâ€ to break out of the paradigm. This is an intentional consequence because it helps highlight which code is fragile and depends on timing. In classes, itâ€™s less obvious when this happens.Hereâ€™s a version of our counter example that replicates the class behavior:1234567function Example() &#123; const [count, setCount] = useState(0); const latestCount = useRef(count); useEffect(() =&gt; &#123; latestCount.current = count; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;latestCount.current&#125; times`); &#125;, 3000); &#125;);It might seem quirky to mutate something in React. However, this is exactly how React itself reassigns this.state in classes. Unlike with captured props and state, you donâ€™t have any guarantees that reading latestCount.current would give you the same value in any particular callback. By definition, you can mutate it any time. This is why itâ€™s not a default, and you have to opt into that.So What About Cleanup?As the docs explain, some effects might have a cleanup phase. Essentially, its purpose is to â€œundoâ€ an effect for cases like subscriptions.Consider this code:123456useEffect(() =&gt; &#123; ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange); &#125;;&#125;);Say props is {id: 10} on the first render, and {id: 20} on the second render. You might think that something like this happens:React cleans up the effect for {id: 10}.React renders UI for {id: 20}.React runs the effect for {id: 20}.(This is not quite the case.)With this mental model, you might think the cleanup â€œseesâ€ the old props because it runs before we re-render, and then the new effect â€œseesâ€ the new props because it runs after the re-render. Thatâ€™s the mental model lifted directly from the class lifecycles, and itâ€™s not accurate here. Letâ€™s see why.React only runs the effects after letting the browser paint. This makes your app faster as most effects donâ€™t need to block screen updates. Effect cleanup is also delayed. The previous effect is cleaned up after the re-render with new props:React renders UI for {id: 20}.The browser paints. We see the UI for {id: 20} on the screen.React cleans up the effect for {id: 10}.React runs the effect for {id: 20}.You might be wondering: but how can the cleanup of the previous effect still â€œseeâ€ the old {id: 10} props if it runs after the props change to {id: 20}?Weâ€™ve been here beforeâ€¦ ğŸ¤”Quoting the previous section:Every function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.Now the answer is clear! The effect cleanup doesnâ€™t read the â€œlatestâ€ props, whatever that means. It reads props that belong to the render itâ€™s defined in:1234567891011121314151617181920212223242526function Example() &#123; useEffect( () =&gt; &#123; ChatAPI.subscribeToFriendStatus(10, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange); &#125;; &#125; ); &#125;function Example() &#123; useEffect( () =&gt; &#123; ChatAPI.subscribeToFriendStatus(20, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange); &#125;; &#125; ); &#125;Kingdoms will rise and turn into ashes, the Sun will shed its outer layers to be a white dwarf, and the last civilization will end. But nothing will make the props â€œseenâ€ by the first render effectâ€™s cleanup anything other than {id: 10}.Thatâ€™s what allows React to deal with effects right after painting â€” and make your apps faster by default. The old props are still there if our code needs them.Synchronization, Not LifecycleOne of my favorite things about React is that it unifies describing the initial render result and the updates. This reduces the entropy of your program.Say my component looks like this:1234567function Greeting(&#123; name &#125;) &#123; return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125;It doesnâ€™t matter if I render &lt;Greeting /&gt; and later &lt;Greeting /&gt;, or if I just render &lt;Greeting /&gt;. In the end, we will see â€œHello, Yuzhiâ€ in both cases.People say: â€œItâ€™s all about the journey, not the destinationâ€. With React, itâ€™s the opposite. Itâ€™s all about the destination, not the journey. Thatâ€™s the difference between $.addClass and $.removeClass calls in jQuery code (our â€œjourneyâ€) and specifying what the CSS class should be in React code (our â€œdestinationâ€).React synchronizes the DOM according to our current props and state. There is no distinction between a â€œmountâ€ or an â€œupdateâ€ when rendering.You should think of effects in a similar way. useEffect lets you synchronize things outside of the React tree according to our props and state.1234567function Greeting(&#123; name &#125;) &#123; useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name; &#125;); return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125;This is subtly different from the familiar mount/update/unmount mental model. It is important really to internalize this. If youâ€™re trying to write an effect that behaves differently depending on whether the component renders for the first time or not, youâ€™re swimming against the tide! Weâ€™re failing at synchronizing if our result depends on the â€œjourneyâ€ rather than the â€œdestinationâ€.It shouldnâ€™t matter whether we rendered with props A, B, and C, or if we rendered with C immediately. While there may be some temporary differences (e.g. while weâ€™re fetching data), eventually the end result should be the same.Still, of course running all effects on every render might not be efficient. (And in some cases, it would lead to infinite loops.)So how can we fix this?Teaching React to Diff Your EffectsWeâ€™ve already learned that lesson with the DOM itself. Instead of touching it on every re-render, React only updates the parts of the DOM that actually change.When youâ€™re updating123&lt;h1 class&gt; Hello, Dan&lt;/h1&gt;to123&lt;h1 class&gt; Hello, Yuzhi&lt;/h1&gt;React sees two objects:12const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;It goes over each of their props and determine that children have changed and need a DOM update, but className did not. So it can just do:1domNode.innerText = &apos;Hello, Yuzhi&apos;;Could we do something like this with effects too? It would be nice to avoid re-running them when applying the effect is unnecessary.For example, maybe our component re-renders because of a state change:12345678910111213function Greeting(&#123; name &#125;) &#123; const [counter, setCounter] = useState(0); useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name; &#125;); return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;button onClick=&#123;() =&gt; setCounter(count + 1)&#125;&gt; Increment &lt;/button&gt; &lt;/h1&gt; );&#125;But our effect doesnâ€™t use the counter state. Our effect synchronizes the document.title with the name prop, but the name prop is the same. Re-assigning document.title on every counter change seems non-ideal.OK, so can React justâ€¦ diff effects?12let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;Not really. React canâ€™t guess what the function does without calling it. (The source doesnâ€™t really contain specific values, it just closes over the name prop.)This is why if you want to avoid re-running effects unnecessarily, you can provide a dependency array (also known as â€œdepsâ€) argument to useEffect:123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, [name]);Itâ€™s like if we told React: â€œHey, I know you canâ€™t see inside this function, but I promise it only uses name and nothing else from the render scope.â€If each of these values is the same between the current and the previous time this effect ran, thereâ€™s nothing to synchronize so React can skip the effect:12345const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;const oldDeps = [&apos;Dan&apos;];const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;const newDeps = [&apos;Dan&apos;];If even one of the values in the dependency array is different between renders, we know running the effect canâ€™t be skipped. Synchronize all the things!Donâ€™t Lie to React About DependenciesLying to React about dependencies has bad consequences. Intuitively, this makes sense, but Iâ€™ve seen pretty much everyone who tries useEffect with a mental model from classes try to cheat the rules. (And I did that too at first!)1234567891011function SearchResults() &#123; async function fetchData() &#123; &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;(The Hooks FAQ explains what to do instead. Weâ€™ll come back to this example below.)â€œBut I only want to run it on mount!â€, youâ€™ll say. For now, remember: if you specify deps, all values from inside your component that are used by the effect must be there. Including props, state, functions â€” anything in your component.Sometimes when you do that, it causes a problem. For example, maybe you see an infinite refetching loop, or a socket is recreated too often. The solution to that problem is not to remove a dependency. Weâ€™ll look at the solutions soon.But before we jump to solutions, letâ€™s understand the problem better.What Happens When Dependencies LieIf deps contain every value used by the effect, React knows when to re-run it:123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, [name]);(Dependencies are different, so we re-run the effect.)But if we specified [] for this effect, the new effect function wouldnâ€™t run:123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, []);(Dependencies are equal, so we skip the effect.)In this case the problem might seem obvious. But the intuition can fool you in other cases where a class solution â€œjumps outâ€ from your memory.For example, letâ€™s say weâ€™re writing a counter that increments every second. With a class, our intuition is: â€œSet up the interval once and destroy it onceâ€. Hereâ€™s an example of how we can do it. When we mentally translate this code to useEffect, we instinctively add [] to the deps. â€œI want it to run onceâ€, right?1234567891011function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, []); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125;However, this example only increments once. Oops.If your mental model is â€œdependencies let me specify when I want to re-trigger the effectâ€, this example might give you an existential crisis. You want to trigger it once because itâ€™s an interval â€” so why is it causing issues?However, this makes sense if you know that dependencies are our hint to React about everything that the effect uses from the render scope. It uses count but we lied that it doesnâ€™t with []. Itâ€™s only a matter of time before this bites us!In the first render, count is 0. Therefore, setCount(count + 1) in the first renderâ€™s effect means setCount(0 + 1). Since we never re-run the effect because of [] deps, it will keep calling setCount(0 + 1) every second:123456789101112131415161718192021222324252627function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] ); &#125;We lied to React by saying our effect doesnâ€™t depend on a value from inside our component, when in fact it does!Our effect uses count â€” a value inside the component (but outside the effect):123456const count = useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []);Therefore, specifying [] as a dependency will create a bug. React will compare the dependencies, and skip updating this effect:(Dependencies are equal, so we skip the effect.)Issues like this are difficult to think about. Therefore, I encourage you to adopt it as a hard rule to always be honest about the effect dependencies, and specify them all. (We provide a lint rule if you want to enforce this on your team.)Two Ways to Be Honest About DependenciesThere are two strategies to be honest about dependencies. You should generally start with the first one, and then apply the second one if needed.The first strategy is to fix the dependency array to include all the values inside the component that are used inside the effect. Letâ€™s include count as a dep:12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]);This makes the dependency array correct. It may not be ideal but thatâ€™s the first issue we needed to fix. Now a change to count will re-run the effect, with each next interval referencing count from its render in setCount(count + 1):1234567891011121314151617181920212223242526function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [0] ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [1] ); &#125;That would fix the problem but our interval would be cleared and set again whenever the count changes. That may be undesirable:(Dependencies are different, so we re-run the effect.)The second strategy is to change our effect code so that it wouldnâ€™t need a value that changes more often than we want. We donâ€™t want to lie about the dependencies â€” we just want to change our effect to have fewer of them.Letâ€™s look at a few common techniques for removing dependencies.Making Effects Self-SufficientWe want to get rid of the count dependency in our effect.12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]);To do this, we need to ask ourselves: what are we using count for? It seems like we only use it for the setCount call. In that case, we donâ€™t actually need count in the scope at all. When we want to update state based on the previous state, we can use the functional updater form of setState:12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []);I like to think of these cases as â€œfalse dependenciesâ€. Yes, count was a necessary dependency because we wrote setCount(count + 1) inside the effect. However, we only truly needed count to transform it into count + 1 and â€œsend it backâ€ to React. But React already knows the current count. All we needed to tell React is to increment the state â€” whatever it is right now.Thatâ€™s exactly what setCount(c =&gt; c + 1) does. You can think of it as â€œsending an instructionâ€ to React about how the state should change. This â€œupdater formâ€ also helps in other cases, like when you batch multiple updates.Note that we actually did the work to remove the dependency. We didnâ€™t cheat. Our effect doesnâ€™t read the counter value from the render scope anymore:(Dependencies are equal, so we skip the effect.)You can try it here.Even though this effect only runs once, the interval callback that belongs to the first render is perfectly capable of sending the c =&gt; c + 1 update instruction every time the interval fires. It doesnâ€™t need to know the current counter state anymore. React already knows it.Functional Updates and Google DocsRemember how we talked about synchronization being the mental model for effects? An interesting aspect of synchronization is that you often want to keep the â€œmessagesâ€ between the systems untangled from their state. For example, editing a document in Google Docs doesnâ€™t actually send the whole page to the server. That would be very inefficient. Instead, it sends a representation of what the user tried to do.While our use case is different, a similar philosophy applies to effects. It helps to send only the minimal necessary information from inside the effects into a component. The updater form like setCount(c =&gt; c + 1) conveys strictly less information than setCount(count + 1) because it isnâ€™t â€œtaintedâ€ by the current count. It only expresses the action (â€œincrementingâ€). Thinking in React involves finding the minimal state. This is the same principle, but for updates.Encoding the intent (rather than the result) is similar to how Google Docs solves collaborative editing. While this is stretching the analogy, functional updates serve a similar role in React. They ensure updates from multiple sources (event handlers, effect subscriptions, etc) can be correctly applied in a batch and in a predictable way.However, even setCount(c =&gt; c + 1) isnâ€™t that great. It looks a bit weird and itâ€™s very limited in what it can do. For example, if we had two state variables whose values depend on each other, or if we needed to calculate the next state based on a prop, it wouldnâ€™t help us. Luckily, setCount(c =&gt; c + 1) has a more powerful sister pattern. Its name is useReducer.Decoupling Updates from ActionsLetâ€™s modify the previous example to have two state variables: count and step. Our interval will increment the count by the value of the step input:12345678910111213141516function Counter() &#123; const [count, setCount] = useState(0); const [step, setStep] = useState(1); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + step); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [step]); return ( &lt;&gt; &lt;h1&gt;&#123;count&#125;&lt;/h1&gt; &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt; &lt;/&gt; );&#125;(Hereâ€™s a demo.)Note that weâ€™re not cheating. Since I started using step inside the effect, I added it to the dependencies. And thatâ€™s why the code runs correctly.The current behavior in this example is that changing the step restarts the interval â€” because itâ€™s one of the dependencies. And in many cases, that is exactly what you want! Thereâ€™s nothing wrong with tearing down an effect and setting it up anew, and we shouldnâ€™t avoid that unless we have a good reason.However, letâ€™s say we want the interval clock to not reset on changes to the step. How do we remove the step dependency from our effect?When setting a state variable depends on the current value of another state variable, you might want to try replacing them both with useReducer.When you find yourself writing setSomething(something =&gt; ...), itâ€™s a good time to consider using a reducer instead. A reducer lets you decouple expressing the â€œactionsâ€ that happened in your component from how the state updates in response to them.Letâ€™s trade the step dependency for a dispatch dependency in our effect:1234567const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: &apos;tick&apos; &#125;); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [dispatch]);(See the demo.)You might ask me: â€œHow is this any better?â€ The answer is that React guarantees the dispatch function to be constant throughout the component lifetime. So the example above doesnâ€™t ever need to resubscribe the interval.We solved our problem!(You may omit dispatch, setState, and useRef container values from the deps because React guarantees them to be static. But it also doesnâ€™t hurt to specify them.)Instead of reading the state inside an effect, it dispatches an action that encodes the information about what happened. This allows our effect to stay decoupled from the step state. Our effect doesnâ€™t care how we update the state, it just tells us about what happened. And the reducer centralizes the update logic:12345678910111213const initialState = &#123; count: 0, step: 1,&#125;;function reducer(state, action) &#123; const &#123; count, step &#125; = state; if (action.type === &apos;tick&apos;) &#123; return &#123; count: count + step, step &#125;; &#125; else if (action.type === &apos;step&apos;) &#123; return &#123; count, step: action.step &#125;; &#125; else &#123; throw new Error(); &#125;&#125;(Hereâ€™s a demo if you missed it earlier).Why useReducer Is the Cheat Mode of HooksWeâ€™ve seen how to remove dependencies when an effect needs to set state based on previous state, or on another state variable. But what if we need props to calculate the next state? For example, maybe our API is &lt;Counter step={1} /&gt;. Surely, in this case we canâ€™t avoid specifying props.step as a dependency?In fact, we can! We can put the reducer itself inside our component to read props:123456789101112131415161718function Counter(&#123; step &#125;) &#123; const [count, dispatch] = useReducer(reducer, 0); function reducer(state, action) &#123; if (action.type === &apos;tick&apos;) &#123; return state + step; &#125; else &#123; throw new Error(); &#125; &#125; useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: &apos;tick&apos; &#125;); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [dispatch]); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125;This pattern disables a few optimizations so try not to use it everywhere, but you can totally access props from a reducer if you need to. (Hereâ€™s a demo.)Even in that case, dispatch identity is still guaranteed to be stable between re-renders. So you may omit it from the effect deps if you want. Itâ€™s not going to cause the effect to re-run.You may be wondering: how can this possibly work? How can the reducer â€œknowâ€ props when called from inside an effect that belongs to another render? The answer is that when you dispatch, React just remembers the action â€” but it will call your reducer during the next render. At that point the fresh props will be in scope, and you wonâ€™t be inside an effect.This is why I like to think of useReducer as the â€œcheat modeâ€ of Hooks. It lets me decouple the update logic from describing what happened. This, in turn, helps me remove unnecessary dependencies from my effects and avoid re-running them more often than necessary.Moving Functions Inside EffectsA common mistake is to think functions shouldnâ€™t be dependencies. For example, this seems like it could work:12345678910111213function SearchResults() &#123; const [data, setData] = useState(&#123; hits: [] &#125;); async function fetchData() &#123; const result = await axios( &apos;https://hn.algolia.com/api/v1/search?query=react&apos;, ); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []);(This example is adapted from a great article by Robin Wieruch â€” check it out!)And to be clear, this code does work. But the problem with simply omitting local functions is that it gets pretty hard to tell whether weâ€™re handling all cases as the component grows!Imagine our code was split like this and each function was five times larger:123456789101112131415161718function SearchResults() &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;Now letâ€™s say we later use some state or prop in one of these functions:12345678910111213141516171819function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;If we forget to update the deps of any effects that call these functions (possibly, through other functions!), our effects will fail to synchronize changes from our props and state. This doesnâ€™t sound great.Luckily, there is an easy solution to this problem. If you only use some functions inside an effect, move them directly into that effect:12345678function SearchResults() &#123; useEffect(() =&gt; &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, []); &#125;(Hereâ€™s a demo.)So what is the benefit? We no longer have to think about the â€œtransitive dependenciesâ€. Our dependencies array isnâ€™t lying anymore: we truly arenâ€™t using anything from the outer scope of the component in our effect.If we later edit getFetchUrl to use the query state, weâ€™re much more likely to notice that weâ€™re editing it inside an effect â€” and therefore, we need to add query to the effect dependencies:12345678910111213141516function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); useEffect(() =&gt; &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, [query]); &#125;(Hereâ€™s a demo.)By adding this dependency, weâ€™re not just â€œappeasing Reactâ€. It makes sense to refetch the data when the query changes. The design of useEffect forces you to notice the change in our data flow and choose how our effects should synchronize it â€” instead of ignoring it until our product users hit a bug.Thanks to the exhaustive-deps lint rule from the eslint-plugin-react-hooks plugin, you can analyze the effects as you type in your editor and receive suggestions about which dependencies are missing. In other words, a machine can tell you which data flow changes arenâ€™t handled correctly by a component.Pretty sweet.But I Canâ€™t Put This Function Inside an EffectSometimes you might not want to move a function inside an effect. For example, several effects in the same component may call the same function, and you donâ€™t want to copy and paste its logic. Or maybe itâ€™s a prop.Should you skip a function like this in the effect dependencies? I think not. Again, effects shouldnâ€™t lie about their dependencies. There are usually better solutions. A common misconception is that â€œa function would never changeâ€. But as we learned throughout this article, this couldnâ€™t be further from truth. Indeed, a function defined inside a component changes on every render!That by itself presents a problem. Say two effects call getFetchUrl:1234567891011121314151617function SearchResults() &#123; function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, []); &#125;In that case you might not want to move getFetchUrl inside either of the effects since you wouldnâ€™t be able to share the logic.On the other hand, if youâ€™re â€œhonestâ€ about the effect dependencies, you may run into a problem. Since both our effects depend on getFetchUrl (which is different on every render), our dependency arrays are useless:1234567891011121314function SearchResults() &#123; function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, [getFetchUrl]); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, [getFetchUrl]); &#125;A tempting solution to this is to just skip the getFetchUrl function in the deps list. However, I donâ€™t think itâ€™s a good solution. This makes it difficult to notice when we are adding a change to the data flow that needs to be handled by an effect. This leads to bugs like the â€œnever updating intervalâ€ we saw earlier.Instead, there are two other solutions that are simpler.First of all, if a function doesnâ€™t use anything from the component scope, you can hoist it outside the component and then freely use it inside your effects:1234567891011121314function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;function SearchResults() &#123; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, []); &#125;Thereâ€™s no need to specify it in deps because itâ€™s not in the render scope and canâ€™t be affected by the data flow. It canâ€™t accidentally depend on props or state.Alternatively, you can wrap it into the useCallback Hook:1234567891011121314function SearchResults() &#123; const getFetchUrl = useCallback((query) =&gt; &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, [getFetchUrl]); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, [getFetchUrl]); &#125;useCallback is essentially like adding another layer of dependency checks. Itâ€™s solving the problem on the other end â€” rather than avoid a function dependency, we make the function itself only change when necessary.Letâ€™s see why this approach is useful. Previously, our example showed two search results (for &#39;react&#39; and &#39;redux&#39; search queries). But letâ€™s say we want to add an input so that you can search for an arbitrary query. So instead of taking query as an argument, getFetchUrl will now read it from local state.Weâ€™ll immediately see that itâ€™s missing a query dependency:123456function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); const getFetchUrl = useCallback(() =&gt; &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, []); &#125;If I fix my useCallback deps to include query, any effect with getFetchUrl in deps will re-run whenever the query changes:1234567891011function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); const getFetchUrl = useCallback(() =&gt; &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, [query]); useEffect(() =&gt; &#123; const url = getFetchUrl(); &#125;, [getFetchUrl]); &#125;Thanks to useCallback, if query is the same, getFetchUrl also stays the same, and our effect doesnâ€™t re-run. But if query changes, getFetchUrl will also change, and we will re-fetch the data. Itâ€™s a lot like when you change some cell in an Excel spreadsheet, and the other cells using it recalculate automatically.This is just a consequence of embracing the data flow and the synchronization mindset. The same solution works for function props passed from parents:12345678910111213141516function Parent() &#123; const [query, setQuery] = useState(&apos;react&apos;); const fetchData = useCallback(() =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, [query]); return &lt;Child fetchData=&#123;fetchData&#125; /&gt;&#125;function Child(&#123; fetchData &#125;) &#123; let [data, setData] = useState(null); useEffect(() =&gt; &#123; fetchData().then(setData); &#125;, [fetchData]); &#125;Since fetchData only changes inside Parent when its query state changes, our Child wonâ€™t refetch the data until itâ€™s actually necessary for the app.Are Functions Part of the Data Flow?Interestingly, this pattern is broken with classes in a way that really shows the difference between the effect and lifecycle paradigms. Consider this translation:1234567891011121314151617class Parent extends Component &#123; state = &#123; query: &apos;react&apos; &#125;; fetchData = () =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query; &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; render() &#123; &#125;&#125;You might be thinking: â€œCome on Dan, we all know that useEffect is like componentDidMount and componentDidUpdate combined, you canâ€™t keep beating that drum!â€ Yet this doesnâ€™t work even with componentDidUpdate:1234567891011class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; if (this.props.fetchData !== prevProps.fetchData) &#123; this.props.fetchData(); &#125; &#125; render() &#123; &#125;&#125;Of course, fetchData is a class method! (Or, rather, a class property â€” but that doesnâ€™t change anything.) Itâ€™s not going to be different because of a state change. So this.props.fetchData will stay equal to prevProps.fetchData and weâ€™ll never refetch. Letâ€™s just remove this condition then?123componentDidUpdate(prevProps) &#123; this.props.fetchData();&#125;Oh wait, this fetches on every re-render. (Adding an animation above in the tree is a fun way to discover it.) Maybe letâ€™s bind it to a particular query?123render() &#123; return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;&#125;But then this.props.fetchData !== prevProps.fetchData is always true, even if the query didnâ€™t change! So weâ€™ll always refetch.The only real solution to this conundrum with classes is to bite the bullet and pass the query itself into the Child component. The Child doesnâ€™t actually end up using the query, but it can trigger a refetch when it changes:12345678910111213141516171819202122232425class Parent extends Component &#123; state = &#123; query: &apos;react&apos; &#125;; fetchData = () =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query; &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; if (this.props.query !== prevProps.query) &#123; this.props.fetchData(); &#125; &#125; render() &#123; &#125;&#125;Over the years of working with classes with React, Iâ€™ve gotten so used to passing unnecessary props down and breaking encapsulation of parent components that I only realized a week ago why we had to do it.With classes, function props by themselves arenâ€™t truly a part of the data flow. Methods close over the mutable this variable so we canâ€™t rely on their identity to mean anything. Therefore, even when we only want a function, we have to pass a bunch of other data around in order to be able to â€œdiffâ€ it. We canâ€™t know whether this.props.fetchData passed from the parent depends on some state or not, and whether that state has just changed.With useCallback, functions can fully participate in the data flow. We can say that if the function inputs changed, the function itself has changed, but if not, it stayed the same. Thanks to the granularity provided by useCallback, changes to props like props.fetchData can propagate down automatically.Similarly, useMemo lets us do the same for complex objects:1234567function ColorPicker() &#123; const [color, setColor] = useState(&apos;pink&apos;); const style = useMemo(() =&gt; (&#123; color &#125;), [color]); return &lt;Child style=&#123;style&#125; /&gt;;&#125;I want to emphasize that putting useCallback everywhere is pretty clunky. Itâ€™s a nice escape hatch and itâ€™s useful when a function is both passed down and called from inside an effect in some children. Or if youâ€™re trying to prevent breaking memoization of a child component. But Hooks lend themselves better to avoiding passing callbacks down altogether.In the above examples, Iâ€™d much prefer if fetchData was either inside my effect (which itself could be extracted to a custom Hook) or a top-level import. I want to keep the effects simple, and callbacks in them donâ€™t help that. (â€œWhat if some props.onComplete callback changes while the request was in flight?â€) You can simulate the class behavior but that doesnâ€™t solve race conditions.Speaking of Race ConditionsA classic data fetching example with classes might look like this:12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; &#125;As you probably know, this code is buggy. It doesnâ€™t handle updates. So the second classic example you could find online is something like this:12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; componentDidUpdate(prevProps) &#123; if (prevProps.id !== this.props.id) &#123; this.fetchData(this.props.id); &#125; &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; &#125;This is definitely better! But itâ€™s still buggy. The reason itâ€™s buggy is that the request may come out of order. So if Iâ€™m fetching {id: 10}, switch to {id: 20}, but the {id: 20} request comes first, the request that started earlier but finished later would incorrectly overwrite my state.This is called a race condition, and itâ€™s typical in code that mixes async / await (which assumes something waits for the result) with top-down data flow (props or state can change while weâ€™re in the middle of an async function).Effects donâ€™t magically solve this problem, although theyâ€™ll warn you if you try to pass an async function to the effect directly. (Weâ€™ll need to improve that warning to better explain the problems you might run into.)If the async approach you use supports cancellation, thatâ€™s great! You can cancel the async request right in your cleanup function.Alternatively, the easiest stopgap approach is to track it with a boolean:1234567891011121314151617function Article(&#123; id &#125;) &#123; const [article, setArticle] = useState(null); useEffect(() =&gt; &#123; let didCancel = false; async function fetchData() &#123; const article = await API.fetchArticle(id); if (!didCancel) &#123; setArticle(article); &#125; &#125; fetchData(); return () =&gt; &#123; didCancel = true; &#125;; &#125;, [id]); &#125;This article goes into more detail about how you can handle errors and loading states, as well as extract that logic into a custom Hook. I recommend you to check it out if youâ€™re interested to learn more about data fetching with Hooks.Raising the BarWith the class lifecycle mindset, side effects behave differently from the render output. Rendering the UI is driven by props and state, and is guaranteed to be consistent with them, but side effects are not. This is a common source of bugs.With the mindset of useEffect, things are synchronized by default. Side effects become a part of the React data flow. For every useEffect call, once you get it right, your component handles edge cases much better.However, the upfront cost of getting it right is higher. This can be annoying. Writing synchronization code that handles edge cases well is inherently more difficult than firing one-off side effects that arenâ€™t consistent with rendering.This could be worrying if useEffect was meant to be the tool you use most of the time. However, itâ€™s a low-level building block. Itâ€™s an early time for Hooks so everybody uses low-level ones all the time, especially in tutorials. But in practice, itâ€™s likely the community will start moving to higher-level Hooks as good APIs gain momentum.Iâ€™m seeing different apps create their own Hooks like useFetch that encapsulates some of their appâ€™s auth logic or useTheme which uses theme context. Once you have a toolbox of those, you donâ€™t reach for useEffect that often. But the resilience it brings benefits every Hook built on top of it.So far, useEffect is most commonly used for data fetching. But data fetching isnâ€™t exactly a synchronization problem. This is especially obvious because our deps are often []. What are we even synchronizing?In the longer term, Suspense for Data Fetching will allow third-party libraries to have a first-class way to tell React to suspend rendering until something async (anything: code, data, images) is ready.As Suspense gradually covers more data fetching use cases, I anticipate that useEffect will fade into background as a power user tool for cases when you actually want to synchronize props and state to some side effect. Unlike data fetching, it handles this case naturally because it was designed for it. But until then, custom Hooks like shown here are a good way to reuse data fetching logic.In ClosingNow that you know pretty much everything I know about using effects, check out the TLDR in the beginning. Does it make sense? Did I miss something? (I havenâ€™t run out of paper yet!)Iâ€™d love to hear from you on Twitter! Thanks for reading.]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
        <category>React Hooks</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>React Hooks</tag>
        <tag>useEffect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[A Complete Guide to useEffectï¼ˆä¸­æ–‡ç‰ˆï¼‰]]></title>
    <url>%2Farchives%2F4233.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/ä½ ç”¨ Hooks å†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„ API å¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº› custom Hooks å»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº† 300 è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨useEffectä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒ class çš„ç”Ÿå‘½å‘¨æœŸâ€¦ ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼šğŸ¤” å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼ŸğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼ŸğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼ŸğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼ŸğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– propï¼Ÿå½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨ Hooks çš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº› â€œå•Šå“ˆâ€ çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚è¿™ç¯‡æ–‡ç« ä¼šæ·±å…¥è®²è§£å¸®ä½ æ˜ç™½ä¸Šé¢é—®é¢˜çš„ç­”æ¡ˆã€‚åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼šuseEffectã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„ class ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†useEffect è¿™ä¸ª Hook çš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yodaè¿™ç¯‡æ–‡ç« ä¼šå‡è®¾ä½ å¯¹ useEffect API æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ã€‚è¿™ç¯‡æ–‡ç« çœŸçš„å¾ˆé•¿ã€‚å®ƒæ›´åƒä¸€æœ¬ mini ä¹¦ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ›´å–œæ¬¢çš„å½¢å¼ã€‚å¦‚æœä½ å¾ˆåŒ†å¿™æˆ–è€…å¹¶ä¸æ˜¯å¤ªå…³å¿ƒæœ¬æ–‡ä¸»é¢˜çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„æ‘˜è¦ã€‚å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ 2013 å¹´ React åˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚æ‘˜è¦å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚å¦‚æœä½ æ‰“ç®—é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œä½ å®Œå…¨å¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†ã€‚æˆ‘ä¼šåœ¨æ–‡ç« æœ«å°¾å¸¦ä¸Šæ‘˜è¦çš„é“¾æ¥ã€‚ğŸ¤” Question: å¦‚ä½•ç”¨useEffectæ¨¡æ‹ŸcomponentDidMountç”Ÿå‘½å‘¨æœŸï¼Ÿè™½ç„¶å¯ä»¥ä½¿ç”¨useEffect(fn, [])ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’ŒcomponentDidMountä¸ä¸€æ ·ï¼ŒuseEffectä¼š_æ•è·_ props å’Œ stateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„ props å’Œ stateã€‚å¦‚æœä½ æƒ³å¾—åˆ° â€œæœ€æ–°â€ çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨ refã€‚è®°ä½ï¼Œeffects çš„å¿ƒæ™ºæ¨¡å‹å’ŒcomponentDidMountä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦ â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ğŸ¤” Question: å¦‚ä½•æ­£ç¡®åœ°åœ¨useEffecté‡Œè¯·æ±‚æ•°æ®ï¼Ÿ[]åˆæ˜¯ä»€ä¹ˆï¼Ÿè¿™ç¯‡æ–‡ç«  æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨useEffecté‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚[]è¡¨ç¤º effect æ²¡æœ‰ä½¿ç”¨ä»»ä½• React æ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥ effect ä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚[]åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº› effect ä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚ğŸ¤” Question: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼Ÿä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ– props å’Œ state çš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢« effect ä½¿ç”¨çš„å‡½æ•°æ”¾åˆ° effect é‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„ effect è¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡ props ä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨useCallbackåŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ° props å’Œ stateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„ FAQ æœ‰æ›´è¯¦ç»†çš„ç­”æ¡ˆã€‚ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿè¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨ effect é‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½® effect ä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨ effect ä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘ effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨[]ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ° effect é‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨useCallbackåŒ…ä¸€å±‚ã€‚useMemo å¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– prop å‘¢ï¼ŸEffect æ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚è¿™èƒ½å¤Ÿé¿å…ä¸€äº› bugsï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„ ref ä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„ props å’Œ stateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ª lint è§„åˆ™æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘ FAQ ä¸­çš„è¿™ä¸ªå›ç­”ã€‚æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and Stateåœ¨æˆ‘ä»¬è®¨è®º effects ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ Counterï¼Œæ³¨æ„é«˜äº®çš„é‚£ä¸€è¡Œï¼š1234567891011function Counter() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;é«˜äº®çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿcount ä¼š â€œç›‘å¬â€ çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹  React çš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹ã€‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œcountä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚å®ƒä¸æ˜¯ç¥å¥‡çš„ â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š123const count = 42;&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»useState()æ‹¿åˆ°countçš„åˆå§‹å€¼0ã€‚å½“æˆ‘ä»¬è°ƒç”¨setCount(1)ï¼ŒReact ä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡countæ˜¯1ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š12345678910111213141516171819function Counter() &#123; const count = 0; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;function Counter() &#123; const count = 1; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;function Counter() &#123; const count = 2; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &#125;å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„count çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š1&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº† count è¿™ä¸ªæ•°å­—ã€‚è¿™ä¸ªæ•°å­—ç”± React æä¾›ã€‚å½“setCountçš„æ—¶å€™ï¼ŒReact ä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„countå€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReact ä¼šæ›´æ–° DOM ä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„countå¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„countå€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  React as a UI Runtimeã€‚ï¼‰æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼š alert ç‚¹å‡»æ¬¡æ•°countï¼š12345678910111213function Counter() &#123; const [count, setCount] = useState(0); function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;button onClick=&#123;handleAlertClick&#125;&gt; Show alert &lt;/button&gt; &lt;/div&gt; );&#125;å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼šç‚¹å‡»å¢åŠ  counter åˆ° 3ç‚¹å‡»ä¸€ä¸‹ â€œShow alertâ€ç‚¹å‡»å¢åŠ  counter åˆ° 5 å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆä½ çŒœ alert ä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯ 5 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯ alert çš„æ—¶å€™ counter çš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯ 3 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚å‰§é€é¢„è­¦æ¥è‡ªå·± è¯•è¯•å§ï¼å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨ state ä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„ IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚ è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯ 3ã€‚alert ä¼š â€œæ•è·â€ æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡º â€œæœ€å°é˜»åŠ›è·¯å¾„â€ æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°countåœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­countå€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚è¿™å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š1234567891011121314function sayHi(person) &#123; const name = person.name; setTimeout(() =&gt; &#123; alert(&apos;Hello, &apos; + name); &#125;, 3000);&#125;let someone = &#123;name: &apos;Dan&apos;&#125;;sayHi(someone);someone = &#123;name: &apos;Yuzhi&apos;&#125;;sayHi(someone);someone = &#123;name: &apos;Dominic&apos;&#125;;sayHi(someone);åœ¨ è¿™ä¸ªä¾‹å­ä¸­, å¤–å±‚çš„someoneä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨ React ä¸­ï¼Œ_å½“å‰_çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚ç„¶åï¼Œåœ¨sayHiå‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡nameä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„personå…³è”ã€‚å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ª alert éƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„nameã€‚è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„countå€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ â€œçœ‹åˆ°â€ çš„æ˜¯å®ƒè‡ªå·±çš„countï¼š12345678910111213141516171819202122232425262728293031function Counter() &#123; const count = 0; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;function Counter() &#123; const count = 1; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;function Counter() &#123; const count = 2; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + count); &#125;, 3000); &#125; &#125;æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ª â€œæ–°ç‰ˆæœ¬â€ çš„handleAlertClickã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„handleAlertClickâ€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ countï¼š12345678910111213141516171819202122232425262728293031function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 0); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 1); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;function Counter() &#123; function handleAlertClick() &#123; setTimeout(() =&gt; &#123; alert(&apos;You clicked on: &apos; + 2); &#125;, 3000); &#125; &lt;button onClick=&#123;handleAlertClick&#125; /&gt; &#125;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ª demo ä¸­ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° â€œå±äºâ€ æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­counterçš„çŠ¶æ€å€¼ã€‚åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œprops å’Œ state æ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚å¦‚æœ props å’Œ state åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½ â€œå±äºâ€ ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨ â€œçœ‹åˆ°â€ çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„countå€¼ã€‚å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„countå€¼ç›´æ¥å†…è”åˆ°äº†handleAlertClickå‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„å› ä¸ºcount å€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹ state è¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨setSomething(newObj)çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„ state ä¸ä¼šè¢«æ±¡æŸ“ã€‚æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effectsè¿™ç¯‡æ–‡ç« æ˜¯å…³äº effects çš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®º effectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffects å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚è®©æˆ‘ä»¬å›åˆ°å®˜ç½‘æ–‡æ¡£ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; document.title = `You clicked $&#123;count&#125; times`; &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffect æ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„count çŠ¶æ€å€¼çš„å‘¢ï¼Ÿä¹Ÿè®¸ï¼Œæ˜¯æŸç§ â€œdata bindingâ€ æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—countèƒ½å¤Ÿåœ¨ effect å‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸countæ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReact ä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„ effect å‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿéƒ½ä¸æ˜¯ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“countæ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•° â€œçœ‹åˆ°â€ çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„countçŠ¶æ€å€¼ã€‚å¯¹äº effects ä¹ŸåŒæ ·å¦‚æ­¤ï¼šå¹¶ä¸æ˜¯countçš„å€¼åœ¨ â€œä¸å˜â€ çš„ effect ä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯ effect å‡½æ•°æœ¬èº«åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚æ¯ä¸€ä¸ª effect ç‰ˆæœ¬ â€œçœ‹åˆ°â€ çš„countå€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š12345678910111213141516171819202122function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;0&#125; times`; &#125; ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;1&#125; times`; &#125; ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; document.title = `You clicked $&#123;2&#125; times`; &#125; ); &#125;React ä¼šè®°ä½ä½ æä¾›çš„ effect å‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äº DOM å¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ª effectï¼ˆè¿™é‡ŒæŒ‡æ›´æ–° document çš„ titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„å‡½æ•° â€” å¹¶ä¸”æ¯ä¸ª effect å‡½æ•° â€œçœ‹åˆ°â€ çš„ props å’Œ state éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡ effects æ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†å…è®¸ Hook çš„ç»„åˆå¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffect å‡½æ•°_å±äº_æŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼šReact: ç»™æˆ‘çŠ¶æ€ä¸º 0æ—¶å€™çš„ UIã€‚ä½ çš„ç»„ä»¶:ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: &lt;p&gt;You clicked 0 times&lt;/p&gt;ã€‚è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effect: () =&gt; { document.title = &#39;You clicked 0 times&#39; }ã€‚React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™ DOM æ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚æµè§ˆå™¨: é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„ effectè¿è¡Œ () =&gt; { document.title = &#39;You clicked 0 times&#39; }ã€‚ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼šä½ çš„ç»„ä»¶: å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º1ã€‚React: ç»™æˆ‘çŠ¶æ€ä¸º 1æ—¶å€™çš„ UIã€‚ä½ çš„ç»„ä»¶:ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: &lt;p&gt;You clicked 1 times&lt;/p&gt;ã€‚è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effectï¼š () =&gt; { document.title = &#39;You clicked 1 times&#39; }ã€‚React: æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº† DOMã€‚Browser: é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚React: å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„ effectè¿è¡Œ () =&gt; { document.title = &#39;You clicked 1 times&#39; }ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦ æ‰€æœ‰æˆ‘ä»¬ç°åœ¨çŸ¥é“ effects ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ â€œçœ‹åˆ°â€ å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„ props å’Œ stateã€‚æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š12345678910111213function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;count&#125; times`); &#125;, 3000); &#125;); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨ effect é‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå‰§é€é¢„è­¦ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„countå€¼ã€‚ä½ å¯ä»¥è‡ªå·±è¯•ä¸€è¯•ï¼šä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€ä¸è¿‡ï¼Œclass ä¸­çš„this.stateå¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„ class å®ç°å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š12345componentDidUpdate() &#123; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;this.state.count&#125; times`); &#125;, 3000);&#125;ç„¶è€Œï¼Œthis.state.countæ€»æ˜¯æŒ‡å‘_æœ€æ–°_çš„ count å€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯5ï¼šæˆ‘è§‰å¾— Hooks è¿™ä¹ˆä¾èµ– Javascript é—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„ class å®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆthe canonical wrong-value-in-a-timeout confusionï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReact ä¿®æ”¹äº† class ä¸­çš„this.stateä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œprops å’Œ state åœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é—­åŒ…ä¿®å¤ä¸Šé¢çš„ class ç‰ˆæœ¬â€¦é€†æ½®è€ŒåŠ¨åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼šæ¯ä¸€ä¸ªç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„ props å’Œ stateã€‚æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š1234567function Example(props) &#123; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(props.counter); &#125;, 1000); &#125;); &#125;1234567function Example(props) &#123; const counter = props.counter; useEffect(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(counter); &#125;, 1000); &#125;); &#125;åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å– props æˆ–è€… state æ˜¯æ— å…³ç´§è¦çš„ã€‚å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œprops å’Œ state å§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„ props ä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½_æƒ³_åœ¨ effect çš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨ refsï¼Œè¿™ç¯‡æ–‡ç« çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»_è¿‡å»æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–æœªæ¥çš„ props å’Œ stateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰é”™_ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿ â€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨ class ä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚ä¸‹é¢è¿™ä¸ªè®¡æ•°å™¨ç‰ˆæœ¬ æ¨¡æ‹Ÿäº† class ä¸­çš„è¡Œä¸ºï¼š1234567function Example() &#123; const [count, setCount] = useState(0); const latestCount = useRef(count); useEffect(() =&gt; &#123; latestCount.current = count; setTimeout(() =&gt; &#123; console.log(`You clicked $&#123;latestCount.current&#125; times`); &#125;, 3000); &#125;);åœ¨ React ä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨ class ç»„ä»¶ä¸­ React æ­£æ˜¯è¿™æ ·å»ä¿®æ”¹this.stateçš„ã€‚ä¸åƒæ•è·çš„ props å’Œ stateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„latestCount.currentæ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚é‚£ Effect ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿåƒ æ–‡æ¡£ä¸­è§£é‡Šçš„, æœ‰äº› effects å¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚æ€è€ƒä¸‹é¢çš„ä»£ç :123456useEffect(() =&gt; &#123; ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange); &#125;;&#125;);å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™propsæ˜¯{id: 10}ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯{id: 20}ã€‚ä½ _å¯èƒ½_ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼šReact æ¸…é™¤äº† {id: 10}çš„ effectã€‚React æ¸²æŸ“{id: 20}çš„ UIã€‚React è¿è¡Œ{id: 20}çš„ effectã€‚(äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚)å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹ â€œçœ‹åˆ°â€ çš„æ˜¯æ—§çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„ effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäº class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡å®ƒå¹¶ä¸ç²¾ç¡®ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚React åªä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œ effectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•° effects å¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effect çš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚ä¸Šä¸€æ¬¡çš„ effect ä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ï¼šReact æ¸²æŸ“{id: 20}çš„ UIã€‚æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°{id: 20}çš„ UIã€‚React æ¸…é™¤{id: 10}çš„ effectã€‚React è¿è¡Œ{id: 20}çš„ effectã€‚ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect å‘ç”Ÿåœ¨ props å˜æˆ{id: 20}ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½ â€œçœ‹åˆ°â€ æ—§çš„{id: 10}ï¼Ÿä½ æ›¾ç»æ¥è¿‡è¿™é‡Œâ€¦ ğŸ¤”å¼•ç”¨ä¸ŠåŠéƒ¨åˆ†å¾—åˆ°çš„ç»“è®º:ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effect çš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å– â€œæœ€æ–°â€ çš„ propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å€¼ï¼š1234567891011121314151617181920212223242526function Example() &#123; useEffect( () =&gt; &#123; ChatAPI.subscribeToFriendStatus(10, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange); &#125;; &#125; ); &#125;function Example() &#123; useEffect( () =&gt; &#123; ChatAPI.subscribeToFriendStatus(20, handleStatusChange); return () =&gt; &#123; ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange); &#125;; &#125; ); &#125;ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ effect çš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°{id: 10}è¿™ä¸ª propsã€‚è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆ React èƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç† effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„ propsã€‚åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸæˆ‘æœ€å–œæ¬¢ React çš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„ç†µã€‚æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š1234567function Greeting(&#123; name &#125;) &#123; return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125;æˆ‘å…ˆæ¸²æŸ“&lt;Greeting /&gt;ç„¶åæ¸²æŸ“&lt;Greeting /&gt;ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“&lt;Greeting /&gt;å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯ â€œHello, Yuzhiâ€ã€‚äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨ React ä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚è¿™å°±æ˜¯ JQuery ä»£ç ä¸­ $.addClass æˆ– $.removeClassè¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’Œ React ä»£ç ä¸­å£°æ˜ CSS ç±»ååº”è¯¥æ˜¯ä»€ä¹ˆï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚React ä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„ props å’Œ state åŒæ­¥åˆ° DOMã€‚â€œmountâ€å’Œ â€œupdateâ€ ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒ effectsã€‚useEffectä½¿ä½ èƒ½å¤Ÿæ ¹æ® props å’Œ state _åŒæ­¥_ React tree ä¹‹å¤–çš„ä¸œè¥¿ã€‚1234567function Greeting(&#123; name &#125;) &#123; useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name; &#125;); return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;/h1&gt; );&#125;è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„ mount/update/unmount å¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ª effect ä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚å…ˆæ¸²æŸ“å±æ€§ Aï¼ŒB å†æ¸²æŸ“ Cï¼Œå’Œç«‹å³æ¸²æŸ“ C å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„ effects å¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå‘Šè¯‰ React å»æ¯”å¯¹ä½ çš„ Effectså…¶å®æˆ‘ä»¬å·²ç»ä» React å¤„ç† DOM çš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚React åªä¼šæ›´æ–° DOM çœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚å½“ä½ æŠŠ123&lt;h1 class&gt; Hello, Dan&lt;/h1&gt;æ›´æ–°åˆ°123&lt;h1 class&gt; Hello, Yuzhi&lt;/h1&gt;React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡:12const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ª propsï¼Œå¹¶ä¸”å‘ç°childrenå‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–° DOMï¼Œä½†classNameå¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š1domNode.innerText = &apos;Hello, Yuzhi&apos;;æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç† effects å—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨ effect å°±å¤ªå¥½äº†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š12345678910111213function Greeting(&#123; name &#125;) &#123; const [counter, setCounter] = useState(0); useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name; &#125;); return ( &lt;h1 class&gt; Hello, &#123;name&#125; &lt;button onClick=&#123;() =&gt; setCounter(counter + 1)&#125;&gt; Increment &lt;/button&gt; &lt;/h1&gt; );&#125;ä½†æ˜¯æˆ‘ä»¬çš„ effect å¹¶æ²¡æœ‰ä½¿ç”¨counterè¿™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬çš„ effect åªä¼šåŒæ­¥nameå±æ€§ç»™document.titleï¼Œä½†nameå¹¶æ²¡æœ‰å˜ã€‚åœ¨æ¯ä¸€æ¬¡ counter æ”¹å˜åé‡æ–°ç»™document.titleèµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚å¥½äº†ï¼Œé‚£ React å¯ä»¥â€¦ åŒºåˆ† effects çš„ä¸åŒå—ï¼Ÿ12let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;å¹¶ä¸èƒ½ã€‚React å¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†nameå±æ€§ã€‚ï¼‰è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å… effects ä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™useEffectä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•° (deps)ï¼š123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, [name]);è¿™å¥½æ¯”ä½ å‘Šè¯‰ Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„nameï¼Œåˆ«æ— å…¶ä»–ã€‚â€å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ª effect çš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥ React ä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡ effectï¼š12345const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;const oldDeps = [&apos;Dan&apos;];const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;const newDeps = [&apos;Dan&apos;];å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡ effect çš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼å…³äºä¾èµ–é¡¹ä¸è¦å¯¹ React æ’’è°å…³äºä¾èµ–é¡¹å¯¹ React æ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ– class å¿ƒæ™ºæ¨¡å‹ä½¿ç”¨useEffectçš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰1234567891011function SearchResults() &#123; async function fetchData() &#123; &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;(å®˜ç½‘çš„ Hooks FAQ è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨ä¸‹é¢ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚)â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œeffect ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚è¿™åŒ…æ‹¬ propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€… socket è¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰ effect ä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReact å°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, [name]);(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†[]è®¾ä¸º effect çš„ä¾èµ–ï¼Œæ–°çš„ effect å‡½æ•°ä¸ä¼šè¿è¡Œï¼š123useEffect(() =&gt; &#123; document.title = &apos;Hello, &apos; + name;&#125;, []);(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œ â€œè·³å‡ºâ€class ç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨ Class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨useEffectçš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º[]ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡ effectâ€ï¼Œå¯¹å—ï¼Ÿ1234567891011function Counter() &#123; const [count, setCount] = useState(0); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, []); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125;ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­åªä¼šé€’å¢ä¸€æ¬¡ã€‚å¤©äº†å™œã€‚å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯ â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘ effect çš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿå¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™ React çš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒ effect æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effect ä¸­ä½¿ç”¨äº†countä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œcountæ˜¯0ã€‚å› æ­¤ï¼ŒsetCount(count + 1)åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äºsetCount(0 + 1)ã€‚æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†[]ä¾èµ–ï¼Œeffect ä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨setCount(0 + 1) ï¼š123456789101112131415161718192021222324252627function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [] ); &#125;æˆ‘ä»¬å¯¹ React æ’’è°è¯´æˆ‘ä»¬çš„ effect ä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„ effect æœ‰ä¾èµ–ï¼æˆ‘ä»¬çš„ effect ä¾èµ–count - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨ effect å¤–é¢å®šä¹‰ï¼‰ï¼š123456const count = useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []);å› æ­¤ï¼Œè®¾ç½®[]ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ª bugã€‚React ä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„ effectï¼š(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥ effect ä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª lint è§„åˆ™å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰ effect ä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«countï¼š12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]);ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯å¤ªç†æƒ³ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡countä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œ effectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„setCount(count + 1)ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ countå€¼ï¼š1234567891011121314151617181920212223242526function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(0 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [0] ); &#125;function Counter() &#123; useEffect( () =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(1 + 1); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [1] ); &#125;è¿™èƒ½è§£å†³é—®é¢˜ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡countæ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹ effect å†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹ effect ä½¿å¾—ä¾èµ–æ›´å°‘ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚è®© Effects è‡ªç»™è‡ªè¶³æˆ‘ä»¬æƒ³å»æ‰ effect çš„countä¾èµ–ã€‚12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(count + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [count]);ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨countï¼Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨setCountè°ƒç”¨ä¸­ç”¨åˆ°äº†countã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨ effect ä¸­ä½¿ç”¨countã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨setStateçš„å‡½æ•°å½¢å¼ï¼š12345useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + 1); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, []);æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸º â€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ effect ä¸­å†™äº†setCount(count + 1)æ‰€ä»¥countæ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠcountè½¬æ¢ä¸ºcount+1ï¼Œç„¶åè¿”å›ç»™ Reactã€‚å¯æ˜¯ React å…¶å®å·²ç»çŸ¥é“å½“å‰çš„countã€‚æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥ React çš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚è¿™æ­£æ˜¯setCount(c =&gt; c + 1)åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™ Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§ â€œæ›´æ–°å½¢å¼â€ åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦æ‰¹é‡æ›´æ–°ã€‚æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„ effect ä¸å†è¯»å–æ¸²æŸ“ä¸­çš„countå€¼ã€‚(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)ä½ å¯ä»¥è‡ªå·± è¯•è¯•ã€‚å°½ç®¡ effect åªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™ React å‘é€c =&gt; c + 1æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„countå€¼ã€‚å› ä¸º React å·²ç»çŸ¥é“äº†ã€‚å‡½æ•°å¼æ›´æ–° å’Œ Google Docsè¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£ effects çš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„ â€œä¿¡æ¯â€ å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ Google Docs ç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogle å¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚è™½ç„¶æˆ‘ä»¬ effect çš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚åªåœ¨ effects ä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ç±»ä¼¼äºsetCount(c =&gt; c + 1)è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”setCount(count + 1)ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„ count å€¼ â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ ä¹Ÿè®¨è®ºäº†å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚è¡¨è¾¾_æ„å›¾_ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’Œ Google Docs å¦‚ä½•å¤„ç†å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨ React ä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffect ä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚ç„¶è€Œï¼Œå³ä½¿æ˜¯setCount(c =&gt; c + 1)ä¹Ÿå¹¶ä¸å®Œç¾ã€‚å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ª prop æ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„ stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ setCount(c =&gt; c + 1)æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«useReducerã€‚è§£è€¦æ¥è‡ª Actions çš„æ›´æ–°æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼šcount å’Œ stepã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨ count ä¸Šå¢åŠ ä¸€ä¸ªstepå€¼ï¼š12345678910111213141516function Counter() &#123; const [count, setCount] = useState(0); const [step, setStep] = useState(1); useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; setCount(c =&gt; c + step); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [step]); return ( &lt;&gt; &lt;h1&gt;&#123;count&#125;&lt;/h1&gt; &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt; &lt;/&gt; );&#125;(è¿™é‡Œæ˜¯ demo.)æ³¨æ„æˆ‘ä»¬æ²¡æœ‰æ’’è°ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨ effect é‡Œä½¿ç”¨äº†stepï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹stepä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect ç„¶åé‡æ–°è¿è¡Œæ–°çš„ effect å¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨stepæ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä» effect ä¸­ç§»é™¤å¯¹stepçš„ä¾èµ–å‘¢ï¼Ÿå½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨useReducerå»æ›¿æ¢å®ƒä»¬ã€‚å½“ä½ å†™ç±»ä¼¼setSomething(something =&gt; ...)è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨ reducer çš„å¥‘æœºã€‚reducer å¯ä»¥è®©ä½ æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ (actions) å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªdispatchä¾èµ–å»æ›¿æ¢ effect çš„stepä¾èµ–ï¼š1234567const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: &apos;tick&apos; &#125;); &#125;, 1000); return () =&gt; clearInterval(id);&#125;, [dispatch]);(æŸ¥çœ‹ demoã€‚)ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ React ä¼šä¿è¯dispatchåœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚æˆ‘ä»¬è§£å†³äº†é—®é¢˜!ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤dispatch, setState, å’ŒuseRefåŒ…è£¹çš„å€¼å› ä¸º React ä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰ç›¸æ¯”äºç›´æ¥åœ¨ effect é‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒ dispatch äº†ä¸€ä¸ª action æ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ effect å’ŒstepçŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„ effect ä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”± reducer å»ç»Ÿä¸€å¤„ç†:12345678910111213const initialState = &#123; count: 0, step: 1,&#125;;function reducer(state, action) &#123; const &#123; count, step &#125; = state; if (action.type === &apos;tick&apos;) &#123; return &#123; count: count + step, step &#125;; &#125; else if (action.type === &apos;step&apos;) &#123; return &#123; count, step: action.step &#125;; &#125; else &#123; throw new Error(); &#125;&#125;(è¿™é‡Œæ˜¯ demo å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚)ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤ effect çš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ– props å»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„ API æ˜¯&lt;Counter step={1} /&gt;ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–props.step ã€‚æ˜¯å—ï¼Ÿå®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠ reducer å‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å– propsï¼š123456789101112131415161718function Counter(&#123; step &#125;) &#123; const [count, dispatch] = useReducer(reducer, 0); function reducer(state, action) &#123; if (action.type === &apos;tick&apos;) &#123; return state + step; &#125; else &#123; throw new Error(); &#125; &#125; useEffect(() =&gt; &#123; const id = setInterval(() =&gt; &#123; dispatch(&#123; type: &apos;tick&apos; &#125;); &#125;, 1000); return () =&gt; clearInterval(id); &#125;, [dispatch]); return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;&#125;è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨ reducer é‡Œé¢è®¿é—® propsã€‚ï¼ˆè¿™é‡Œæ˜¯ demoã€‚ï¼‰å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact ä¹Ÿä¿è¯dispatchåœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚ æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ· effect ä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„ reducer æ€ä¹ˆ â€œçŸ¥é“â€ æ–°çš„ propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ dispatchçš„æ—¶å€™ï¼ŒReact åªæ˜¯è®°ä½äº† action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨ reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„ props å°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸” reducer è°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨ effect é‡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸ºuseReduceræ˜¯ Hooks çš„ â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„ effect è°ƒç”¨ã€‚æŠŠå‡½æ•°ç§»åˆ° Effects é‡Œä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š12345678910111213function SearchResults() &#123; const [data, setData] = useState(&#123; hits: [] &#125;); async function fetchData() &#123; const result = await axios( &apos;https://hn.algolia.com/api/v1/search?query=react&apos;, ); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []);(è¿™ä¸ªä¾‹å­ æ”¹ç¼–è‡ª Robin Wieruch è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” ç‚¹å‡»æŸ¥çœ‹ï¼)éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š123456789101112131415161718function SearchResults() &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº› state æˆ–è€… propï¼š12345678910111213141516171819function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; useEffect(() =&gt; &#123; fetchData(); &#125;, []); &#125;å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„ effects çš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„ effects å°±ä¸ä¼šåŒæ­¥ props å’Œ state å¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨ effect ä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ° effect ä¸­ï¼š12345678function SearchResults() &#123; useEffect(() =&gt; &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, []); &#125;(è¿™é‡Œæ˜¯ demo.)è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº› â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼šåœ¨æˆ‘ä»¬çš„ effect ä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ getFetchUrlå»ä½¿ç”¨queryçŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨ effect é‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠqueryæ·»åŠ åˆ° effect çš„ä¾èµ–é‡Œï¼š12345678910111213141516function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); useEffect(() =&gt; &#123; function getFetchUrl() &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; async function fetchData() &#123; const result = await axios(getFetchUrl()); setData(result.data); &#125; fetchData(); &#125;, [query]); &#125;(è¿™é‡Œæ˜¯ demo.)æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨ â€œå–æ‚¦ Reactâ€ã€‚åœ¨ query æ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚useEffectçš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„ effects è¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº† bugã€‚æ„Ÿè°¢eslint-plugin-react-hooks æ’ä»¶çš„exhaustive-depslint è§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ ç¼–ç çš„æ—¶å€™å°±åˆ†æ effects å¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚éå¸¸æ£’ã€‚ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ° Effect é‡Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥ effect é‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ª effect ä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ª effect é‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª propã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œefffects ä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚ æ¯”å¦‚æœ‰ä¸¤ä¸ª effects ä¼šè°ƒç”¨ getFetchUrl:1234567891011121314151617function SearchResults() &#123; function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, []); &#125;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠgetFetchUrl ç§»åˆ° effects ä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆ â€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ª effects éƒ½ä¾èµ–getFetchUrlï¼Œè€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š1234567891011121314function SearchResults() &#123; function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, [getFetchUrl]); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, [getFetchUrl]); &#125;ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠgetFetchUrlä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢ â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€ çš„é—®é¢˜ã€‚ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨ effects ä¸­ä½¿ç”¨ï¼š1234567891011121314function getFetchUrl(query) &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;function SearchResults() &#123; useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, []); &#125;ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äº props æˆ– stateã€‚æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆ useCallback Hook:1234567891011121314function SearchResults() &#123; const getFetchUrl = useCallback((query) =&gt; &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, []); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;react&apos;); &#125;, [getFetchUrl]); useEffect(() =&gt; &#123; const url = getFetchUrl(&apos;redux&apos;); &#125;, [getFetchUrl]); &#125;useCallbackæœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸º&#39;react&#39;å’Œ&#39;redux&#39;ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶ (query)ã€‚ä¸åŒäºä¼ é€’queryå‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨getFetchUrlä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†queryä¾èµ–ï¼šå¦‚æœæˆ‘æŠŠqueryæ·»åŠ åˆ°useCallback çš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†getFetchUrlçš„ effect åœ¨queryæ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š1234567891011function SearchResults() &#123; const [query, setQuery] = useState(&apos;react&apos;); const getFetchUrl = useCallback(() =&gt; &#123; return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, [query]); useEffect(() =&gt; &#123; const url = getFetchUrl(); &#125;, [getFetchUrl]); &#125;æˆ‘ä»¬è¦æ„Ÿè°¢useCallbackï¼Œå› ä¸ºå¦‚æœquery ä¿æŒä¸å˜ï¼ŒgetFetchUrlä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„ effect ä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœqueryä¿®æ”¹äº†ï¼ŒgetFetchUrlä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨ Excel é‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š12345678910111213141516function Parent() &#123; const [query, setQuery] = useState(&apos;react&apos;); const fetchData = useCallback(() =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query; &#125;, [query]); return &lt;Child fetchData=&#123;fetchData&#125; /&gt;&#125;function Child(&#123; fetchData &#125;) &#123; let [data, setData] = useState(null); useEffect(() =&gt; &#123; fetchData().then(setData); &#125;, [fetchData]); &#125;å› ä¸ºfetchDataåªæœ‰åœ¨Parentçš„queryçŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Childåªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿæœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨ class ç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº† effect å’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š1234567891011121314151617class Parent extends Component &#123; state = &#123; query: &apos;react&apos; &#125;; fetchData = () =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query; &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; render() &#123; &#125;&#125;ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº† Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“useEffect å°±åƒcomponentDidMount å’Œ componentDidUpdateçš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€ å¥½å§ï¼Œå°±ç®—åŠ äº†componentDidUpdateç…§æ ·æ— ç”¨ï¼š1234567891011class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; if (this.props.fetchData !== prevProps.fetchData) &#123; this.props.fetchData(); &#125; &#125; render() &#123; &#125;&#125;å½“ç„¶å¦‚æ­¤ï¼ŒfetchDataæ˜¯ä¸€ä¸ª class æ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯ class å±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥this.props.fetchDataå’Œ prevProps.fetchDataå§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ123componentDidUpdate(prevProps) &#123; this.props.fetchData();&#125;ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚) ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„ query?123render() &#123; return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;&#125;ä½†è¿™æ ·ä¸€æ¥ï¼Œthis.props.fetchData !== prevProps.fetchData è¡¨è¾¾å¼æ°¸è¿œæ˜¯trueï¼Œå³ä½¿queryå¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚æƒ³è¦è§£å†³è¿™ä¸ª class ç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠqueryæœ¬èº«ä¼ å…¥ Child ç»„ä»¶ã€‚ Child è™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥_ä½¿ç”¨_è¿™ä¸ªqueryçš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š12345678910111213141516171819202122232425class Parent extends Component &#123; state = &#123; query: &apos;react&apos; &#125;; fetchData = () =&gt; &#123; const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query; &#125;; render() &#123; return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;; &#125;&#125;class Child extends Component &#123; state = &#123; data: null &#125;; componentDidMount() &#123; this.props.fetchData(); &#125; componentDidUpdate(prevProps) &#123; if (this.props.query !== prevProps.query) &#123; this.props.fetchData(); &#125; &#125; render() &#123; &#125;&#125;åœ¨ä½¿ç”¨ React çš„ class ç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„ props ä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚åœ¨ class ç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„thiså˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åš â€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„this.props.fetchData æ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚ä½¿ç”¨useCallbackï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„useCallbackï¼Œå±æ€§æ¯”å¦‚props.fetchDataçš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚ç±»ä¼¼çš„ï¼ŒuseMemoå¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚1234567function ColorPicker() &#123; const [color, setColor] = useState(&apos;pink&apos;); const style = useMemo(() =&gt; (&#123; color &#125;), [color]); return &lt;Child style=&#123;style&#125; /&gt;;&#125;æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨useCallbackæ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„ effect ä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼ŒuseCallback æ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´ Hooks æœ¬èº«èƒ½æ›´å¥½åœ°é¿å…ä¼ é€’å›è°ƒå‡½æ•°ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠfetchDataæ”¾åœ¨æˆ‘çš„ effect é‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®© effects ä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ªprops.onCompleteå›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥æ¨¡æ‹Ÿ class çš„è¡Œä¸ºä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚è¯´è¯´ç«æ€ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨ class ç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; &#125;ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š12345678910111213class Article extends Component &#123; state = &#123; article: null &#125;; componentDidMount() &#123; this.fetchData(this.props.id); &#125; componentDidUpdate(prevProps) &#123; if (prevProps.id !== this.props.id) &#123; this.fetchData(this.props.id); &#125; &#125; async fetchData(id) &#123; const article = await API.fetchArticle(id); this.setState(&#123; article &#125;); &#125; &#125;è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ {id: 10}ï¼Œç„¶åæ›´æ–°åˆ°{id: 20}ï¼Œä½†{id: 20}çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†async / awaitï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆprops å’Œ state å¯èƒ½ä¼šåœ¨ async å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚Effects å¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ªasync å‡½æ•°ç»™ effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š1234567891011121314151617function Article(&#123; id &#125;) &#123; const [article, setArticle] = useState(null); useEffect(() =&gt; &#123; let didCancel = false; async function fetchData() &#123; const article = await API.fetchArticle(id); if (!didCancel) &#123; setArticle(article); &#125; &#125; fetchData(); return () =&gt; &#123; didCancel = true; &#125;; &#125;, [id]); &#125;è¿™ç¯‡æ–‡ç« è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„ Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨ Hooks é‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚æé«˜æ°´å‡†åœ¨ class ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UI æ¸²æŸ“æ˜¯è¢« props å’Œ state é©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚è€Œåœ¨useEffectçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº† React æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ªuseEffectè°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚ç„¶è€Œï¼Œç”¨å¥½useEffectçš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœuseEffectæ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸º Hooks å¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨ Hooksï¼Œå› ä¸ºå¥½çš„ API ä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„ Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„useFetchæˆ–è€…ä½¿ç”¨ theme context çš„useTheme ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨useEffectã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„ Hook éƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚ç›®å‰ä¸ºæ­¢ï¼ŒuseEffectä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯[]æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿé•¿è¿œæ¥çœ‹ï¼Œ Suspense ç”¨äºæ•°æ®è¯·æ±‚ ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰ React æš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚å½“ Suspense é€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™useEffect ä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥ props å’Œ state åˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„ Hooks æ¯”å¦‚è¿™å„¿æåˆ°çš„æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚åœ¨ç»“æŸå‰ç°åœ¨ä½ å·®ä¸å¤šçŸ¥é“äº†æˆ‘å…³äºå¦‚ä½•ä½¿ç”¨ effects çš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹å¼€å¤´çš„ TLDRã€‚ä½ ç°åœ¨è§‰å¾—å®ƒè¯´å¾—æœ‰é“ç†å—ï¼Ÿæˆ‘æœ‰é—æ¼ä»€ä¹ˆå—ï¼Ÿï¼ˆæˆ‘çš„çº¸è¿˜æ²¡æœ‰å†™å®Œï¼ï¼‰æˆ‘å¾ˆæƒ³åœ¨ Twitter ä¸Šå¬å¬ä½ çš„æƒ³æ³•ã€‚è°¢è°¢é˜…è¯»ã€‚]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
        <category>React Hooks</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>React Hooks</tag>
        <tag>useEffect</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[What are React Hooks]]></title>
    <url>%2Farchives%2Fef81.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://www.robinwieruch.de/react-hooks/October 29, 2018 - Edit this Post on GitHubReact Hooks were introduced at React Conf October 2018 as a way to use state and side-effects in React function components. Whereas function components have been called functional stateless components (FSC) before, they are finally able to use state with React Hooks. Therefore, many people refer to them as function components now.In this walkthrough, I want to explain the motivation behind hooks, what will change in React and why we shouldnâ€™t panic, and how React hooks can be used in function components by showcasing common React Hooks such as the state and effect hooks by example.React Hooks were invented by the React team to introduce state management and side-effects in function components. Itâ€™s their way of making it more effortless to use only React function components without the need to refactor a React function component to a React class component for using lifecycle methods, in order to use have side-effects, or local state. React Hooks enable us to write React applications with only function components.Unnecessary Component Refactorings: Previously, only React class components were used for local state management and lifecycle methods. The latter have been essential for introducing side-effects, such as listeners or data fetching, in React class components.12345678910111213141516171819202122232425262728import React from &apos;react&apos;;class Counter extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; count: 0, &#125;; &#125; render() &#123; return ( &lt;div&gt; &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;) &#125; &gt; Click me &lt;/button&gt; &lt;/div&gt; ); &#125;&#125;export default Counter;Only if you didnâ€™t need state or lifecycle methods, React functional stateless components could be used. And because React function components are more lightweight (and elegant), people already used plenty of function components. This came with the drawback of refactoring components from React function components to React class components every time state or lifecycle methods were needed (and vice versa).1234567891011121314151617import React, &#123; useState &#125; from &apos;react&apos;;// how to use the state hook in a React function componentfunction Counter() &#123; const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt; Click me &lt;/button&gt; &lt;/div&gt; );&#125;export default Counter;With Hooks there is no need for this refactoring. Side-effects and state are finally available in React function components. Thatâ€™s why a rebranding from functional stateless components to function components would be reasonable.Side-effect Logic: In React class components, side-effects were mostly introduced in lifecycle methods (e.g. componentDidMount, componentDidUpdate, componentWillUnmount). A side-effect could be fetching data in React or interacting with the Browser API. Usually these side-effects came with a setup and clean up phase. For instance, if you would miss to remove your listener, you could run into React performance issues.12345678910111213141516171819202122232425262728293031// side-effects in a React class componentclass MyComponent extends Component &#123; // setup phase componentDidMount() &#123; // add listener for feature 1 // add listener for feature 2 &#125; // clean up phase componentWillUnmount() &#123; // remove listener for feature 1 // remove listener for feature 2 &#125; ...&#125;// side-effects in React function component with React Hooksfunction MyComponent() &#123; useEffect(() =&gt; &#123; // add listener for feature 1 (setup) // return function to remove listener for feature 1 (clean up) &#125;); useEffect(() =&gt; &#123; // add listener for feature 2 (setup) // return function to remove listener for feature 2 (clean up) &#125;); ...&#125;Now, if you would introduce more than one of these side-effects in a React class componentâ€™s lifecycle methods, all side-effects would be grouped by lifecycle method but not by side-effect. Thatâ€™s what React Hooks are going to change by encapsulating a side-effect in one hook whereas every hook has its own side-effect with a setup and clean up phase. You will see later in a tutorial how this works for real by adding and removing listeners in a React Hook.Reactâ€™s Abstraction Hell: Abstraction and thus reusability were introduced with Higher-Order Components and Render Prop Components in React. There is also Reactâ€™s Context with its Provider and Consumer Components that introduce another level of abstraction. All of these advanced patterns in React are using so called wrapping components. The implementation of the following components shouldnâ€™t be foreign to developers who are creating larger React applications.12345678910111213141516171819import &#123; compose &#125; from &apos;recompose&apos;;import &#123; withRouter &#125; from &apos;react-router-dom&apos;;function App(&#123; history, state, dispatch &#125;) &#123; return ( &lt;ThemeContext.Consumer&gt; &#123;theme =&gt; &lt;Content theme=&#123;theme&#125;&gt; ... &lt;/Content&gt; &#125; &lt;/ThemeContext.Consumer&gt; );&#125;export default compose( withRouter, withReducer(reducer, initialState))(App);Sophie Alpert coined it â€œthe wrapper hellâ€ in React. You are not only seeing it in the implementation, but also when inspecting your components in the browser. There are dozens of wrapped components due to Render Prop Components (including Consumer components from Reactâ€™s Context) and Higher-Order Components. It becomes an unreadable component tree, because all the abstracted logic is covered up in other React components. The actual visible components are hard to track down in the browserâ€™s DOM. So what if these additional components were not needed because the logic is only encapsulated in functions as side-effects instead? Then you would remove all these wrapping components and flatten your component treeâ€™s structure:12345678910111213function App() &#123; const theme = useTheme(); const history = useRouter(); const [state, dispatch] = useReducer(reducer, initialState); return ( &lt;Content theme=&#123;theme&#125;&gt; ... &lt;/Content&gt; );&#125;export default App;Thatâ€™s what React Hooks are bringing on the table. All side-effects are sitting directly in the component without introducing other components as container for business logic. The container disappears and the logic just sits in React Hooks that are only functions. Andrew Clark already left a statement in favor of React Hooks in his popular Higher-Order Component library called recompose.JavaScript Class Confusion: JavaScript mixes two worlds pretty well: Object-oriented programming (OOP) and functional programming. React introduces many developers to both worlds. On the one side, React (and Redux) introduced people to functional programming (FP) with function compositions, general programming concepts with functions (e.g. higher-order functions, JavaScript built-in methods like map, reduce, filter) and other terms such as immutability and side-effects. React itself didnâ€™t really introduce these things, because they are features of the language or the programming paradigm itself, but they are heavily used in React whereas every React developer becomes automatically a better JavaScript developer.On the other side, React uses JavaScript classes as one way to define React components. A class is only the declaration whereas the actual usage of the component is the instantiation of it. It creates a class instance whereas the this object of the class instance is used to interact with class methods (e.g. setState, forceUpdate, other custom class methods). However, classes come with a steeper learning curve for React beginners who are not coming from an OOP background. Thatâ€™s why class bindings, the this object and inheritance can be confusing. I have a few chapters in my React book focusing only on this aspect of React which is always the most confusing thing about React for beginners.123456789101112131415161718192021222324252627282930313233343536373839404142// I THOUGHT WE ARE USING A CLASS. WHY IS IT EXTENDING FROM SOMETHING?class Counter extends Component &#123; // WAIT ... THIS WORKS??? state = &#123; value: 0 &#125;; // I THOUGH IT&apos;S THIS WAY, BUT WHY DO I NEED PROPS HERE? // constructor(props) &#123; // SUPER??? // super(props); // // this.state = &#123; // value: 0, // &#125;; // &#125; // WHY DO I HAVE TO USE AN ARROW FUNCTION??? onIncrement = () =&gt; &#123; this.setState(state =&gt; (&#123; value: state.value + 1 &#125;)); &#125;; // SHOULDN&apos;T IT BE this.onDecrement = this.onDecrement.bind(this); in the constructor??? // WHAT&apos;S this.onDecrement = this.onDecrement.bind(this); DOING ANYWAY? onDecrement = () =&gt; &#123; this.setState(state =&gt; (&#123; value: state.value - 1 &#125;)); &#125;; render() &#123; return ( &lt;div&gt; &#123;this.state.value&#125; &#123;/* WHY IS EVERYTHING AVAILABLE ON &quot;THIS&quot;??? */&#125; &lt;button onClick=&#123;this.onIncrement&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;this.onDecrement&#125;&gt;-&lt;/button&gt; &lt;/div&gt; ) &#125;&#125;Now, many people argue React shouldnâ€™t take JavaScript classes away because people donâ€™t understand them. After all, they belong to the language. However, one of the hypotheses of introducing the Hooks API is a smoother learning curve for React beginners when writing their React components without JavaScript classes in the first place.Every time a new feature is introduced, people are concerned about it. There is one side of the group that is ecstatic about the change, and the other side that fears the change. I heard the most common concerns for React Hooks are:Everything changes! Subtle panic mode â€¦React is becoming bloated like Angular!Itâ€™s useless, classes worked fine.Itâ€™s magic!Let me address these concerns here:Everything changes: React Hooks will change how we write React applications in the future. However, at the moment, nothing changes. You can still write class components with local state and lifecycle methods and deploy advanced patterns such as Higher-Order Components or Render Prop Components. Nobody takes these learnings away from you. See how I upgraded all my open source projects from older versions to React 16.6. and none of of these projects had problems. They are using HOCs, Render Props and I believe even the old context API (correct me if am wrong). Everything I have learned all these years still works. The React team makes sure that React stays backward compatible. It will be the same with React 16.7.React is becoming bloated like Angular: React was always seen as a library with a slim API. Thatâ€™s true and shall be true in the future. However, in order to adjust things that were the status quo of building component-based applications a few years ago, and not to be overtaken by other libraries who adapt to the new status quo, React introduces changes in favor of older APIs. If React would start out fresh this year, maybe there would be only function components and hooks. But React was released a couple of years ago and needs to adapt to keep up with the status quo or to invent a status quo. Maybe there will follow deprecations of React class components and lifecycle methods in a few years in favor of React function components and hooks, but at the moment, the React team keeps React class components in their repertoire of tools. After all, the React team utilizes hooks as an invention to run a marathon with React an not to win a sprint. Obviously, React Hooks add yet another API to React, but it is in favor to simplify Reactâ€™s API in the future. I like this transition more than having a React 2 where everything is different.Itâ€™s useless, classes worked fine: Imagine you would start from zero to learn React and you would be introduced to React with Hooks. Maybe create-react-app wouldnâ€™t start out with a React class component but with a React function component. Everything you need to learn for your components would be React Hooks. They manage state and side-effects, so you would only need to know about the state and the effect hook. Itâ€™s everything a React class component did for you before. It will be simpler for React beginners to learn React without all the other overhead that comes with JavaScript classes (inheritance, this, bindings, super, â€¦). Imagine React Hooks as a new way of how to write React components - Itâ€™s a new mindset. I am a skeptical person myself, but once I wrote a couple of simpler scenarios with React Hooks, I was convinced that this is the simplest way to write but also to learn React. As someone who is doing lots of React workshops, I argue that it takes away all the frustration classes bring on the table for React beginners.Itâ€™s magic: React is known to be down to earth with JavaScript. Writing React applications makes you a better JavaScript developer - thatâ€™s one of the best things about React when someone asks me: â€œWhy should I learn React?â€. Whether there comes another library in the future or not, everyone is prepared by honing their JavaScript skills and general programming skills when using React. Itâ€™s one of the things that made Redux, often used in React, popular: There is no magic, it is plain JavaScript. Now these React Hooks come along the way, introduce something stateful in a previously often pure function component, a couple of not easily to accept rules, and many donâ€™t understand whatâ€™s going on under the hood. But think about it this way: A function component in React is not a mere function. You still have to import React as library to your source code file. It does something with your function, because the function becomes a function component in React land. This function component comes with hidden implementations that were there all the time. How else would it have been possible to use functions as function components as we did it before React Hooks were introduced? And people accepted it too, even though itâ€™s kinda magic. Now, the only thing changed (and maybe it has already been this way before) is that these function components come with an extra hidden object that keeps track of hooks. To quote Dan Abramov from his article about hooks: â€œPerhaps youâ€™re wondering where React keeps the state for Hooks. The answer is itâ€™s kept in the exact same place where React keeps state for classes. React has an internal update queue which is the source of truth for any state, no matter how you define your components.â€.Finally, think about it this way: Component-based solutions such as Angular, Vue, and React are pushing the boundaries of web development with every release. They build up on top of technologies that were invented more than two decades ago. They adapt them to make web development effortless in 2018 and not 1998. They optimize them like crazy to meet the needs in the here and now. We are building web applications with components and not with HTML templates anymore. We are not there yet, but I imagine a future where we sit together and invent a component-based standard for the browser. Angular, Vue and React are only the spearhead of this movement.In the following, I want to dive into a few popular React Hooks by example to get you up to speed. All examples can be found in this GitHub repository.You have seen the useState Hook before in a code snippet for a typical counter example. It is used to manage local state in function components. Letâ€™s use the hook in a more elaborate example where we are going to manage an array of items. In another article of mine, you can learn more about managing arrays as state in React, but this time we are doing it with React hooks. Letâ€™s get started:12345678910111213141516171819202122232425262728293031import React, &#123; useState &#125; from &apos;react&apos;;const INITIAL_LIST = [ &#123; id: &apos;0&apos;, title: &apos;React with RxJS for State Management Tutorial&apos;, url: &apos;https://www.robinwieruch.de/react-rxjs-state-management-tutorial/&apos;, &#125;, &#123; id: &apos;1&apos;, title: &apos;A complete React with Apollo and GraphQL Tutorial&apos;, url: &apos;https://www.robinwieruch.de/react-graphql-apollo-tutorial&apos;, &#125;,];function App() &#123; const [list, setList] = useState(INITIAL_LIST); return ( &lt;ul&gt; &#123;list.map(item =&gt; ( &lt;li key=&#123;item.id&#125;&gt; &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt; &lt;/li&gt; ))&#125; &lt;/ul&gt; );&#125;export default App;The useState hook accepts an initial state as argument and returns, by using array destructuring, two variables that can be named however you want to name them. Whereas the first variable is the actual state, the second variable is a function to update the state by providing a new state.The goal of this scenario is to remove an item from the list. In order to accomplish it, every item in the rendered list has a button with a click handler. The click handler can be inlined in the function component, because it will make use of list and setList later. Hence you donâ€™t need to pass these variables to the handler, because they are already available from the outer scope of the component.123456789101112131415161718192021function App() &#123; const [list, setList] = useState(INITIAL_LIST); function onRemoveItem() &#123; // remove item from &quot;list&quot; // set the new list in state with &quot;setList&quot; &#125; return ( &lt;ul&gt; &#123;list.map(item =&gt; ( &lt;li key=&#123;item.id&#125;&gt; &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt; &lt;button type=&quot;button&quot; onClick=&#123;onRemoveItem&#125;&gt; Remove &lt;/button&gt; &lt;/li&gt; ))&#125; &lt;/ul&gt; );&#125;Somehow we need to know about the item that should be removed from the list. Using a higher-order function, we can pass the identifier of the item to the handler function. Otherwise we wouldnâ€™t be able to identify the item that should be removed from the list.123456789101112131415161718192021function App() &#123; const [list, setList] = useState(INITIAL_LIST); function onRemoveItem(id) &#123; // remove item from &quot;list&quot; // set the new list in state with &quot;setList&quot; &#125; return ( &lt;ul&gt; &#123;list.map(item =&gt; ( &lt;li key=&#123;item.id&#125;&gt; &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt; &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt; Remove &lt;/button&gt; &lt;/li&gt; ))&#125; &lt;/ul&gt; );&#125;Finally, use the identifier to filter the list with a built-in array method. It returns a new list which is used to set the new state of the list.123456789101112131415161718192021function App() &#123; const [list, setList] = useState(INITIAL_LIST); function onRemoveItem(id) &#123; const newList = list.filter(item =&gt; item.id !== id); setList(newList); &#125; return ( &lt;ul&gt; &#123;list.map(item =&gt; ( &lt;li key=&#123;item.id&#125;&gt; &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt; &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt; Remove &lt;/button&gt; &lt;/li&gt; ))&#125; &lt;/ul&gt; );&#125;That should do the job. You are able to remove an item from the list based on the identifier you pass to the handler. The handler then filters the list and sets the new state of the list with the setList function.The useState hook gives you everything you need to manage state in a function component: initial state, the latest state, and a state update function. Everything else is JavaScript again. Furthermore, you donâ€™t need to bother about the state object with its shallow merge as before in a class component. Instead, you encapsulate one domain (e.g. list) with useState, but if you would need another state (e.g. counter), then just encapsulate this domain with another useState. You can read more about the useState hook in Reactâ€™s documentation.Letâ€™s head over to the next hook called useEffect. As mentioned before, function components should be able to manage state and side-effects with hooks. Managing state was showcased with the useState hook. Now comes the useEffect hook into play for side-effects which are usually used for interactions with the Browser/DOM API or external API like data fetching. Letâ€™s see how the useEffect hook can be used for interaction with the Browser API by implementing a simple stopwatch. You can see how it is done in a React class component in this GitHub repository.1234567891011121314151617181920212223import React, &#123; useState &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); return ( &lt;div&gt; &#123;!isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt; Start &lt;/button&gt; )&#125; &#123;isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt; Stop &lt;/button&gt; )&#125; &lt;/div&gt; );&#125;export default App;There is no stopwatch yet. But at least there are is a conditional rendering to show either a â€œStartâ€ or â€œStopâ€ button. The state for the boolean flag is managed by the useState hook.Letâ€™s introduce our side-effect with useEffect that registers an interval. The function used for the interval emits a console logging every second to your developer tools of your browser.123456789101112131415161718192021222324252627import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); &#125;); return ( &lt;div&gt; &#123;!isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt; Start &lt;/button&gt; )&#125; &#123;isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt; Stop &lt;/button&gt; )&#125; &lt;/div&gt; );&#125;export default App;In order to remove the interval when the component unmounts (but also after every other render update), you can return a function in useEffect for anything to be called for the clean up. For instance, there shouldnâ€™t be any memory leak left behind when the component isnâ€™t there anymore.123456789101112131415import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); return () =&gt; clearInterval(interval); &#125;); ...&#125;export default App;Now, you want to setup the side-effect when mounting the component and the clean up the side-effect when unmounting the component. If you would log how many times the function within the effect is called, you would see that it sets a new interval every time the state of the component changes (e.g. click on â€œStartâ€/â€œStopâ€ button).12345678910111213141516import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; console.log(&apos;effect runs&apos;); const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); return () =&gt; clearInterval(interval); &#125;); ...&#125;export default App;In order to only run the effect on mount and unmount of the component, you can pass it an empty array as second argument.123456789101112131415import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); return () =&gt; clearInterval(interval); &#125;, []); ...&#125;export default App;However, since the interval is cleaned up after every render too, we need to set the interval in our update cycle too. But we can tell the effect to run only when the isOn variable changes. Only when one of the variables in the array changes, the effect will run during the update cycle. If you keep the array empty, the effect will only run on mount and unmount, because there is no variable to be checked for running the side-effect again.123456789101112131415import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); return () =&gt; clearInterval(interval); &#125;, [isOn]); ...&#125;export default App;The interval is running whether the isOn boolean is true or false. It would be great to only run it when the stopwatch is activated.12345678910111213141516171819import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); useEffect(() =&gt; &#123; let interval; if (isOn) &#123; interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000); &#125; return () =&gt; clearInterval(interval); &#125;, [isOn]); ...&#125;export default App;Now introduce another state in your function component to keep track of the timer of the stopwatch. It is used to update the timer, but only when the stopwatch is activated.123456789101112131415161718192021222324252627282930313233343536373839import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); const [timer, setTimer] = useState(0); useEffect(() =&gt; &#123; let interval; if (isOn) &#123; interval = setInterval( () =&gt; setTimer(timer + 1), 1000, ); &#125; return () =&gt; clearInterval(interval); &#125;, [isOn]); return ( &lt;div&gt; &#123;timer&#125; &#123;!isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt; Start &lt;/button&gt; )&#125; &#123;isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt; Stop &lt;/button&gt; )&#125; &lt;/div&gt; );&#125;export default App;There is still one mistake in the code. When the interval is running, it updates the timer every second by increasing it by one. However, it always relies on a stale state for the timer. Only when the inOn boolean flag changes the state is fine. In order to receive always the latest state for the timer when the interval is running, you can use a function instead for the state update function which always has the latest state.1234567891011121314151617181920212223import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); const [timer, setTimer] = useState(0); useEffect(() =&gt; &#123; let interval; if (isOn) &#123; interval = setInterval( () =&gt; setTimer(timer =&gt; timer + 1), 1000, ); &#125; return () =&gt; clearInterval(interval); &#125;, [isOn]); ...&#125;export default App;An alternative would have been to run the effect also when the timer changes. Then the effect would receive the latest timer state.1234567891011121314151617181920212223import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); const [timer, setTimer] = useState(0); useEffect(() =&gt; &#123; let interval; if (isOn) &#123; interval = setInterval( () =&gt; setTimer(timer + 1), 1000, ); &#125; return () =&gt; clearInterval(interval); &#125;, [isOn, timer]); ...&#125;export default App;Thatâ€™s the implementation for the stopwatch that uses the Browser API If you want to continue, you can extend the example by providing a â€œResetâ€ button too.123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOn, setIsOn] = useState(false); const [timer, setTimer] = useState(0); useEffect(() =&gt; &#123; let interval; if (isOn) &#123; interval = setInterval( () =&gt; setTimer(timer =&gt; timer + 1), 1000, ); &#125; return () =&gt; clearInterval(interval); &#125;, [isOn]); const onReset = () =&gt; &#123; setIsOn(false); setTimer(0); &#125;; return ( &lt;div&gt; &#123;timer&#125; &#123;!isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt; Start &lt;/button&gt; )&#125; &#123;isOn &amp;&amp; ( &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt; Stop &lt;/button&gt; )&#125; &lt;button type=&quot;button&quot; disabled=&#123;timer === 0&#125; onClick=&#123;onReset&#125;&gt; Reset &lt;/button&gt; &lt;/div&gt; );&#125;export default App;Thatâ€™s it. The useEffect hook is used for side-effects in React function components that are used for interacting with the Browser/DOM API or other third-party APIs (e.g. data fetching). You can read more about the useEffect hook in Reactâ€™s documentation.Last but not least, after you have learned about the two most popular hooks that introduce state and side-effects in function components, there is one last thing I want to show you: custom hooks. Thatâ€™s right, you can implement your own custom React Hooks that can be reused in your application or by others. Letâ€™s see how they work with an example application which is able to detect whether your device is online or offline.12345678910111213import React, &#123; useState &#125; from &apos;react&apos;;function App() &#123; const [isOffline, setIsOffline] = useState(false); if (isOffline) &#123; return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;; &#125; return &lt;div&gt;You are online!&lt;/div&gt;;&#125;export default App;Again, introduce the useEffect hook for the side-effect. In this case, the effect adds and removes listeners that check if the device is online or offline. Both listeners are setup only once on mount and cleaned up once on unmount (empty array as second argument). Whenever one of the listeners is called, it sets the state for the isOffline boolean.12345678910111213141516171819202122232425262728293031import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function App() &#123; const [isOffline, setIsOffline] = useState(false); function onOffline() &#123; setIsOffline(true); &#125; function onOnline() &#123; setIsOffline(false); &#125; useEffect(() =&gt; &#123; window.addEventListener(&apos;offline&apos;, onOffline); window.addEventListener(&apos;online&apos;, onOnline); return () =&gt; &#123; window.removeEventListener(&apos;offline&apos;, onOffline); window.removeEventListener(&apos;online&apos;, onOnline); &#125;; &#125;, []); if (isOffline) &#123; return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;; &#125; return &lt;div&gt;You are online!&lt;/div&gt;;&#125;export default App;Everything is nicely encapsulated in one effect now. Itâ€™s a great functionality which should be reuse somewhere else too. Thatâ€™s why we can extract the functionality as its a custom hook which follows the same naming convention as the other hooks.12345678910111213141516171819202122232425262728293031323334353637import React, &#123; useState, useEffect &#125; from &apos;react&apos;;function useOffline() &#123; const [isOffline, setIsOffline] = useState(false); function onOffline() &#123; setIsOffline(true); &#125; function onOnline() &#123; setIsOffline(false); &#125; useEffect(() =&gt; &#123; window.addEventListener(&apos;offline&apos;, onOffline); window.addEventListener(&apos;online&apos;, onOnline); return () =&gt; &#123; window.removeEventListener(&apos;offline&apos;, onOffline); window.removeEventListener(&apos;online&apos;, onOnline); &#125;; &#125;, []); return isOffline;&#125;function App() &#123; const isOffline = useOffline(); if (isOffline) &#123; return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;; &#125; return &lt;div&gt;You are online!&lt;/div&gt;;&#125;export default App;Extracting the custom hook as function was not the only thing. You also have to return the isOffline state from the custom hook in order to use it in your application to show a message to users who are offline. Otherwise, it should render the normal application. Thatâ€™s it for the custom hook that detects whether you are online or offline. You can read more about custom hooks in Reactâ€™s documentation.React Hooks being reusable is the best thing about them, because there is the potential to grow an ecosystem of custom React Hooks that can be installed from npm for any React application. And not only for React applications. Evan You, creator of Vue, is hooked (!) by them as well. Maybe we will see a bridge between both ecosystems where it is possible to share hooks between Vue and React.If you want to dive deeper into the state and effect hooks, you can check out the following React hook tutorials:How to useReducer Hook?Migration from Class Components to HooksComparison useState vs useReducerModern State Management with HooksHow to fetch data with React HooksCheckout the official FAQ and Rules for hooks in Reactâ€™s documentation to learn more about their fine-grained behaviour. In addition, you can checkout all officially available React Hooks too.For everyone who is still concerned about React Hooks: Give them a shot yourself. Implement a couple of React function components with state and side-effects. I had to do it myself to understand how they work and to feel comfortable with them. And I must say it feels pretty great to use them.The Road to learn ReactBuild a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like 50.000+ readers.Get the Book for freeNever miss an article about web development, JavaScript and self-growth.Take PartJoin 30.000+ DevelopersLearn Web Development with JavaScriptTips and TricksAccess Tutorials, eBooks and CoursesPersonal Development as a Software Engineer]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
        <category>React Hooks</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>React Hooks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯ç›¸å…³æ–‡ç« æ”¶è—]]></title>
    <url>%2Farchives%2Ff37d.html</url>
    <content type="text"><![CDATA[å‰ç«¯æ¶æ„æ”¯ä»˜å®å‰ç«¯åº”ç”¨æ¶æ„çš„å‘å±•å’Œé€‰æ‹©]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>æ–‡ç« æ”¶è—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœåŠ¡å™¨é‡ç½®å¯†ç ]]></title>
    <url>%2Farchives%2Ffe92.html</url>
    <content type="text"><![CDATA[æœ‰æ—¶å€™ä¼šå¿˜è®°æœåŠ¡å™¨å¯†ç ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®˜ç½‘é¢æ¿ç­‰æ–¹å¼è¿ä¸Šæ—¶ï¼Œå¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹rootå¯†ç ï¼šæ•´æ®µèµ‹å€¼ä¸‹é¢çš„å‘½ä»¤ï¼ˆâ€æ–°å¯†ç â€å¤„ æ›¿æ¢ä¸ºè¦ä¿®æ”¹çš„å¯†ç ï¼‰ï¼š1234echo root:æ–°å¯†ç  |sudo chpasswd rootsudo sed -i &apos;s/^.*PermitRootLogin.*/PermitRootLogin yes/g&apos; /etc/ssh/sshd_config;sudo sed -i &apos;s/^.*PasswordAuthentication.*/PasswordAuthentication yes/g&apos; /etc/ssh/sshd_config;sudo rebooté‡å¯åç”¨rootè´¦æˆ·ç™»å½•å³å¯ã€‚]]></content>
      <categories>
        <category>æœåŠ¡å™¨</category>
      </categories>
      <tags>
        <tag>æœåŠ¡å™¨</tag>
        <tag>Linux</tag>
        <tag>é‡ç½®å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§£å¯†ä¼ ç»Ÿç»„ä»¶é—´é€šä¿¡ä¸Reactç»„ä»¶é—´é€šä¿¡]]></title>
    <url>%2Farchives%2Fac71.html</url>
    <content type="text"><![CDATA[åœ¨Reactä¸­æœ€å°çš„é€»è¾‘å•å…ƒæ˜¯ç»„ä»¶ï¼Œç»„ä»¶ä¹‹é—´å¦‚æœæœ‰è€¦åˆå…³ç³»å°±ä¼šè¿›è¡Œé€šä¿¡ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç»Reactä¸­çš„ç»„ä»¶é€šä¿¡çš„ä¸åŒæ–¹å¼é€šè¿‡å½’çº³èŒƒï¼Œå¯ä»¥å°†ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡å½’ç±»ä¸ºå››ç§ç±»å‹çš„ç»„ä»¶é—´é€šä¿¡ï¼Œåˆ†åˆ«æ˜¯çˆ¶å­ç»„ä»¶ï¼Œçˆ·å­™ç»„ä»¶ï¼Œå…„å¼Ÿç»„ä»¶å’Œä»»æ„ç»„ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å‰ä¸‰ä¸ªä¹Ÿå¯ä»¥ç®—ä½œä»»æ„ç»„ä»¶çš„èŒƒç•´ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªæ˜¯ä¸‡èƒ½æ–¹æ³•çˆ¶å­ç»„ä»¶çˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡åˆ†ä¸ºçˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡å’Œå­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢å…ˆæ¥ä»‹ç»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡ï¼Œä¼ ç»Ÿåšæ³•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯åˆå§‹åŒ–æ—¶çš„å‚æ•°ä¼ é€’å’Œå®ä¾‹é˜¶æ®µçš„æ–¹æ³•è°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹12345678910111213141516171819202122232425262728class Child &#123; constructor(name) &#123; // è·å–domå¼•ç”¨ this.$div = document.querySelector('#wp'); // åˆå§‹åŒ–æ—¶ä¼ å…¥name this.updateName(name); &#125; updateName(name) &#123; // å¯¹å¤–æä¾›æ›´æ–°çš„api this.name = name; // æ›´æ–°dom this.$div.innerHTML = name; &#125;&#125;class Parent &#123; constructor() &#123; // åˆå§‹åŒ–é˜¶æ®µ this.child = new Child('yan'); setTimeout(() =&gt; &#123; // å®ä¾‹åŒ–é˜¶æ®µ this.child.updateName('hou'); &#125;, 2000); &#125;&#125;åœ¨Reactä¸­å°†ä¸¤ä¸ªæƒ…å†µç»Ÿä¸€å¤„ç†ï¼Œå…¨éƒ¨é€šè¿‡å±æ€§æ¥å®Œæˆï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿™æ ·æ˜¯å› ä¸ºReactåœ¨å±æ€§æ›´æ–°æ—¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ2ç§’åå­ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œå¹¶è·å–æ–°çš„å±æ€§å€¼1234567891011121314151617181920class Child extends Component &#123; render() &#123; return &lt;div&gt;&#123;this.props.name&#125;&lt;/div&gt; &#125;&#125;class Parent extends Component &#123; constructor() &#123; // åˆå§‹åŒ–é˜¶æ®µ this.state = &#123;name: 'yan'&#125;; setTimeout(() =&gt; &#123; // å®ä¾‹åŒ–é˜¶æ®µ this.setState(&#123;name: 'hou'&#125;) &#125;, 2000); &#125; render() &#123; return &lt;Child name=&#123;this.state.name&#125; /&gt; &#125;&#125;ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å­ç»„ä»¶å¦‚ä½•å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼Œä¼ ç»Ÿåšæ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å›è°ƒå‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ä¸ºå­ç»„ä»¶éƒ¨ç½²æ¶ˆæ¯æ¥å£å…ˆæ¥çœ‹å›è°ƒå‡½æ•°çš„ä¾‹å­ï¼Œå›è°ƒå‡½æ•°çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç¼ºç‚¹å°±æ˜¯å¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥ï¼Œå¹¶ä¸”ä¸å¯æ’¤å›ï¼Œå¹¶ä¸”åªèƒ½ä¼ å…¥ä¸€ä¸ªå‡½æ•°123456789101112131415class Child &#123; constructor(cb) &#123; // è°ƒç”¨çˆ¶ç»„ä»¶ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œå‘é€æ¶ˆæ¯ setTimeout(() =&gt; &#123; cb() &#125;, 2000); &#125;&#125;class Parent &#123; constructor() &#123; // åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•° this.child = new Child(function () &#123; console.log('child update') &#125;); &#125;&#125;ä¸‹é¢æ¥çœ‹çœ‹æ¶ˆæ¯æ¥å£æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªå¯ä»¥å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯çš„åŸºç±»ï¼Œæ¯”å¦‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªç®€å•çš„EventEimtterï¼Œå®é™…ç”Ÿäº§ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«äººå†™å¥½çš„ç±»åº“ï¼Œæ¯”å¦‚@jsmini/eventï¼Œå­ç»„ä»¶ç»§æ‰¿æ¶ˆæ¯åŸºç±»ï¼Œå°±æœ‰äº†å‘å¸ƒæ¶ˆæ¯çš„èƒ½åŠ›ï¼Œç„¶åçˆ¶ç»„ä»¶è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯ï¼Œå³å¯å®ç°å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡çš„åŠŸèƒ½æ¶ˆæ¯æ¥å£çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥éšå¤„è®¢é˜…ï¼Œå¹¶ä¸”å¯ä»¥å¤šæ¬¡è®¢é˜…ï¼Œè¿˜å¯ä»¥å–æ¶ˆè®¢é˜…ï¼Œç¼ºç‚¹æ˜¯ç•¥æ˜¾éº»çƒ¦ï¼Œéœ€è¦å¼•å…¥æ¶ˆæ¯åŸºç±»123456789101112131415161718192021222324252627282930313233// æ¶ˆæ¯æ¥å£ï¼Œè®¢é˜…å‘å¸ƒæ¨¡å¼ï¼Œç±»ä¼¼ç»‘å®šäº‹ä»¶ï¼Œè§¦å‘äº‹ä»¶class EventEimtter &#123; constructor() &#123; this.eventMap = &#123;&#125;; &#125; sub(name, cb) &#123; const eventList = this.eventMap[name] = this.eventMap[name] || &#123;&#125;; eventList.push(cb); &#125; pub(name, ...data) &#123; (this.eventMap[name] || []).forEach(cb =&gt; cb(...data)); &#125;&#125;class Child extends EventEimtter &#123; constructor() &#123; super(); // é€šè¿‡æ¶ˆæ¯æ¥å£å‘å¸ƒæ¶ˆæ¯ setTimeout(() =&gt; &#123; this.pub('update') &#125;, 2000); &#125;&#125;class Parent &#123; constructor() &#123; // åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•° this.child = new Child(); // è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯ this.child.sub('update', function () &#123; console.log('child update') &#125;); &#125;&#125;Backbone.jså°±åŒæ—¶æ”¯æŒå›è°ƒå‡½æ•°å’Œæ¶ˆæ¯æ¥å£æ–¹å¼ï¼Œä½†Reactä¸­é€‰æ‹©äº†æ¯”è¾ƒç®€å•çš„å›è°ƒå‡½æ•°æ¨¡å¼ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹Reactçš„ä¾‹å­1234567891011121314class Child extends Component &#123; constructor(props) &#123; setTimeout(() =&gt; &#123; this.props.cb() &#125;, 2000); &#125; render() &#123; return &lt;div&gt;&lt;/div&gt; &#125;&#125;class Parent extends Component &#123; render() &#123; return &lt;Child cb=&#123;() =&gt; &#123;console.log('update')&#125;&#125; /&gt; &#125;&#125;çˆ·å­™ç»„ä»¶çˆ¶å­ç»„ä»¶å…¶å®å¯ä»¥ç®—æ˜¯çˆ·å­™ç»„ä»¶çš„ä¸€ç§ç‰¹ä¾‹ï¼Œè¿™é‡Œçš„çˆ·å­™ç»„ä»¶ä¸å…‰æŒ‡çˆ·çˆ·å’Œå­™å­ï¼Œè€Œæ˜¯æ³›æŒ‡ç¥–å…ˆä¸åä»£ç»„ä»¶é€šä¿¡ï¼Œå¯èƒ½éš”ç€å¾ˆå¤šå±‚çº§ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº†çˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜ï¼Œæ ¹æ®åŒ–å½’æ³•ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºçˆ·å­™ç»„ä»¶çš„ç­”æ¡ˆï¼Œé‚£å°±æ˜¯å±‚å±‚ä¼ é€’å±æ€§ä¹ˆï¼ŒæŠŠçˆ·å­™ç»„ä»¶é€šä¿¡åˆ†è§£ä¸ºå¤šä¸ªçˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜å±‚å±‚ä¼ é€’çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç”¨å·²æœ‰çŸ¥è¯†å°±èƒ½è§£å†³ï¼Œé—®é¢˜æ˜¯ä¼šæµªè´¹å¾ˆå¤šä»£ç ï¼Œéå¸¸ç¹çï¼Œä¸­é—´ä½œä¸ºæ¡¥æ¢çš„ç»„ä»¶ä¼šå¼•å…¥å¾ˆå¤šä¸å±äºè‡ªå·±çš„å±æ€§åœ¨Reactä¸­ï¼Œé€šè¿‡contextå¯ä»¥è®©ç¥–å…ˆç»„ä»¶ç›´æ¥æŠŠå±æ€§ä¼ é€’åˆ°åä»£ç»„ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼æ˜Ÿé™…æ—…è¡Œä¸­çš„è™«æ´ä¸€æ ·ï¼Œé€šè¿‡contextè¿™ä¸ªç‰¹æ®Šçš„æ¡¥æ¢ï¼Œå¯ä»¥è·¨è¶Šä»»æ„å±‚æ¬¡å‘åä»£ç»„ä»¶ä¼ é€’æ¶ˆæ¯æ€ä¹ˆåœ¨éœ€è¦é€šä¿¡çš„ç»„ä»¶ä¹‹é—´å¼€å¯è¿™ä¸ªè™«æ´å‘¢ï¼Ÿéœ€è¦åŒå‘å£°æ˜ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¥–å…ˆç»„ä»¶å£°æ˜å±æ€§ï¼Œå¹¶åœ¨åä»£ç»„ä»¶ä¸Šå†æ¬¡å£°æ˜å±æ€§ï¼Œç„¶ååœ¨ç¥–å…ˆç»„ä»¶ä¸Šæ”¾ä¸Šå±æ€§å°±å¯ä»¥äº†ï¼Œå°±å¯ä»¥åœ¨åä»£ç»„ä»¶è¯»å–å±æ€§äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­123456789101112131415161718192021222324import PropTypes from 'prop-types';class Child extends Component &#123; // åä»£ç»„ä»¶å£°æ˜éœ€è¦è¯»å–contextä¸Šçš„æ•°æ® static contextTypes = &#123; text: PropTypes.string &#125; render() &#123; // é€šè¿‡this.context è¯»å–contextä¸Šçš„æ•°æ® return &lt;div&gt;&#123;this.context.text&#125;&lt;/div&gt; &#125;&#125;class Ancestor extends Component &#123; // ç¥–å…ˆç»„ä»¶å£°æ˜éœ€è¦æ”¾å…¥contextä¸Šçš„æ•°æ® static childContextTypes = &#123; text: PropTypes.string &#125; // ç¥–å…ˆç»„ä»¶å¾€contextæ”¾å…¥æ•°æ® getChildContext() &#123; return &#123;text: 'yanhaijing'&#125; &#125;&#125;contextçš„ä¼˜ç‚¹æ˜¯å¯ä»¥çœå»å±‚å±‚ä¼ é€’çš„éº»çƒ¦ï¼Œå¹¶ä¸”é€šè¿‡åŒå‘å£°æ˜æ§åˆ¶äº†æ•°æ®çš„å¯è§æ€§ï¼Œå¯¹äºå±‚æ•°å¾ˆå¤šæ—¶ï¼Œä¸å¤±ä¸ºä¸€ç§æ–¹æ¡ˆï¼›ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±åƒå…¨å±€å˜é‡ä¸€æ ·ï¼Œå¦‚æœä¸åŠ èŠ‚åˆ¶å¾ˆå®¹æ˜“é€ æˆæ··ä¹±ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å‡ºç°é‡åè¦†ç›–çš„é—®é¢˜ä¸ªäººçš„å»ºè®®æ˜¯å¯¹ä¸€äº›æ‰€æœ‰ç»„ä»¶å…±äº«çš„åªè¯»ä¿¡æ¯å¯ä»¥é‡‡ç”¨contextæ¥ä¼ é€’ï¼Œæ¯”å¦‚ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ç­‰å°è´´å£«ï¼šReact Routerè·¯ç”±å°±æ˜¯é€šè¿‡contextæ¥ä¼ é€’è·¯ç”±å±æ€§çš„å…„å¼Ÿç»„ä»¶å¦‚æœä¸¤ä¸ªç»„ä»¶æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä½œä¸ºæ¡¥æ¢ï¼Œæ¥è®©ä¸¤ä¸ªç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œè¿™å…¶å®å°±æ˜¯ä¸»æ¨¡å—æ¨¡å¼ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªå­ç»„ä»¶é€šè¿‡çˆ¶ç»„ä»¶æ¥å®ç°æ˜¾ç¤ºæ•°å­—åŒæ­¥çš„åŠŸèƒ½123456789101112131415class Parent extends Component &#123; constructor() &#123; this.onChange = function (num) &#123; this.setState(&#123;num&#125;) &#125;.bind(this); &#125; render() &#123; return ( &lt;div&gt; &lt;Child1 num=&#123;this.state.num&#125; onChange=&#123;this.onChange&#125;&gt; &lt;Child2 num=&#123;this.state.num&#125; onChange=&#123;this.onChange&#125;&gt; &lt;/div&gt; ); &#125;&#125;ä¸»æ¨¡å—æ¨¡å¼çš„ä¼˜ç‚¹å°±æ˜¯è§£è€¦ï¼ŒæŠŠä¸¤ä¸ªå­ç»„ä»¶ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œè§£è€¦æˆå­ç»„ä»¶å’Œçˆ¶ç»„ä»¶ä¹‹é—´çš„è€¦åˆï¼ŒæŠŠåˆ†æ•£çš„ä¸œè¥¿æ”¶é›†åœ¨ä¸€èµ·å¥½å¤„éå¸¸æ˜æ˜¾ï¼Œèƒ½å¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ä»»æ„ç»„ä»¶ä»»æ„ç»„ä»¶åŒ…æ‹¬ä¸Šé¢çš„ä¸‰ç§å…³ç³»ç»„ä»¶ï¼Œä¸Šé¢ä¸‰ç§å…³ç³»åº”è¯¥ä¼˜å…ˆä½¿ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ï¼Œå¯¹äºä»»æ„çš„ä¸¤ä¸ªç»„ä»¶é—´é€šä¿¡ï¼Œæ€»å…±æœ‰ä¸‰ç§åŠæ³•ï¼Œåˆ†åˆ«æ˜¯å…±åŒç¥–å…ˆæ³•ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å’ŒçŠ¶æ€ç®¡ç†åŸºäºæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„çˆ·å­™ç»„ä»¶å’Œå…„å¼Ÿç»„ä»¶ï¼Œåªè¦æ‰¾åˆ°ä¸¤ä¸ªç»„ä»¶çš„å…±åŒç¥–å…ˆï¼Œå°±å¯ä»¥å°†ä»»æ„ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼Œè½¬åŒ–ä¸ºä»»æ„ç»„ä»¶å’Œå…±åŒç¥–å…ˆä¹‹é—´çš„é€šä¿¡ï¼Œè¿™ä¸ªæ–¹æ³•çš„å¥½å¤„å°±æ˜¯éå¸¸ç®€å•ï¼Œå·²çŸ¥çŸ¥è¯†å°±èƒ½æå®šï¼Œç¼ºç‚¹å°±æ˜¯ä¸Šé¢ä¸¤ç§æ¨¡å¼ç¼ºç‚¹çš„å åŠ ï¼Œé™¤äº†ä¸´æ—¶æ–¹æ¡ˆï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ³•å¦ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå°±æ˜¯å¼•å…¥ä¸€ä¸ªå…¨å±€æ¶ˆæ¯å·¥å…·ï¼Œä¸¤ä¸ªç»„ä»¶é€šè¿‡è¿™ä¸ªå…¨å±€å·¥å…·è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·ä¸¤ä¸ªç»„ä»¶é—´çš„é€šä¿¡ï¼Œå°±é€šè¿‡å…¨å±€æ¶ˆæ¯åª’ä»‹å®Œæˆäº†è¿˜è®°å¾—ä¸Šé¢ä»‹ç»çš„æ¶ˆæ¯åŸºç±»å—ï¼Ÿä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç»„ä»¶1å’Œç»„ä»¶2é€šè¿‡å…¨å±€eventè¿›è¡Œé€šä¿¡12345678910111213141516171819202122232425262728293031class EventEimtter &#123; constructor() &#123; this.eventMap = &#123;&#125;; &#125; sub(name, cb) &#123; const eventList = this.eventMap[name] = this.eventMap[name] || &#123;&#125;; eventList.push(cb); &#125; pub(name, ...data) &#123; (this.eventMap[name] || []).forEach(cb =&gt; cb(...data)); &#125;&#125;// å…¨å±€æ¶ˆæ¯å·¥å…·const event = new EventEimtter;// ä¸€ä¸ªç»„ä»¶class Element1 extends Component &#123; constructor() &#123; // è®¢é˜…æ¶ˆæ¯ event.sub('element2update', () =&gt; &#123;console.log('element2 update')&#125;); &#125;&#125;// å¦ä¸€ä¸ªç»„ä»¶ã€‚class Element2 extends Component &#123; constructor() &#123; // å‘å¸ƒæ¶ˆæ¯ setTimeout(function () &#123; event.pub('element2update') &#125;, 2000) &#125;&#125;æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¨¡å¼éå¸¸ç®€å•ï¼Œåˆ©ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå°†ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„è€¦åˆè§£è€¦æˆäº†ç»„ä»¶å’Œæ¶ˆæ¯ä¸­å¿ƒ+æ¶ˆæ¯åç§°çš„è€¦åˆï¼Œä½†ä¸ºäº†è§£è€¦å´å¼•å…¥å…¨å±€æ¶ˆæ¯ä¸­å¿ƒå’Œæ¶ˆæ¯åç§°ï¼Œæ¶ˆæ¯ä¸­å¿ƒå¯¹ç»„ä»¶çš„ä¾µå…¥æ€§å¾ˆå¼ºï¼Œå’Œç¬¬ä¸‰æ–¹ç»„ä»¶é€šä¿¡ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼å°å‹é¡¹ç›®æ¯”è¾ƒé€‚åˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½†éšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œè¾¾åˆ°ä¸­ç­‰é¡¹ç›®ä»¥åï¼Œæ¶ˆæ¯åå­—çˆ†ç‚¸å¼å¢é•¿ï¼Œæ¶ˆæ¯åå­—çš„ç»´æŠ¤æˆäº†æ£˜æ‰‹çš„é—®é¢˜ï¼Œé‡åæ¦‚ç‡æå¤§ï¼Œæ²¡æœ‰äººæ•¢éšä¾¿åˆ é™¤æ¶ˆæ¯ä¿¡æ¯ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…æ‰¾ä¸åˆ°æ¶ˆæ¯è®¢é˜…è€…çš„ä¿¡æ¯ç­‰å…¶å®ä¸Šé¢çš„é—®é¢˜ä¹Ÿä¸æ˜¯æ²¡æœ‰è§£å†³åŠæ³•ï¼Œé‡åçš„é—®é¢˜å¯ä»¥é€šè¿‡åˆ¶å®šè§„èŒƒï¼Œæ¶ˆæ¯å‘½åç©ºé—´ç­‰æ–¹å¼æ¥æå¤§é™ä½å†²çªï¼Œå…¶ä»–é—®é¢˜å¯ä»¥é€šè¿‡æŠŠæ¶ˆæ¯åå­—ç»Ÿä¸€ç»´æŠ¤åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡å¯¹æ¶ˆæ¯çš„ä¸­å¿ƒåŒ–ç®¡ç†ï¼Œå¯ä»¥è®©å¾ˆå¤šé—®é¢˜éƒ½å¾ˆå®¹æ˜“è§£å†³å¦‚æœä½ çš„é¡¹ç›®éå¸¸å¤§ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ¡ˆéƒ½ä¸åˆé€‚ï¼Œé‚£ä½ å¯èƒ½éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œé€šè¿‡çŠ¶æ€ç®¡ç†å·¥å…·æŠŠç»„ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œå’Œå…³ç³»çš„å¤„ç†é€»è¾‘ä»ç»„å»ºä¸­æŠ½è±¡å‡ºæ¥ï¼Œå¹¶é›†ä¸­åŒ–åˆ°ç»Ÿä¸€çš„åœ°æ–¹æ¥å¤„ç†ï¼ŒReduxå°±æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„çŠ¶æ€ç®¡ç†å·¥å…·é™¤äº†Reduxï¼Œè¿˜æœ‰Mobxï¼ŒRematchï¼Œreselectç­‰å·¥å…·ï¼Œæœ¬æ–‡ä¸å±•å¼€ä»‹ç»ï¼Œæœ‰æœºä¼šåé¢å•ç‹¬æˆæ–‡ï¼Œè¿™äº›éƒ½æ˜¯ç”¨æ¥è§£å†³ä¸åŒé—®é¢˜çš„ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„å·¥å…·å°±å¥½äº†æ€»ç»“ç»„ä»¶é—´çš„å…³ç³»åƒå˜ä¸‡åŒ–ï¼Œéƒ½å¯ä»¥ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•è§£å†³ï¼Œå¯¹äºä¸åŒè§„æ¨¡çš„é¡¹ç›®ï¼Œåº”è¯¥é€‰æ‹©é€‚åˆè‡ªå·±çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸Šé¢ä»‹ç»çš„ä¸åŒæ–¹å¼è§£è€¦çš„ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…³äºä¸åŒè€¦åˆå…³ç³»çš„å¥½åï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€Šå›¾è§£7ç§è€¦åˆå…³ç³»ã€‹]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å›¾è§£7ç§è€¦åˆå…³ç³»]]></title>
    <url>%2Farchives%2F7e29.html</url>
    <content type="text"><![CDATA[æ·±å…¥è®²è®²æ¨¡å—ä¹‹é—´çš„è€¦åˆå…³ç³»è¿™ä¸ªäº‹æƒ…ã€‚æœ¬æ–‡å°†ç”¨å›¾æ–‡è¯¦ç»†è®²è§£ä¸ƒç§è€¦åˆçš„ä¸åŒä¹‹å¤„ã€‚é«˜å†…èšä¸ä½è€¦åˆé«˜å†…èšä¸ä½è€¦åˆæ˜¯æ¯ä¸ªè½¯ä»¶å¼€å‘è€…è¿½æ±‚çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå†…èšå’Œè€¦åˆåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå†…èšæ˜¯ä»åŠŸèƒ½è§’åº¦æ¥åº¦é‡æ¨¡å—å†…çš„è”ç³»ï¼Œä¸€ä¸ªå¥½çš„å†…èšæ¨¡å—åº”å½“æ°å¥½åšä¸€ä»¶äº‹ã€‚å®ƒæè¿°çš„æ˜¯æ¨¡å—å†…çš„åŠŸèƒ½è”ç³»ã€‚è€¦åˆæ˜¯è½¯ä»¶ç»“æ„ä¸­å„æ¨¡å—ä¹‹é—´ç›¸äº’è¿æ¥çš„ä¸€ç§åº¦é‡ï¼Œè€¦åˆå¼ºå¼±å–å†³äºæ¨¡å—é—´æ¥å£çš„å¤æ‚ç¨‹åº¦ã€è¿›å…¥æˆ–è®¿é—®ä¸€ä¸ªæ¨¡å—çš„ç‚¹ä»¥åŠé€šè¿‡æ¥å£çš„æ•°æ®ã€‚è€¦åˆä¸åŒæ¨¡å—ä¹‹é—´çš„å…³ç³»å°±æ˜¯è€¦åˆï¼Œæ ¹æ®è€¦åˆç¨‹åº¦å¯ä»¥åˆ†ä¸º7ç§ï¼Œè€¦åˆåº¦ä¾æ¬¡å˜ä½ã€‚å†…å®¹è€¦åˆå…¬å…±è€¦åˆå¤–éƒ¨è€¦åˆæ§åˆ¶è€¦åˆæ ‡è®°è€¦åˆæ•°æ®è€¦åˆéç›´æ¥è€¦åˆä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´æ¯ç§è€¦åˆæ˜¯ä»€ä¹ˆï¼Œå¼€å§‹ä¹‹å‰å…ˆæ¥è¯´ä¸‹è¦å®ç°çš„åŠŸèƒ½ã€‚m1å’Œm2æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå…¶ä¸­m2ç§ä¼šæ˜¾ç¤ºm1çš„è¾“å…¥ï¼Œm1ä¼šæ˜¾ç¤ºm2çš„è¾“å…¥ã€‚å¾ˆæ˜¾ç„¶ï¼Œm1å’Œm2ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¼šæœ‰ä¸€äº›è”ç³»ï¼ˆè€¦åˆï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥æƒ³æƒ³å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¸‹é¢ç”¨7ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚æ³¨ï¼šé¡¹ç›®çš„ä»£ç æˆ‘æ”¾åˆ°äº†githubï¼Œé¡¹ç›®çš„demoï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ã€‚å†…å®¹è€¦åˆå†…å®¹è€¦åˆæ˜¯æœ€ç´§çš„è€¦åˆç¨‹åº¦ï¼Œä¸€ä¸ªæ¨¡å—ç›´æ¥è®¿é—®å¦ä¸€æ¨¡å—çš„å†…å®¹ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªæ¨¡å—ä¸ºå†…å®¹è€¦åˆã€‚ä¸ºäº†å®ç°åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†m1çš„è¾“å…¥æ”¾åˆ°m2.m1inputä¸Šï¼Œå°†m2çš„è¾“å…¥æ”¾åˆ°m1.m2inputä¸Šã€‚// m1.js root.m2.m1input = this.value; m2.update(); // m2.js root.m1.m2input = this.value; m1.update(); PS:ä¸çŸ¥é“è°ä¼šè¿™ä¹ˆå†™ä»£ç ï¼Œé™¤äº†æˆ‘ä¸ºäº†åšæ¼”ç¤ºä¹‹å¤–ã€‚ã€‚ã€‚æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚å…¬å…±è€¦åˆä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€ä¸ªå…¨å±€æ•°æ®ç»“æ„ï¼Œåˆ™ç§°ä¹‹ä¸ºå…¬å…±è€¦åˆã€‚åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€çš„dataä¸Šã€‚// m1.js root.data.m1input = this.value; m2.update(); // m2.js root.data.m2input = this.value; m1.update(); æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚å¤–éƒ¨è€¦åˆä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€å…¨å±€ç®€å•å˜é‡ï¼Œè€Œä¸”ä¸é€šè¿‡å‚æ•°è¡¨ä¼ é€’è¯¥å…¨å±€å˜é‡çš„ä¿¡æ¯ï¼Œåˆ™ç§°ä¹‹ä¸ºå¤–éƒ¨è€¦åˆã€‚å¤–éƒ¨è€¦åˆå’Œå…¬å…±è€¦åˆå¾ˆåƒï¼ŒåŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯ç®€å•å˜é‡ï¼Œä¸€ä¸ªæ˜¯å¤æ‚æ•°æ®ç»“æ„ã€‚åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2éƒ½å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€ä¸Šã€‚// m1.js root.m1input = this.value; m2.update(); // m2.js root.m2input = this.value; m1.update(); æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚æ§åˆ¶è€¦åˆæ¨¡å—ä¹‹é—´ä¼ é€’çš„ä¸æ˜¯æ•°æ®ä¿¡æ¯ï¼Œè€Œæ˜¯æ§åˆ¶ä¿¡æ¯ä¾‹å¦‚æ ‡å¿—ã€å¼€å…³é‡ç­‰ï¼Œä¸€ä¸ªæ¨¡å—æ§åˆ¶äº†å¦ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚ä»æ§åˆ¶è€¦åˆå¼€å§‹ï¼Œæ¨¡å—çš„æ•°æ®å°±æ”¾åœ¨è‡ªå·±å†…éƒ¨äº†ï¼Œä¸åŒæ¨¡å—ä¹‹é—´é€šè¿‡æ¥å£äº’ç›¸è°ƒç”¨ã€‚åœ¨è¿™ä¸ªcaseä¸­ï¼Œå¾—å¢åŠ ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯å½“m1çš„è¾“å…¥ä¸ºç©ºæ—¶ï¼Œéšè—m2çš„æ˜¾ç¤ºä¿¡æ¯ã€‚// m1.js root.m1input = this.value; m2.update(); m2.toggle(!!this.value); // ä¼ é€’flag ä¸Šé¢çš„ä»£ç ä¸­m1ç›´æ¥æ§åˆ¶äº†m2çš„æ˜¾ç¤ºå’Œéšè—ã€‚æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚æ ‡è®°è€¦åˆè°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´ä¼ é€’æ•°æ®ç»“æ„è€Œä¸æ˜¯ç®€å•æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿç§°ä½œç‰¹å¾è€¦åˆã€‚åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚// m1.js me.m1input = this.value; m2.update(me); // ä¼ é€’å¼•ç”¨ // m2.js me.m2input = this.value; m1.update(me); æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚æ•°æ®è€¦åˆè°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´åªä¼ é€’ç®€å•çš„æ•°æ®é¡¹å‚æ•°ã€‚ç›¸å½“äºé«˜çº§è¯­è¨€ä¸­çš„å€¼ä¼ é€’ã€‚åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªç®€å•æ•°æ®ç»“æ„ã€‚// m1.js me.m1input = this.value; m2.update(me.m1input); // ä¼ é€’å€¼ // m2.js me.m2input = this.value; m1.update(me.m2input); æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚éç›´æ¥è€¦åˆä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å®Œå…¨æ˜¯é€šè¿‡ä¸»æ¨¡å—çš„æ§åˆ¶å’Œè°ƒç”¨æ¥å®ç°çš„ã€‚è€¦åˆåº¦æœ€å¼±ï¼Œæ¨¡å—ç‹¬ç«‹æ€§æœ€å¼ºã€‚å­æ¨¡å—æ— éœ€çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå­æ¨¡å—ä¹‹é—´çš„è”ç³»ï¼Œå…¨éƒ¨å˜æˆå­æ¨¡å—å’Œä¸»æ¨¡å—ä¹‹é—´çš„è”ç³»ã€‚åœ¨è¿™ä¸ªcaseç§ï¼Œå¢åŠ ä¸€ä¸ªindex.jsä½œä¸ºä¸»æ¨¡å—ã€‚// index.js var m1 = root.m1; var m2 = root.m2; m1.init(function (str) { m2.update(str); }); m2.init(function (str) { m1.update(str); }); // m1.js me.m1input = this.value; inputcb(me.m1input); // inputcbæ˜¯å›è°ƒå‡½æ•° // m2.js me.m2input = this.value; inputcb(me.m2input); æŸ¥çœ‹å®Œæ•´ä»£ç å’Œdemoã€‚å†…èšå…¶å®å…³äºå†…èšä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±ç ”ç©¶ç ”ç©¶ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†æ¥åˆ†äº«å†…èšçš„é—®é¢˜ã€‚å¶ç„¶å†…èšé€»è¾‘å†…èšæ—¶é—´å†…èšé€šä¿¡å†…èšé¡ºåºå†…èšåŠŸèƒ½å†…èšæ€»ç»“å¸Œæœ›ä½ çœ‹å®Œä¸Šé¢çš„æ–‡ç« ï¼Œææ‡‚äº†è€¦åˆçš„ç§ç±»ï¼Œä¹Ÿå¸Œæœ›ä½ ä»¥åèƒ½ä½¿ç”¨éç›´æ¥è€¦åˆè¿™ç§æ–¹å¼æ¥å†™ä»£ç ï¼Œç¥å¥½ã€‚]]></content>
      <categories>
        <category>æ¨¡å—åŒ–</category>
      </categories>
      <tags>
        <tag>æ¨¡å—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¸¡æ±¤]]></title>
    <url>%2Farchives%2F201.html</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç¯‡æœ‰å¯†ç çš„åšå®¢ c412f6b8aabc1c782cd41fa8b902a21d1796600928ce6b1c3a25b75f6a07ca6274c08a7f4c7697e988225692db0b452481c5b7af64963fe9c5d94782d809d1b1c732e74c0d68733bb0eb8c4b1311c36c233ad644b52e782ae7c0600e10ce00671e688c63b7774cecb3e8a45362bad7e628dd987a2c8927837b0f2045a957cc076a794fec723880484e383efc26009b7812ccb20bc3062723d4f162a9b5fbca4e21e7641848846a466936572ff43b183049a3535504c165496d9574ecb755ed9660526af58298222b1452dc28264b7568eafa606ecfb16bc584a3ec17e2634649110bc8ad92e743043071ea837876b0b7f0c8070048f97620541b0c595a28ba24e7bcc6d1148d104a04f787f430aac0390885fd9aaa169614b486b5c51e5b4fe7ae2800458c665ac5573747da1acd61c1be75de9ed9e2e992b725ceb6f5854be7c68a6fe0b0bd30a13e120a57ebec88fa4e7f0668c8230ba3e32a4a2cab380861a5cfd504c9160546a15163dad9ad1bb3620504e0e1c1e03eb117e70db50432ba327c3a821bbc50a1e20de3f959d5ed4e02d1d48fc03489986b2353df715456a063327601e640e4903cb8c94985e9d65773a023b8aedfd2f9cd952df50f5ba231c37c82a109bc446f693cb4ebe46222d4aea2f89114a35d80101e90ff1cb2d7c1ab253d6e6e2a5dec9d88c79752815cfea20c7a95512357d7b2dee73fab83d5a90395dd66c97d14ca470144221dd3ccb0e981c71f096dd5a82d98dcdc1c0d9bbe5059ea4b91512aa3d26a719ed39044800fe85a6d5544c92fa3a7e213d16fbe31e35b8f94f028bd2510185b058206578a195266c5db504755e5b4371fba90d058fb4edfd7479353e7cb0c285497b590d7ac37ec9788a96e625f58b01bd00b0e392de3147c7cf91110a093fe807cd5fc0bd764b4cd9fa6929d84964574ac5a6c3d5a2858f32e70ef27dd9bb24646ba8fcb74a2459a589c776c84431ae6e5ac4eafab126948b0fe2f4f959bab5d90935af7734643e206f921a9e497efe5236a7f8162bbf56228712296a87517294fe376daf174e75a328193d5051250d4ed819206d3efd9cf5d7e8d8e2ea50402c60b1e44b5771e94bbe037ab6af0d39ed5312a06bc930f04ec6bab59607e9b88746e7da19383f80aa9e4132dd6060c05f20a4e3705bf5c9993abc9f91f44ae53743059b8e7fb1125d321eeed975d69823e3367934947e508d416f282deb1533004bb5dd721e85abdb0843c87d4e1dd8fdf7cb1b191281982f04cda5c44d0d9c44184c17c9e8ba425eed6259129e261a6e15cb3a5294ea137d2db774aeae284c04b3fa11404e46a1d60f87ea888a372624df6e17e7fe4846d8d97aa4c5a6c179a9ccc274a331abe9336583648667d510e6533984e2b6ee2afe8a9d9edcfeeaa1abb5d4c1de0865c27e45fa84ed238eee0c85c4a7e282cf6d9075084b2958f159efbce0ea188b4f8f95570c405a4030357c8c6a4cb3cc094c0637fe87ce768606b39ce2d121a9e28a49b4237a91fcde0ac3154cfe410c51ccb6d5731cba482d1de3c102359a0ff5c096679b02d1f1220860795f3887b5fbf2a3f59287f44c05e3c943a52906ba3cd594142357906f18c579aa818e879e0a09f15265dc617e980324b00e09a09033445289f496dbe9d331b570b8f772d3edc73f7c8ebedae02e7cb732588c66c15106b9868121ec73ae9ef491b1118b126f3d54c0d2a0ac9a5689f9574dbc4ea69262f929ba7b15e701e5fd9a54c57ff19c44f0e0202d085090416815f474d510894c9bcfdec4f2ee19cd640dd507f1b086ee6b7433fc5da4dd2a505f3287c17de927236f1d6d3d9afeaa7dd58a5f65f99de74e8288a3ac249fee3140c5f6f8defd0ea695c5990e6fe27466b54d396360f40f3d75e623399b4c4e835dd8b369693a621d21f36e5ccfdca7853f90f4f8d4e7c9b258b8062bc2b15f4a17b0776bf4af875885f0482a4839238cad0829e6248468cf5a30a63e6f70b851cbaad4700889711cc274154085614cce9ba1d6aede846506d43263f41e7b5da895c60199dd8696f11267767b5a932928c33fbbee0b86720f25e44b6173d286ed691298b41eb3777959f1bfb183360ddd87c0d7ac0846adea911f40c4c36db5bf490fd0c35606397a45cdcfb203aa7fdc5ae58b91d9cac539c5ed03d8fc66f2e8d78b1cd1cc0990835177d64d206c3ebff7b5c9d763ced7b8540d5b2e84a81b4e434f6192ac9f24f1305350d2bf9c1fbeed68da1e4b986b93ee875cee1531bbb60c37f7d85b05203271fbaad58bf97596b8e09857da41a9fd37798dda901ae84ccad960d00d73553be3a6cd147858904cd040ed84161413ac239c2a3c47d7407975d2c896b7d22b340e407bb72e421c77bb1695e7d529139393efc39660f2e06876a8240a561b5c86d5c203ea9243b8dbc63bce6346740c150de41edda0a6cb41006fd35ec9290cd17de5a81533f7120951b6e844ccb09bef537749dcaf8c4bf7807f813f624243d0f6e56b8dfb466ebae18fd13cc66419eeebffc7c6f6150dbecb4f77584fbe5bcaae132804cf3a83efd45ddb0e676d3216e90d4b9e702e057f649a1cefd10e53c8eeb6a0b66dc95eb8fafd69a6956c115e6f86e8491eac08d8a0f07f58a30adc1b4fa691c9f04373c0695b79254837d7dfc12bf0ad7b684643586f4557f2f7d317a2ac748e803262a54143da8a67c5959d46a22cf2c981d0acc08c4840fb0bc7a8f501ff96ffd8015277a893f99024cc091f64bc2233d270e6903a53a6b20edf2b1ed264329299d4224c4e520f97172e5d2384d97c8d0d71240857d860b8d0b434644af7f08c0a68438bf652f7dfc0313fe95b5ec8e26211ad7631d5e0e23fbadfc40fcde1e243882c0e96b3c4fbee2dcb692b156fe68abada0135ffc8ff48b278c0427db073b14a3a7600ffc1dcf30d7df68c43867dceea38d8c5e502a7b8d66d317d6c7cad5e201040bc177e7196304223799e6ab93da05cfa19d09729418eac2ad0096eb6471c027e84cbafc338fed0abbe9cf57f1f39cda1bfcff19b22249fe4e3e8974095c80610ee7cd3d888e31596fb3c05fe6b06ff4b6971ae06461ed537f2658df0d840569685b05f650a51e3fd080b3a1a4efe2a2d306fb19b9d2ba5b82bc3293e7c4c3807ec8c9af2842cd8194979a175f25f015b00b60264180d995bc9ef0d45780d30a90ff0dc7a9802f9ebba534d6a94e30cab627bd1dcf3b137d3194094c1599f78ab8a9fb2d5c7d9d0026854c74d49990c136ba07aa76bf833dc9ad22759707275636dfdbd1decb92e642bd3970b2b6bf0f5bcd3b1077d3ec4ab9321cab6117c8fc126871555f5433f0dcbdd35ba2cc315dc843a76c9472381c3ca838f7ef0dd64e3725000570acc41873d4ebc545af9cc6f51489]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>å…¶ä»–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React æŠ€æœ¯æ ˆ]]></title>
    <url>%2Farchives%2F4a9b.html</url>
    <content type="text"><![CDATA[React æŠ€æœ¯æ ˆReact æ˜¯ç›®å‰æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶ã€‚Facebook å…¬å¸2013å¹´æ¨å‡ºç°åœ¨æœ€å¥½çš„ç¤¾åŒºæ”¯æŒå’Œç”Ÿæ€åœˆå¤§é‡çš„ç¬¬ä¸‰æ–¹å·¥å…·React çš„ä¼˜ç‚¹ç»„ä»¶æ¨¡å¼ï¼šä»£ç å¤ç”¨å’Œå›¢é˜Ÿåˆ†å·¥è™šæ‹Ÿ DOMï¼šæ€§èƒ½ä¼˜åŠ¿ç§»åŠ¨ç«¯æ”¯æŒï¼šè·¨ç»ˆç«¯React çš„ç¼ºç‚¹å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­å…¨æ–°çš„ä¸€å¥—æ¦‚å¿µï¼Œä¸å…¶ä»–æ‰€æœ‰æ¡†æ¶æˆªç„¶ä¸åŒåªæœ‰é‡‡ç”¨å®ƒçš„æ•´ä¸ªæŠ€æœ¯æ ˆï¼Œæ‰èƒ½å‘æŒ¥æœ€å¤§å¨åŠ›æ€»ç»“ï¼šReact éå¸¸å…ˆè¿›å’Œå¼ºå¤§ï¼Œä½†æ˜¯å­¦ä¹ å’Œå®ç°æˆæœ¬éƒ½ä¸ä½JSX è¯­æ³•React ä½¿ç”¨ JSX è¯­æ³•ï¼ŒJavaScript ä»£ç ä¸­å¯ä»¥å†™ HTML ä»£ç ã€‚1let myTitle = &lt;h1&gt;Hello, world!&lt;/h1&gt;;JSX è¯­æ³•è§£é‡Šï¼ˆ1ï¼‰JSX è¯­æ³•çš„æœ€å¤–å±‚ï¼Œåªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚12// é”™è¯¯let myTitle = &lt;p&gt;Hello&lt;/p&gt;&lt;p&gt;World&lt;/p&gt;;ï¼ˆ2ï¼‰JSX è¯­æ³•ä¸­å¯ä»¥æ’å…¥ JavaScript ä»£ç ï¼Œä½¿ç”¨å¤§æ‹¬å·ã€‚1let myTitle = &lt;p&gt;&#123;'Hello ' + 'World'&#125;&lt;/p&gt;Babel è½¬ç å™¨JavaScript å¼•æ“ï¼ˆåŒ…æ‹¬æµè§ˆå™¨å’Œ Nodeï¼‰éƒ½ä¸è®¤è¯† JSXï¼Œéœ€è¦é¦–å…ˆä½¿ç”¨ Babel è½¬ç ï¼Œç„¶åæ‰èƒ½è¿è¡Œã€‚123456&lt;script src="react.js"&gt;&lt;/script&gt;&lt;script src="react-dom.js"&gt;&lt;/script&gt;&lt;script src="babel.min.js"&gt;&lt;/script&gt;&lt;script type="text/babel"&gt; // ** Our code goes here! **&lt;/script&gt;React éœ€è¦åŠ è½½ä¸¤ä¸ªåº“ï¼šReact å’Œ React-DOMï¼Œå‰è€…æ˜¯ React çš„æ ¸å¿ƒåº“ï¼Œåè€…æ˜¯ React çš„ DOM é€‚é…åº“ã€‚Babel ç”¨æ¥åœ¨æµè§ˆå™¨è½¬æ¢ JSX è¯­æ³•ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»è½¬å¥½äº†ï¼Œæµè§ˆå™¨å°±ä¸éœ€è¦åŠ è½½è¿™ä¸ªåº“ã€‚è¯¾å ‚ç»ƒä¹ ï¼šJSX è¯­æ³•æµè§ˆå™¨æ‰“å¼€demos/jsx-demo/index.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œå®Œæˆç»ƒä¹ ã€‚1234ReactDOM.render( &lt;span&gt;Hello World!&lt;/span&gt;, document.getElementById('example'));ç¤ºä¾‹ï¼šReact ç»„ä»¶React å…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„ç»„ä»¶ï¼Œæ’å…¥ç½‘é¡µã€‚æµè§ˆå™¨æ‰“å¼€demos/react-component-demo/index1.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚12345678910class MyTitle extends React.Component &#123; render() &#123; return &lt;h1&gt;Hello World&lt;/h1&gt;; &#125;&#125;;ReactDOM.render( &lt;MyTitle/&gt;, document.getElementById('example'));è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°ç»„ä»¶å¯ä»¥ä»å¤–éƒ¨ä¼ å…¥å‚æ•°ï¼Œå†…éƒ¨ä½¿ç”¨this.propsè·å–å‚æ•°ã€‚æ‰“å¼€demos/react-component-demo/index2.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œå®Œæˆç»ƒä¹ ã€‚123456789class MyTitle extends React.Component &#123; render() &#123; return &lt;h1 style=&#123;&#123;color: this.props.color&#125;&#125; &gt;Hello World&lt;/h1&gt;; &#125;&#125;;&lt;MyTitle color="red" /&gt;,ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€ç»„ä»¶å¾€å¾€ä¼šæœ‰å†…éƒ¨çŠ¶æ€ï¼Œä½¿ç”¨this.stateè¡¨ç¤ºã€‚æµè§ˆå™¨æ‰“å¼€demos/react-component-demo/index3.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚è¯¾å ‚ç»ƒä¹ ï¼šReact ç»„ä»¶å®æˆ˜æµè§ˆå™¨æ‰“å¼€demos/react-component-demo/index4.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œå®Œæˆç»ƒä¹ ã€‚ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸReact ä¸ºç»„ä»¶çš„ä¸åŒç”Ÿå‘½é˜¶æ®µï¼Œæä¾›äº†è¿‘åä¸ªé’©å­æ–¹æ³•ã€‚componentWillMount()ï¼šç»„ä»¶åŠ è½½å‰è°ƒç”¨componentDidMount()ï¼šç»„ä»¶åŠ è½½åè°ƒç”¨componentWillUpdate(): ç»„ä»¶æ›´æ–°å‰è°ƒç”¨componentDidUpdate(): ç»„ä»¶æ›´æ–°åè°ƒç”¨componentWillUnmount()ï¼šç»„ä»¶å¸è½½å‰è°ƒç”¨componentWillReceiveProps()ï¼šç»„ä»¶æ¥å—æ–°çš„å‚æ•°æ—¶è°ƒç”¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›é’©å­ï¼Œè‡ªåŠ¨å®Œæˆä¸€äº›æ“ä½œã€‚è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç»„ä»¶å¯ä»¥é€šè¿‡ Ajax è¯·æ±‚ï¼Œä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚Ajax è¯·æ±‚ä¸€èˆ¬åœ¨componentDidMountæ–¹æ³•é‡Œé¢å‘å‡ºã€‚123456componentDidMount() &#123; const url = '...'; $.getJSON(url) .done() .fail();&#125;æ‰“å¼€demos/react-lifecycle-demo/index.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œå®Œæˆç»ƒä¹ ã€‚React ç»„ä»¶åº“React çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œå°±æ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šå·²ç»å†™å¥½çš„ç»„ä»¶åº“ï¼Œå¯ä»¥ä½¿ç”¨ã€‚React-Bootstrapï¼šhttps://react-bootstrap.github.io/ç¤ºä¾‹ï¼šReChartsReCharts æ˜¯ä¸€ä¸ª React å›¾è¡¨ç»„ä»¶åº“ã€‚http://recharts.org/æµè§ˆå™¨æ‰“å¼€demos/recharts-demo/index.htmlï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œä»”ç»†æŸ¥çœ‹æºç ï¼Œä½“ä¼š JSX è¯­æ³•å¯¹è¡¨è¾¾å¤æ‚ç»„ä»¶çš„ä¼˜åŠ¿ã€‚1234567&lt;LineChart width=&#123;1000&#125; height=&#123;400&#125; data=&#123;data&#125;&gt; &lt;XAxis dataKey="name"/&gt; &lt;YAxis/&gt; &lt;CartesianGrid stroke="#eee" strokeDasharray="5 5"/&gt; &lt;Line type="monotone" dataKey="uv" stroke="#8884d8" /&gt; &lt;Line type="monotone" dataKey="pv" stroke="#82ca9d" /&gt;&lt;/LineChart&gt;React çš„æ ¸å¿ƒæ€æƒ³View æ˜¯ State çš„è¾“å‡ºã€‚1view = f(state)ä¸Šå¼ä¸­ï¼Œfè¡¨ç¤ºå‡½æ•°å…³ç³»ã€‚åªè¦ State å‘ç”Ÿå˜åŒ–ï¼ŒView ä¹Ÿè¦éšä¹‹å˜åŒ–ã€‚React çš„æœ¬è´¨æ˜¯å°†å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰å‡½æ•°åŒ–ã€‚12345678const person = &#123; name: "michel", age: 31&#125;const App = (&#123; person &#125;) =&gt; &lt;h1&gt;&#123; person.name &#125;&lt;/h1&gt;ReactDOM.render(&lt;App person=&#123;person&#125; /&gt;, document.body)React æ²¡æœ‰è§£å†³çš„é—®é¢˜React æœ¬èº«åªæ˜¯ä¸€ä¸ª DOM çš„æŠ½è±¡å±‚ï¼Œä½¿ç”¨ç»„ä»¶æ„å»ºè™šæ‹Ÿ DOMã€‚å¦‚æœå¼€å‘å¤§åº”ç”¨ï¼Œè¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ã€‚æ¶æ„ï¼šå¤§å‹åº”ç”¨ç¨‹åºåº”è¯¥å¦‚ä½•ç»„ç»‡ä»£ç ï¼Ÿé€šä¿¡ï¼šç»„ä»¶ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿæ¶æ„é—®é¢˜React åªæ˜¯è§†å›¾å±‚çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨äºä»»ä½•ä¸€ç§æ¶æ„ã€‚MVCMVVMObserverReactiveâ€¦åˆ°åº•å“ªä¸€ç§æ¶æ„æœ€åˆé€‚ React ï¼Ÿé€šä¿¡é—®é¢˜ç»„ä»¶ä¼šå‘ç”Ÿä¸‰ç§é€šä¿¡ã€‚å‘å­ç»„ä»¶å‘æ¶ˆæ¯å‘çˆ¶ç»„ä»¶å‘æ¶ˆæ¯å‘å…¶ä»–ç»„ä»¶å‘æ¶ˆæ¯React åªæä¾›äº†ä¸€ç§é€šä¿¡æ‰‹æ®µï¼šä¼ å‚ã€‚å¯¹äºå¤§åº”ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚çŠ¶æ€çš„åŒæ­¥é€šä¿¡çš„æœ¬è´¨æ˜¯çŠ¶æ€çš„åŒæ­¥ã€‚React åŒæ­¥çŠ¶æ€çš„åŸºæœ¬æ–¹æ³•ï¼šæ‰¾åˆ°é€šä¿¡åŒæ–¹æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ï¼Œé€šè¿‡å®ƒçš„stateï¼Œä½¿å¾—å­ç»„ä»¶çš„çŠ¶æ€ä¿æŒåŒæ­¥ã€‚Flux æ¶æ„Facebook æå‡º Flux æ¶æ„çš„æ¦‚å¿µï¼Œè¢«è®¤ä¸ºæ˜¯ React åº”ç”¨çš„æ ‡å‡†æ¶æ„ã€‚æœ€å¤§ç‰¹ç‚¹ï¼šæ•°æ®å•å‘æµåŠ¨ã€‚ä¸ MVVM çš„æ•°æ®åŒå‘ç»‘å®šï¼Œå½¢æˆé²œæ˜å¯¹æ¯”ã€‚Flux çš„æ ¸å¿ƒæ€æƒ³ä¸åŒç»„ä»¶çš„stateï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªå¤–éƒ¨çš„ã€å…¬å…±çš„ Store ä¸Šé¢ã€‚ç»„ä»¶è®¢é˜… Store çš„ä¸åŒéƒ¨åˆ†ã€‚ç»„ä»¶å‘é€ï¼ˆdispatchï¼‰åŠ¨ä½œï¼ˆactionï¼‰ï¼Œå¼•å‘ Store çš„æ›´æ–°ã€‚Flux åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæœ‰30å¤šç§å®ç°ã€‚ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª React æ¶æ„React æ¶æ„çš„æœ€é‡è¦ä½œç”¨ï¼šç®¡ç† Store ä¸ View ä¹‹é—´çš„å…³ç³»ã€‚MobXï¼šå“åº”å¼ï¼ˆReactiveï¼‰ç®¡ç†ï¼Œstate æ˜¯å¯å˜å¯¹è±¡ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®Reduxï¼šå‡½æ•°å¼ï¼ˆFunctionalï¼‰ç®¡ç†ï¼Œstate æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œé€‚åˆå¤§å‹é¡¹ç›®MobX æ¶æ„MobX çš„æ ¸å¿ƒæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚Store æ˜¯è¢«è§‚å¯Ÿè€…ï¼ˆobservableï¼‰ç»„ä»¶æ˜¯è§‚å¯Ÿè€…ï¼ˆobserverï¼‰ä¸€æ—¦Storeæœ‰å˜åŒ–ï¼Œä¼šç«‹åˆ»è¢«ç»„ä»¶è§‚å¯Ÿåˆ°ï¼Œä»è€Œå¼•å‘é‡æ–°æ¸²æŸ“ã€‚MobX çš„æœ€ç®€å•ä¾‹å­1234567891011const &#123;observable&#125; = mobx;const &#123;observer&#125; = mobxReact;const person = observable(&#123;name: "å¼ ä¸‰", age: 31&#125;);const App = observer( (&#123; person &#125;) =&gt; &lt;h1&gt;&#123; person.name &#125;&lt;/h1&gt;);ReactDOM.render(&lt;App person=&#123;person&#125; /&gt;, document.body);person.name = "æå››";ä»£ç ï¼šdemos/mobx-demo/browser-demoç›®å½•ç¤ºä¾‹ï¼šMobXè¿›å…¥demos/mobx-demoç›®å½•ï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œç†è§£ MobX æ¡†æ¶ã€‚UI å±‚æ˜¯è§‚å¯Ÿè€…ï¼ŒStore æ˜¯è¢«è§‚å¯Ÿè€…ã€‚Store æ‰€æœ‰çš„å±æ€§ï¼Œåˆ†æˆä¸¤å¤§ç±»ï¼šç›´æ¥è¢«è§‚å¯Ÿçš„å±æ€§å’Œè‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„å±æ€§ã€‚123456class Store &#123; @observable name = 'Bartek'; @computed get decorated() &#123; return `$&#123;this.name&#125; is awesome!`; &#125;&#125;UI ä¼šè§‚å¯Ÿåˆ° Store çš„å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚Redux æ¶æ„Redux çš„æ ¸å¿ƒæ¦‚å¿µæ‰€æœ‰çš„çŠ¶æ€å­˜æ”¾åœ¨Storeã€‚ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“ï¼Œéƒ½å¿…é¡»ç”±çŠ¶æ€å˜åŒ–å¼•èµ·ã€‚ç”¨æˆ·åœ¨ UI ä¸Šå‘å‡ºactionã€‚reducerå‡½æ•°æ¥æ”¶actionï¼Œç„¶åæ ¹æ®å½“å‰çš„stateï¼Œè®¡ç®—å‡ºæ–°çš„stateã€‚Redux åº”ç”¨çš„æ¶æ„Redux å±‚ä¿å­˜æ‰€æœ‰çŠ¶æ€ï¼ŒReact ç»„ä»¶æ‹¿åˆ°çŠ¶æ€ä»¥åï¼Œæ¸²æŸ“å‡º HTML ä»£ç ã€‚ç¤ºä¾‹ï¼šReduxè¿›å…¥demos/redux-demoç›®å½•ï¼ŒæŒ‰ç…§ã€Šæ“ä½œè¯´æ˜ã€‹ï¼Œç†è§£ Redux æ¡†æ¶ã€‚Redux å°†ç»„ä»¶åˆ†æˆ UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶ä¸¤ç±»ã€‚UI ç»„ä»¶æ˜¯çº¯ç»„ä»¶ï¼Œä¸åŒ…å« state å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¸æ¶‰åŠç»„ä»¶çš„è¡Œä¸ºï¼Œåªæ¶‰åŠç»„ä»¶çš„å¤–è§‚ã€‚1234567&lt;div className="index"&gt; &lt;p&gt;&#123;this.props.text&#125;&lt;/p&gt; &lt;input defaultValue=&#123;this.props.name&#125; onChange=&#123;this.props.onChange&#125; /&gt;&lt;/div&gt;å®¹å™¨ç»„ä»¶æ­£å¥½ç›¸åã€‚ä¸æ¶‰åŠç»„ä»¶çš„å¤–è§‚ï¼Œåªæ¶‰åŠç»„ä»¶çš„è¡Œä¸ºã€‚è´Ÿè´£è®¢é˜… Storeï¼Œå°† Store çš„æ•°æ®å¤„ç†ä»¥åï¼Œå†é€šè¿‡å‚æ•°ä¼ ç»™ UI ç»„ä»¶ã€‚ç”¨æˆ·ç»™å‡ºé…ç½®ä»¥åï¼Œç”± Redux ç”Ÿæˆã€‚12345// MyComponent æ˜¯çº¯çš„ UI ç»„ä»¶const App = connect( mapStateToProps, mapDispatchToProps)(MyComponent);mapStateToProps: å®šä¹‰ UI ç»„ä»¶å‚æ•°ä¸ State ä¹‹é—´çš„æ˜ å°„mapDispatchToPropsï¼šå®šä¹‰ UI ç»„ä»¶ä¸ Action ä¹‹é—´çš„æ˜ å°„æ‹†åˆ† UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„UI ç»„ä»¶ä¸åå°æ•°æ®æ— å…³ï¼Œå¯ä»¥ç”±è®¾è®¡å¸ˆè´Ÿè´£å®¹å™¨ç»„ä»¶åªè´Ÿè´£æ•°æ®å’Œè¡Œä¸ºï¼Œä¸€æ—¦ Store çš„æ•°æ®ç»“æ„å˜åŒ–ï¼Œåªè¦è°ƒæ•´å®¹å™¨ç»„ä»¶å³å¯è¡¨ç°å±‚å’ŒåŠŸèƒ½å±‚è„±é’©ï¼Œæœ‰åˆ©äºä»£ç é‡ç”¨ï¼Œä¹Ÿæœ‰åˆ©äºçœ‹æ¸…åº”ç”¨çš„æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘Reducer å‡½æ•°reduceræ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶actionï¼Œç®—å‡ºæ–°çš„stateã€‚123456789101112function reducer(state = &#123; text: 'ä½ å¥½ï¼Œè®¿é—®è€…', name: 'è®¿é—®è€…'&#125;, action) &#123; switch (action.type) &#123; case 'change': return &#123; name: action.payload, text: 'ä½ å¥½ï¼Œ' + action.payload &#125;; &#125;&#125;Storeç”± Redux æä¾›çš„createStoreæ–¹æ³•ç”Ÿæˆï¼Œè¯¥æ–¹æ³•æ¥å—reducerä½œä¸ºå‚æ•°ã€‚ä¸ºäº†æŠŠStoreä¼ å…¥ç»„ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ Redux æä¾›çš„Providerç»„ä»¶åœ¨åº”ç”¨çš„æœ€å¤–é¢ï¼ŒåŒ…è£¹ä¸€å±‚ã€‚12345678const store = createStore(reducer);ReactDOM.render( &lt;Provider store=&#123;store&#125;&gt; &lt;App /&gt; &lt;/Provider&gt;, document.body.appendChild(document.createElement('div')));]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React è®¾è®¡æ€æƒ³]]></title>
    <url>%2Farchives%2F7615.html</url>
    <content type="text"><![CDATA[React è®¾è®¡æ€æƒ³è¯‘è€…åºï¼šæœ¬æ–‡æ˜¯ React æ ¸å¿ƒå¼€å‘è€…ã€æœ‰ React API ç»ˆç»“è€…ä¹‹ç§°çš„ Sebastian MarkbÃ¥ge æ’°å†™ï¼Œé˜è¿°äº†ä»–è®¾è®¡ React çš„åˆè¡·ã€‚é˜…è¯»æ­¤æ–‡ï¼Œä½ èƒ½ç«™åœ¨æ›´é«˜çš„é«˜åº¦æ€è€ƒ React çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‚åŸæ–‡åœ°å€ï¼šhttps://github.com/reactjs/react-basicæˆ‘å†™æ­¤æ–‡æ˜¯æƒ³æ­£å¼åœ°é˜è¿°æˆ‘å¿ƒä¸­ React çš„å¿ƒæ™ºæ¨¡å‹ã€‚ç›®çš„æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šè¿™æ ·è®¾è®¡ Reactï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®è¿™äº›è®ºç‚¹åæ¨å‡º Reactã€‚ä¸å¯å¦è®¤ï¼Œæ­¤æ–‡ä¸­çš„éƒ¨åˆ†è®ºæ®æˆ–å‰æå°šå­˜äº‰è®®ï¼Œè€Œä¸”éƒ¨åˆ†ç¤ºä¾‹çš„è®¾è®¡å¯èƒ½å­˜åœ¨ bug æˆ–ç–å¿½ã€‚è¿™åªæ˜¯æ­£å¼ç¡®å®šå®ƒçš„æœ€åˆé˜¶æ®µã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„å®Œå–„å®ƒçš„æƒ³æ³•å¯ä»¥éšæ—¶æäº¤ pull requestã€‚æœ¬æ–‡ä¸ä¼šä»‹ç»æ¡†æ¶ç»†èŠ‚ä¸­çš„å¥‡æŠ€æ·«å·§ï¼Œç›¸ä¿¡è¿™æ ·èƒ½æçº²æŒˆé¢†ï¼Œè®©ä½ çœ‹æ¸… React ç”±ç®€å•åˆ°å¤æ‚çš„è®¾è®¡è¿‡ç¨‹ã€‚React.js çš„çœŸå®å®ç°ä¸­å……æ»¡äº†å…·ä½“é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ¸è¿›å¼çš„è§£æ³•ï¼Œç®—æ³•ä¼˜åŒ–ï¼Œå†å²é—ç•™ä»£ç ï¼Œdebug å·¥å…·ä»¥åŠå…¶ä»–ä¸€äº›å¯ä»¥è®©å®ƒçœŸçš„å…·æœ‰é«˜å¯ç”¨æ€§çš„å†…å®¹ã€‚è¿™äº›ä»£ç å¯èƒ½å¹¶ä¸ç¨³å®šï¼Œå› ä¸ºæœªæ¥æµè§ˆå™¨çš„å˜åŒ–å’ŒåŠŸèƒ½æƒé‡çš„å˜åŒ–éšæ—¶é¢ä¸´æ”¹å˜ã€‚æ‰€ä»¥å…·ä½“çš„ä»£ç å¾ˆéš¾å½»åº•è§£é‡Šæ¸…æ¥šã€‚æˆ‘åå‘äºé€‰æ‹©ä¸€ç§æˆ‘èƒ½å®Œå…¨ hold ä½çš„ç®€æ´çš„å¿ƒæ™ºæ¨¡å‹æ¥ä½œä»‹ç»ã€‚å˜æ¢ï¼ˆTransformationï¼‰è®¾è®¡ React çš„æ ¸å¿ƒå‰ææ˜¯è®¤ä¸º UI åªæ˜¯æŠŠæ•°æ®é€šè¿‡æ˜ å°„å…³ç³»å˜æ¢æˆå¦ä¸€ç§å½¢å¼çš„æ•°æ®ã€‚åŒæ ·çš„è¾“å…¥å¿…ä¼šæœ‰åŒæ ·çš„è¾“å‡ºã€‚è¿™æ°å¥½å°±æ˜¯çº¯å‡½æ•°ã€‚123function NameBox(name) &#123; return &#123; fontWeight: 'bold', labelContent: name &#125;;&#125;12&apos;Sebastian MarkbÃ¥ge&apos; -&gt;&#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;;æŠ½è±¡ï¼ˆAbstractionï¼‰ä½ ä¸å¯èƒ½ä»…ç”¨ä¸€ä¸ªå‡½æ•°å°±èƒ½å®ç°å¤æ‚çš„ UIã€‚é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦æŠŠ UI æŠ½è±¡æˆå¤šä¸ªéšè—å†…éƒ¨ç»†èŠ‚ï¼Œåˆå¯å¤ç”¨çš„å‡½æ•°ã€‚é€šè¿‡åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ¥å®ç°å¤æ‚çš„ UIï¼Œè¿™å°±æ˜¯æŠ½è±¡ã€‚123456789function FancyUserBox(user) &#123; return &#123; borderStyle: '1px solid blue', childContent: [ 'Name: ', NameBox(user.firstName + ' ' + user.lastName) ] &#125;;&#125;12345678&#123; firstName: &apos;Sebastian&apos;, lastName: &apos;MarkbÃ¥ge&apos; &#125; -&gt;&#123; borderStyle: &apos;1px solid blue&apos;, childContent: [ &apos;Name: &apos;, &#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125; ]&#125;;ç»„åˆï¼ˆCompositionï¼‰ä¸ºäº†çœŸæ­£è¾¾åˆ°é‡ç”¨çš„ç‰¹æ€§ï¼Œåªé‡ç”¨å¶å­ç„¶åæ¯æ¬¡éƒ½ä¸ºä»–ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ˜¯ä¸å¤Ÿçš„ã€‚ä½ è¿˜éœ€è¦å¯ä»¥åŒ…å«å…¶ä»–æŠ½è±¡çš„å®¹å™¨å†æ¬¡è¿›è¡Œç»„åˆã€‚æˆ‘ç†è§£çš„â€œç»„åˆâ€å°±æ˜¯å°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„æŠ½è±¡åˆå¹¶ä¸ºä¸€ä¸ªã€‚12345678910111213function FancyBox(children) &#123; return &#123; borderStyle: '1px solid blue', children: children &#125;;&#125;function UserBox(user) &#123; return FancyBox([ 'Name: ', NameBox(user.firstName + ' ' + user.lastName) ]);&#125;çŠ¶æ€ï¼ˆStateï¼‰UI ä¸å•å•æ˜¯å¯¹æœåŠ¡å™¨ç«¯æˆ–ä¸šåŠ¡é€»è¾‘çŠ¶æ€çš„å¤åˆ¶ã€‚å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šçŠ¶æ€æ˜¯é’ˆå¯¹å…·ä½“çš„æ¸²æŸ“ç›®æ ‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª text field ä¸­æ‰“å­—ã€‚å®ƒä¸ä¸€å®šè¦å¤åˆ¶åˆ°å…¶ä»–é¡µé¢æˆ–è€…ä½ çš„æ‰‹æœºè®¾å¤‡ã€‚æ»šåŠ¨ä½ç½®è¿™ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½ å‡ ä¹ä¸ä¼šå¤åˆ¶åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡çš„ã€‚æˆ‘ä»¬å€¾å‘äºä½¿ç”¨ä¸å¯å˜çš„æ•°æ®æ¨¡å‹ã€‚æˆ‘ä»¬æŠŠå¯ä»¥æ”¹å˜ state çš„å‡½æ•°ä¸²è”èµ·æ¥ä½œä¸ºåŸç‚¹æ”¾ç½®åœ¨é¡¶å±‚ã€‚1234567891011121314151617181920212223function FancyNameBox(user, likes, onClick) &#123; return FancyBox([ 'Name: ', NameBox(user.firstName + ' ' + user.lastName), 'Likes: ', LikeBox(likes), LikeButton(onClick) ]);&#125;// å®ç°ç»†èŠ‚var likes = 0;function addOneMoreLike() &#123; likes++; rerender();&#125;// åˆå§‹åŒ–FancyNameBox( &#123; firstName: 'Sebastian', lastName: 'MarkbÃ¥ge' &#125;, likes, addOneMoreLike);æ³¨æ„ï¼šæœ¬ä¾‹æ›´æ–°çŠ¶æ€æ—¶ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼ˆaddOneMoreLike å‡½æ•°ä¸­ï¼‰ã€‚æˆ‘å®é™…çš„æƒ³æ³•æ˜¯å½“ä¸€ä¸ªâ€œupdateâ€ä¼ å…¥æ—¶æˆ‘ä»¬è¿”å›ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„çŠ¶æ€ï¼Œä½†é‚£æ ·ä¼šæ¯”è¾ƒå¤æ‚ã€‚æ­¤ç¤ºä¾‹å¾…æ›´æ–°Memoizationå¯¹äºçº¯å‡½æ•°ï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°ä¸€æ¬¡æ¬¡è°ƒç”¨æœªå…å¤ªæµªè´¹èµ„æºã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„ memorized ç‰ˆæœ¬ï¼Œç”¨æ¥è¿½è¸ªæœ€åä¸€ä¸ªå‚æ•°å’Œç»“æœã€‚è¿™æ ·å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨åŒæ ·çš„å€¼ï¼Œå°±ä¸éœ€è¦åå¤æ‰§è¡Œå®ƒäº†ã€‚1234567891011121314151617181920212223function memoize(fn) &#123; var cachedArg; var cachedResult; return function(arg) &#123; if (cachedArg === arg) &#123; return cachedResult; &#125; cachedArg = arg; cachedResult = fn(arg); return cachedResult; &#125;;&#125;var MemoizedNameBox = memoize(NameBox);function NameAndAgeBox(user, currentTime) &#123; return FancyBox([ 'Name: ', MemoizedNameBox(user.firstName + ' ' + user.lastName), 'Age in milliseconds: ', currentTime - user.dateOfBirth ]);&#125;åˆ—è¡¨ï¼ˆListsï¼‰å¤§éƒ¨åˆ† UI éƒ½æ˜¯å±•ç¤ºåˆ—è¡¨æ•°æ®ä¸­ä¸åŒ item çš„åˆ—è¡¨ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªå¤©ç„¶çš„å±‚çº§ã€‚ä¸ºäº†ç®¡ç†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ª item çš„ state ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ª Map å®¹çº³å…·ä½“ item çš„ stateã€‚123456789101112131415function UserList(users, likesPerUser, updateUserLikes) &#123; return users.map(user =&gt; FancyNameBox( user, likesPerUser.get(user.id), () =&gt; updateUserLikes(user.id, likesPerUser.get(user.id) + 1) ));&#125;var likesPerUser = new Map();function updateUserLikes(id, likeCount) &#123; likesPerUser.set(id, likeCount); rerender();&#125;UserList(data.users, likesPerUser, updateUserLikes);æ³¨æ„ï¼šç°åœ¨æˆ‘ä»¬å‘ FancyNameBox ä¼ äº†å¤šä¸ªä¸åŒçš„å‚æ•°ã€‚è¿™æ‰“ç ´äº†æˆ‘ä»¬çš„ memoization å› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªèƒ½å­˜å‚¨ä¸€ä¸ªå€¼ã€‚æ›´å¤šç›¸å…³å†…å®¹åœ¨ä¸‹é¢ã€‚è¿ç»­æ€§ï¼ˆContinuationsï¼‰ä¸å¹¸çš„æ˜¯ï¼Œè‡ªä» UI ä¸­æœ‰å¤ªå¤šçš„åˆ—è¡¨ï¼Œæ˜ç¡®çš„ç®¡ç†å°±éœ€è¦å¤§é‡çš„é‡å¤æ€§æ ·æ¿ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨è¿Ÿä¸€äº›å‡½æ•°çš„æ‰§è¡Œï¼Œè¿›è€ŒæŠŠä¸€äº›æ¨¡æ¿ç§»å‡ºä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨â€œæŸ¯é‡ŒåŒ–â€ï¼ˆJavaScript ä¸­çš„ bindï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ ¸å¿ƒçš„å‡½æ•°å¤–é¢ä¼ é€’ stateï¼Œè¿™æ ·å°±æ²¡æœ‰æ ·æ¿ä»£ç äº†ã€‚ä¸‹é¢è¿™æ ·å¹¶æ²¡æœ‰å‡å°‘æ ·æ¿ä»£ç ï¼Œä½†è‡³å°‘æŠŠå®ƒä»å…³é”®ä¸šåŠ¡é€»è¾‘ä¸­å‰¥ç¦»ã€‚123456789101112function FancyUserList(users) &#123; return FancyBox( UserList.bind(null, users) );&#125;const box = FancyUserList(data.users);const resolvedChildren = box.children(likesPerUser, updateUserLikes);const resolvedBox = &#123; ...box, children: resolvedChildren&#125;;State Mapä¹‹å‰æˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ç»„åˆé¿å…é‡å¤æ‰§è¡Œç›¸åŒçš„ä¸œè¥¿è¿™æ ·ä¸€ç§é‡å¤æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå’Œä¼ é€’ state é€»è¾‘æŒªåŠ¨åˆ°è¢«å¤ç”¨å¾ˆå¤šçš„ä½å±‚çº§çš„å‡½æ•°ä¸­å»ã€‚12345678910111213141516171819202122232425262728function FancyBoxWithState( children, stateMap, updateState) &#123; return FancyBox( children.map(child =&gt; child.continuation( stateMap.get(child.key), updateState )) );&#125;function UserList(users) &#123; return users.map(user =&gt; &#123; continuation: FancyNameBox.bind(null, user), key: user.id &#125;);&#125;function FancyUserList(users) &#123; return FancyBoxWithState.bind(null, UserList(users) );&#125;const continuation = FancyUserList(data.users);continuation(likesPerUser, updateUserLikes);Memoization Mapä¸€æ—¦æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ª memoization åˆ—è¡¨ä¸­ memoize å¤šä¸ª item å°±ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚å› ä¸ºä½ éœ€è¦åˆ¶å®šå¤æ‚çš„ç¼“å­˜ç®—æ³•æ¥å¹³è¡¡è°ƒç”¨é¢‘ç‡å’Œå†…å­˜å æœ‰ç‡ã€‚è¿˜å¥½ UI åœ¨åŒä¸€ä¸ªä½ç½®ä¼šç›¸å¯¹çš„ç¨³å®šã€‚ç›¸åŒçš„ä½ç½®ä¸€èˆ¬æ¯æ¬¡éƒ½ä¼šæ¥å—ç›¸åŒçš„å‚æ•°ã€‚è¿™æ ·ä»¥æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªé›†åˆæ¥åš memoization æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç­–ç•¥ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¯¹å¾… state åŒæ ·çš„æ–¹å¼ï¼Œåœ¨ç»„åˆçš„å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ª memoization ç¼“å­˜ã€‚12345678910111213141516171819202122232425262728function memoize(fn) &#123; return function(arg, memoizationCache) &#123; if (memoizationCache.arg === arg) &#123; return memoizationCache.result; &#125; const result = fn(arg); memoizationCache.arg = arg; memoizationCache.result = result; return result; &#125;;&#125;function FancyBoxWithState( children, stateMap, updateState, memoizationCache) &#123; return FancyBox( children.map(child =&gt; child.continuation( stateMap.get(child.key), updateState, memoizationCache.get(child.key) )) );&#125;const MemoizedFancyNameBox = memoize(FancyNameBox);ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰å¤šå±‚æŠ½è±¡éœ€è¦å…±äº«çç¢æ•°æ®æ—¶ï¼Œä¸€å±‚å±‚ä¼ é€’æ•°æ®éå¸¸éº»çƒ¦ã€‚å¦‚æœèƒ½æœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨å¤šå±‚æŠ½è±¡ä¸­å¿«æ·åœ°ä¼ é€’æ•°æ®ï¼ŒåŒæ—¶åˆä¸éœ€è¦ç‰µæ¶‰åˆ°ä¸­é—´å±‚çº§ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚React ä¸­æˆ‘ä»¬æŠŠå®ƒå«åšâ€œcontextâ€ã€‚æœ‰æ—¶å€™æ•°æ®ä¾èµ–å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æŠ½è±¡æ ‘è‡ªä¸Šè€Œä¸‹è¿›è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¸ƒå±€ç®—æ³•ä¸­ï¼Œä½ éœ€è¦åœ¨å®ç°ä»–ä»¬çš„ä½ç½®ä¹‹å‰äº†è§£å­èŠ‚ç‚¹çš„å¤§å°ã€‚ç°åœ¨ï¼Œè¿™ä¸ªä¾‹å­æœ‰ä¸€ç‚¹è¶…çº²ã€‚æˆ‘ä¼šä½¿ç”¨ ä»£æ•°æ•ˆåº” è¿™ä¸ªç”±æˆ‘å‘èµ·çš„ ECMAScript æ–°ç‰¹æ€§æè®®ã€‚å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹å¾ˆç†Ÿæ‚‰ï¼Œå®ƒä»¬ åœ¨é¿å…ç”± monad å¼ºåˆ¶å¼•å…¥çš„ä»ªå¼ä¸€æ ·çš„ç¼–ç ã€‚123456789101112131415161718192021222324function ThemeBorderColorRequest() &#123; &#125;function FancyBox(children) &#123; const color = raise new ThemeBorderColorRequest(); return &#123; borderWidth: '1px', borderColor: color, children: children &#125;;&#125;function BlueTheme(children) &#123; return try &#123; children(); &#125; catch effect ThemeBorderColorRequest -&gt; [, continuation] &#123; continuation('blue'); &#125;&#125;function App(data) &#123; return BlueTheme( FancyUserList.bind(null, data.users) );&#125;]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Reactä¸­çš„stateå’Œprops]]></title>
    <url>%2Farchives%2F992.html</url>
    <content type="text"><![CDATA[æ•´ç†ä¸€ä¸‹Reactä¸­å…³äºstateå’Œpropsçš„çŸ¥è¯†ç‚¹ã€‚åœ¨ä»»ä½•åº”ç”¨ä¸­ï¼Œæ•°æ®éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æˆ‘ä»¬éœ€è¦ç›´æ¥çš„æ”¹å˜é¡µé¢ä¸Šä¸€å—çš„åŒºåŸŸæ¥ä½¿å¾—è§†å›¾çš„åˆ·æ–°ï¼Œæˆ–è€…é—´æ¥åœ°æ”¹å˜å…¶ä»–åœ°æ–¹çš„æ•°æ®ã€‚Reactçš„æ•°æ®æ˜¯è‡ªé¡¶å‘ä¸‹å•å‘æµåŠ¨çš„ï¼Œå³ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶ä¸­ï¼Œç»„ä»¶çš„æ•°æ®å­˜å‚¨åœ¨propså’Œstateä¸­ï¼Œè¿™ä¸¤ä¸ªå±æ€§æœ‰å•¥å­åŒºåˆ«å‘¢ï¼ŸpropsReactçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç»„ä»¶åŒ–æ€æƒ³ï¼Œé¡µé¢ä¼šè¢«åˆ‡åˆ†æˆä¸€äº›ç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚ç»„ä»¶ä»æ¦‚å¿µä¸Šçœ‹å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºè¾“å…¥å€¼ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯propsï¼Œæ‰€ä»¥å¯ä»¥æŠŠpropsç†è§£ä¸ºä»å¤–éƒ¨ä¼ å…¥ç»„ä»¶å†…éƒ¨çš„æ•°æ®ã€‚ç”±äºReactæ˜¯å•å‘æ•°æ®æµï¼Œæ‰€ä»¥propsåŸºæœ¬ä¸Šä¹Ÿå°±æ˜¯ä»æœçˆ¶çº§ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’çš„æ•°æ®ã€‚ç”¨æ³•å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªåˆ—è¡¨ï¼Œæ ¹æ®Reactç»„ä»¶åŒ–æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ—è¡¨ä¸­çš„è¡Œå½“åšä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰è¿™æ ·ä¸¤ä¸ªç»„ä»¶ï¼š&lt;ItemList/&gt;å’Œ&lt;Item/&gt;ã€‚å…ˆçœ‹çœ‹&lt;ItemList/&gt;123456789import Item from &quot;./item&quot;;export default class ItemList extends React.Component&#123; const itemList = data.map(item =&gt; &lt;Item item=item /&gt;); render()&#123; return ( &#123;itemList&#125; ) &#125;&#125;åˆ—è¡¨çš„æ•°æ®æˆ‘ä»¬å°±æš‚æ—¶å…ˆå‡è®¾æ˜¯æ”¾åœ¨ä¸€ä¸ªdataå˜é‡ä¸­ï¼Œç„¶åé€šè¿‡mapå‡½æ•°è¿”å›ä¸€ä¸ªæ¯ä¸€é¡¹éƒ½æ˜¯&lt;Item item=&#39;æ•°æ®&#39;/&gt;çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå…¶å®åŒ…å«äº†data.lengthä¸ª&lt;Item/&gt;ç»„ä»¶ï¼Œæ•°æ®é€šè¿‡åœ¨ç»„ä»¶ä¸Šè‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚å½“ç„¶ï¼Œè¿™é‡Œæƒ³ä¼ é€’å‡ ä¸ªè‡ªå®šä¹‰å‚æ•°éƒ½å¯ä»¥ã€‚åœ¨&lt;Item /&gt;ä¸­æ˜¯è¿™æ ·çš„ï¼š1234567export default class Item extends React.Component&#123; render()&#123; return ( &lt;li&gt;&#123;this.props.item&#125;&lt;/li&gt; ) &#125;&#125;åœ¨renderå‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œç»„ä»¶å†…éƒ¨æ˜¯ä½¿ç”¨this.propsæ¥è·å–ä¼ é€’åˆ°è¯¥ç»„ä»¶çš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ‰€æœ‰ä½ å¯¹è¿™ä¸ªç»„ä»¶çš„é…ç½®ï¼Œç°åœ¨åªåŒ…å«äº†ä¸€ä¸ªitemå±æ€§ï¼Œæ‰€ä»¥é€šè¿‡this.props.itemæ¥è·å–å³å¯ã€‚åªè¯»æ€§propsç»å¸¸è¢«ç”¨ä½œæ¸²æŸ“ç»„ä»¶å’Œåˆå§‹åŒ–çŠ¶æ€ï¼Œå½“ä¸€ä¸ªç»„ä»¶è¢«å®ä¾‹åŒ–ä¹‹åï¼Œå®ƒçš„propsæ˜¯åªè¯»çš„ï¼Œä¸å¯æ”¹å˜çš„ã€‚å¦‚æœpropsåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è¢«æ”¹å˜ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºçš„å½¢æ€å˜å¾—ä¸å¯é¢„æµ‹ã€‚åªæœ‰é€šè¿‡çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ‰å¯ä»¥æŠŠæ–°çš„propsä¼ å…¥ç»„ä»¶ä¸­ã€‚é»˜è®¤å‚æ•°åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æœ€å¥½ä¸ºpropsä¸­çš„å‚æ•°è®¾ç½®ä¸€ä¸ªdefaultPropsï¼Œå¹¶ä¸”åˆ¶å®šå®ƒçš„ç±»å‹ã€‚æ¯”å¦‚ï¼Œè¿™æ ·ï¼š1234567Item.defaultProps = &#123; item: &apos;Hello Props&apos;,&#125;;Item.propTypes = &#123; item: PropTypes.string,&#125;;å…³äºpropTypesï¼Œå¯ä»¥å£°æ˜ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š1234567optionalArray: PropTypes.array,optionalBool: PropTypes.bool,optionalFunc: PropTypes.func,optionalNumber: PropTypes.number,optionalObject: PropTypes.object,optionalString: PropTypes.string,optionalSymbol: PropTypes.symbol,æ³¨æ„ï¼Œboolå’Œfuncæ˜¯ç®€å†™ã€‚è¿™äº›çŸ¥è¯†åŸºç¡€æ•°æ®ç±»å‹ï¼Œè¿˜æœ‰ä¸€äº›å¤æ‚çš„ï¼Œé™„ä¸Šé“¾æ¥ï¼šhttps://facebook.github.io/react/docs/typechecking-with-proptypes.htmlæ€»ç»“propsæ˜¯ä¸€ä¸ªä»å¤–éƒ¨ä¼ è¿›ç»„ä»¶çš„å‚æ•°ï¼Œä¸»è¦ä½œä¸ºå°±æ˜¯ä»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œå®ƒå…·æœ‰å¯è¯»æ€§å’Œä¸å˜æ€§ï¼Œåªèƒ½é€šè¿‡å¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„propsæ¥é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œå¦åˆ™å­ç»„ä»¶çš„propsä»¥åŠå±•ç°å½¢å¼ä¸ä¼šæ”¹å˜ã€‚statestateæ˜¯ä»€ä¹ˆå‘¢ï¼ŸState is similar to props, but it is private and fully controlled by the component.ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å¯ä»¥ç”±æ•°æ®çŠ¶æ€å’Œå¤–éƒ¨å‚æ•°æ‰€å†³å®šï¼Œå¤–éƒ¨å‚æ•°ä¹Ÿå°±æ˜¯propsï¼Œè€Œæ•°æ®çŠ¶æ€å°±æ˜¯stateã€‚ç”¨æ³•12345678910111213export default class ItemList extends React.Component&#123; constructor()&#123; super(); this.state = &#123; itemList:&apos;ä¸€äº›æ•°æ®&apos;, &#125; &#125; render()&#123; return ( &#123;this.state.itemList&#125; ) &#125;&#125;é¦–å…ˆï¼Œåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡this.stateç»™ç»„ä»¶è®¾å®šä¸€ä¸ªåˆå§‹çš„stateï¼Œåœ¨ç¬¬ä¸€æ¬¡renderçš„æ—¶å€™å°±ä¼šç”¨è¿™ä¸ªæ•°æ®æ¥æ¸²æŸ“ç»„ä»¶ã€‚setStatestateä¸åŒäºpropsçš„ä¸€ç‚¹æ˜¯ï¼Œstateæ˜¯å¯ä»¥è¢«æ”¹å˜çš„ã€‚ä¸è¿‡ï¼Œä¸å¯ä»¥ç›´æ¥é€šè¿‡this.state=çš„æ–¹å¼æ¥ä¿®æ”¹ï¼Œè€Œéœ€è¦é€šè¿‡this.setState()æ–¹æ³•æ¥ä¿®æ”¹stateã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé€šè¿‡å¼‚æ­¥æ“ä½œæ¥è·å–æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨didMounté˜¶æ®µæ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼š1234567componentDidMount()&#123; fetch(&apos;url&apos;) .then(response =&gt; response.json()) .then((data) =&gt; &#123; this.setState(&#123;itemList:item&#125;); &#125;&#125;å½“æ•°æ®è·å–å®Œæˆåï¼Œé€šè¿‡this.setStateæ¥ä¿®æ”¹æ•°æ®çŠ¶æ€ã€‚å½“æˆ‘ä»¬è°ƒç”¨this.setStateæ–¹æ³•æ—¶ï¼ŒReactä¼šæ›´æ–°ç»„ä»¶çš„æ•°æ®çŠ¶æ€stateï¼Œå¹¶ä¸”é‡æ–°è°ƒç”¨renderæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¹ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚æ³¨æ„ï¼šé€šè¿‡this.state=æ¥åˆå§‹åŒ–stateï¼Œä½¿ç”¨this.setStateæ¥ä¿®æ”¹stateï¼Œconstructoræ˜¯å”¯ä¸€èƒ½å¤Ÿåˆå§‹åŒ–çš„åœ°æ–¹ã€‚setStateæ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªéœ€è¦ä¼ å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å³å¯ï¼Œä¸éœ€è¦ä¼ å…¥æ•´ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š123456789101112export default class ItemList extends React.Component&#123; constructor()&#123; super(); this.state = &#123; name:&apos;axuebin&apos;, age:25, &#125; &#125; componentDidMount()&#123; this.setState(&#123;age:18&#125;) &#125;&#125;åœ¨æ‰§è¡Œå®ŒsetStateä¹‹åçš„stateåº”è¯¥æ˜¯{name:&#39;axuebin&#39;,age:18}ã€‚setStateè¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨setStateè°ƒç”¨å®Œæˆå¹¶ä¸”ç»„ä»¶å¼€å§‹é‡æ–°æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬æ¸²æŸ“æ˜¯å¦å®Œæˆï¼š123this.setState(&#123; name:&apos;xb&apos;&#125;,()=&gt;console.log(&apos;setState finished&apos;))æ€»ç»“stateçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜ã€æ§åˆ¶ä»¥åŠä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ï¼Œå®ƒåªèƒ½åœ¨constructorä¸­åˆå§‹åŒ–ï¼Œå®ƒç®—æ˜¯ç»„ä»¶çš„ç§æœ‰å±æ€§ï¼Œä¸å¯é€šè¿‡å¤–éƒ¨è®¿é—®å’Œä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ç»„ä»¶å†…éƒ¨çš„this.setStateæ¥ä¿®æ”¹ï¼Œä¿®æ”¹stateå±æ€§ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚åŒºåˆ«stateæ˜¯ç»„ä»¶è‡ªå·±ç®¡ç†æ•°æ®ï¼Œæ§åˆ¶è‡ªå·±çš„çŠ¶æ€ï¼Œå¯å˜ï¼›propsæ˜¯å¤–éƒ¨ä¼ å…¥çš„æ•°æ®å‚æ•°ï¼Œä¸å¯å˜ï¼›æ²¡æœ‰stateçš„å«åšæ— çŠ¶æ€ç»„ä»¶ï¼Œæœ‰stateçš„å«åšæœ‰çŠ¶æ€ç»„ä»¶ï¼›å¤šç”¨propsï¼Œå°‘ç”¨stateã€‚ä¹Ÿå°±æ˜¯å¤šå†™æ— çŠ¶æ€ç»„ä»¶ã€‚]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>React</tag>
      </tags>
  </entry>
</search>

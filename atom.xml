<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Andy&#39;s Blog</title>
  
  <subtitle>Quick notes</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://andyxw.com/"/>
  <updated>2019-08-23T11:08:57.747Z</updated>
  <id>https://andyxw.com/</id>
  
  <author>
    <name>Andy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>A Complete Guide to useEffect</title>
    <link href="https://andyxw.com/archives/6387.html"/>
    <id>https://andyxw.com/archives/6387.html</id>
    <published>2019-08-23T11:02:17.805Z</published>
    <updated>2019-08-23T11:08:57.747Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/a-complete-guide-to-useeffect/</a></p></blockquote><p>You wrote a few components with <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hooks</a>. Maybe even a small app. Youâ€™re mostly satisfied. Youâ€™re comfortable with the API and picked up a few tricks along the way. You even made some <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom Hooks</a> to extract repetitive logic (300 lines gone!) and showed it off to your colleagues. â€œGreat jobâ€, they said.</p><p>But sometimes when you <code>useEffect</code>, the pieces donâ€™t quite fit together. You have a nagging feeling that youâ€™re missing something. It seems similar to class lifecyclesâ€¦ but is it really? You find yourself asking questions like:</p><ul><li>ğŸ¤” How do I replicate <code>componentDidMount</code> with <code>useEffect</code>?</li><li>ğŸ¤” How do I correctly fetch data inside <code>useEffect</code>? What is <code>[]</code>?</li><li>ğŸ¤” Do I need to specify functions as effect dependencies or not?</li><li>ğŸ¤” Why do I sometimes get an infinite refetching loop?</li><li>ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?</li></ul><p>When I just started using Hooks, I was confused by all of those questions too. Even when writing the initial docs, I didnâ€™t have a firm grasp on some of the subtleties. Iâ€™ve since had a few â€œahaâ€ moments that I want to share with you. <strong>This deep dive will make the answers to these questions look obvious to you.</strong></p><p>To <em>see</em> the answers, we need to take a step back. The goal of this article isnâ€™t to give you a list of bullet point recipes. Itâ€™s to help you truly â€œgrokâ€ <code>useEffect</code>. There wonâ€™t be much to learn. In fact, weâ€™ll spend most of our time _un_learning.</p><p><strong>Itâ€™s only after I stopped looking at the <code>useEffect</code> Hook through the prism of the familiar class lifecycle methods that everything came together for me.</strong></p><blockquote><p>â€œUnlearn what you have learned.â€ â€” Yoda</p></blockquote><p><a href="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" target="_blank" rel="noopener"><img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" alt=""></a></p><p><strong>This article assumes that youâ€™re somewhat familiar with <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener"><code>useEffect</code></a> API.</strong></p><p><strong>Itâ€™s also <em>really</em> long. Itâ€™s like a mini-book. Thatâ€™s just my preferred format. But I wrote a TLDR just below if youâ€™re in a rush or donâ€™t really care.</strong></p><p><strong>If youâ€™re not comfortable with deep dives, you might want to wait until these explanations appear elsewhere. Just like when React came out in 2013, it will take some time for people to recognize a different mental model and teach it.</strong></p><h2 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a><a href="#tldr"></a>TLDR</h2><p>Hereâ€™s a quick TLDR if you donâ€™t want to read the whole thing. If some parts donâ€™t make sense, you can scroll down until you find something related.</p><p>Feel free to skip it if you plan to read the whole post. Iâ€™ll link to it at the end.</p><p><strong>ğŸ¤” Question: How do I replicate <code>componentDidMount</code> with <code>useEffect</code>?</strong></p><p>While you can <code>useEffect(fn, [])</code>, itâ€™s not an exact equivalent. Unlike <code>componentDidMount</code>, it will <em>capture</em> props and state. So even inside the callbacks, youâ€™ll see the initial props and state. If you want to see â€œlatestâ€ something, you can write it to a ref. But thereâ€™s usually a simpler way to structure the code so that you donâ€™t have to. Keep in mind that the mental model for effects is different from <code>componentDidMount</code> and other lifecycles, and trying to find their exact equivalents may confuse you more than help. To get productive, you need to â€œthink in effectsâ€, and their mental model is closer to implementing synchronization than to responding to lifecycle events.</p><p><strong>ğŸ¤” Question: How do I correctly fetch data inside <code>useEffect</code>? What is <code>[]</code>?</strong></p><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">This article</a> is a good primer on data fetching with <code>useEffect</code>. Make sure to read it to the end! Itâ€™s not as long as this one. <code>[]</code> means the effect doesnâ€™t use any value that participates in React data flow, and is for that reason safe to apply once. It is also a common source of bugs when the value actually _is_ used. Youâ€™ll need to learn a few strategies (primarily <code>useReducer</code> and <code>useCallback</code>) that can <em>remove the need</em> for a dependency instead of incorrectly omitting it.</p><p><strong>ğŸ¤” Question: Do I need to specify functions as effect dependencies or not?</strong></p><p>The recommendation is to hoist functions that donâ€™t need props or state <em>outside</em> of your component, and pull the ones that are used only by an effect <em>inside</em> of that effect. If after that your effect still ends up using functions in the render scope (including function from props), wrap them into <code>useCallback</code> where theyâ€™re defined, and repeat the process. Why does it matter? Functions can â€œseeâ€ values from props and state â€” so they participate in the data flow. Thereâ€™s a <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">more detailed answer</a> in our FAQ.</p><p><strong>ğŸ¤” Question: Why do I sometimes get an infinite refetching loop?</strong></p><p>This can happen if youâ€™re doing data fetching in an effect without the second dependencies argument. Without it, effects run after every render â€” and setting the state will trigger the effects again. An infinite loop may also happen if you specify a value that <em>always</em> changes in the dependency array. You can tell which one by removing them one by one. However, removing a dependency you use (or blindly specifying <code>[]</code>) is usually the wrong fix. Instead, fix the problem at its source. For example, functions can cause this problem, and putting them inside effects, hoisting them out, or wrapping them with <code>useCallback</code> helps. To avoid recreating objects, <code>useMemo</code> can serve a similar purpose.</p><p><strong>ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?</strong></p><p>Effects always â€œseeâ€ props and state from the render they were defined in. That <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">helps prevent bugs</a> but in some cases can be annoying. For those cases, you can explicitly maintain some value in a mutable ref (the linked article explains it at the end). If you think youâ€™re seeing some props or state from an old render but donâ€™t expect it, you probably missed some dependencies. Try using the <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint rule</a> to train yourself to see them. A few days, and itâ€™ll be like a second nature to you. See also <a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="noopener">this answer</a> in our FAQ.</p><p>I hope this TLDR was helpful! Otherwise, letâ€™s go.</p><h2 id="Each-Render-Has-Its-Own-Props-and-State"><a href="#Each-Render-Has-Its-Own-Props-and-State" class="headerlink" title="Each Render Has Its Own Props and State"></a><a href="#each-render-has-its-own-props-and-state"></a>Each Render Has Its Own Props and State</h2><p>Before we can talk about effects, we need to talk about rendering.</p><p>Hereâ€™s a counter. Look at the highlighted line closely:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>What does it mean? Does <code>count</code> somehow â€œwatchâ€ changes to our state and update automatically? That might be a useful first intuition when you learn React but itâ€™s <em>not</em> an <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">accurate mental model</a>.</p><p><strong>In this example, <code>count</code> is just a number.</strong> Itâ€™s not a magic â€œdata bindingâ€, a â€œwatcherâ€, a â€œproxyâ€, or anything else. Itâ€™s a good old number like this one:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const count = 42;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>The first time our component renders, the <code>count</code> variable we get from <code>useState()</code> is <code>0</code>. When we call <code>setCount(1)</code>, React calls our component again. This time, <code>count</code> will be <code>1</code>. And so on:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Whenever we update the state, React calls our component. Each render result â€œseesâ€ its own <code>counter</code> state value which is a <em>constant</em> inside our function.</strong></p><p>So this line doesnâ€™t do any special data binding:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p><strong>It only embeds a number value into the render output.</strong> That number is provided by React. When we <code>setCount</code>, React calls our component again with a different <code>count</code> value. Then React updates the DOM to match our latest render output.</p><p>The key takeaway is that the <code>count</code> constant inside any particular render doesnâ€™t change over time. Itâ€™s our component thatâ€™s called again â€” and each render â€œseesâ€ its own <code>count</code> value thatâ€™s isolated between renders.</p><p><em>(For an in-depth overview of this process, check out my post <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">React as a UI Runtime</a>.)</em></p><h2 id="Each-Render-Has-Its-Own-Event-Handlers"><a href="#Each-Render-Has-Its-Own-Event-Handlers" class="headerlink" title="Each Render Has Its Own Event Handlers"></a><a href="#each-render-has-its-own-event-handlers"></a>Each Render Has Its Own Event Handlers</h2><p>So far so good. What about event handlers?</p><p>Look at this example. It shows an alert with the <code>count</code> after three seconds:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  function handleAlertClick() &#123;    setTimeout(() =&gt; &#123;      alert(&apos;You clicked on: &apos; + count);    &#125;, 3000);  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;        Show alert      &lt;/button&gt;    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Letâ€™s say I do this sequence of steps:</p><ul><li><strong>Increment</strong> the counter to 3</li><li><strong>Press</strong> â€œShow alertâ€</li><li><strong>Increment</strong> it to 5 before the timeout fires</li></ul><p><img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt=""></p><p>What do you expect the alert to show? Will it show 5 â€” which is the counter state at the time of the alert? Or will it show 3 â€” the state when I clicked?</p><p><em>spoilers ahead</em></p><p>Go ahead and <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">try it yourself!</a></p><p>If the behavior doesnâ€™t quite make sense to you, imagine a more practical example: a chat app with the current recipient ID in the state, and a Send button. <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">This article</a> explores the reasons in depth but the correct answer is 3.</p><p>The alert will â€œcaptureâ€ the state at the time I clicked the button.</p><p><em>(There are ways to implement the other behavior too but Iâ€™ll be focusing on the default case for now. When building a mental model, itâ€™s important that we distinguish the â€œpath of least resistanceâ€ from the opt-in escape hatches.)</em></p><p>But how does it work?</p><p>Weâ€™ve discussed that the <code>count</code> value is constant for every particular call to our function. Itâ€™s worth emphasizing this â€” <strong>our function gets called many times (once per each render), but every one of those times the <code>count</code> value inside of it is constant and set to a particular value (state for that render).</strong></p><p>This is not specific to React â€” regular functions work in a similar way:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function sayHi(person) &#123;</span><br><span class="line">  const name = person.name;  setTimeout(() =&gt; &#123;</span><br><span class="line">    alert(&apos;Hello, &apos; + name);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let someone = &#123;name: &apos;Dan&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Yuzhi&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Dominic&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br></pre></td></tr></table></figure><p>In <a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="noopener">this example</a>, the outer <code>someone</code> variable is reassigned several times. (Just like somewhere in React, the <em>current</em> component state can change.) <strong>However, inside <code>sayHi</code>, there is a local <code>name</code> constant that is associated with a <code>person</code> from a particular call.</strong> That constant is local, so itâ€™s isolated between the calls! As a result, when the timeouts fire, each alert â€œremembersâ€ its own <code>name</code>.</p><p>This explains how our event handler captures the <code>count</code> at the time of the click. If we apply the same substitution principle, each render â€œseesâ€ its own <code>count</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So effectively, each render returns its own â€œversionâ€ of <code>handleAlertClick</code>. Each of those versions â€œremembersâ€ its own <code>count</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 0);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 1);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 2);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is why <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">in this demo</a> event handlers â€œbelongâ€ to a particular render, and when you click, it keeps using the <code>counter</code> state <em>from</em> that render.</p><p><strong>Inside any particular render, props and state forever stay the same.</strong> But if props and state are isolated between renders, so are any values using them (including the event handlers). They also â€œbelongâ€ to a particular render. So even async functions inside an event handler will â€œseeâ€ the same <code>count</code> value.</p><p><em>Side note: I inlined concrete <code>count</code> values right into <code>handleAlertClick</code> functions above. This mental substitution is safe because <code>count</code> canâ€™t possibly change within a particular render. Itâ€™s declared as a <code>const</code> and is a number. It would be safe to think the same way about other values like objects too, but only if we agree to avoid mutating state. Calling <code>setSomething(newObj)</code> with a newly created object instead of mutating it is fine because state belonging to previous renders is intact.</em></p><h2 id="Each-Render-Has-Its-Own-Effects"><a href="#Each-Render-Has-Its-Own-Effects" class="headerlink" title="Each Render Has Its Own Effects"></a><a href="#each-render-has-its-own-effects"></a>Each Render Has Its Own Effects</h2><p>This was supposed to be a post about effects but we still havenâ€™t talked about effects yet! Weâ€™ll rectify this now. Turns out, effects arenâ€™t really any different.</p><p>Letâ€™s go back to an example from <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">the docs</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = `You clicked $&#123;count&#125; times`;  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Hereâ€™s a question for you: how does the effect read the latest <code>count</code> state?</strong></p><p>Maybe, thereâ€™s some kind of â€œdata bindingâ€ or â€œwatchingâ€ that makes <code>count</code> update live inside the effect function? Maybe <code>count</code> is a mutable variable that React sets inside our component so that our effect always sees the latest value?</p><p>Nope.</p><p>We already know that <code>count</code> is constant within a particular component render. Event handlers â€œseeâ€ the <code>count</code> state from the render that they â€œbelongâ€ to because <code>count</code> is a variable in their scope. The same is true for effects!</p><p><strong>Itâ€™s not the <code>count</code> variable that somehow changes inside an â€œunchangingâ€ effect. Itâ€™s the <em>effect function itself</em> thatâ€™s different on every render.</strong></p><p>Each version â€œseesâ€ the <code>count</code> value from the render that it â€œbelongsâ€ to:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;0&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;1&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;2&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React remembers the effect function you provided, and runs it after flushing changes to the DOM and letting the browser paint the screen.</p><p>So even if we speak of a single conceptual <em>effect</em> here (updating the document title), it is represented by a <em>different function</em> on every render â€” and each effect function â€œseesâ€ props and state from the particular render it â€œbelongsâ€ to.</p><p><strong>Conceptually, you can imagine effects are a <em>part of the render result</em>.</strong></p><p>Strictly saying, theyâ€™re not (in order to <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener">allow Hook composition</a> without clumsy syntax or runtime overhead). But in the mental model weâ€™re building up, effect functions <em>belong</em> to a particular render in the same way that event handlers do.</p><p>To make sure we have a solid understanding, letâ€™s recap our first render:</p><ul><li><strong>React:</strong> Give me the UI when the state is <code>0</code>.</li><li><p><strong>Your component:</strong></p><ul><li>Hereâ€™s the render result: <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li><li>Also remember to run this effect after youâ€™re done: <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li></ul></li><li><strong>React:</strong> Sure. Updating the UI. Hey browser, Iâ€™m adding some stuff to the DOM.</li><li><strong>Browser:</strong> Cool, I painted it to the screen.</li><li><p><strong>React:</strong> OK, now Iâ€™m going to run the effect you gave me.</p><ul><li>Running <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li></ul></li></ul><p>Now letâ€™s recap what happens after we click:</p><ul><li><strong>Your component:</strong> Hey React, set my state to <code>1</code>.</li><li><strong>React:</strong> Give me the UI for when the state is <code>1</code>.</li><li><p><strong>Your component:</strong></p><ul><li>Hereâ€™s the render result: <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li><li>Also remember to run this effect after youâ€™re done: <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li></ul></li><li><strong>React:</strong> Sure. Updating the UI. Hey browser, Iâ€™ve changed the DOM.</li><li><strong>Browser:</strong> Cool, I painted your changes to the screen.</li><li><p><strong>React:</strong> OK, now Iâ€™ll run the effect that belongs to the render I just did.</p><ul><li>Running <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li></ul></li></ul><h2 id="Each-Render-Has-Its-Ownâ€¦-Everything"><a href="#Each-Render-Has-Its-Ownâ€¦-Everything" class="headerlink" title="Each Render Has Its Ownâ€¦ Everything"></a><a href="#each-render-has-its-own-everything"></a>Each Render Has Its Ownâ€¦ Everything</h2><p><strong>We know now that effects run after every render, are conceptually a part of the component output, and â€œseeâ€ the props and state from that particular render.</strong></p><p>Letâ€™s try a thought experiment. Consider this code:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    setTimeout(() =&gt; &#123;      console.log(`You clicked $&#123;count&#125; times`);    &#125;, 3000);  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If I click several times with a small delay, what is the log going to look like?</p><p><em>spoilers ahead</em></p><p>You might think this is a gotcha and the end result is unintuitive. Itâ€™s not! Weâ€™re going to see a sequence of logs â€” each one belonging to a particular render and thus with its own <code>count</code> value. You can <a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="noopener">try it yourself</a>:</p><p><img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif" alt=""></p><p>You may think: â€œOf course thatâ€™s how it works! How else could it work?â€</p><p>Well, thatâ€™s not how <code>this.state</code> works in classes. Itâ€™s easy to make the mistake of thinking that this <a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="noopener">class implementation</a> is equivalent:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(`You clicked $&#123;this.state.count&#125; times`);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, <code>this.state.count</code> always points at the <em>latest</em> count rather than the one belonging to a particular render. So youâ€™ll see <code>5</code> logged each time instead:</p><p><img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt=""></p><p>I think itâ€™s ironic that Hooks rely so much on JavaScript closures, and yet itâ€™s the class implementation that suffers from <a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="noopener">the canonical wrong-value-in-a-timeout confusion</a> thatâ€™s often associated with closures. This is because the actual source of the confusion in this example is the mutation (React mutates <code>this.state</code> in classes to point to the latest state) and not closures themselves.</p><p><strong>Closures are great when the values you close over never change. That makes them easy to think about because youâ€™re essentially referring to constants.</strong> And as we discussed, props and state never change within a particular render. By the way, we can fix the class versionâ€¦ by <a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="noopener">using a closure</a>.</p><h2 id="Swimming-Against-the-Tide"><a href="#Swimming-Against-the-Tide" class="headerlink" title="Swimming Against the Tide"></a><a href="#swimming-against-the-tide"></a>Swimming Against the Tide</h2><p>At this point itâ€™s important that we call it out explicitly: <strong>every</strong> function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.</p><p>So these two examples are equivalent:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(props.counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  const counter = props.counter;  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>It doesnâ€™t matter whether you read from props or state â€œearlyâ€ inside of your component.</strong> Theyâ€™re not going to change! Inside the scope of a single render, props and state stay the same. (Destructuring props makes this more obvious.)</p><p>Of course, sometimes you <em>want</em> to read the latest rather than captured value inside some callback defined in an effect. The easiest way to do it is by using refs, as described in the last section of <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">this article</a>.</p><p>Be aware that when you want to read the <em>future</em> props or state from a function in a <em>past</em> render, youâ€™re swimming against the tide. Itâ€™s not <em>wrong</em> (and in some cases necessary) but it might look less â€œcleanâ€ to break out of the paradigm. This is an intentional consequence because it helps highlight which code is fragile and depends on timing. In classes, itâ€™s less obvious when this happens.</p><p>Hereâ€™s a <a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="noopener">version of our counter example</a> that replicates the class behavior:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const latestCount = useRef(count);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        latestCount.current = count;    setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(`You clicked $&#123;latestCount.current&#125; times`);    &#125;, 3000);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt=""></p><p>It might seem quirky to mutate something in React. However, this is exactly how React itself reassigns <code>this.state</code> in classes. Unlike with captured props and state, you donâ€™t have any guarantees that reading <code>latestCount.current</code> would give you the same value in any particular callback. By definition, you can mutate it any time. This is why itâ€™s not a default, and you have to opt into that.</p><h2 id="So-What-About-Cleanup"><a href="#So-What-About-Cleanup" class="headerlink" title="So What About Cleanup?"></a><a href="#so-what-about-cleanup"></a>So What About Cleanup?</h2><p>As <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="noopener">the docs explain</a>, some effects might have a cleanup phase. Essentially, its purpose is to â€œundoâ€ an effect for cases like subscriptions.</p><p>Consider this code:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Say <code>props</code> is <code>{id: 10}</code> on the first render, and <code>{id: 20}</code> on the second render. You <em>might</em> think that something like this happens:</p><ul><li>React cleans up the effect for <code>{id: 10}</code>.</li><li>React renders UI for <code>{id: 20}</code>.</li><li>React runs the effect for <code>{id: 20}</code>.</li></ul><p>(This is not quite the case.)</p><p>With this mental model, you might think the cleanup â€œseesâ€ the old props because it runs before we re-render, and then the new effect â€œseesâ€ the new props because it runs after the re-render. Thatâ€™s the mental model lifted directly from the class lifecycles, and <strong>itâ€™s not accurate here</strong>. Letâ€™s see why.</p><p>React only runs the effects after <a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="noopener">letting the browser paint</a>. This makes your app faster as most effects donâ€™t need to block screen updates. Effect cleanup is also delayed. <strong>The previous effect is cleaned up <em>after</em> the re-render with new props:</strong></p><ul><li><strong>React renders UI for <code>{id: 20}</code>.</strong></li><li>The browser paints. We see the UI for <code>{id: 20}</code> on the screen.</li><li><strong>React cleans up the effect for <code>{id: 10}</code>.</strong></li><li>React runs the effect for <code>{id: 20}</code>.</li></ul><p>You might be wondering: but how can the cleanup of the previous effect still â€œseeâ€ the old <code>{id: 10}</code> props if it runs <em>after</em> the props change to <code>{id: 20}</code>?</p><p>Weâ€™ve been here beforeâ€¦ ğŸ¤”</p><p><img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt=""></p><p>Quoting the previous section:</p><blockquote><p>Every function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.</p></blockquote><p>Now the answer is clear! The effect cleanup doesnâ€™t read the â€œlatestâ€ props, whatever that means. It reads props that belong to the render itâ€™s defined in:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">            return () =&gt; &#123;        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);      &#125;;    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      </span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Kingdoms will rise and turn into ashes, the Sun will shed its outer layers to be a white dwarf, and the last civilization will end. But nothing will make the props â€œseenâ€ by the first render effectâ€™s cleanup anything other than <code>{id: 10}</code>.</p><p>Thatâ€™s what allows React to deal with effects right after painting â€” and make your apps faster by default. The old props are still there if our code needs them.</p><h2 id="Synchronization-Not-Lifecycle"><a href="#Synchronization-Not-Lifecycle" class="headerlink" title="Synchronization, Not Lifecycle"></a><a href="#synchronization-not-lifecycle"></a>Synchronization, Not Lifecycle</h2><p>One of my favorite things about React is that it unifies describing the initial render result and the updates. This <a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="noopener">reduces the entropy</a> of your program.</p><p>Say my component looks like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It doesnâ€™t matter if I render <code>&lt;Greeting /&gt;</code> and later <code>&lt;Greeting /&gt;</code>, or if I just render <code>&lt;Greeting /&gt;</code>. In the end, we will see â€œHello, Yuzhiâ€ in both cases.</p><p>People say: â€œItâ€™s all about the journey, not the destinationâ€. With React, itâ€™s the opposite. <strong>Itâ€™s all about the destination, not the journey.</strong> Thatâ€™s the difference between <code>$.addClass</code> and <code>$.removeClass</code> calls in jQuery code (our â€œjourneyâ€) and specifying what the CSS class <em>should be</em> in React code (our â€œdestinationâ€).</p><p><strong>React synchronizes the DOM according to our current props and state.</strong> There is no distinction between a â€œmountâ€ or an â€œupdateâ€ when rendering.</p><p>You should think of effects in a similar way. <strong><code>useEffect</code> lets you <em>synchronize</em> things outside of the React tree according to our props and state.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = &apos;Hello, &apos; + name;  &#125;);  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is subtly different from the familiar <em>mount/update/unmount</em> mental model. It is important really to internalize this. <strong>If youâ€™re trying to write an effect that behaves differently depending on whether the component renders for the first time or not, youâ€™re swimming against the tide!</strong> Weâ€™re failing at synchronizing if our result depends on the â€œjourneyâ€ rather than the â€œdestinationâ€.</p><p>It shouldnâ€™t matter whether we rendered with props A, B, and C, or if we rendered with C immediately. While there may be some temporary differences (e.g. while weâ€™re fetching data), eventually the end result should be the same.</p><p>Still, of course running all effects on <em>every</em> render might not be efficient. (And in some cases, it would lead to infinite loops.)</p><p>So how can we fix this?</p><h2 id="Teaching-React-to-Diff-Your-Effects"><a href="#Teaching-React-to-Diff-Your-Effects" class="headerlink" title="Teaching React to Diff Your Effects"></a><a href="#teaching-react-to-diff-your-effects"></a>Teaching React to Diff Your Effects</h2><p>Weâ€™ve already learned that lesson with the DOM itself. Instead of touching it on every re-render, React only updates the parts of the DOM that actually change.</p><p>When youâ€™re updating</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Dan</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>to</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Yuzhi</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>React sees two objects:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;</span><br><span class="line">const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;</span><br></pre></td></tr></table></figure><p>It goes over each of their props and determine that <code>children</code> have changed and need a DOM update, but <code>className</code> did not. So it can just do:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domNode.innerText = &apos;Hello, Yuzhi&apos;;</span><br></pre></td></tr></table></figure><p><strong>Could we do something like this with effects too? It would be nice to avoid re-running them when applying the effect is unnecessary.</strong></p><p>For example, maybe our component re-renders because of a state change:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  const [counter, setCounter] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = &apos;Hello, &apos; + name;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCounter(count + 1)&#125;&gt;        Increment      &lt;/button&gt;    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But our effect doesnâ€™t use the <code>counter</code> state. <strong>Our effect synchronizes the <code>document.title</code> with the <code>name</code> prop, but the <code>name</code> prop is the same.</strong> Re-assigning <code>document.title</code> on every counter change seems non-ideal.</p><p>OK, so can React justâ€¦ diff effects?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br></pre></td></tr></table></figure><p>Not really. React canâ€™t guess what the function does without calling it. (The source doesnâ€™t really contain specific values, it just closes over the <code>name</code> prop.)</p><p>This is why if you want to avoid re-running effects unnecessarily, you can provide a dependency array (also known as â€œdepsâ€) argument to <code>useEffect</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><strong>Itâ€™s like if we told React: â€œHey, I know you canâ€™t see <em>inside</em> this function, but I promise it only uses <code>name</code> and nothing else from the render scope.â€</strong></p><p>If each of these values is the same between the current and the previous time this effect ran, thereâ€™s nothing to synchronize so React can skip the effect:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const oldDeps = [&apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const newDeps = [&apos;Dan&apos;];</span><br></pre></td></tr></table></figure><p>If even one of the values in the dependency array is different between renders, we know running the effect canâ€™t be skipped. Synchronize all the things!</p><h2 id="Donâ€™t-Lie-to-React-About-Dependencies"><a href="#Donâ€™t-Lie-to-React-About-Dependencies" class="headerlink" title="Donâ€™t Lie to React About Dependencies"></a><a href="#dont-lie-to-react-about-dependencies"></a>Donâ€™t Lie to React About Dependencies</h2><p>Lying to React about dependencies has bad consequences. Intuitively, this makes sense, but Iâ€™ve seen pretty much everyone who tries <code>useEffect</code> with a mental model from classes try to cheat the rules. (And I did that too at first!)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(The <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">Hooks FAQ</a> explains what to do instead. Weâ€™ll come back to this example <a href="#moving-functions-inside-effects">below</a>.)</em></p><p>â€œBut I only want to run it on mount!â€, youâ€™ll say. For now, remember: if you specify deps, <strong><em>all</em> values from inside your component that are used by the effect <em>must</em> be there</strong>. Including props, state, functions â€” anything in your component.</p><p>Sometimes when you do that, it causes a problem. For example, maybe you see an infinite refetching loop, or a socket is recreated too often. <strong>The solution to that problem is <em>not</em> to remove a dependency.</strong> Weâ€™ll look at the solutions soon.</p><p>But before we jump to solutions, letâ€™s understand the problem better.</p><h2 id="What-Happens-When-Dependencies-Lie"><a href="#What-Happens-When-Dependencies-Lie" class="headerlink" title="What Happens When Dependencies Lie"></a><a href="#what-happens-when-dependencies-lie"></a>What Happens When Dependencies Lie</h2><p>If deps contain every value used by the effect, React knows when to re-run it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt=""></p><p><em>(Dependencies are different, so we re-run the effect.)</em></p><p>But if we specified <code>[]</code> for this effect, the new effect function wouldnâ€™t run:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>In this case the problem might seem obvious. But the intuition can fool you in other cases where a class solution â€œjumps outâ€ from your memory.</p><p>For example, letâ€™s say weâ€™re writing a counter that increments every second. With a class, our intuition is: â€œSet up the interval once and destroy it onceâ€. Hereâ€™s an <a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="noopener">example</a> of how we can do it. When we mentally translate this code to <code>useEffect</code>, we instinctively add <code>[]</code> to the deps. â€œI want it to run onceâ€, right?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(count + 1);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, this example <a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="noopener">only <em>increments</em> once</a>. <em>Oops.</em></p><p>If your mental model is â€œdependencies let me specify when I want to re-trigger the effectâ€, this example might give you an existential crisis. You <em>want</em> to trigger it once because itâ€™s an interval â€” so why is it causing issues?</p><p>However, this makes sense if you know that dependencies are our hint to React about <em>everything</em> that the effect uses from the render scope. It uses <code>count</code> but we lied that it doesnâ€™t with <code>[]</code>. Itâ€™s only a matter of time before this bites us!</p><p>In the first render, <code>count</code> is <code>0</code>. Therefore, <code>setCount(count + 1)</code> in the first renderâ€™s effect means <code>setCount(0 + 1)</code>. <strong>Since we never re-run the effect because of <code>[]</code> deps, it will keep calling <code>setCount(0 + 1)</code> every second:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We lied to React by saying our effect doesnâ€™t depend on a value from inside our component, when in fact it does!</p><p>Our effect uses <code>count</code> â€” a value inside the component (but outside the effect):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const count = </span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>Therefore, specifying <code>[]</code> as a dependency will create a bug. React will compare the dependencies, and skip updating this effect:</p><p><img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>Issues like this are difficult to think about. Therefore, I encourage you to adopt it as a hard rule to always be honest about the effect dependencies, and specify them all. (We provide a <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint rule</a> if you want to enforce this on your team.)</p><h2 id="Two-Ways-to-Be-Honest-About-Dependencies"><a href="#Two-Ways-to-Be-Honest-About-Dependencies" class="headerlink" title="Two Ways to Be Honest About Dependencies"></a><a href="#two-ways-to-be-honest-about-dependencies"></a>Two Ways to Be Honest About Dependencies</h2><p>There are two strategies to be honest about dependencies. You should generally start with the first one, and then apply the second one if needed.</p><p><strong>The first strategy is to fix the dependency array to include <em>all</em> the values inside the component that are used inside the effect.</strong> Letâ€™s include <code>count</code> as a dep:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);  &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>This makes the dependency array correct. It may not be <em>ideal</em> but thatâ€™s the first issue we needed to fix. Now a change to <code>count</code> will re-run the effect, with each next interval referencing <code>count</code> from its render in <code>setCount(count + 1)</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [0]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [1]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That would <a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="noopener">fix the problem</a> but our interval would be cleared and set again whenever the <code>count</code> changes. That may be undesirable:</p><p><img src="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt=""></p><p><em>(Dependencies are different, so we re-run the effect.)</em></p><p><strong>The second strategy is to change our effect code so that it wouldnâ€™t <em>need</em> a value that changes more often than we want.</strong> We donâ€™t want to lie about the dependencies â€” we just want to change our effect to have <em>fewer</em> of them.</p><p>Letâ€™s look at a few common techniques for removing dependencies.</p><h2 id="Making-Effects-Self-Sufficient"><a href="#Making-Effects-Self-Sufficient" class="headerlink" title="Making Effects Self-Sufficient"></a><a href="#making-effects-self-sufficient"></a>Making Effects Self-Sufficient</h2><p>We want to get rid of the <code>count</code> dependency in our effect.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>To do this, we need to ask ourselves: <strong>what are we using <code>count</code> for?</strong> It seems like we only use it for the <code>setCount</code> call. In that case, we donâ€™t actually need <code>count</code> in the scope at all. When we want to update state based on the previous state, we can use the <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="noopener">functional updater form</a> of <code>setState</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(c =&gt; c + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>I like to think of these cases as â€œfalse dependenciesâ€. Yes, <code>count</code> was a necessary dependency because we wrote <code>setCount(count + 1)</code> inside the effect. However, we only truly needed <code>count</code> to transform it into <code>count + 1</code> and â€œsend it backâ€ to React. But React <em>already knows</em> the current <code>count</code>. <strong>All we needed to tell React is to increment the state â€” whatever it is right now.</strong></p><p>Thatâ€™s exactly what <code>setCount(c =&gt; c + 1)</code> does. You can think of it as â€œsending an instructionâ€ to React about how the state should change. This â€œupdater formâ€ also helps in other cases, like when you <a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="noopener">batch multiple updates</a>.</p><p><strong>Note that we actually <em>did the work</em> to remove the dependency. We didnâ€™t cheat. Our effect doesnâ€™t read the <code>counter</code> value from the render scope anymore:</strong></p><p><img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>You can try it <a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="noopener">here</a>.</p><p>Even though this effect only runs once, the interval callback that belongs to the first render is perfectly capable of sending the <code>c =&gt; c + 1</code> update instruction every time the interval fires. It doesnâ€™t need to know the current <code>counter</code> state anymore. React already knows it.</p><h2 id="Functional-Updates-and-Google-Docs"><a href="#Functional-Updates-and-Google-Docs" class="headerlink" title="Functional Updates and Google Docs"></a><a href="#functional-updates-and-google-docs"></a>Functional Updates and Google Docs</h2><p>Remember how we talked about synchronization being the mental model for effects? An interesting aspect of synchronization is that you often want to keep the â€œmessagesâ€ between the systems untangled from their state. For example, editing a document in Google Docs doesnâ€™t actually send the <em>whole</em> page to the server. That would be very inefficient. Instead, it sends a representation of what the user tried to do.</p><p>While our use case is different, a similar philosophy applies to effects. <strong>It helps to send only the minimal necessary information from inside the effects into a component.</strong> The updater form like <code>setCount(c =&gt; c + 1)</code> conveys strictly less information than <code>setCount(count + 1)</code> because it isnâ€™t â€œtaintedâ€ by the current count. It only expresses the action (â€œincrementingâ€). Thinking in React involves <a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="noopener">finding the minimal state</a>. This is the same principle, but for updates.</p><p>Encoding the <em>intent</em> (rather than the result) is similar to how Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="noopener">solves</a> collaborative editing. While this is stretching the analogy, functional updates serve a similar role in React. They ensure updates from multiple sources (event handlers, effect subscriptions, etc) can be correctly applied in a batch and in a predictable way.</p><p><strong>However, even <code>setCount(c =&gt; c + 1)</code> isnâ€™t that great.</strong> It looks a bit weird and itâ€™s very limited in what it can do. For example, if we had two state variables whose values depend on each other, or if we needed to calculate the next state based on a prop, it wouldnâ€™t help us. Luckily, <code>setCount(c =&gt; c + 1)</code> has a more powerful sister pattern. Its name is <code>useReducer</code>.</p><h2 id="Decoupling-Updates-from-Actions"><a href="#Decoupling-Updates-from-Actions" class="headerlink" title="Decoupling Updates from Actions"></a><a href="#decoupling-updates-from-actions"></a>Decoupling Updates from Actions</h2><p>Letâ€™s modify the previous example to have two state variables: <code>count</code> and <code>step</code>. Our interval will increment the count by the value of the <code>step</code> input:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(c =&gt; c + step);    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="noopener">demo</a>.)</p><p>Note that <strong>weâ€™re not cheating</strong>. Since I started using <code>step</code> inside the effect, I added it to the dependencies. And thatâ€™s why the code runs correctly.</p><p>The current behavior in this example is that changing the <code>step</code> restarts the interval â€” because itâ€™s one of the dependencies. And in many cases, that is exactly what you want! Thereâ€™s nothing wrong with tearing down an effect and setting it up anew, and we shouldnâ€™t avoid that unless we have a good reason.</p><p>However, letâ€™s say we want the interval clock to not reset on changes to the <code>step</code>. How do we remove the <code>step</code> dependency from our effect?</p><p><strong>When setting a state variable depends on the current value of another state variable, you might want to try replacing them both with <code>useReducer</code>.</strong></p><p>When you find yourself writing <code>setSomething(something =&gt; ...)</code>, itâ€™s a good time to consider using a reducer instead. A reducer lets you <strong>decouple expressing the â€œactionsâ€ that happened in your component from how the state updates in response to them</strong>.</p><p>Letâ€™s trade the <code>step</code> dependency for a <code>dispatch</code> dependency in our effect:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &apos;tick&apos; &#125;);   &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [dispatch]);</span><br></pre></td></tr></table></figure><p>(See the <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>.)</p><p>You might ask me: â€œHow is this any better?â€ The answer is that <strong>React guarantees the <code>dispatch</code> function to be constant throughout the component lifetime. So the example above doesnâ€™t ever need to resubscribe the interval.</strong></p><p>We solved our problem!</p><p><em>(You may omit <code>dispatch</code>, <code>setState</code>, and <code>useRef</code> container values from the deps because React guarantees them to be static. But it also doesnâ€™t hurt to specify them.)</em></p><p>Instead of reading the state <em>inside</em> an effect, it dispatches an <em>action</em> that encodes the information about <em>what happened</em>. This allows our effect to stay decoupled from the <code>step</code> state. Our effect doesnâ€™t care <em>how</em> we update the state, it just tells us about <em>what happened</em>. And the reducer centralizes the update logic:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">  step: 1,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  const &#123; count, step &#125; = state;</span><br><span class="line">  if (action.type === &apos;tick&apos;) &#123;    return &#123; count: count + step, step &#125;;  &#125; else if (action.type === &apos;step&apos;) &#123;</span><br><span class="line">    return &#123; count, step: action.step &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a> if you missed it earlier).</p><h2 id="Why-useReducer-Is-the-Cheat-Mode-of-Hooks"><a href="#Why-useReducer-Is-the-Cheat-Mode-of-Hooks" class="headerlink" title="Why useReducer Is the Cheat Mode of Hooks"></a><a href="#why-usereducer-is-the-cheat-mode-of-hooks"></a>Why useReducer Is the Cheat Mode of Hooks</h2><p>Weâ€™ve seen how to remove dependencies when an effect needs to set state based on previous state, or on another state variable. <strong>But what if we need <em>props</em> to calculate the next state?</strong> For example, maybe our API is <code>&lt;Counter step={1} /&gt;</code>. Surely, in this case we canâ€™t avoid specifying <code>props.step</code> as a dependency?</p><p>In fact, we can! We can put <em>the reducer itself</em> inside our component to read props:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter(&#123; step &#125;) &#123;  const [count, dispatch] = useReducer(reducer, 0);</span><br><span class="line"></span><br><span class="line">  function reducer(state, action) &#123;</span><br><span class="line">    if (action.type === &apos;tick&apos;) &#123;</span><br><span class="line">      return state + step;    &#125; else &#123;</span><br><span class="line">      throw new Error();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &apos;tick&apos; &#125;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This pattern disables a few optimizations so try not to use it everywhere, but you can totally access props from a reducer if you need to. (Hereâ€™s a <a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="noopener">demo</a>.)</p><p><strong>Even in that case, <code>dispatch</code> identity is still guaranteed to be stable between re-renders.</strong> So you may omit it from the effect deps if you want. Itâ€™s not going to cause the effect to re-run.</p><p>You may be wondering: how can this possibly work? How can the reducer â€œknowâ€ props when called from inside an effect that belongs to another render? The answer is that when you <code>dispatch</code>, React just remembers the action â€” but it will <em>call</em> your reducer during the next render. At that point the fresh props will be in scope, and you wonâ€™t be inside an effect.</p><p><strong>This is why I like to think of <code>useReducer</code> as the â€œcheat modeâ€ of Hooks. It lets me decouple the update logic from describing what happened. This, in turn, helps me remove unnecessary dependencies from my effects and avoid re-running them more often than necessary.</strong></p><h2 id="Moving-Functions-Inside-Effects"><a href="#Moving-Functions-Inside-Effects" class="headerlink" title="Moving Functions Inside Effects"></a><a href="#moving-functions-inside-effects"></a>Moving Functions Inside Effects</h2><p>A common mistake is to think functions shouldnâ€™t be dependencies. For example, this seems like it could work:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [data, setData] = useState(&#123; hits: [] &#125;);</span><br><span class="line"></span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(</span><br><span class="line">      &apos;https://hn.algolia.com/api/v1/search?query=react&apos;,</span><br><span class="line">    );</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br></pre></td></tr></table></figure><p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="noopener">This example</a> is adapted from a great article by Robin Wieruch â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">check it out</a>!)</em></p><p>And to be clear, this code <em>does</em> work. <strong>But the problem with simply omitting local functions is that it gets pretty hard to tell whether weâ€™re handling all cases as the component grows!</strong></p><p>Imagine our code was split like this and each function was five times larger:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now letâ€™s say we later use some state or prop in one of these functions:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we forget to update the deps of any effects that call these functions (possibly, through other functions!), our effects will fail to synchronize changes from our props and state. This doesnâ€™t sound great.</p><p>Luckily, there is an easy solution to this problem. <strong>If you only use some functions <em>inside</em> an effect, move them directly <em>into</em> that effect:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        function getFetchUrl() &#123;      return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;    &#125;    async function fetchData() &#123;      const result = await axios(getFetchUrl());      setData(result.data);    &#125;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="noopener">Hereâ€™s a demo</a>.)</p><p>So what is the benefit? We no longer have to think about the â€œtransitive dependenciesâ€. Our dependencies array isnâ€™t lying anymore: <strong>we truly <em>arenâ€™t</em> using anything from the outer scope of the component in our effect</strong>.</p><p>If we later edit <code>getFetchUrl</code> to use the <code>query</code> state, weâ€™re much more likely to notice that weâ€™re editing it <em>inside</em> an effect â€” and therefore, we need to add <code>query</code> to the effect dependencies:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    function getFetchUrl() &#123;</span><br><span class="line">      return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;    &#125;</span><br><span class="line"></span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, [query]); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="noopener">demo</a>.)</p><p>By adding this dependency, weâ€™re not just â€œappeasing Reactâ€. It <em>makes sense</em> to refetch the data when the query changes. <strong>The design of <code>useEffect</code> forces you to notice the change in our data flow and choose how our effects should synchronize it â€” instead of ignoring it until our product users hit a bug.</strong></p><p>Thanks to the <code>exhaustive-deps</code> lint rule from the <code>eslint-plugin-react-hooks</code> plugin, you can <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">analyze the effects as you type in your editor</a> and receive suggestions about which dependencies are missing. In other words, a machine can tell you which data flow changes arenâ€™t handled correctly by a component.</p><p><img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt=""></p><p>Pretty sweet.</p><h2 id="But-I-Canâ€™t-Put-This-Function-Inside-an-Effect"><a href="#But-I-Canâ€™t-Put-This-Function-Inside-an-Effect" class="headerlink" title="But I Canâ€™t Put This Function Inside an Effect"></a><a href="#but-i-cant-put-this-function-inside-an-effect"></a>But I Canâ€™t Put This Function Inside an Effect</h2><p>Sometimes you might not want to move a function <em>inside</em> an effect. For example, several effects in the same component may call the same function, and you donâ€™t want to copy and paste its logic. Or maybe itâ€™s a prop.</p><p>Should you skip a function like this in the effect dependencies? I think not. Again, <strong>effects shouldnâ€™t lie about their dependencies.</strong> There are usually better solutions. A common misconception is that â€œa function would never changeâ€. But as we learned throughout this article, this couldnâ€™t be further from truth. Indeed, a function defined inside a component changes on every render!</p><p><strong>That by itself presents a problem.</strong> Say two effects call <code>getFetchUrl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  function getFetchUrl(query) &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In that case you might not want to move <code>getFetchUrl</code> inside either of the effects since you wouldnâ€™t be able to share the logic.</p><p>On the other hand, if youâ€™re â€œhonestâ€ about the effect dependencies, you may run into a problem. Since both our effects depend on <code>getFetchUrl</code> <strong>(which is different on every render)</strong>, our dependency arrays are useless:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    function getFetchUrl(query) &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A tempting solution to this is to just skip the <code>getFetchUrl</code> function in the deps list. However, I donâ€™t think itâ€™s a good solution. This makes it difficult to notice when we <em>are</em> adding a change to the data flow that <em>needs</em> to be handled by an effect. This leads to bugs like the â€œnever updating intervalâ€ we saw earlier.</p><p>Instead, there are two other solutions that are simpler.</p><p><strong>First of all, if a function doesnâ€™t use anything from the component scope, you can hoist it outside the component and then freely use it inside your effects:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function getFetchUrl(query) &#123;  return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;</span><br><span class="line">function SearchResults() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Thereâ€™s no need to specify it in deps because itâ€™s not in the render scope and canâ€™t be affected by the data flow. It canâ€™t accidentally depend on props or state.</p><p>Alternatively, you can wrap it into the <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="noopener"><code>useCallback</code> Hook</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    const getFetchUrl = useCallback((query) =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, []);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useCallback</code> is essentially like adding another layer of dependency checks. Itâ€™s solving the problem on the other end â€” <strong>rather than avoid a function dependency, we make the function itself only change when necessary</strong>.</p><p>Letâ€™s see why this approach is useful. Previously, our example showed two search results (for <code>&#39;react&#39;</code> and <code>&#39;redux&#39;</code> search queries). But letâ€™s say we want to add an input so that you can search for an arbitrary <code>query</code>. So instead of taking <code>query</code> as an argument, <code>getFetchUrl</code> will now read it from local state.</p><p>Weâ€™ll immediately see that itâ€™s missing a <code>query</code> dependency:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line">  const getFetchUrl = useCallback(() =&gt; &#123; </span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;, []);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If I fix my <code>useCallback</code> deps to include <code>query</code>, any effect with <code>getFetchUrl</code> in deps will re-run whenever the <code>query</code> changes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const getFetchUrl = useCallback(() =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, [query]);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl();</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Thanks to <code>useCallback</code>, if <code>query</code> is the same, <code>getFetchUrl</code> also stays the same, and our effect doesnâ€™t re-run. But if <code>query</code> changes, <code>getFetchUrl</code> will also change, and we will re-fetch the data. Itâ€™s a lot like when you change some cell in an Excel spreadsheet, and the other cells using it recalculate automatically.</p><p>This is just a consequence of embracing the data flow and the synchronization mindset. <strong>The same solution works for function props passed from parents:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const fetchData = useCallback(() =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;      &#125;, [query]);  </span><br><span class="line">  return &lt;Child fetchData=&#123;fetchData&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; fetchData &#125;) &#123;</span><br><span class="line">  let [data, setData] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData().then(setData);</span><br><span class="line">  &#125;, [fetchData]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Since <code>fetchData</code> only changes inside <code>Parent</code> when its <code>query</code> state changes, our <code>Child</code> wonâ€™t refetch the data until itâ€™s actually necessary for the app.</p><h2 id="Are-Functions-Part-of-the-Data-Flow"><a href="#Are-Functions-Part-of-the-Data-Flow" class="headerlink" title="Are Functions Part of the Data Flow?"></a><a href="#are-functions-part-of-the-data-flow"></a>Are Functions Part of the Data Flow?</h2><p>Interestingly, this pattern is broken with classes in a way that really shows the difference between the effect and lifecycle paradigms. Consider this translation:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;      &#125;;  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;    this.props.fetchData();  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You might be thinking: â€œCome on Dan, we all know that <code>useEffect</code> is like <code>componentDidMount</code> and <code>componentDidUpdate</code> combined, you canâ€™t keep beating that drum!â€ <strong>Yet this doesnâ€™t work even with <code>componentDidUpdate</code>:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;        if (this.props.fetchData !== prevProps.fetchData) &#123;      this.props.fetchData();    &#125;  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Of course, <code>fetchData</code> is a class method! (Or, rather, a class property â€” but that doesnâ€™t change anything.) Itâ€™s not going to be different because of a state change. So <code>this.props.fetchData</code> will stay equal to <code>prevProps.fetchData</code> and weâ€™ll never refetch. Letâ€™s just remove this condition then?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps) &#123;</span><br><span class="line">  this.props.fetchData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Oh wait, this fetches on <em>every</em> re-render. (Adding an animation above in the tree is a fun way to discover it.) Maybe letâ€™s bind it to a particular query?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But then <code>this.props.fetchData !== prevProps.fetchData</code> is <em>always</em> <code>true</code>, even if the <code>query</code> didnâ€™t change! So weâ€™ll <em>always</em> refetch.</p><p>The only real solution to this conundrum with classes is to bite the bullet and pass the <code>query</code> itself into the <code>Child</code> component. The <code>Child</code> doesnâ€™t actually end up <em>using</em> the <code>query</code>, but it can trigger a refetch when it changes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;</span><br><span class="line">    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;;  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    if (this.props.query !== prevProps.query) &#123;      this.props.fetchData();    &#125;  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Over the years of working with classes with React, Iâ€™ve gotten so used to passing unnecessary props down and breaking encapsulation of parent components that I only realized a week ago why we had to do it.</p><p><strong>With classes, function props by themselves arenâ€™t truly a part of the data flow.</strong> Methods close over the mutable <code>this</code> variable so we canâ€™t rely on their identity to mean anything. Therefore, even when we only want a function, we have to pass a bunch of other data around in order to be able to â€œdiffâ€ it. We canâ€™t know whether <code>this.props.fetchData</code> passed from the parent depends on some state or not, and whether that state has just changed.</p><p><strong>With <code>useCallback</code>, functions can fully participate in the data flow.</strong> We can say that if the function inputs changed, the function itself has changed, but if not, it stayed the same. Thanks to the granularity provided by <code>useCallback</code>, changes to props like <code>props.fetchData</code> can propagate down automatically.</p><p>Similarly, <a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a> lets us do the same for complex objects:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ColorPicker() &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  const [color, setColor] = useState(&apos;pink&apos;);</span><br><span class="line">  const style = useMemo(() =&gt; (&#123; color &#125;), [color]);</span><br><span class="line">  return &lt;Child style=&#123;style&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>I want to emphasize that putting <code>useCallback</code> everywhere is pretty clunky.</strong> Itâ€™s a nice escape hatch and itâ€™s useful when a function is both passed down <em>and</em> called from inside an effect in some children. Or if youâ€™re trying to prevent breaking memoization of a child component. But Hooks lend themselves better to <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="noopener">avoiding passing callbacks down</a> altogether.</p><p>In the above examples, Iâ€™d much prefer if <code>fetchData</code> was either inside my effect (which itself could be extracted to a custom Hook) or a top-level import. I want to keep the effects simple, and callbacks in them donâ€™t help that. (â€œWhat if some <code>props.onComplete</code> callback changes while the request was in flight?â€) You can <a href="#swimming-against-the-tide">simulate the class behavior</a> but that doesnâ€™t solve race conditions.</p><h2 id="Speaking-of-Race-Conditions"><a href="#Speaking-of-Race-Conditions" class="headerlink" title="Speaking of Race Conditions"></a><a href="#speaking-of-race-conditions"></a>Speaking of Race Conditions</h2><p>A classic data fetching example with classes might look like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you probably know, this code is buggy. It doesnâ€™t handle updates. So the second classic example you could find online is something like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;    if (prevProps.id !== this.props.id) &#123;      this.fetchData(this.props.id);    &#125;  &#125;  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is definitely better! But itâ€™s still buggy. The reason itâ€™s buggy is that the request may come out of order. So if Iâ€™m fetching <code>{id: 10}</code>, switch to <code>{id: 20}</code>, but the <code>{id: 20}</code> request comes first, the request that started earlier but finished later would incorrectly overwrite my state.</p><p>This is called a race condition, and itâ€™s typical in code that mixes <code>async</code> / <code>await</code> (which assumes something waits for the result) with top-down data flow (props or state can change while weâ€™re in the middle of an async function).</p><p>Effects donâ€™t magically solve this problem, although theyâ€™ll warn you if you try to pass an <code>async</code> function to the effect directly. (Weâ€™ll need to improve that warning to better explain the problems you might run into.)</p><p>If the async approach you use supports cancellation, thatâ€™s great! You can cancel the async request right in your cleanup function.</p><p>Alternatively, the easiest stopgap approach is to track it with a boolean:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Article(&#123; id &#125;) &#123;</span><br><span class="line">  const [article, setArticle] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let didCancel = false;</span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const article = await API.fetchArticle(id);</span><br><span class="line">      if (!didCancel) &#123;        setArticle(article);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;      didCancel = true;    &#125;;  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">This article</a> goes into more detail about how you can handle errors and loading states, as well as extract that logic into a custom Hook. I recommend you to check it out if youâ€™re interested to learn more about data fetching with Hooks.</p><h2 id="Raising-the-Bar"><a href="#Raising-the-Bar" class="headerlink" title="Raising the Bar"></a><a href="#raising-the-bar"></a>Raising the Bar</h2><p>With the class lifecycle mindset, side effects behave differently from the render output. Rendering the UI is driven by props and state, and is guaranteed to be consistent with them, but side effects are not. This is a common source of bugs.</p><p>With the mindset of <code>useEffect</code>, things are synchronized by default. Side effects become a part of the React data flow. For every <code>useEffect</code> call, once you get it right, your component handles edge cases much better.</p><p>However, the upfront cost of getting it right is higher. This can be annoying. Writing synchronization code that handles edge cases well is inherently more difficult than firing one-off side effects that arenâ€™t consistent with rendering.</p><p>This could be worrying if <code>useEffect</code> was meant to be <em>the</em> tool you use most of the time. However, itâ€™s a low-level building block. Itâ€™s an early time for Hooks so everybody uses low-level ones all the time, especially in tutorials. But in practice, itâ€™s likely the community will start moving to higher-level Hooks as good APIs gain momentum.</p><p>Iâ€™m seeing different apps create their own Hooks like <code>useFetch</code> that encapsulates some of their appâ€™s auth logic or <code>useTheme</code> which uses theme context. Once you have a toolbox of those, you donâ€™t reach for <code>useEffect</code> <em>that</em> often. But the resilience it brings benefits every Hook built on top of it.</p><p>So far, <code>useEffect</code> is most commonly used for data fetching. But data fetching isnâ€™t exactly a synchronization problem. This is especially obvious because our deps are often <code>[]</code>. What are we even synchronizing?</p><p>In the longer term, <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="noopener">Suspense for Data Fetching</a> will allow third-party libraries to have a first-class way to tell React to suspend rendering until something async (anything: code, data, images) is ready.</p><p>As Suspense gradually covers more data fetching use cases, I anticipate that <code>useEffect</code> will fade into background as a power user tool for cases when you actually want to synchronize props and state to some side effect. Unlike data fetching, it handles this case naturally because it was designed for it. But until then, custom Hooks like <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">shown here</a> are a good way to reuse data fetching logic.</p><h2 id="In-Closing"><a href="#In-Closing" class="headerlink" title="In Closing"></a><a href="#in-closing"></a>In Closing</h2><p>Now that you know pretty much everything I know about using effects, check out the <a href="#tldr">TLDR</a> in the beginning. Does it make sense? Did I miss something? (I havenâ€™t run out of paper yet!)</p><p>Iâ€™d love to hear from you on Twitter! Thanks for reading.</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/6387.html">https://andyxw.com/archives/6387.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      useEffect å®Œæ•´æŒ‡å— â€” Dan Abramov
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
      <category term="useEffect" scheme="https://andyxw.com/tags/useEffect/"/>
    
  </entry>
  
  <entry>
    <title>A Complete Guide to useEffectï¼ˆä¸­æ–‡ç‰ˆï¼‰</title>
    <link href="https://andyxw.com/archives/4233.html"/>
    <id>https://andyxw.com/archives/4233.html</id>
    <published>2019-08-23T10:49:59.210Z</published>
    <updated>2019-08-23T11:08:57.745Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/</a></p></blockquote><p>ä½ ç”¨ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hooks</a> å†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„ API å¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº› <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom Hooks</a> å»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº† 300 è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚</p><p>ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨<code>useEffect</code>ä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒ class çš„ç”Ÿå‘½å‘¨æœŸâ€¦ ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š</p><ul><li>ğŸ¤” å¦‚ä½•ç”¨<code>useEffect</code>æ¨¡æ‹Ÿ<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸï¼Ÿ</li><li>ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨<code>useEffect</code>é‡Œè¯·æ±‚æ•°æ®ï¼Ÿ<code>[]</code>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– propï¼Ÿ</li></ul><p>å½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨ Hooks çš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº› â€œå•Šå“ˆâ€ çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚<strong>è¿™ç¯‡æ–‡ç« ä¼šæ·±å…¥è®²è§£å¸®ä½ æ˜ç™½ä¸Šé¢é—®é¢˜çš„ç­”æ¡ˆã€‚</strong></p><p>åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼š<code>useEffect</code>ã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚</p><p><strong>å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„ class ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†<code>useEffect</code> è¿™ä¸ª Hook çš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚</strong></p><blockquote><p>â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yoda</p></blockquote><p><a href="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" target="_blank" rel="noopener"><img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" alt=""></a></p><p><strong>è¿™ç¯‡æ–‡ç« ä¼šå‡è®¾ä½ å¯¹ <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener"><code>useEffect</code></a> API æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ã€‚</strong></p><p><strong>è¿™ç¯‡æ–‡ç« çœŸçš„å¾ˆé•¿ã€‚å®ƒæ›´åƒä¸€æœ¬ mini ä¹¦ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ›´å–œæ¬¢çš„å½¢å¼ã€‚å¦‚æœä½ å¾ˆåŒ†å¿™æˆ–è€…å¹¶ä¸æ˜¯å¤ªå…³å¿ƒæœ¬æ–‡ä¸»é¢˜çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„æ‘˜è¦ã€‚</strong></p><p><strong>å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ 2013 å¹´ React åˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚</strong></p><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a><a href="#%E6%91%98%E8%A6%81"></a>æ‘˜è¦</h2><p>å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚</p><p>å¦‚æœä½ æ‰“ç®—é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œä½ å®Œå…¨å¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†ã€‚æˆ‘ä¼šåœ¨æ–‡ç« æœ«å°¾å¸¦ä¸Šæ‘˜è¦çš„é“¾æ¥ã€‚</p><p><strong>ğŸ¤” Question: å¦‚ä½•ç”¨<code>useEffect</code>æ¨¡æ‹Ÿ<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸï¼Ÿ</strong></p><p>è™½ç„¶å¯ä»¥ä½¿ç”¨<code>useEffect(fn, [])</code>ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’Œ<code>componentDidMount</code>ä¸ä¸€æ ·ï¼Œ<code>useEffect</code>ä¼š_æ•è·_ props å’Œ stateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„ props å’Œ stateã€‚å¦‚æœä½ æƒ³å¾—åˆ° â€œæœ€æ–°â€ çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨ refã€‚è®°ä½ï¼Œeffects çš„å¿ƒæ™ºæ¨¡å‹å’Œ<code>componentDidMount</code>ä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦ â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p><p><strong>ğŸ¤” Question: å¦‚ä½•æ­£ç¡®åœ°åœ¨<code>useEffect</code>é‡Œè¯·æ±‚æ•°æ®ï¼Ÿ<code>[]</code>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨<code>useEffect</code>é‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚<code>[]</code>è¡¨ç¤º effect æ²¡æœ‰ä½¿ç”¨ä»»ä½• React æ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥ effect ä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚<code>[]</code>åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯<code>useReducer</code> å’Œ <code>useCallback</code>ï¼‰æ¥ç§»é™¤è¿™äº› effect ä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚</p><p><strong>ğŸ¤” Question: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼Ÿ</strong></p><p>ä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ– props å’Œ state çš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢« effect ä½¿ç”¨çš„å‡½æ•°æ”¾åˆ° effect é‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„ effect è¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡ props ä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨<code>useCallback</code>åŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ° props å’Œ stateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„ FAQ æœ‰<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">æ›´è¯¦ç»†çš„ç­”æ¡ˆ</a>ã€‚</p><p><strong>ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</strong></p><p>è¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨ effect é‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½® effect ä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨ effect ä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘ effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨<code>[]</code>ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ° effect é‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨<code>useCallback</code>åŒ…ä¸€å±‚ã€‚<code>useMemo</code> å¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚</p><p><strong>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– prop å‘¢ï¼Ÿ</strong></p><p>Effect æ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚è¿™èƒ½å¤Ÿ<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">é¿å…ä¸€äº› bugs</a>ï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„ ref ä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„ props å’Œ stateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ª <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint è§„åˆ™</a>æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘ FAQ ä¸­çš„<a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="noopener">è¿™ä¸ªå›ç­”ã€‚</a></p><p>æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚</p><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Props-and-State"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Props-and-State" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and State"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84-props-and-state"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and State</h2><p>åœ¨æˆ‘ä»¬è®¨è®º effects ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ Counterï¼Œæ³¨æ„é«˜äº®çš„é‚£ä¸€è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é«˜äº®çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ<code>count</code> ä¼š â€œç›‘å¬â€ çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹  React çš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯<a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹</a>ã€‚</p><p><strong>ä¸Šé¢ä¾‹å­ä¸­ï¼Œ<code>count</code>ä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚</strong>å®ƒä¸æ˜¯ç¥å¥‡çš„ â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const count = 42;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»<code>useState()</code>æ‹¿åˆ°<code>count</code>çš„åˆå§‹å€¼<code>0</code>ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>setCount(1)</code>ï¼ŒReact ä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡<code>count</code>æ˜¯<code>1</code>ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„<code>count</code> çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚</strong></p><p>æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p><strong>å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº† count è¿™ä¸ªæ•°å­—ã€‚</strong>è¿™ä¸ªæ•°å­—ç”± React æä¾›ã€‚å½“<code>setCount</code>çš„æ—¶å€™ï¼ŒReact ä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„<code>count</code>å€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReact ä¼šæ›´æ–° DOM ä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚</p><p>è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„<code>count</code>å€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚</p><p><em>ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">React as a UI Runtime</a>ã€‚ï¼‰</em></p><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿ</p><p>çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼š alert ç‚¹å‡»æ¬¡æ•°<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  function handleAlertClick() &#123;    setTimeout(() =&gt; &#123;      alert(&apos;You clicked on: &apos; + count);    &#125;, 3000);  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;        Show alert      &lt;/button&gt;    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼š</p><ul><li><strong>ç‚¹å‡»å¢åŠ </strong> counter åˆ° 3</li><li><strong>ç‚¹å‡»ä¸€ä¸‹</strong> â€œShow alertâ€</li><li><strong>ç‚¹å‡»å¢åŠ </strong> counter åˆ° 5 å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ</li></ul><p><img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt=""></p><p>ä½ çŒœ alert ä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯ 5 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯ alert çš„æ—¶å€™ counter çš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯ 3 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚</p><p><em>å‰§é€é¢„è­¦</em></p><p>æ¥è‡ªå·± <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">è¯•è¯•å§ï¼</a></p><p>å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨ state ä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„ IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚ <a href="https://overreacted.io/how-are-function-components-different-from-classes" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯ 3ã€‚</p><p>alert ä¼š â€œæ•è·â€ æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚</p><p><em>ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡º â€œæœ€å°é˜»åŠ›è·¯å¾„â€ æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰</em></p><p>ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‘ç°<code>count</code>åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” <strong>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­<code>count</code>å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚</strong></p><p>è¿™å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function sayHi(person) &#123;</span><br><span class="line">  const name = person.name;  setTimeout(() =&gt; &#123;</span><br><span class="line">    alert(&apos;Hello, &apos; + name);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let someone = &#123;name: &apos;Dan&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Yuzhi&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Dominic&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br></pre></td></tr></table></figure><p>åœ¨ <a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a>ä¸­, å¤–å±‚çš„<code>someone</code>ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨ React ä¸­ï¼Œ_å½“å‰_çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚<strong>ç„¶åï¼Œåœ¨<code>sayHi</code>å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡<code>name</code>ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„<code>person</code>å…³è”ã€‚</strong>å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ª alert éƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„<code>name</code>ã€‚</p><p>è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„<code>count</code>å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ â€œçœ‹åˆ°â€ çš„æ˜¯å®ƒè‡ªå·±çš„<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ª â€œæ–°ç‰ˆæœ¬â€ çš„<code>handleAlertClick</code>ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„<code>handleAlertClick</code>â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ <code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 0);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 1);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 2);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">åœ¨è¿™ä¸ª demo ä¸­</a>ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° â€œå±äºâ€ æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­<code>counter</code>çš„çŠ¶æ€å€¼ã€‚</p><p><strong>åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œprops å’Œ state æ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚</strong>å¦‚æœ props å’Œ state åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½ â€œå±äºâ€ ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨ â€œçœ‹åˆ°â€ çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</p><p><em>å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„<code>count</code>å€¼ç›´æ¥å†…è”åˆ°äº†<code>handleAlertClick</code>å‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„å› ä¸º<code>count</code> å€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹ state è¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨<code>setSomething(newObj)</code>çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„ state ä¸ä¼šè¢«æ±¡æŸ“ã€‚</em></p><h2 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Effects"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Effects" class="headerlink" title="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effects"></a><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84effects"></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effects</h2><p>è¿™ç¯‡æ–‡ç« æ˜¯å…³äº effects çš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®º effectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffects å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>è®©æˆ‘ä»¬å›åˆ°<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a>ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = `You clicked $&#123;count&#125; times`;  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffect æ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„<code>count</code> çŠ¶æ€å€¼çš„å‘¢ï¼Ÿ</strong></p><p>ä¹Ÿè®¸ï¼Œæ˜¯æŸç§ â€œdata bindingâ€ æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—<code>count</code>èƒ½å¤Ÿåœ¨ effect å‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸<code>count</code>æ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReact ä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„ effect å‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿ</p><p>éƒ½ä¸æ˜¯ã€‚</p><p>æˆ‘ä»¬å·²ç»çŸ¥é“<code>count</code>æ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•° â€œçœ‹åˆ°â€ çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„<code>count</code>çŠ¶æ€å€¼ã€‚å¯¹äº effects ä¹ŸåŒæ ·å¦‚æ­¤ï¼š</p><p><strong>å¹¶ä¸æ˜¯<code>count</code>çš„å€¼åœ¨ â€œä¸å˜â€ çš„ effect ä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯ <em>effect å‡½æ•°æœ¬èº«</em>åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚</strong></p><p>æ¯ä¸€ä¸ª effect ç‰ˆæœ¬ â€œçœ‹åˆ°â€ çš„<code>count</code>å€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;0&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;1&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;2&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React ä¼šè®°ä½ä½ æä¾›çš„ effect å‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äº DOM å¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚</p><p>æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ª <em>effect</em>ï¼ˆè¿™é‡ŒæŒ‡æ›´æ–° document çš„ titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ª<em>ä¸åŒçš„å‡½æ•°</em> â€” å¹¶ä¸”æ¯ä¸ª effect å‡½æ•° â€œçœ‹åˆ°â€ çš„ props å’Œ state éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚</p><p><strong>æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡ effects æ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚</strong></p><p>ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener">å…è®¸ Hook çš„ç»„åˆ</a>å¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffect å‡½æ•°_å±äº_æŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚</p><p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼š</p><ul><li><strong>React:</strong> ç»™æˆ‘çŠ¶æ€ä¸º <code>0</code>æ—¶å€™çš„ UIã€‚</li><li><p><strong>ä½ çš„ç»„ä»¶:</strong></p><ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effect: <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li></ul></li><li><strong>React:</strong> æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™ DOM æ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚</li><li><strong>æµè§ˆå™¨:</strong> é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li><p><strong>React:</strong> å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„ effect</p><ul><li>è¿è¡Œ <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li></ul></li></ul><p>ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><ul><li><strong>ä½ çš„ç»„ä»¶:</strong> å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º<code>1</code>ã€‚</li><li><strong>React:</strong> ç»™æˆ‘çŠ¶æ€ä¸º <code>1</code>æ—¶å€™çš„ UIã€‚</li><li><p><strong>ä½ çš„ç»„ä»¶:</strong></p><ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effectï¼š <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li></ul></li><li><strong>React:</strong> æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº† DOMã€‚</li><li><strong>Browser:</strong> é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li><p><strong>React:</strong> å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„ effect</p><ul><li>è¿è¡Œ <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li></ul></li></ul><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦-æ‰€æœ‰"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦-æ‰€æœ‰" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦ æ‰€æœ‰"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%89%80%E6%9C%89"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦ æ‰€æœ‰</h2><p><strong>æˆ‘ä»¬ç°åœ¨çŸ¥é“ effects ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ â€œçœ‹åˆ°â€ å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„ props å’Œ stateã€‚</strong></p><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    setTimeout(() =&gt; &#123;      console.log(`You clicked $&#123;count&#125; times`);    &#125;, 3000);  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨ effect é‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><em>å‰§é€é¢„è­¦</em></p><p>ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„<code>count</code>å€¼ã€‚ä½ å¯ä»¥<a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a>ï¼š</p><p><img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif" alt=""></p><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€</p><p>ä¸è¿‡ï¼Œclass ä¸­çš„<code>this.state</code>å¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„ <a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="noopener">class å®ç°</a>å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(`You clicked $&#123;this.state.count&#125; times`);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œ<code>this.state.count</code>æ€»æ˜¯æŒ‡å‘_æœ€æ–°_çš„ count å€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯<code>5</code>ï¼š</p><p><img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt=""></p><p>æˆ‘è§‰å¾— Hooks è¿™ä¹ˆä¾èµ– Javascript é—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„ class å®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆ<a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="noopener">the canonical wrong-value-in-a-timeout confusion</a>ï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReact ä¿®æ”¹äº† class ä¸­çš„<code>this.state</code>ä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚</p><p><strong>å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚</strong>æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œprops å’Œ state åœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="noopener">ä½¿ç”¨é—­åŒ…</a>ä¿®å¤ä¸Šé¢çš„ class ç‰ˆæœ¬â€¦</p><h2 id="é€†æ½®è€ŒåŠ¨"><a href="#é€†æ½®è€ŒåŠ¨" class="headerlink" title="é€†æ½®è€ŒåŠ¨"></a><a href="#%E9%80%86%E6%BD%AE%E8%80%8C%E5%8A%A8"></a>é€†æ½®è€ŒåŠ¨</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼š<strong>æ¯ä¸€ä¸ª</strong>ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„ props å’Œ stateã€‚</p><p>æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(props.counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  const counter = props.counter;  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å– props æˆ–è€… state æ˜¯æ— å…³ç´§è¦çš„ã€‚</strong>å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œprops å’Œ state å§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„ props ä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰</p><p>å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½_æƒ³_åœ¨ effect çš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨ refsï¼Œ<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»_è¿‡å»<em>æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–</em>æœªæ¥<em>çš„ props å’Œ stateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰</em>é”™_ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿ â€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨ class ä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚</p><p>ä¸‹é¢è¿™ä¸ª<a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="noopener">è®¡æ•°å™¨ç‰ˆæœ¬</a> æ¨¡æ‹Ÿäº† class ä¸­çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const latestCount = useRef(count);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        latestCount.current = count;    setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(`You clicked $&#123;latestCount.current&#125; times`);    &#125;, 3000);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt=""></p><p>åœ¨ React ä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨ class ç»„ä»¶ä¸­ React æ­£æ˜¯è¿™æ ·å»ä¿®æ”¹<code>this.state</code>çš„ã€‚ä¸åƒæ•è·çš„ props å’Œ stateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„<code>latestCount.current</code>æ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚</p><h2 id="é‚£-Effect-ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ"><a href="#é‚£-Effect-ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ Effect ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ"></a><a href="#%E9%82%A3effect%E4%B8%AD%E7%9A%84%E6%B8%85%E7%90%86%E5%8F%88%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%E5%91%A2%EF%BC%9F"></a>é‚£ Effect ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</h2><p>åƒ <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="noopener">æ–‡æ¡£ä¸­è§£é‡Šçš„</a>, æœ‰äº› effects å¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚</p><p>æ€è€ƒä¸‹é¢çš„ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™<code>props</code>æ˜¯<code>{id: 10}</code>ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯<code>{id: 20}</code>ã€‚ä½ _å¯èƒ½_ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼š</p><ul><li>React æ¸…é™¤äº† <code>{id: 10}</code>çš„ effectã€‚</li><li>React æ¸²æŸ“<code>{id: 20}</code>çš„ UIã€‚</li><li>React è¿è¡Œ<code>{id: 20}</code>çš„ effectã€‚</li></ul><p>(äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚)</p><p>å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹ â€œçœ‹åˆ°â€ çš„æ˜¯æ—§çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„ effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäº class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡<strong>å®ƒå¹¶ä¸ç²¾ç¡®</strong>ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>React åªä¼šåœ¨<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="noopener">æµè§ˆå™¨ç»˜åˆ¶</a>åè¿è¡Œ effectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•° effects å¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effect çš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚<strong>ä¸Šä¸€æ¬¡çš„ effect ä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ï¼š</strong></p><ul><li><strong>React æ¸²æŸ“<code>{id: 20}</code>çš„ UIã€‚</strong></li><li>æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°<code>{id: 20}</code>çš„ UIã€‚</li><li><strong>React æ¸…é™¤<code>{id: 10}</code>çš„ effectã€‚</strong></li><li>React è¿è¡Œ<code>{id: 20}</code>çš„ effectã€‚</li></ul><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect å‘ç”Ÿåœ¨ props å˜æˆ<code>{id: 20}</code>ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½ â€œçœ‹åˆ°â€ æ—§çš„<code>{id: 10}</code>ï¼Ÿ</p><p>ä½ æ›¾ç»æ¥è¿‡è¿™é‡Œâ€¦ ğŸ¤”</p><p><img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt=""></p><p>å¼•ç”¨ä¸ŠåŠéƒ¨åˆ†å¾—åˆ°çš„ç»“è®º:</p><blockquote><p>ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚</p></blockquote><p>ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effect çš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å– â€œæœ€æ–°â€ çš„ propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">            return () =&gt; &#123;        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);      &#125;;    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      </span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ effect çš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°<code>{id: 10}</code>è¿™ä¸ª propsã€‚</p><p>è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆ React èƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç† effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„ propsã€‚</p><h2 id="åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ"><a href="#åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ"></a><a href="#%E5%90%8C%E6%AD%A5%EF%BC%8C-%E8%80%8C%E9%9D%9E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"></a>åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ</h2><p>æˆ‘æœ€å–œæ¬¢ React çš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„<a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="noopener">ç†µ</a>ã€‚</p><p>æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘å…ˆæ¸²æŸ“<code>&lt;Greeting /&gt;</code>ç„¶åæ¸²æŸ“<code>&lt;Greeting /&gt;</code>ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“<code>&lt;Greeting /&gt;</code>å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯ â€œHello, Yuzhiâ€ã€‚</p><p>äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨ React ä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚<strong>é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚</strong>è¿™å°±æ˜¯ JQuery ä»£ç ä¸­ <code>$.addClass</code> æˆ– <code>$.removeClass</code>è¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’Œ React ä»£ç ä¸­å£°æ˜ CSS ç±»å<em>åº”è¯¥æ˜¯ä»€ä¹ˆ</em>ï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p><strong>React ä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„ props å’Œ state åŒæ­¥åˆ° DOMã€‚</strong>â€œmountâ€å’Œ â€œupdateâ€ ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒ effectsã€‚<strong><code>useEffect</code>ä½¿ä½ èƒ½å¤Ÿæ ¹æ® props å’Œ state _åŒæ­¥_ React tree ä¹‹å¤–çš„ä¸œè¥¿ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = &apos;Hello, &apos; + name;  &#125;);  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„ <em>mount/update/unmount</em> å¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚<strong>å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ª effect ä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚</strong>å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚</p><p>å…ˆæ¸²æŸ“å±æ€§ Aï¼ŒB å†æ¸²æŸ“ Cï¼Œå’Œç«‹å³æ¸²æŸ“ C å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p>ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨<em>æ¯ä¸€æ¬¡</em>æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„ effects å¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰</p><p>æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><h2 id="å‘Šè¯‰-React-å»æ¯”å¯¹ä½ çš„-Effects"><a href="#å‘Šè¯‰-React-å»æ¯”å¯¹ä½ çš„-Effects" class="headerlink" title="å‘Šè¯‰ React å»æ¯”å¯¹ä½ çš„ Effects"></a><a href="#%E5%91%8A%E8%AF%89react%E5%8E%BB%E6%AF%94%E5%AF%B9%E4%BD%A0%E7%9A%84effects"></a>å‘Šè¯‰ React å»æ¯”å¯¹ä½ çš„ Effects</h2><p>å…¶å®æˆ‘ä»¬å·²ç»ä» React å¤„ç† DOM çš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚React åªä¼šæ›´æ–° DOM çœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚</p><p>å½“ä½ æŠŠ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Dan</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>æ›´æ–°åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Yuzhi</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;</span><br><span class="line">const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ª propsï¼Œå¹¶ä¸”å‘ç°<code>children</code>å‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–° DOMï¼Œä½†<code>className</code>å¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domNode.innerText = &apos;Hello, Yuzhi&apos;;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç† effects å—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨ effect å°±å¤ªå¥½äº†ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  const [counter, setCounter] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = &apos;Hello, &apos; + name;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCounter(counter + 1)&#125;&gt;        Increment      &lt;/button&gt;    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬çš„ effect å¹¶æ²¡æœ‰ä½¿ç”¨<code>counter</code>è¿™ä¸ªçŠ¶æ€ã€‚<strong>æˆ‘ä»¬çš„ effect åªä¼šåŒæ­¥<code>name</code>å±æ€§ç»™<code>document.title</code>ï¼Œä½†<code>name</code>å¹¶æ²¡æœ‰å˜ã€‚</strong>åœ¨æ¯ä¸€æ¬¡ counter æ”¹å˜åé‡æ–°ç»™<code>document.title</code>èµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚</p><p>å¥½äº†ï¼Œé‚£ React å¯ä»¥â€¦ åŒºåˆ† effects çš„ä¸åŒå—ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸èƒ½ã€‚React å¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†<code>name</code>å±æ€§ã€‚ï¼‰</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å… effects ä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™<code>useEffect</code>ä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•° (deps)ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><strong>è¿™å¥½æ¯”ä½ å‘Šè¯‰ Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„<code>name</code>ï¼Œåˆ«æ— å…¶ä»–ã€‚â€</strong></p><p>å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ª effect çš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥ React ä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡ effectï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const oldDeps = [&apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const newDeps = [&apos;Dan&apos;];</span><br></pre></td></tr></table></figure><p>å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡ effect çš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼</p><h2 id="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹-React-æ’’è°"><a href="#å…³äºä¾èµ–é¡¹ä¸è¦å¯¹-React-æ’’è°" class="headerlink" title="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹ React æ’’è°"></a><a href="#%E5%85%B3%E4%BA%8E%E4%BE%9D%E8%B5%96%E9%A1%B9%E4%B8%8D%E8%A6%81%E5%AF%B9react%E6%92%92%E8%B0%8E"></a>å…³äºä¾èµ–é¡¹ä¸è¦å¯¹ React æ’’è°</h2><p>å…³äºä¾èµ–é¡¹å¯¹ React æ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ– class å¿ƒæ™ºæ¨¡å‹ä½¿ç”¨<code>useEffect</code>çš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(å®˜ç½‘çš„ <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">Hooks FAQ</a> è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨<a href="#moving-functions-inside-effects">ä¸‹é¢</a>ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚)</em></p><p>â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œ<strong>effect ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚</strong>è¿™åŒ…æ‹¬ propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</p><p>æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€… socket è¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚<strong>è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚</strong>æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚</p><h2 id="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"><a href="#å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"></a><a href="#%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86%E9%94%99%E8%AF%AF%E7%9A%84%E4%BE%9D%E8%B5%96%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7%E5%91%A2%EF%BC%9F"></a>å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</h2><p>å¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰ effect ä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReact å°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt=""></p><p><em>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)</em></p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†<code>[]</code>è®¾ä¸º effect çš„ä¾èµ–ï¼Œæ–°çš„ effect å‡½æ•°ä¸ä¼šè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œ â€œè·³å‡ºâ€class ç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨ Class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="noopener">ä¾‹å­</a>è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨<code>useEffect</code>çš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º<code>[]</code>ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡ effectâ€ï¼Œå¯¹å—ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(count + 1);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­<a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="noopener">åªä¼šé€’å¢ä¸€æ¬¡</a>ã€‚<em>å¤©äº†å™œã€‚</em></p><p>å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯ â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘ effect çš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ</p><p>å¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™ React çš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒ effect æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effect ä¸­ä½¿ç”¨äº†<code>count</code>ä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œ<code>count</code>æ˜¯<code>0</code>ã€‚å› æ­¤ï¼Œ<code>setCount(count + 1)</code>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äº<code>setCount(0 + 1)</code>ã€‚<strong>æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†<code>[]</code>ä¾èµ–ï¼Œeffect ä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨<code>setCount(0 + 1)</code> ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹ React æ’’è°è¯´æˆ‘ä»¬çš„ effect ä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„ effect æœ‰ä¾èµ–ï¼</p><p>æˆ‘ä»¬çš„ effect ä¾èµ–<code>count</code> - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨ effect å¤–é¢å®šä¹‰ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const count = </span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œè®¾ç½®<code>[]</code>ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ª bugã€‚React ä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„ effectï¼š</p><p><img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥ effect ä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint è§„åˆ™</a>å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰</p><h2 id="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"><a href="#ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•" class="headerlink" title="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"></a><a href="#%E4%B8%A4%E7%A7%8D%E8%AF%9A%E5%AE%9E%E5%91%8A%E7%9F%A5%E4%BE%9D%E8%B5%96%E7%9A%84%E6%96%B9%E6%B3%95"></a>ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•</h2><p>æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚</p><p><strong>ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰ effect ä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚</strong>è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);  &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯<em>å¤ªç†æƒ³</em>ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡<code>count</code>ä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œ effectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„<code>setCount(count + 1)</code>ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ <code>count</code>å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [0]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [1]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™èƒ½<a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="noopener">è§£å†³é—®é¢˜</a>ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡<code>count</code>æ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š</p><p><img src="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt=""></p><p><em>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)</em></p><p><strong>ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹ effect å†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚</strong>æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹ effect ä½¿å¾—ä¾èµ–æ›´å°‘ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚</p><h2 id="è®©-Effects-è‡ªç»™è‡ªè¶³"><a href="#è®©-Effects-è‡ªç»™è‡ªè¶³" class="headerlink" title="è®© Effects è‡ªç»™è‡ªè¶³"></a><a href="#%E8%AE%A9effects%E8%87%AA%E7%BB%99%E8%87%AA%E8%B6%B3"></a>è®© Effects è‡ªç»™è‡ªè¶³</h2><p>æˆ‘ä»¬æƒ³å»æ‰ effect çš„<code>count</code>ä¾èµ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼š<strong>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨<code>count</code>ï¼Ÿ</strong>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨<code>setCount</code>è°ƒç”¨ä¸­ç”¨åˆ°äº†<code>count</code>ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨ effect ä¸­ä½¿ç”¨<code>count</code>ã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setState</code>çš„<a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="noopener">å‡½æ•°å½¢å¼</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(c =&gt; c + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸º â€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ effect ä¸­å†™äº†<code>setCount(count + 1)</code>æ‰€ä»¥<code>count</code>æ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠ<code>count</code>è½¬æ¢ä¸º<code>count+1</code>ï¼Œç„¶åè¿”å›ç»™ Reactã€‚å¯æ˜¯ React å…¶å®å·²ç»çŸ¥é“å½“å‰çš„<code>count</code>ã€‚<strong>æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥ React çš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚</strong></p><p>è¿™æ­£æ˜¯<code>setCount(c =&gt; c + 1)</code>åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™ Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§ â€œæ›´æ–°å½¢å¼â€ åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦<a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="noopener">æ‰¹é‡æ›´æ–°</a>ã€‚</p><p><strong>æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„ effect ä¸å†è¯»å–æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</strong></p><p><img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>ä½ å¯ä»¥è‡ªå·± <a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="noopener">è¯•è¯•</a>ã€‚</p><p>å°½ç®¡ effect åªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™ React å‘é€<code>c =&gt; c + 1</code>æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„<code>count</code>å€¼ã€‚å› ä¸º React å·²ç»çŸ¥é“äº†ã€‚</p><h2 id="å‡½æ•°å¼æ›´æ–°-å’Œ-Google-Docs"><a href="#å‡½æ•°å¼æ›´æ–°-å’Œ-Google-Docs" class="headerlink" title="å‡½æ•°å¼æ›´æ–° å’Œ Google Docs"></a><a href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%9B%B4%E6%96%B0-%E5%92%8C-google-docs"></a>å‡½æ•°å¼æ›´æ–° å’Œ Google Docs</h2><p>è¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£ effects çš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„ â€œä¿¡æ¯â€ å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ Google Docs ç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogle å¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ effect çš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚<strong>åªåœ¨ effects ä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</strong>ç±»ä¼¼äº<code>setCount(c =&gt; c + 1)</code>è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”<code>setCount(count + 1)</code>ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„ count å€¼ â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ ä¹Ÿè®¨è®ºäº†<a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="noopener">å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€</a>ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚</p><p>è¡¨è¾¾_æ„å›¾_ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’Œ Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†</a>å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨ React ä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffect ä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚</p><p><strong>ç„¶è€Œï¼Œå³ä½¿æ˜¯<code>setCount(c =&gt; c + 1)</code>ä¹Ÿå¹¶ä¸å®Œç¾ã€‚</strong>å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ª prop æ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„ stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ <code>setCount(c =&gt; c + 1)</code>æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«<code>useReducer</code>ã€‚</p><h2 id="è§£è€¦æ¥è‡ª-Actions-çš„æ›´æ–°"><a href="#è§£è€¦æ¥è‡ª-Actions-çš„æ›´æ–°" class="headerlink" title="è§£è€¦æ¥è‡ª Actions çš„æ›´æ–°"></a><a href="#%E8%A7%A3%E8%80%A6%E6%9D%A5%E8%87%AAactions%E7%9A%84%E6%9B%B4%E6%96%B0"></a>è§£è€¦æ¥è‡ª Actions çš„æ›´æ–°</h2><p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼š<code>count</code> å’Œ <code>step</code>ã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨ count ä¸Šå¢åŠ ä¸€ä¸ª<code>step</code>å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(c =&gt; c + step);    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="noopener">demo</a>.)</p><p>æ³¨æ„<strong>æˆ‘ä»¬æ²¡æœ‰æ’’è°</strong>ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨ effect é‡Œä½¿ç”¨äº†<code>step</code>ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚</p><p>è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹<code>step</code>ä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect ç„¶åé‡æ–°è¿è¡Œæ–°çš„ effect å¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚</p><p>ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨<code>step</code>æ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä» effect ä¸­ç§»é™¤å¯¹<code>step</code>çš„ä¾èµ–å‘¢ï¼Ÿ</p><p><strong>å½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨<code>useReducer</code>å»æ›¿æ¢å®ƒä»¬ã€‚</strong></p><p>å½“ä½ å†™ç±»ä¼¼<code>setSomething(something =&gt; ...)</code>è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨ reducer çš„å¥‘æœºã€‚reducer å¯ä»¥è®©ä½ <strong>æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ (actions) å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚</strong></p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ª<code>dispatch</code>ä¾èµ–å»æ›¿æ¢ effect çš„<code>step</code>ä¾èµ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &apos;tick&apos; &#125;);   &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [dispatch]);</span><br></pre></td></tr></table></figure><p>(æŸ¥çœ‹ <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>ã€‚)</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ <strong>React ä¼šä¿è¯<code>dispatch</code>åœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚</strong></p><p>æˆ‘ä»¬è§£å†³äº†é—®é¢˜!</p><p><em>ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤<code>dispatch</code>, <code>setState</code>, å’Œ<code>useRef</code>åŒ…è£¹çš„å€¼å› ä¸º React ä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰</em></p><p>ç›¸æ¯”äºç›´æ¥åœ¨ effect é‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒ dispatch äº†ä¸€ä¸ª <em>action</em> æ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ effect å’Œ<code>step</code>çŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„ effect ä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”± reducer å»ç»Ÿä¸€å¤„ç†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">  step: 1,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  const &#123; count, step &#125; = state;</span><br><span class="line">  if (action.type === &apos;tick&apos;) &#123;    return &#123; count: count + step, step &#125;;  &#125; else if (action.type === &apos;step&apos;) &#123;</span><br><span class="line">    return &#123; count, step: action.step &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a> å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚)</p><h2 id="ä¸ºä»€ä¹ˆ-useReducer-æ˜¯-Hooks-çš„ä½œå¼Šæ¨¡å¼"><a href="#ä¸ºä»€ä¹ˆ-useReducer-æ˜¯-Hooks-çš„ä½œå¼Šæ¨¡å¼" class="headerlink" title="ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼"></a><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88usereducer%E6%98%AFhooks%E7%9A%84%E4%BD%9C%E5%BC%8A%E6%A8%A1%E5%BC%8F"></a>ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼</h2><p>æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤ effect çš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚<strong>ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ– <em>props</em> å»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿ</strong>ä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„ API æ˜¯<code>&lt;Counter step={1} /&gt;</code>ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–<code>props.step</code> ã€‚æ˜¯å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠ <em>reducer</em> å‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å– propsï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter(&#123; step &#125;) &#123;  const [count, dispatch] = useReducer(reducer, 0);</span><br><span class="line"></span><br><span class="line">  function reducer(state, action) &#123;</span><br><span class="line">    if (action.type === &apos;tick&apos;) &#123;</span><br><span class="line">      return state + step;    &#125; else &#123;</span><br><span class="line">      throw new Error();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &apos;tick&apos; &#125;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨ reducer é‡Œé¢è®¿é—® propsã€‚ï¼ˆè¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="noopener">demo</a>ã€‚ï¼‰</p><p><strong>å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact ä¹Ÿä¿è¯<code>dispatch</code>åœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚</strong> æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ· effect ä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„ reducer æ€ä¹ˆ â€œçŸ¥é“â€ æ–°çš„ propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ <code>dispatch</code>çš„æ—¶å€™ï¼ŒReact åªæ˜¯è®°ä½äº† action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨ reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„ props å°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸” reducer è°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨ effect é‡Œã€‚</p><p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸º<code>useReducer</code>æ˜¯ Hooks çš„ â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„ effect è°ƒç”¨ã€‚</strong></p><h2 id="æŠŠå‡½æ•°ç§»åˆ°-Effects-é‡Œ"><a href="#æŠŠå‡½æ•°ç§»åˆ°-Effects-é‡Œ" class="headerlink" title="æŠŠå‡½æ•°ç§»åˆ° Effects é‡Œ"></a><a href="#%E6%8A%8A%E5%87%BD%E6%95%B0%E7%A7%BB%E5%88%B0effects%E9%87%8C"></a>æŠŠå‡½æ•°ç§»åˆ° Effects é‡Œ</h2><p>ä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [data, setData] = useState(&#123; hits: [] &#125;);</span><br><span class="line"></span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(</span><br><span class="line">      &apos;https://hn.algolia.com/api/v1/search?query=react&apos;,</span><br><span class="line">    );</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br></pre></td></tr></table></figure><p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a> æ”¹ç¼–è‡ª Robin Wieruch è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a>ï¼)</em></p><p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚<strong>ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚</strong></p><p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº› state æˆ–è€… propï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„ effects çš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„ effects å°±ä¸ä¼šåŒæ­¥ props å’Œ state å¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚<strong>å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨ effect ä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ° effect ä¸­ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        function getFetchUrl() &#123;      return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;    &#125;    async function fetchData() &#123;      const result = await axios(getFetchUrl());      setData(result.data);    &#125;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="noopener">è¿™é‡Œæ˜¯ demo</a>.)</p><p>è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº› â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼š<strong>åœ¨æˆ‘ä»¬çš„ effect ä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</strong></p><p>å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ <code>getFetchUrl</code>å»ä½¿ç”¨<code>query</code>çŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨ effect é‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>query</code>æ·»åŠ åˆ° effect çš„ä¾èµ–é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    function getFetchUrl() &#123;</span><br><span class="line">      return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;    &#125;</span><br><span class="line"></span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, [query]); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="noopener">demo</a>.)</p><p>æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨ â€œå–æ‚¦ Reactâ€ã€‚åœ¨ query æ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚<code>useEffect</code>çš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„ effects è¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº† bugã€‚</p><p>æ„Ÿè°¢<code>eslint-plugin-react-hooks</code> æ’ä»¶çš„<code>exhaustive-deps</code>lint è§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">ç¼–ç çš„æ—¶å€™å°±åˆ†æ effects</a> å¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚</p><p><img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt=""></p><p>éå¸¸æ£’ã€‚</p><h2 id="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°-Effect-é‡Œ"><a href="#ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°-Effect-é‡Œ" class="headerlink" title="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ° Effect é‡Œ"></a><a href="#%E4%BD%86%E6%88%91%E4%B8%8D%E8%83%BD%E6%8A%8A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%94%BE%E5%88%B0effect%E9%87%8C"></a>ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ° Effect é‡Œ</h2><p>æœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥ effect é‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ª effect ä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ª effect é‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª propã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œ<strong>efffects ä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚</strong>é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚</p><p><strong>å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚</strong> æ¯”å¦‚æœ‰ä¸¤ä¸ª effects ä¼šè°ƒç”¨ <code>getFetchUrl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  function getFetchUrl(query) &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠ<code>getFetchUrl</code> ç§»åˆ° effects ä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆ â€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ª effects éƒ½ä¾èµ–<code>getFetchUrl</code>ï¼Œ<strong>è€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒ</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    function getFetchUrl(query) &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠ<code>getFetchUrl</code>ä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢ â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€ çš„é—®é¢˜ã€‚</p><p>ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨ effects ä¸­ä½¿ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function getFetchUrl(query) &#123;  return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;</span><br><span class="line">function SearchResults() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äº props æˆ– stateã€‚</p><p>æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆ <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="noopener"><code>useCallback</code> Hook</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    const getFetchUrl = useCallback((query) =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, []);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useCallback</code>æœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - <strong>æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚</strong></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸º<code>&#39;react&#39;</code>å’Œ<code>&#39;redux&#39;</code>ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶ (<code>query</code>)ã€‚ä¸åŒäºä¼ é€’<code>query</code>å‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨<code>getFetchUrl</code>ä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚</p><p>æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†<code>query</code>ä¾èµ–ï¼š</p><p>å¦‚æœæˆ‘æŠŠ<code>query</code>æ·»åŠ åˆ°<code>useCallback</code> çš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†<code>getFetchUrl</code>çš„ effect åœ¨<code>query</code>æ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const getFetchUrl = useCallback(() =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, [query]);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl();</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦æ„Ÿè°¢<code>useCallback</code>ï¼Œå› ä¸ºå¦‚æœ<code>query</code> ä¿æŒä¸å˜ï¼Œ<code>getFetchUrl</code>ä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„ effect ä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœ<code>query</code>ä¿®æ”¹äº†ï¼Œ<code>getFetchUrl</code>ä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨ Excel é‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚</p><p>è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚<strong>å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const fetchData = useCallback(() =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;      &#125;, [query]);  </span><br><span class="line">  return &lt;Child fetchData=&#123;fetchData&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; fetchData &#125;) &#123;</span><br><span class="line">  let [data, setData] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData().then(setData);</span><br><span class="line">  &#125;, [fetchData]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>fetchData</code>åªæœ‰åœ¨<code>Parent</code>çš„<code>query</code>çŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>Child</code>åªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><h2 id="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"><a href="#å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ" class="headerlink" title="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"></a><a href="#%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E5%90%97%EF%BC%9F"></a>å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ</h2><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨ class ç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº† effect å’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;      &#125;;  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;    this.props.fetchData();  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº† Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“<code>useEffect</code> å°±åƒ<code>componentDidMount</code> å’Œ <code>componentDidUpdate</code>çš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€ <strong>å¥½å§ï¼Œå°±ç®—åŠ äº†<code>componentDidUpdate</code>ç…§æ ·æ— ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;        if (this.props.fetchData !== prevProps.fetchData) &#123;      this.props.fetchData();    &#125;  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æ­¤ï¼Œ<code>fetchData</code>æ˜¯ä¸€ä¸ª class æ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯ class å±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥<code>this.props.fetchData</code>å’Œ <code>prevProps.fetchData</code>å§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps) &#123;</span><br><span class="line">  this.props.fetchData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚) ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„ query?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·ä¸€æ¥ï¼Œ<code>this.props.fetchData !== prevProps.fetchData</code> è¡¨è¾¾å¼æ°¸è¿œæ˜¯<code>true</code>ï¼Œå³ä½¿<code>query</code>å¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚</p><p>æƒ³è¦è§£å†³è¿™ä¸ª class ç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠ<code>query</code>æœ¬èº«ä¼ å…¥ <code>Child</code> ç»„ä»¶ã€‚ <code>Child</code> è™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥_ä½¿ç”¨_è¿™ä¸ª<code>query</code>çš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;</span><br><span class="line">    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;;  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    if (this.props.query !== prevProps.query) &#123;      this.props.fetchData();    &#125;  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ React çš„ class ç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„ props ä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚</p><p><strong>åœ¨ class ç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚</strong>ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„<code>this</code>å˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åš â€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„<code>this.props.fetchData</code> æ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚</p><p><strong>ä½¿ç”¨<code>useCallback</code>ï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚</strong>æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„<code>useCallback</code>ï¼Œå±æ€§æ¯”å¦‚<code>props.fetchData</code>çš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚</p><p>ç±»ä¼¼çš„ï¼Œ<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a>å¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ColorPicker() &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  const [color, setColor] = useState(&apos;pink&apos;);</span><br><span class="line">  const style = useMemo(() =&gt; (&#123; color &#125;), [color]);</span><br><span class="line">  return &lt;Child style=&#123;style&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨<code>useCallback</code>æ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚</strong>å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„ effect ä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>useCallback</code> æ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´ Hooks æœ¬èº«èƒ½æ›´å¥½åœ°<a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="noopener">é¿å…ä¼ é€’å›è°ƒå‡½æ•°</a>ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠ<code>fetchData</code>æ”¾åœ¨æˆ‘çš„ effect é‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®© effects ä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ª<code>props.onComplete</code>å›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥<a href="#swimming-against-the-tide">æ¨¡æ‹Ÿ class çš„è¡Œä¸º</a>ä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚</p><h2 id="è¯´è¯´ç«æ€"><a href="#è¯´è¯´ç«æ€" class="headerlink" title="è¯´è¯´ç«æ€"></a><a href="#%E8%AF%B4%E8%AF%B4%E7%AB%9E%E6%80%81"></a>è¯´è¯´ç«æ€</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨ class ç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;    if (prevProps.id !== this.props.id) &#123;      this.fetchData(this.props.id);    &#125;  &#125;  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ <code>{id: 10}</code>ï¼Œç„¶åæ›´æ–°åˆ°<code>{id: 20}</code>ï¼Œä½†<code>{id: 20}</code>çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚</p><p>è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†<code>async</code> / <code>await</code>ï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆprops å’Œ state å¯èƒ½ä¼šåœ¨ async å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚</p><p>Effects å¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ª<code>async</code> å‡½æ•°ç»™ effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰</p><p>å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚</p><p>æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Article(&#123; id &#125;) &#123;</span><br><span class="line">  const [article, setArticle] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let didCancel = false;</span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const article = await API.fetchArticle(id);</span><br><span class="line">      if (!didCancel) &#123;        setArticle(article);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;      didCancel = true;    &#125;;  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„ Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨ Hooks é‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚</p><h2 id="æé«˜æ°´å‡†"><a href="#æé«˜æ°´å‡†" class="headerlink" title="æé«˜æ°´å‡†"></a><a href="#%E6%8F%90%E9%AB%98%E6%B0%B4%E5%87%86"></a>æé«˜æ°´å‡†</h2><p>åœ¨ class ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UI æ¸²æŸ“æ˜¯è¢« props å’Œ state é©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚</p><p>è€Œåœ¨<code>useEffect</code>çš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº† React æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ª<code>useEffect</code>è°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚</p><p>ç„¶è€Œï¼Œç”¨å¥½<code>useEffect</code>çš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚</p><p>è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœ<code>useEffect</code>æ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸º Hooks å¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨ Hooksï¼Œå› ä¸ºå¥½çš„ API ä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚</p><p>æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„ Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„<code>useFetch</code>æˆ–è€…ä½¿ç”¨ theme context çš„<code>useTheme</code> ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨<code>useEffect</code>ã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„ Hook éƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼Œ<code>useEffect</code>ä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯<code>[]</code>æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿ</p><p>é•¿è¿œæ¥çœ‹ï¼Œ <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="noopener">Suspense ç”¨äºæ•°æ®è¯·æ±‚</a> ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰ React æš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚</p><p>å½“ Suspense é€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™<code>useEffect</code> ä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥ props å’Œ state åˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„ Hooks æ¯”å¦‚<a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™å„¿æåˆ°çš„</a>æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚</p><h2 id="åœ¨ç»“æŸå‰"><a href="#åœ¨ç»“æŸå‰" class="headerlink" title="åœ¨ç»“æŸå‰"></a><a href="#%E5%9C%A8%E7%BB%93%E6%9D%9F%E5%89%8D"></a>åœ¨ç»“æŸå‰</h2><p>ç°åœ¨ä½ å·®ä¸å¤šçŸ¥é“äº†æˆ‘å…³äºå¦‚ä½•ä½¿ç”¨ effects çš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹å¼€å¤´çš„ <a href="#tldr">TLDR</a>ã€‚ä½ ç°åœ¨è§‰å¾—å®ƒè¯´å¾—æœ‰é“ç†å—ï¼Ÿæˆ‘æœ‰é—æ¼ä»€ä¹ˆå—ï¼Ÿï¼ˆæˆ‘çš„çº¸è¿˜æ²¡æœ‰å†™å®Œï¼ï¼‰</p><p>æˆ‘å¾ˆæƒ³åœ¨ Twitter ä¸Šå¬å¬ä½ çš„æƒ³æ³•ã€‚è°¢è°¢é˜…è¯»ã€‚</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/4233.html">https://andyxw.com/archives/4233.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      useEffect å®Œæ•´æŒ‡å— â€” Dan Abramov
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
      <category term="useEffect" scheme="https://andyxw.com/tags/useEffect/"/>
    
  </entry>
  
  <entry>
    <title>What are React Hooks</title>
    <link href="https://andyxw.com/archives/ef81.html"/>
    <id>https://andyxw.com/archives/ef81.html</id>
    <published>2019-08-21T09:31:54.000Z</published>
    <updated>2019-08-21T09:36:21.439Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://www.robinwieruch.de/react-hooks/" target="_blank" rel="noopener">https://www.robinwieruch.de/react-hooks/</a></p></blockquote><p>October 29, 2018 - <a href="https://github.com/rwieruch/blog_robinwieruch_content/blob/master/react-hooks.md" target="_blank" rel="noopener">Edit this Post on GitHub</a></p><p><img src="https://www.robinwieruch.de/img/posts/react-hooks/banner_1024.jpg" alt=""></p><p>React Hooks were introduced at <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank" rel="noopener">React Conf October 2018</a> as a way to use state and side-effects in React function components. Whereas function components have been called functional stateless components (FSC) before, they are finally able to use state with React Hooks. Therefore, many people refer to them as function components now.</p><p>In this walkthrough, I want to explain the motivation behind hooks, what will change in React and why we shouldnâ€™t panic, and how React hooks can be used in function components by showcasing common React Hooks such as the state and effect hooks by example.</p><p>React Hooks were invented by the React team to introduce state management and side-effects in function components. Itâ€™s their way of making it more effortless to use only React function components without the need to refactor a React function component to a React class component for using lifecycle methods, in order to use have side-effects, or local state. React Hooks enable us to write React applications with only function components.</p><p><strong>Unnecessary Component Refactorings:</strong> Previously, only React class components were used for local state management and lifecycle methods. The latter have been essential for introducing side-effects, such as listeners or data fetching, in React class components.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">class Counter extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;() =&gt;</span><br><span class="line">            this.setState(&#123; count: this.state.count + 1 &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Counter;</span><br></pre></td></tr></table></figure><p>Only if you didnâ€™t need state or lifecycle methods, React functional <em>stateless</em> components could be used. And because React function components are more lightweight (and elegant), people already used plenty of function components. This came with the drawback of refactoring components from React function components to React class components every time state or lifecycle methods were needed (and vice versa).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">// how to use the state hook in a React function component</span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Counter;</span><br></pre></td></tr></table></figure><p>With Hooks there is no need for this refactoring. Side-effects and state are finally available in React function components. Thatâ€™s why a rebranding from functional stateless components to function components would be reasonable.</p><p><strong>Side-effect Logic:</strong> In React class components, side-effects were mostly introduced in lifecycle methods (e.g. componentDidMount, componentDidUpdate, componentWillUnmount). A side-effect could be <a href="https://www.robinwieruch.de/react-fetching-data/" target="_blank" rel="noopener">fetching data in React</a> or <a href="https://www.robinwieruch.de/react-intersection-observer-api/" target="_blank" rel="noopener">interacting with the Browser API</a>. Usually these side-effects came with a setup and clean up phase. For instance, if you would miss to remove your listener, you could run into <a href="https://www.robinwieruch.de/react-warning-cant-call-setstate-on-an-unmounted-component/" target="_blank" rel="noopener">React performance issues</a>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// side-effects in a React class component</span><br><span class="line">class MyComponent extends Component &#123;</span><br><span class="line">  // setup phase</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    // add listener for feature 1</span><br><span class="line">    // add listener for feature 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // clean up phase</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    // remove listener for feature 1</span><br><span class="line">    // remove listener for feature 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// side-effects in React function component with React Hooks</span><br><span class="line">function MyComponent() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // add listener for feature 1 (setup)</span><br><span class="line">    // return function to remove listener for feature 1 (clean up)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // add listener for feature 2 (setup)</span><br><span class="line">    // return function to remove listener for feature 2 (clean up)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now, if you would introduce more than one of these side-effects in a React class componentâ€™s lifecycle methods, all side-effects would be grouped by lifecycle method but not by side-effect. Thatâ€™s what React Hooks are going to change by encapsulating a side-effect in one hook whereas every hook has its own side-effect with a setup and clean up phase. You will see later in a tutorial how this works for real by adding and removing listeners in a React Hook.</p><p><strong>Reactâ€™s Abstraction Hell:</strong> Abstraction and thus reusability were introduced with <a href="https://www.robinwieruch.de/gentle-introduction-higher-order-components/" target="_blank" rel="noopener">Higher-Order Components</a> and <a href="https://www.robinwieruch.de/react-render-props-pattern/" target="_blank" rel="noopener">Render Prop Components</a> in React. There is also <a href="https://www.robinwieruch.de/react-context-api/" target="_blank" rel="noopener">Reactâ€™s Context with its Provider and Consumer Components</a> that introduce another level of abstraction. All of these advanced patterns in React are using so called wrapping components. The implementation of the following components shouldnâ€™t be foreign to developers who are creating larger React applications.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; compose &#125; from &apos;recompose&apos;;</span><br><span class="line">import &#123; withRouter &#125; from &apos;react-router-dom&apos;;</span><br><span class="line"></span><br><span class="line">function App(&#123; history, state, dispatch &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;ThemeContext.Consumer&gt;</span><br><span class="line">      &#123;theme =&gt;</span><br><span class="line">        &lt;Content theme=&#123;theme&#125;&gt;</span><br><span class="line">          ...</span><br><span class="line">        &lt;/Content&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/ThemeContext.Consumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default compose(</span><br><span class="line">  withRouter,</span><br><span class="line">  withReducer(reducer, initialState)</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure><p>Sophie Alpert coined it â€œthe wrapper hellâ€ in React. You are not only seeing it in the implementation, but also when inspecting your components in the browser. There are dozens of wrapped components due to Render Prop Components (including Consumer components from Reactâ€™s Context) and Higher-Order Components. It becomes an unreadable component tree, because all the abstracted logic is covered up in other React components. The actual visible components are hard to track down in the browserâ€™s DOM. So what if these additional components were not needed because the logic is only encapsulated in functions as side-effects instead? Then you would remove all these wrapping components and flatten your component treeâ€™s structure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const theme = useTheme();</span><br><span class="line">  const history = useRouter();</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Content theme=&#123;theme&#125;&gt;</span><br><span class="line">      ...</span><br><span class="line">    &lt;/Content&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s what React Hooks are bringing on the table. All side-effects are sitting directly in the component without introducing other components as container for business logic. The container disappears and the logic just sits in React Hooks that are only functions. <a href="https://github.com/acdlite/recompose/commit/7867de653abbb57a49934e52622a60b433bda918" target="_blank" rel="noopener">Andrew Clark already left a statement in favor of React Hooks in his popular Higher-Order Component library called recompose.</a></p><p><strong>JavaScript Class Confusion:</strong> JavaScript mixes two worlds pretty well: Object-oriented programming (OOP) and functional programming. React introduces many developers to both worlds. On the one side, React (and Redux) introduced people to functional programming (FP) with function compositions, general programming concepts with functions (e.g. higher-order functions, JavaScript built-in methods like map, reduce, filter) and other terms such as immutability and side-effects. React itself didnâ€™t really introduce these things, because they are features of the language or the programming paradigm itself, but they are heavily used in React whereas <a href="https://www.robinwieruch.de/javascript-fundamentals-react-requirements/" target="_blank" rel="noopener">every React developer becomes automatically a better JavaScript developer</a>.</p><p>On the other side, React uses JavaScript classes as one way to define React components. A class is only the declaration whereas the actual usage of the component is the instantiation of it. It creates a class instance whereas the <code>this</code> object of the class instance is used to interact with class methods (e.g. setState, forceUpdate, other custom class methods). However, classes come with a steeper learning curve for React beginners who are not coming from an OOP background. Thatâ€™s why class bindings, the <code>this</code> object and inheritance can be confusing. I have <a href="https://www.robinwieruch.de/the-road-to-learn-react/" target="_blank" rel="noopener">a few chapters in my React book</a> focusing only on this aspect of React which is always the most confusing thing about React for beginners.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// I THOUGHT WE ARE USING A CLASS. WHY IS IT EXTENDING FROM SOMETHING?</span><br><span class="line">class Counter extends Component &#123;</span><br><span class="line">  // WAIT ... THIS WORKS???</span><br><span class="line">  state = &#123; value: 0 &#125;;</span><br><span class="line"></span><br><span class="line">  // I THOUGH IT&apos;S THIS WAY, BUT WHY DO I NEED PROPS HERE?</span><br><span class="line">  // constructor(props) &#123;</span><br><span class="line">  //  SUPER???</span><br><span class="line">  //  super(props);</span><br><span class="line">  //</span><br><span class="line">  //  this.state = &#123;</span><br><span class="line">  //    value: 0,</span><br><span class="line">  //  &#125;;</span><br><span class="line">  // &#125;</span><br><span class="line"></span><br><span class="line">  // WHY DO I HAVE TO USE AN ARROW FUNCTION???</span><br><span class="line">  onIncrement = () =&gt; &#123;</span><br><span class="line">    this.setState(state =&gt; (&#123;</span><br><span class="line">      value: state.value + 1</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // SHOULDN&apos;T IT BE this.onDecrement = this.onDecrement.bind(this); in the constructor???</span><br><span class="line">  // WHAT&apos;S this.onDecrement = this.onDecrement.bind(this); DOING ANYWAY?</span><br><span class="line">  onDecrement = () =&gt; &#123;</span><br><span class="line">    this.setState(state =&gt; (&#123;</span><br><span class="line">      value: state.value - 1</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;this.state.value&#125;</span><br><span class="line"></span><br><span class="line">        &#123;/* WHY IS EVERYTHING AVAILABLE ON &quot;THIS&quot;??? */&#125;</span><br><span class="line">        &lt;button onClick=&#123;this.onIncrement&#125;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.onDecrement&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now, many people argue React shouldnâ€™t take JavaScript classes away because people donâ€™t understand them. After all, they belong to the language. However, one of the hypotheses of introducing the Hooks API is a smoother learning curve for React beginners when writing their React components without JavaScript classes in the first place.</p><p>Every time a new feature is introduced, people are concerned about it. There is one side of the group that is ecstatic about the change, and the other side that fears the change. I heard the most common concerns for React Hooks are:</p><ul><li>Everything changes! <em>Subtle panic mode â€¦</em></li><li>React is becoming bloated like Angular!</li><li>Itâ€™s useless, classes worked fine.</li><li>Itâ€™s magic!</li></ul><p><strong>Let me address these concerns here:</strong></p><p><strong>Everything changes:</strong> React Hooks will change how we write React applications in the future. However, at the moment, nothing changes. You can still write class components with local state and lifecycle methods and deploy advanced patterns such as Higher-Order Components or Render Prop Components. Nobody takes these learnings away from you. See how I upgraded all my open source projects from older versions to React 16.6. and none of of these projects had problems. They are using HOCs, Render Props and I believe even the old context API (correct me if am wrong). Everything I have learned all these years still works. The React team makes sure that React stays backward compatible. It will be the same with React 16.7.</p><p><img src="https://www.robinwieruch.de/img/posts/react-hooks/react-upgrades_1024.jpg" alt=""></p><p><strong>React is becoming bloated like Angular:</strong> React was always seen as a library with a slim API. Thatâ€™s true and shall be true in the future. However, in order to adjust things that were the status quo of building component-based applications a few years ago, and not to be overtaken by other libraries who adapt to the new status quo, React introduces changes in favor of older APIs. If React would start out fresh this year, maybe there would be only function components and hooks. But React was released a couple of years ago and needs to adapt to keep up with the status quo or to invent a status quo. Maybe there will follow deprecations of React class components and lifecycle methods in a few years in favor of React function components and hooks, but at the moment, the React team keeps React class components in their repertoire of tools. After all, the React team utilizes hooks as an invention to run a marathon with React an not to win a sprint. Obviously, React Hooks add yet another API to React, but it is in favor to simplify Reactâ€™s API in the future. I like this transition more than having a React 2 where everything is different.</p><p><strong>Itâ€™s useless, classes worked fine:</strong> Imagine you would start from zero to learn React and you would be introduced to React with Hooks. Maybe <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a> wouldnâ€™t start out with a React class component but with a React function component. Everything you need to learn for your components would be React Hooks. They manage state and side-effects, so you would only need to know about the state and the effect hook. Itâ€™s everything a React class component did for you before. It will be simpler for React beginners to learn React without all the other overhead that comes with JavaScript classes (inheritance, this, bindings, super, â€¦). Imagine React Hooks as a new way of how to write React components - Itâ€™s a new mindset. I am a skeptical person myself, but once I wrote a couple of simpler scenarios with React Hooks, I was convinced that this is the simplest way to write but also to learn React. As someone who is doing lots of React workshops, I argue that it takes away all the frustration classes bring on the table for React beginners.</p><p><strong>Itâ€™s magic:</strong> React is known to be down to earth with JavaScript. Writing React applications makes you a better JavaScript developer - thatâ€™s one of the best things about React when someone asks me: â€œWhy should I learn React?â€. Whether there comes another library in the future or not, everyone is prepared by honing their JavaScript skills and general programming skills when using React. Itâ€™s one of the things that made Redux, often used in React, popular: There is no magic, it is plain JavaScript. Now these React Hooks come along the way, introduce something stateful in a previously often pure function component, a couple of not easily to accept rules, and many donâ€™t understand whatâ€™s going on under the hood. But think about it this way: A function component in React is not a mere function. You still have to import React as library to your source code file. It does something with your function, because the function becomes a function component in React land. This function component comes with hidden implementations that were there all the time. How else would it have been possible to use functions as function components as we did it before React Hooks were introduced? And people accepted it too, even though itâ€™s kinda magic. Now, the only thing changed (and maybe it has already been this way before) is that these function components come with an extra hidden object that keeps track of hooks. To quote Dan Abramov from <a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889" target="_blank" rel="noopener">his article about hooks</a>: <em>â€œPerhaps youâ€™re wondering where React keeps the state for Hooks. The answer is itâ€™s kept in the exact same place where React keeps state for classes. React has an internal update queue which is the source of truth for any state, no matter how you define your components.â€</em>.</p><p><strong>Finally, think about it this way:</strong> Component-based solutions such as Angular, Vue, and React are pushing the boundaries of web development with every release. They build up on top of technologies that were invented more than two decades ago. They adapt them to make web development effortless in 2018 and not 1998. They optimize them like crazy to meet the needs in the here and now. We are building web applications with components and not with HTML templates anymore. We are not there yet, but I imagine a future where we sit together and invent a component-based standard for the browser. Angular, Vue and React are only the spearhead of this movement.</p><p>In the following, I want to dive into a few popular React Hooks by example to get you up to speed. All examples can be found in this <a href="https://github.com/the-road-to-learn-react/react-hooks-introduction" target="_blank" rel="noopener">GitHub repository</a>.</p><p>You have seen the useState Hook before in a code snippet for a typical counter example. It is used to manage local state in function components. Letâ€™s use the hook in a more elaborate example where we are going to manage an array of items. In another article of mine, you can learn more about <a href="https://www.robinwieruch.de/react-state-array-add-update-remove/" target="_blank" rel="noopener">managing arrays as state in React</a>, but this time we are doing it with React hooks. Letâ€™s get started:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const INITIAL_LIST = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: &apos;0&apos;,</span><br><span class="line">    title: &apos;React with RxJS for State Management Tutorial&apos;,</span><br><span class="line">    url:</span><br><span class="line">      &apos;https://www.robinwieruch.de/react-rxjs-state-management-tutorial/&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &apos;1&apos;,</span><br><span class="line">    title: &apos;A complete React with Apollo and GraphQL Tutorial&apos;,</span><br><span class="line">    url: &apos;https://www.robinwieruch.de/react-graphql-apollo-tutorial&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>The useState hook accepts an initial state as argument and returns, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring" target="_blank" rel="noopener">by using array destructuring</a>, two variables that can be named however you want to name them. Whereas the first variable is the actual state, the second variable is a function to update the state by providing a new state.</p><p>The goal of this scenario is to remove an item from the list. In order to accomplish it, every item in the rendered list has a button with a click handler. The click handler can be inlined in the function component, because it will make use of <code>list</code> and <code>setList</code> later. Hence you donâ€™t need to pass these variables to the handler, because they are already available from the outer scope of the component.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem() &#123;</span><br><span class="line">    // remove item from &quot;list&quot;</span><br><span class="line">    // set the new list in state with &quot;setList&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;onRemoveItem&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Somehow we need to know about the item that should be removed from the list. Using a higher-order function, we can pass the identifier of the item to the handler function. Otherwise we wouldnâ€™t be able to identify the item that should be removed from the list.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem(id) &#123;</span><br><span class="line">    // remove item from &quot;list&quot;</span><br><span class="line">    // set the new list in state with &quot;setList&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Finally, use the identifier to filter the list with a built-in array method. It returns a new list which is used to set the new state of the list.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem(id) &#123;</span><br><span class="line">    const newList = list.filter(item =&gt; item.id !== id);</span><br><span class="line">    setList(newList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That should do the job. You are able to remove an item from the list based on the identifier you pass to the handler. The handler then filters the list and sets the new state of the list with the <code>setList</code> function.</p><p>The useState hook gives you everything you need to manage state in a function component: initial state, the latest state, and a state update function. Everything else is JavaScript again. Furthermore, you donâ€™t need to bother about the state object with its shallow merge as before in a class component. Instead, you encapsulate one domain (e.g. list) with useState, but if you would need another state (e.g. counter), then just encapsulate this domain with another useState. You can read more about <a href="https://reactjs.org/docs/hooks-state.html" target="_blank" rel="noopener">the useState hook in Reactâ€™s documentation</a>.</p><p>Letâ€™s head over to the next hook called useEffect. As mentioned before, function components should be able to manage state and side-effects with hooks. Managing state was showcased with the useState hook. Now comes the useEffect hook into play for side-effects which are usually used for interactions with the Browser/DOM API or external API like data fetching. Letâ€™s see how the useEffect hook can be used for interaction with the Browser API by implementing a simple stopwatch. You can see how it is done in a React class component in this <a href="https://github.com/the-road-to-learn-react/react-interval-setstate-unmounted-component-performance" target="_blank" rel="noopener">GitHub repository</a>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>There is no stopwatch yet. But at least there are is a <a href="https://www.robinwieruch.de/conditional-rendering-react/" target="_blank" rel="noopener">conditional rendering</a> to show either a â€œStartâ€ or â€œStopâ€ button. The state for the boolean flag is managed by the useState hook.</p><p>Letâ€™s introduce our side-effect with useEffect that registers an interval. The function used for the interval emits a console logging every second to your developer tools of your browser.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>In order to remove the interval when the component unmounts (but also after every other render update), you can return a function in useEffect for anything to be called for the clean up. For instance, there shouldnâ€™t be any memory leak left behind when the component isnâ€™t there anymore.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Now, you want to setup the side-effect when mounting the component and the clean up the side-effect when unmounting the component. If you would log how many times the function within the effect is called, you would see that it sets a new interval every time the state of the component changes (e.g. click on â€œStartâ€/â€œStopâ€ button).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;effect runs&apos;);</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>In order to only run the effect on mount and unmount of the component, you can pass it an empty array as second argument.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>However, since the interval is cleaned up after every render too, we need to set the interval in our update cycle too. But we can tell the effect to run only when the <code>isOn</code> variable changes. Only when one of the variables in the array changes, the effect will run during the update cycle. If you keep the array empty, the effect will only run on mount and unmount, because there is no variable to be checked for running the side-effect again.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>The interval is running whether the <code>isOn</code> boolean is true or false. It would be great to only run it when the stopwatch is activated.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Now introduce another state in your function component to keep track of the timer of the stopwatch. It is used to update the timer, but only when the stopwatch is activated.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;timer&#125;</span><br><span class="line"></span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>There is still one mistake in the code. When the interval is running, it updates the timer every second by increasing it by one. However, it always relies on a stale state for the timer. Only when the <code>inOn</code> boolean flag changes the state is fine. In order to receive always the latest state for the timer when the interval is running, you can use a function instead for the state update function which always has the latest state.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer =&gt; timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>An alternative would have been to run the effect also when the timer changes. Then the effect would receive the latest timer state.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn, timer]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s the implementation for the stopwatch that uses the Browser API If you want to continue, you can extend the example by providing a â€œResetâ€ button too.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer =&gt; timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  const onReset = () =&gt; &#123;</span><br><span class="line">    setIsOn(false);</span><br><span class="line">    setTimer(0);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;timer&#125;</span><br><span class="line"></span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &lt;button type=&quot;button&quot; disabled=&#123;timer === 0&#125; onClick=&#123;onReset&#125;&gt;</span><br><span class="line">        Reset</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s it. The useEffect hook is used for side-effects in React function components that are used for interacting with the Browser/DOM API or other third-party APIs (e.g. data fetching). You can read more about <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">the useEffect hook in Reactâ€™s documentation</a>.</p><p>Last but not least, after you have learned about the two most popular hooks that introduce state and side-effects in function components, there is one last thing I want to show you: custom hooks. Thatâ€™s right, you can implement your own custom React Hooks that can be reused in your application or by others. Letâ€™s see how they work with an example application which is able to detect whether your device is online or offline.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Again, introduce the useEffect hook for the side-effect. In this case, the effect adds and removes listeners that check if the device is online or offline. Both listeners are setup only once on mount and cleaned up once on unmount (empty array as second argument). Whenever one of the listeners is called, it sets the state for the <code>isOffline</code> boolean.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  function onOffline() &#123;</span><br><span class="line">    setIsOffline(true);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function onOnline() &#123;</span><br><span class="line">    setIsOffline(false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    window.addEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">    window.addEventListener(&apos;online&apos;, onOnline);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.removeEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">      window.removeEventListener(&apos;online&apos;, onOnline);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Everything is nicely encapsulated in one effect now. Itâ€™s a great functionality which should be reuse somewhere else too. Thatâ€™s why we can extract the functionality as its a custom hook which follows the same naming convention as the other hooks.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function useOffline() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  function onOffline() &#123;</span><br><span class="line">    setIsOffline(true);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function onOnline() &#123;</span><br><span class="line">    setIsOffline(false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    window.addEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">    window.addEventListener(&apos;online&apos;, onOnline);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.removeEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">      window.removeEventListener(&apos;online&apos;, onOnline);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return isOffline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const isOffline = useOffline();</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Extracting the custom hook as function was not the only thing. You also have to return the <code>isOffline</code> state from the custom hook in order to use it in your application to show a message to users who are offline. Otherwise, it should render the normal application. Thatâ€™s it for the custom hook that detects whether you are online or offline. You can read more about <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom hooks in Reactâ€™s documentation</a>.</p><p>React Hooks being reusable is the best thing about them, because there is the potential to grow an ecosystem of custom React Hooks that can be installed from npm for any React application. And not only for React applications. Evan You, creator of Vue, <a href="https://twitter.com/youyuxi/status/1056042395891105793" target="_blank" rel="noopener">is hooked (!) by them as well</a>. Maybe we will see a bridge between both ecosystems where it is possible to share hooks between Vue and React.</p><hr><p>If you want to dive deeper into the state and effect hooks, you can check out the following React hook tutorials:</p><ul><li><a href="https://www.robinwieruch.de/react-usereducer-hook/" target="_blank" rel="noopener">How to useReducer Hook?</a></li><li><a href="https://www.robinwieruch.de/react-hooks-migration" target="_blank" rel="noopener">Migration from Class Components to Hooks</a></li><li><a href="https://www.robinwieruch.de/react-usereducer-vs-usestate/" target="_blank" rel="noopener">Comparison useState vs useReducer</a></li><li><a href="https://www.robinwieruch.de/react-state-usereducer-usestate-usecontext" target="_blank" rel="noopener">Modern State Management with Hooks</a></li><li><a href="https://www.robinwieruch.de/react-hooks-fetch-data" target="_blank" rel="noopener">How to fetch data with React Hooks</a></li></ul><p>Checkout the official <a href="https://reactjs.org/docs/hooks-faq.html" target="_blank" rel="noopener">FAQ</a> and <a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener">Rules</a> for hooks in Reactâ€™s documentation to learn more about their fine-grained behaviour. In addition, you can checkout <a href="https://reactjs.org/docs/hooks-reference.html" target="_blank" rel="noopener">all officially available React Hooks</a> too.</p><p>For everyone who is still concerned about React Hooks: Give them a shot yourself. Implement a couple of React function components with state and side-effects. I had to do it myself to understand how they work and to feel comfortable with them. And I must say it feels pretty great to use them.</p><h2 id="The-Road-to-learn-React"><a href="#The-Road-to-learn-React" class="headerlink" title="The Road to learn React"></a>The Road to learn React</h2><p><img src="https://www.robinwieruch.de/img/page/cover.png" alt=""></p><p>Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.</p><p><a href="https://roadtoreact.com/" target="_blank" rel="noopener">Get the Book for free</a></p><h3 id="Never-miss-an-article-about-web-development-JavaScript-and-self-growth"><a href="#Never-miss-an-article-about-web-development-JavaScript-and-self-growth" class="headerlink" title="Never miss an article about web development, JavaScript and self-growth."></a>Never miss an article about web development, JavaScript and self-growth.</h3><h2 id="Take-Part"><a href="#Take-Part" class="headerlink" title="Take Part"></a>Take Part</h2><h3 id="Join-30-000-Developers"><a href="#Join-30-000-Developers" class="headerlink" title="Join 30.000+ Developers"></a>Join 30.000+ Developers</h3><h3 id="Learn-Web-Development-with-JavaScript"><a href="#Learn-Web-Development-with-JavaScript" class="headerlink" title="Learn Web Development with JavaScript"></a>Learn Web Development with JavaScript</h3><h3 id="Tips-and-Tricks"><a href="#Tips-and-Tricks" class="headerlink" title="Tips and Tricks"></a>Tips and Tricks</h3><h3 id="Access-Tutorials-eBooks-and-Courses"><a href="#Access-Tutorials-eBooks-and-Courses" class="headerlink" title="Access Tutorials, eBooks and Courses"></a>Access Tutorials, eBooks and Courses</h3><h3 id="Personal-Development-as-a-Software-Engineer"><a href="#Personal-Development-as-a-Software-Engineer" class="headerlink" title="Personal Development as a Software Engineer"></a>Personal Development as a Software Engineer</h3><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/ef81.html">https://andyxw.com/archives/ef81.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      RWieruch - What are React Hooks
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ç›¸å…³æ–‡ç« æ”¶è—</title>
    <link href="https://andyxw.com/archives/f37d.html"/>
    <id>https://andyxw.com/archives/f37d.html</id>
    <published>2018-10-24T02:15:36.000Z</published>
    <updated>2019-08-21T02:07:23.815Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><h6 id="å‰ç«¯æ¶æ„"><a href="#å‰ç«¯æ¶æ„" class="headerlink" title="å‰ç«¯æ¶æ„"></a>å‰ç«¯æ¶æ„</h6><blockquote><p><a href="https://github.com/sorrycc/blog/issues/6" target="_blank" rel="noopener">æ”¯ä»˜å®å‰ç«¯åº”ç”¨æ¶æ„çš„å‘å±•å’Œé€‰æ‹©</a></p></blockquote><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/f37d.html">https://andyxw.com/archives/f37d.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      å‰ç«¯ç›¸å…³æ–‡ç« æ”¶è—
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="é“¾æ¥" scheme="https://andyxw.com/tags/%E9%93%BE%E6%8E%A5/"/>
    
      <category term="æ”¶è—" scheme="https://andyxw.com/tags/%E6%94%B6%E8%97%8F/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡å™¨é‡ç½®å¯†ç </title>
    <link href="https://andyxw.com/archives/fe92.html"/>
    <id>https://andyxw.com/archives/fe92.html</id>
    <published>2018-10-15T09:33:12.000Z</published>
    <updated>2018-10-15T12:00:55.263Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><p>æœ‰æ—¶å€™ä¼šå¿˜è®°æœåŠ¡å™¨å¯†ç ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®˜ç½‘é¢æ¿ç­‰æ–¹å¼è¿ä¸Šæ—¶ï¼Œå¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹rootå¯†ç ï¼š<br>æ•´æ®µèµ‹å€¼ä¸‹é¢çš„å‘½ä»¤ï¼ˆâ€æ–°å¯†ç â€å¤„ æ›¿æ¢ä¸ºè¦ä¿®æ”¹çš„å¯†ç ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo root:æ–°å¯†ç  |sudo chpasswd root</span><br><span class="line">sudo sed -i &apos;s/^.*PermitRootLogin.*/PermitRootLogin yes/g&apos; /etc/ssh/sshd_config;</span><br><span class="line">sudo sed -i &apos;s/^.*PasswordAuthentication.*/PasswordAuthentication yes/g&apos; /etc/ssh/sshd_config;</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>é‡å¯åç”¨rootè´¦æˆ·ç™»å½•å³å¯ã€‚</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/fe92.html">https://andyxw.com/archives/fe92.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      LinuxæœåŠ¡å™¨é‡ç½®å¯†ç 
    
    </summary>
    
      <category term="æœåŠ¡å™¨" scheme="https://andyxw.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="æœåŠ¡å™¨" scheme="https://andyxw.com/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
      <category term="Linux" scheme="https://andyxw.com/tags/Linux/"/>
    
      <category term="é‡ç½®å¯†ç " scheme="https://andyxw.com/tags/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>è§£å¯†ä¼ ç»Ÿç»„ä»¶é—´é€šä¿¡ä¸Reactç»„ä»¶é—´é€šä¿¡</title>
    <link href="https://andyxw.com/archives/ac71.html"/>
    <id>https://andyxw.com/archives/ac71.html</id>
    <published>2018-08-17T08:39:36.000Z</published>
    <updated>2018-08-17T08:44:40.533Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><p>åœ¨Reactä¸­æœ€å°çš„é€»è¾‘å•å…ƒæ˜¯ç»„ä»¶ï¼Œç»„ä»¶ä¹‹é—´å¦‚æœæœ‰è€¦åˆå…³ç³»å°±ä¼šè¿›è¡Œé€šä¿¡ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç»Reactä¸­çš„ç»„ä»¶é€šä¿¡çš„ä¸åŒæ–¹å¼</p><p>é€šè¿‡å½’çº³èŒƒï¼Œå¯ä»¥å°†ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡å½’ç±»ä¸ºå››ç§ç±»å‹çš„ç»„ä»¶é—´é€šä¿¡ï¼Œåˆ†åˆ«æ˜¯çˆ¶å­ç»„ä»¶ï¼Œçˆ·å­™ç»„ä»¶ï¼Œå…„å¼Ÿç»„ä»¶å’Œä»»æ„ç»„ä»¶ï¼Œ<br>éœ€è¦æ³¨æ„çš„æ˜¯å‰ä¸‰ä¸ªä¹Ÿå¯ä»¥ç®—ä½œä»»æ„ç»„ä»¶çš„èŒƒç•´ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªæ˜¯ä¸‡èƒ½æ–¹æ³•</p><h3 id="çˆ¶å­ç»„ä»¶"><a href="#çˆ¶å­ç»„ä»¶" class="headerlink" title="çˆ¶å­ç»„ä»¶"></a>çˆ¶å­ç»„ä»¶</h3><p>çˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡åˆ†ä¸ºçˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡å’Œå­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢å…ˆæ¥ä»‹ç»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡ï¼Œ<br>ä¼ ç»Ÿåšæ³•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯åˆå§‹åŒ–æ—¶çš„å‚æ•°ä¼ é€’å’Œå®ä¾‹é˜¶æ®µçš„æ–¹æ³•è°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="comment">// è·å–domå¼•ç”¨</span></span><br><span class="line">        <span class="keyword">this</span>.$div = <span class="built_in">document</span>.querySelector(<span class="string">'#wp'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–æ—¶ä¼ å…¥name</span></span><br><span class="line">        <span class="keyword">this</span>.updateName(name);</span><br><span class="line">    &#125;</span><br><span class="line">    updateName(name) &#123;</span><br><span class="line">        <span class="comment">// å¯¹å¤–æä¾›æ›´æ–°çš„api</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// æ›´æ–°dom</span></span><br><span class="line">        <span class="keyword">this</span>.$div.innerHTML = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µ</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child(<span class="string">'yan'</span>);</span><br><span class="line">        </span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–é˜¶æ®µ</span></span><br><span class="line">            <span class="keyword">this</span>.child.updateName(<span class="string">'hou'</span>);</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Reactä¸­å°†ä¸¤ä¸ªæƒ…å†µç»Ÿä¸€å¤„ç†ï¼Œå…¨éƒ¨é€šè¿‡å±æ€§æ¥å®Œæˆï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿™æ ·æ˜¯å› ä¸ºReactåœ¨å±æ€§æ›´æ–°æ—¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œ<br>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ2ç§’åå­ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œå¹¶è·å–æ–°çš„å±æ€§å€¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µ</span></span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">name</span>: <span class="string">'yan'</span>&#125;;</span><br><span class="line"></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–é˜¶æ®µ</span></span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">name</span>: <span class="string">'hou'</span>&#125;)</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">name</span>=<span class="string">&#123;this.state.name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å­ç»„ä»¶å¦‚ä½•å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼Œä¼ ç»Ÿåšæ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å›è°ƒå‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ä¸ºå­ç»„ä»¶éƒ¨ç½²æ¶ˆæ¯æ¥å£</p><p>å…ˆæ¥çœ‹å›è°ƒå‡½æ•°çš„ä¾‹å­ï¼Œå›è°ƒå‡½æ•°çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç¼ºç‚¹å°±æ˜¯å¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥ï¼Œå¹¶ä¸”ä¸å¯æ’¤å›ï¼Œå¹¶ä¸”åªèƒ½ä¼ å…¥ä¸€ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(cb) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç»„ä»¶ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œå‘é€æ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; cb() &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'child update'</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹çœ‹æ¶ˆæ¯æ¥å£æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªå¯ä»¥å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯çš„åŸºç±»ï¼Œæ¯”å¦‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªç®€å•çš„<code>EventEimtter</code>ï¼Œå®é™…ç”Ÿäº§ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«äººå†™å¥½çš„ç±»åº“ï¼Œæ¯”å¦‚<a href="https://github.com/jsmini/event" target="_blank" rel="noopener">@jsmini/event</a>ï¼Œå­ç»„ä»¶ç»§æ‰¿æ¶ˆæ¯åŸºç±»ï¼Œå°±æœ‰äº†å‘å¸ƒæ¶ˆæ¯çš„èƒ½åŠ›ï¼Œç„¶åçˆ¶ç»„ä»¶è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯ï¼Œå³å¯å®ç°å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡çš„åŠŸèƒ½</p><p>æ¶ˆæ¯æ¥å£çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥éšå¤„è®¢é˜…ï¼Œå¹¶ä¸”å¯ä»¥å¤šæ¬¡è®¢é˜…ï¼Œè¿˜å¯ä»¥å–æ¶ˆè®¢é˜…ï¼Œç¼ºç‚¹æ˜¯ç•¥æ˜¾éº»çƒ¦ï¼Œéœ€è¦å¼•å…¥æ¶ˆæ¯åŸºç±»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯æ¥å£ï¼Œè®¢é˜…å‘å¸ƒæ¨¡å¼ï¼Œç±»ä¼¼ç»‘å®šäº‹ä»¶ï¼Œè§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventMap = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sub(name, cb) &#123;</span><br><span class="line">        <span class="keyword">const</span> eventList = <span class="keyword">this</span>.eventMap[name] = <span class="keyword">this</span>.eventMap[name] || &#123;&#125;;</span><br><span class="line">        eventList.push(cb);</span><br><span class="line">    &#125;</span><br><span class="line">    pub(name, ...data) &#123;</span><br><span class="line">        (<span class="keyword">this</span>.eventMap[name] || []).forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(...data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// é€šè¿‡æ¶ˆæ¯æ¥å£å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">this</span>.pub(<span class="string">'update'</span>) &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">this</span>.child.sub(<span class="string">'update'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'child update'</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Backbone.jså°±åŒæ—¶æ”¯æŒå›è°ƒå‡½æ•°å’Œæ¶ˆæ¯æ¥å£æ–¹å¼ï¼Œä½†Reactä¸­é€‰æ‹©äº†æ¯”è¾ƒç®€å•çš„å›è°ƒå‡½æ•°æ¨¡å¼ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹Reactçš„ä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">this</span>.props.cb() &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">cb</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;console.log('update')&#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="çˆ·å­™ç»„ä»¶"><a href="#çˆ·å­™ç»„ä»¶" class="headerlink" title="çˆ·å­™ç»„ä»¶"></a>çˆ·å­™ç»„ä»¶</h3><p>çˆ¶å­ç»„ä»¶å…¶å®å¯ä»¥ç®—æ˜¯çˆ·å­™ç»„ä»¶çš„ä¸€ç§ç‰¹ä¾‹ï¼Œè¿™é‡Œçš„çˆ·å­™ç»„ä»¶ä¸å…‰æŒ‡çˆ·çˆ·å’Œå­™å­ï¼Œè€Œæ˜¯æ³›æŒ‡ç¥–å…ˆä¸åä»£ç»„ä»¶é€šä¿¡ï¼Œå¯èƒ½éš”ç€å¾ˆå¤šå±‚çº§ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº†çˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜ï¼Œæ ¹æ®åŒ–å½’æ³•ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºçˆ·å­™ç»„ä»¶çš„ç­”æ¡ˆï¼Œé‚£å°±æ˜¯å±‚å±‚ä¼ é€’å±æ€§ä¹ˆï¼ŒæŠŠçˆ·å­™ç»„ä»¶é€šä¿¡åˆ†è§£ä¸ºå¤šä¸ªçˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜</p><p>å±‚å±‚ä¼ é€’çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç”¨å·²æœ‰çŸ¥è¯†å°±èƒ½è§£å†³ï¼Œé—®é¢˜æ˜¯ä¼šæµªè´¹å¾ˆå¤šä»£ç ï¼Œéå¸¸ç¹çï¼Œä¸­é—´ä½œä¸ºæ¡¥æ¢çš„ç»„ä»¶ä¼šå¼•å…¥å¾ˆå¤šä¸å±äºè‡ªå·±çš„å±æ€§</p><p>åœ¨Reactä¸­ï¼Œé€šè¿‡contextå¯ä»¥è®©ç¥–å…ˆç»„ä»¶ç›´æ¥æŠŠå±æ€§ä¼ é€’åˆ°åä»£ç»„ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼æ˜Ÿé™…æ—…è¡Œä¸­çš„è™«æ´ä¸€æ ·ï¼Œé€šè¿‡contextè¿™ä¸ªç‰¹æ®Šçš„æ¡¥æ¢ï¼Œå¯ä»¥è·¨è¶Šä»»æ„å±‚æ¬¡å‘åä»£ç»„ä»¶ä¼ é€’æ¶ˆæ¯</p><p>æ€ä¹ˆåœ¨éœ€è¦é€šä¿¡çš„ç»„ä»¶ä¹‹é—´å¼€å¯è¿™ä¸ªè™«æ´å‘¢ï¼Ÿéœ€è¦åŒå‘å£°æ˜ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¥–å…ˆç»„ä»¶å£°æ˜å±æ€§ï¼Œå¹¶åœ¨åä»£ç»„ä»¶ä¸Šå†æ¬¡å£°æ˜å±æ€§ï¼Œç„¶ååœ¨ç¥–å…ˆç»„ä»¶ä¸Šæ”¾ä¸Šå±æ€§å°±å¯ä»¥äº†ï¼Œå°±å¯ä»¥åœ¨åä»£ç»„ä»¶è¯»å–å±æ€§äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åä»£ç»„ä»¶å£°æ˜éœ€è¦è¯»å–contextä¸Šçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        text: PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡this.context è¯»å–contextä¸Šçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.context.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ancestor</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¥–å…ˆç»„ä»¶å£°æ˜éœ€è¦æ”¾å…¥contextä¸Šçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        text: PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¥–å…ˆç»„ä»¶å¾€contextæ”¾å…¥æ•°æ®</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">text</span>: <span class="string">'yanhaijing'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>contextçš„ä¼˜ç‚¹æ˜¯å¯ä»¥çœå»å±‚å±‚ä¼ é€’çš„éº»çƒ¦ï¼Œå¹¶ä¸”é€šè¿‡åŒå‘å£°æ˜æ§åˆ¶äº†æ•°æ®çš„å¯è§æ€§ï¼Œå¯¹äºå±‚æ•°å¾ˆå¤šæ—¶ï¼Œä¸å¤±ä¸ºä¸€ç§æ–¹æ¡ˆï¼›ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±åƒå…¨å±€å˜é‡ä¸€æ ·ï¼Œå¦‚æœä¸åŠ èŠ‚åˆ¶å¾ˆå®¹æ˜“é€ æˆæ··ä¹±ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å‡ºç°é‡åè¦†ç›–çš„é—®é¢˜</p><p>ä¸ªäººçš„å»ºè®®æ˜¯å¯¹ä¸€äº›æ‰€æœ‰ç»„ä»¶å…±äº«çš„åªè¯»ä¿¡æ¯å¯ä»¥é‡‡ç”¨contextæ¥ä¼ é€’ï¼Œæ¯”å¦‚ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ç­‰</p><p><em>å°è´´å£«ï¼šReact Routerè·¯ç”±å°±æ˜¯é€šè¿‡contextæ¥ä¼ é€’è·¯ç”±å±æ€§çš„</em></p><h3 id="å…„å¼Ÿç»„ä»¶"><a href="#å…„å¼Ÿç»„ä»¶" class="headerlink" title="å…„å¼Ÿç»„ä»¶"></a>å…„å¼Ÿç»„ä»¶</h3><p>å¦‚æœä¸¤ä¸ªç»„ä»¶æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä½œä¸ºæ¡¥æ¢ï¼Œæ¥è®©ä¸¤ä¸ªç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œè¿™å…¶å®å°±æ˜¯ä¸»æ¨¡å—æ¨¡å¼</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªå­ç»„ä»¶é€šè¿‡çˆ¶ç»„ä»¶æ¥å®ç°æ˜¾ç¤ºæ•°å­—åŒæ­¥çš„åŠŸèƒ½</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.onChange = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;num&#125;)</span><br><span class="line">        &#125;.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Child1 num=&#123;<span class="keyword">this</span>.state.num&#125; onChange=&#123;<span class="keyword">this</span>.onChange&#125;&gt;</span><br><span class="line">                &lt;Child2 num=&#123;<span class="keyword">this</span>.state.num&#125; onChange=&#123;<span class="keyword">this</span>.onChange&#125;&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸»æ¨¡å—æ¨¡å¼çš„ä¼˜ç‚¹å°±æ˜¯è§£è€¦ï¼ŒæŠŠä¸¤ä¸ªå­ç»„ä»¶ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œè§£è€¦æˆå­ç»„ä»¶å’Œçˆ¶ç»„ä»¶ä¹‹é—´çš„è€¦åˆï¼ŒæŠŠåˆ†æ•£çš„ä¸œè¥¿æ”¶é›†åœ¨ä¸€èµ·å¥½å¤„éå¸¸æ˜æ˜¾ï¼Œèƒ½å¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</p><h3 id="ä»»æ„ç»„ä»¶"><a href="#ä»»æ„ç»„ä»¶" class="headerlink" title="ä»»æ„ç»„ä»¶"></a>ä»»æ„ç»„ä»¶</h3><p>ä»»æ„ç»„ä»¶åŒ…æ‹¬ä¸Šé¢çš„ä¸‰ç§å…³ç³»ç»„ä»¶ï¼Œä¸Šé¢ä¸‰ç§å…³ç³»åº”è¯¥ä¼˜å…ˆä½¿ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ï¼Œå¯¹äºä»»æ„çš„ä¸¤ä¸ªç»„ä»¶é—´é€šä¿¡ï¼Œæ€»å…±æœ‰ä¸‰ç§åŠæ³•ï¼Œåˆ†åˆ«æ˜¯å…±åŒç¥–å…ˆæ³•ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å’ŒçŠ¶æ€ç®¡ç†</p><p>åŸºäºæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„çˆ·å­™ç»„ä»¶å’Œå…„å¼Ÿç»„ä»¶ï¼Œåªè¦æ‰¾åˆ°ä¸¤ä¸ªç»„ä»¶çš„å…±åŒç¥–å…ˆï¼Œå°±å¯ä»¥å°†ä»»æ„ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼Œè½¬åŒ–ä¸ºä»»æ„ç»„ä»¶å’Œå…±åŒç¥–å…ˆä¹‹é—´çš„é€šä¿¡ï¼Œè¿™ä¸ªæ–¹æ³•çš„å¥½å¤„å°±æ˜¯éå¸¸ç®€å•ï¼Œå·²çŸ¥çŸ¥è¯†å°±èƒ½æå®šï¼Œç¼ºç‚¹å°±æ˜¯ä¸Šé¢ä¸¤ç§æ¨¡å¼ç¼ºç‚¹çš„å åŠ ï¼Œé™¤äº†ä¸´æ—¶æ–¹æ¡ˆï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ³•</p><p>å¦ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå°±æ˜¯å¼•å…¥ä¸€ä¸ªå…¨å±€æ¶ˆæ¯å·¥å…·ï¼Œä¸¤ä¸ªç»„ä»¶é€šè¿‡è¿™ä¸ªå…¨å±€å·¥å…·è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·ä¸¤ä¸ªç»„ä»¶é—´çš„é€šä¿¡ï¼Œå°±é€šè¿‡å…¨å±€æ¶ˆæ¯åª’ä»‹å®Œæˆäº†</p><p>è¿˜è®°å¾—ä¸Šé¢ä»‹ç»çš„æ¶ˆæ¯åŸºç±»å—ï¼Ÿä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç»„ä»¶1å’Œç»„ä»¶2é€šè¿‡å…¨å±€eventè¿›è¡Œé€šä¿¡</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventMap = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sub(name, cb) &#123;</span><br><span class="line">        <span class="keyword">const</span> eventList = <span class="keyword">this</span>.eventMap[name] = <span class="keyword">this</span>.eventMap[name] || &#123;&#125;;</span><br><span class="line">        eventList.push(cb);</span><br><span class="line">    &#125;</span><br><span class="line">    pub(name, ...data) &#123;</span><br><span class="line">        (<span class="keyword">this</span>.eventMap[name] || []).forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(...data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€æ¶ˆæ¯å·¥å…·</span></span><br><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> EventEimtter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        event.sub(<span class="string">'element2update'</span>, () =&gt; &#123;<span class="built_in">console</span>.log(<span class="string">'element2 update'</span>)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ä¸ªç»„ä»¶ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element2</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; event.pub(<span class="string">'element2update'</span>) &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¨¡å¼éå¸¸ç®€å•ï¼Œåˆ©ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå°†ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„è€¦åˆè§£è€¦æˆäº†ç»„ä»¶å’Œæ¶ˆæ¯ä¸­å¿ƒ+æ¶ˆæ¯åç§°çš„è€¦åˆï¼Œä½†ä¸ºäº†è§£è€¦å´å¼•å…¥å…¨å±€æ¶ˆæ¯ä¸­å¿ƒå’Œæ¶ˆæ¯åç§°ï¼Œæ¶ˆæ¯ä¸­å¿ƒå¯¹ç»„ä»¶çš„ä¾µå…¥æ€§å¾ˆå¼ºï¼Œå’Œç¬¬ä¸‰æ–¹ç»„ä»¶é€šä¿¡ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼</p><p>å°å‹é¡¹ç›®æ¯”è¾ƒé€‚åˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½†éšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œè¾¾åˆ°ä¸­ç­‰é¡¹ç›®ä»¥åï¼Œæ¶ˆæ¯åå­—çˆ†ç‚¸å¼å¢é•¿ï¼Œæ¶ˆæ¯åå­—çš„ç»´æŠ¤æˆäº†æ£˜æ‰‹çš„é—®é¢˜ï¼Œé‡åæ¦‚ç‡æå¤§ï¼Œæ²¡æœ‰äººæ•¢éšä¾¿åˆ é™¤æ¶ˆæ¯ä¿¡æ¯ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…æ‰¾ä¸åˆ°æ¶ˆæ¯è®¢é˜…è€…çš„ä¿¡æ¯ç­‰</p><p>å…¶å®ä¸Šé¢çš„é—®é¢˜ä¹Ÿä¸æ˜¯æ²¡æœ‰è§£å†³åŠæ³•ï¼Œé‡åçš„é—®é¢˜å¯ä»¥é€šè¿‡åˆ¶å®šè§„èŒƒï¼Œæ¶ˆæ¯å‘½åç©ºé—´ç­‰æ–¹å¼æ¥æå¤§é™ä½å†²çªï¼Œå…¶ä»–é—®é¢˜å¯ä»¥é€šè¿‡æŠŠæ¶ˆæ¯åå­—ç»Ÿä¸€ç»´æŠ¤åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡å¯¹æ¶ˆæ¯çš„ä¸­å¿ƒåŒ–ç®¡ç†ï¼Œå¯ä»¥è®©å¾ˆå¤šé—®é¢˜éƒ½å¾ˆå®¹æ˜“è§£å†³</p><p>å¦‚æœä½ çš„é¡¹ç›®éå¸¸å¤§ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ¡ˆéƒ½ä¸åˆé€‚ï¼Œé‚£ä½ å¯èƒ½éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œé€šè¿‡çŠ¶æ€ç®¡ç†å·¥å…·æŠŠç»„ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œå’Œå…³ç³»çš„å¤„ç†é€»è¾‘ä»ç»„å»ºä¸­æŠ½è±¡å‡ºæ¥ï¼Œå¹¶é›†ä¸­åŒ–åˆ°ç»Ÿä¸€çš„åœ°æ–¹æ¥å¤„ç†ï¼ŒReduxå°±æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„çŠ¶æ€ç®¡ç†å·¥å…·</p><p>é™¤äº†Reduxï¼Œè¿˜æœ‰Mobxï¼ŒRematchï¼Œreselectç­‰å·¥å…·ï¼Œæœ¬æ–‡ä¸å±•å¼€ä»‹ç»ï¼Œæœ‰æœºä¼šåé¢å•ç‹¬æˆæ–‡ï¼Œè¿™äº›éƒ½æ˜¯ç”¨æ¥è§£å†³ä¸åŒé—®é¢˜çš„ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„å·¥å…·å°±å¥½äº†</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç»„ä»¶é—´çš„å…³ç³»åƒå˜ä¸‡åŒ–ï¼Œéƒ½å¯ä»¥ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•è§£å†³ï¼Œå¯¹äºä¸åŒè§„æ¨¡çš„é¡¹ç›®ï¼Œåº”è¯¥é€‰æ‹©é€‚åˆè‡ªå·±çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸Šé¢ä»‹ç»çš„ä¸åŒæ–¹å¼è§£è€¦çš„ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…³äºä¸åŒè€¦åˆå…³ç³»çš„å¥½åï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€Š<a href="https://andyxw.com/archives/7e29.html">å›¾è§£7ç§è€¦åˆå…³ç³»</a>ã€‹</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/ac71.html">https://andyxw.com/archives/ac71.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»ä¼ ç»Ÿç»„ä»¶é—´é€šä¿¡ä¸Reactä¸­çš„ç»„ä»¶é€šä¿¡4ç§æ–¹å¼
    
    </summary>
    
      <category term="React" scheme="https://andyxw.com/categories/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>å›¾è§£7ç§è€¦åˆå…³ç³»</title>
    <link href="https://andyxw.com/archives/7e29.html"/>
    <id>https://andyxw.com/archives/7e29.html</id>
    <published>2018-08-17T08:36:01.000Z</published>
    <updated>2018-08-17T08:42:17.490Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><p>æ·±å…¥è®²è®²æ¨¡å—ä¹‹é—´çš„è€¦åˆå…³ç³»è¿™ä¸ªäº‹æƒ…ã€‚</p><p>æœ¬æ–‡å°†ç”¨å›¾æ–‡è¯¦ç»†è®²è§£ä¸ƒç§è€¦åˆçš„ä¸åŒä¹‹å¤„ã€‚</p><h2 id="é«˜å†…èšä¸ä½è€¦åˆ"><a href="#é«˜å†…èšä¸ä½è€¦åˆ" class="headerlink" title="é«˜å†…èšä¸ä½è€¦åˆ"></a>é«˜å†…èšä¸ä½è€¦åˆ</h2><p>é«˜å†…èšä¸ä½è€¦åˆæ˜¯æ¯ä¸ªè½¯ä»¶å¼€å‘è€…è¿½æ±‚çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå†…èšå’Œè€¦åˆåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p><img src="!--ï¿¼0--&gt;416.png" alt=""></p><blockquote><p>å†…èšæ˜¯ä»åŠŸèƒ½è§’åº¦æ¥åº¦é‡æ¨¡å—å†…çš„è”ç³»ï¼Œä¸€ä¸ªå¥½çš„å†…èšæ¨¡å—åº”å½“æ°å¥½åšä¸€ä»¶äº‹ã€‚å®ƒæè¿°çš„æ˜¯æ¨¡å—å†…çš„åŠŸèƒ½è”ç³»ã€‚</p></blockquote><blockquote><p>è€¦åˆæ˜¯è½¯ä»¶ç»“æ„ä¸­å„æ¨¡å—ä¹‹é—´ç›¸äº’è¿æ¥çš„ä¸€ç§åº¦é‡ï¼Œè€¦åˆå¼ºå¼±å–å†³äºæ¨¡å—é—´æ¥å£çš„å¤æ‚ç¨‹åº¦ã€è¿›å…¥æˆ–è®¿é—®ä¸€ä¸ªæ¨¡å—çš„ç‚¹ä»¥åŠé€šè¿‡æ¥å£çš„æ•°æ®ã€‚</p></blockquote><h2 id="è€¦åˆ"><a href="#è€¦åˆ" class="headerlink" title="è€¦åˆ"></a>è€¦åˆ</h2><p>ä¸åŒæ¨¡å—ä¹‹é—´çš„å…³ç³»å°±æ˜¯è€¦åˆï¼Œæ ¹æ®è€¦åˆç¨‹åº¦å¯ä»¥åˆ†ä¸º7ç§ï¼Œè€¦åˆåº¦ä¾æ¬¡å˜ä½ã€‚</p><ul><li>å†…å®¹è€¦åˆ</li><li>å…¬å…±è€¦åˆ</li><li>å¤–éƒ¨è€¦åˆ</li><li>æ§åˆ¶è€¦åˆ</li><li>æ ‡è®°è€¦åˆ</li><li>æ•°æ®è€¦åˆ</li><li>éç›´æ¥è€¦åˆ</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´æ¯ç§è€¦åˆæ˜¯ä»€ä¹ˆï¼Œå¼€å§‹ä¹‹å‰å…ˆæ¥è¯´ä¸‹è¦å®ç°çš„åŠŸèƒ½ã€‚m1å’Œm2æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå…¶ä¸­m2ç§ä¼šæ˜¾ç¤ºm1çš„è¾“å…¥ï¼Œm1ä¼šæ˜¾ç¤ºm2çš„è¾“å…¥ã€‚</p><p><img src="!--ï¿¼1--&gt;417.png" alt=""></p><p>å¾ˆæ˜¾ç„¶ï¼Œm1å’Œm2ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¼šæœ‰ä¸€äº›è”ç³»ï¼ˆè€¦åˆï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥æƒ³æƒ³å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¸‹é¢ç”¨7ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p><strong>æ³¨ï¼š</strong>é¡¹ç›®çš„ä»£ç æˆ‘æ”¾åˆ°äº†<a href="https://github.com/yanhaijing/coupling" target="_blank" rel="noopener">github</a>ï¼Œé¡¹ç›®çš„demoï¼Œå¯ä»¥åœ¨<a href="http://yanhaijing.com/coupling/" target="_blank" rel="noopener">è¿™é‡ŒæŸ¥çœ‹</a>ã€‚</p><h3 id="å†…å®¹è€¦åˆ"><a href="#å†…å®¹è€¦åˆ" class="headerlink" title="å†…å®¹è€¦åˆ"></a>å†…å®¹è€¦åˆ</h3><p>å†…å®¹è€¦åˆæ˜¯æœ€ç´§çš„è€¦åˆç¨‹åº¦ï¼Œä¸€ä¸ªæ¨¡å—ç›´æ¥è®¿é—®å¦ä¸€æ¨¡å—çš„å†…å®¹ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªæ¨¡å—ä¸ºå†…å®¹è€¦åˆã€‚</p><p><img src="!--ï¿¼2--&gt;418.png" alt=""></p><p>ä¸ºäº†å®ç°åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†m1çš„è¾“å…¥æ”¾åˆ°m2.m1inputä¸Šï¼Œå°†m2çš„è¾“å…¥æ”¾åˆ°m1.m2inputä¸Šã€‚</p><pre><code>// m1.jsroot.m2.m1input = this.value;m2.update();// m2.jsroot.m1.m2input = this.value;m1.update();</code></pre><p><strong>PS:</strong>ä¸çŸ¥é“è°ä¼šè¿™ä¹ˆå†™ä»£ç ï¼Œé™¤äº†æˆ‘ä¸ºäº†åšæ¼”ç¤ºä¹‹å¤–ã€‚ã€‚ã€‚</p><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo1" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo1/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="å…¬å…±è€¦åˆ"><a href="#å…¬å…±è€¦åˆ" class="headerlink" title="å…¬å…±è€¦åˆ"></a>å…¬å…±è€¦åˆ</h3><p>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€ä¸ªå…¨å±€æ•°æ®ç»“æ„ï¼Œåˆ™ç§°ä¹‹ä¸ºå…¬å…±è€¦åˆã€‚</p><p><img src="!--ï¿¼3--&gt;419.png" alt=""></p><p>åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€çš„dataä¸Šã€‚</p><pre><code>// m1.jsroot.data.m1input = this.value;m2.update();// m2.jsroot.data.m2input = this.value;m1.update();</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo2" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo2/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="å¤–éƒ¨è€¦åˆ"><a href="#å¤–éƒ¨è€¦åˆ" class="headerlink" title="å¤–éƒ¨è€¦åˆ"></a>å¤–éƒ¨è€¦åˆ</h3><p>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€å…¨å±€ç®€å•å˜é‡ï¼Œè€Œä¸”ä¸é€šè¿‡å‚æ•°è¡¨ä¼ é€’è¯¥å…¨å±€å˜é‡çš„ä¿¡æ¯ï¼Œåˆ™ç§°ä¹‹ä¸ºå¤–éƒ¨è€¦åˆã€‚å¤–éƒ¨è€¦åˆå’Œå…¬å…±è€¦åˆå¾ˆåƒï¼ŒåŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯ç®€å•å˜é‡ï¼Œä¸€ä¸ªæ˜¯å¤æ‚æ•°æ®ç»“æ„ã€‚</p><p><img src="!--ï¿¼4--&gt;420.png" alt=""></p><p>åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2éƒ½å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€ä¸Šã€‚</p><pre><code>// m1.jsroot.m1input = this.value;m2.update();// m2.jsroot.m2input = this.value;m1.update();</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo3" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo3/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ§åˆ¶è€¦åˆ"><a href="#æ§åˆ¶è€¦åˆ" class="headerlink" title="æ§åˆ¶è€¦åˆ"></a>æ§åˆ¶è€¦åˆ</h3><p>æ¨¡å—ä¹‹é—´ä¼ é€’çš„ä¸æ˜¯æ•°æ®ä¿¡æ¯ï¼Œè€Œæ˜¯æ§åˆ¶ä¿¡æ¯ä¾‹å¦‚æ ‡å¿—ã€å¼€å…³é‡ç­‰ï¼Œä¸€ä¸ªæ¨¡å—æ§åˆ¶äº†å¦ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚</p><p>ä»æ§åˆ¶è€¦åˆå¼€å§‹ï¼Œæ¨¡å—çš„æ•°æ®å°±æ”¾åœ¨è‡ªå·±å†…éƒ¨äº†ï¼Œä¸åŒæ¨¡å—ä¹‹é—´é€šè¿‡æ¥å£äº’ç›¸è°ƒç”¨ã€‚</p><p><img src="!--ï¿¼5--&gt;421.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œå¾—å¢åŠ ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯å½“m1çš„è¾“å…¥ä¸ºç©ºæ—¶ï¼Œéšè—m2çš„æ˜¾ç¤ºä¿¡æ¯ã€‚</p><pre><code>// m1.jsroot.m1input = this.value;m2.update();m2.toggle(!!this.value); // ä¼ é€’flag</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­m1ç›´æ¥æ§åˆ¶äº†m2çš„æ˜¾ç¤ºå’Œéšè—ã€‚</p><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo4" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo4/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ ‡è®°è€¦åˆ"><a href="#æ ‡è®°è€¦åˆ" class="headerlink" title="æ ‡è®°è€¦åˆ"></a>æ ‡è®°è€¦åˆ</h3><p>è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´ä¼ é€’æ•°æ®ç»“æ„è€Œä¸æ˜¯ç®€å•æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿç§°ä½œç‰¹å¾è€¦åˆã€‚</p><p><img src="!--ï¿¼6--&gt;422.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><pre><code>// m1.jsme.m1input = this.value;m2.update(me); // ä¼ é€’å¼•ç”¨// m2.jsme.m2input = this.value;m1.update(me);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo5" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo5/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ•°æ®è€¦åˆ"><a href="#æ•°æ®è€¦åˆ" class="headerlink" title="æ•°æ®è€¦åˆ"></a>æ•°æ®è€¦åˆ</h3><p>è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´åªä¼ é€’ç®€å•çš„æ•°æ®é¡¹å‚æ•°ã€‚ç›¸å½“äºé«˜çº§è¯­è¨€ä¸­çš„å€¼ä¼ é€’ã€‚</p><p><img src="!--ï¿¼7--&gt;423.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªç®€å•æ•°æ®ç»“æ„ã€‚</p><pre><code>// m1.jsme.m1input = this.value;m2.update(me.m1input); // ä¼ é€’å€¼// m2.jsme.m2input = this.value;m1.update(me.m2input);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo6" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo6/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="éç›´æ¥è€¦åˆ"><a href="#éç›´æ¥è€¦åˆ" class="headerlink" title="éç›´æ¥è€¦åˆ"></a>éç›´æ¥è€¦åˆ</h3><p>ä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å®Œå…¨æ˜¯é€šè¿‡ä¸»æ¨¡å—çš„æ§åˆ¶å’Œè°ƒç”¨æ¥å®ç°çš„ã€‚è€¦åˆåº¦æœ€å¼±ï¼Œæ¨¡å—ç‹¬ç«‹æ€§æœ€å¼ºã€‚</p><p>å­æ¨¡å—æ— éœ€çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå­æ¨¡å—ä¹‹é—´çš„è”ç³»ï¼Œå…¨éƒ¨å˜æˆå­æ¨¡å—å’Œä¸»æ¨¡å—ä¹‹é—´çš„è”ç³»ã€‚</p><p><img src="!--ï¿¼8--&gt;424.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseç§ï¼Œå¢åŠ ä¸€ä¸ªindex.jsä½œä¸ºä¸»æ¨¡å—ã€‚</p><pre><code>// index.jsvar m1 = root.m1;var m2 = root.m2;m1.init(function (str) {    m2.update(str);});m2.init(function (str) {    m1.update(str);});// m1.jsme.m1input = this.value;inputcb(me.m1input); // inputcbæ˜¯å›è°ƒå‡½æ•°// m2.jsme.m2input = this.value;inputcb(me.m2input);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo7" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo7/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h2 id="å†…èš"><a href="#å†…èš" class="headerlink" title="å†…èš"></a>å†…èš</h2><p>å…¶å®å…³äºå†…èšä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±ç ”ç©¶ç ”ç©¶ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†æ¥åˆ†äº«å†…èšçš„é—®é¢˜ã€‚</p><ul><li>å¶ç„¶å†…èš</li><li>é€»è¾‘å†…èš</li><li>æ—¶é—´å†…èš</li><li>é€šä¿¡å†…èš</li><li>é¡ºåºå†…èš</li><li>åŠŸèƒ½å†…èš</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¸Œæœ›ä½ çœ‹å®Œä¸Šé¢çš„æ–‡ç« ï¼Œææ‡‚äº†è€¦åˆçš„ç§ç±»ï¼Œä¹Ÿå¸Œæœ›ä½ ä»¥åèƒ½ä½¿ç”¨éç›´æ¥è€¦åˆè¿™ç§æ–¹å¼æ¥å†™ä»£ç ï¼Œç¥å¥½ã€‚</p><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/7e29.html">https://andyxw.com/archives/7e29.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡å°†ç”¨å›¾æ–‡è¯¦ç»†è®²è§£ä¸ƒç§è€¦åˆçš„ä¸åŒä¹‹å¤„
    
    </summary>
    
      <category term="æ¨¡å—åŒ–" scheme="https://andyxw.com/categories/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="æ¨¡å—åŒ–" scheme="https://andyxw.com/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>é¸¡æ±¤</title>
    <link href="https://andyxw.com/archives/201.html"/>
    <id>https://andyxw.com/archives/201.html</id>
    <published>2018-08-05T02:32:11.000Z</published>
    <updated>2019-08-21T02:40:43.323Z</updated>
    
    <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script><div id="security">  <div class="input-container">  <input type="password" class="form-control" id="pass" placeholder="è¿™æ˜¯ç¯‡æœ‰å¯†ç çš„åšå®¢" />    <label for="pass">è¿™æ˜¯ç¯‡æœ‰å¯†ç çš„åšå®¢</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">U2FsdGVkX1+zbqikt1FbBS+vD+IhrXG3k8MJcIsPhIi8vanHZFftnXo+VB/G0v7LYde9cvL5pS4CuiM7pLtNSpg3mncAk6AsaIF5Sq5LK6ffoaw3/KosqiwA0tjKg0gzxzfuzAak0LlAKHbYAqNj2HcHTZt8zEaH2Mox9dQWh8o81PFR8/sPioPrmLWK+65xGeFLpbn08leNBLddHZmUE4cT973fuBtGS3HMhLRryA6K+vs8SaJtnXtD5433kaa+YE8gZHGIId42CP8u2eKRgvFObhLkBpyy7tTJ6hucXDZoHULBR6VbX8o59WCFGVjyWWr4i7SsTIM1WpuwVktOxv24pZ2ekwSV6ByzzYHHcocmiBTvDmt8fizjzKq0dL7XdU/IjEKk7kQsoqiKkIVH1X6G3fGY23o0A86BtNyDrJSE5uTWdcXDOvs1kTjPEjZz55BoAq3IiOcc1CaIAzY0ddIH7RewAjeN+oMhv2BneCONZ04X6DhvPi2AxFAEkLlP8P04BamjQFpxtbVDwKmfuMu8ZT/GRR9fBrjfgZtjE7xcAUjmmbL9Op2mtkKMp9mI1xgzMkf+4XYCTeACJtZh+tru8wmYccd+JmQNZFHuFSseq9Kxv8Cv3ZYxEF4ZcL/gl2Q4RReT9f1rMwoICcpV1jxyqdIQvMzyBPBKojrpRbP/rT0DmxZ1NiZ/x+zKPQ9plUka572b76zMk7IknuCWGobwBTbhvHMwOs4f/ys3+lX8IKoYttIDVdPcR3s5x890b5Ku6ROmKwlI/ipb5Bp8AKJosz8RWpOs8GViIE8qzaW3z67n9IujdrUHx8HUNkj+ozqivsUFTJNes+p6bW/HcseUwlSMpjIh3DM7Jf7I9sbO1jHNVY6wstT6VnrrRbP80ppV8pIJKEb5wPQW8Eafu+xCOlbEmch9GBceOgF+u3peat9xX1DjF7on4GkgdmkfeJ6js5QvYHIPksQOIBYDO/0dZPfcXSjkB6hllC+Xd2wDUzPKsu7D/ns9pBtKdD0wzTleXlGg/yEE1smMqiC6u1YK4NZEYIcy1Y1vbrnhoyPN6lZ3YfxlNO8aNYXTybDxmXcOLVkAScGvK1YKhFmNvbDnL/4LGCMJDSA8vE7PjklHJCPXlq+09JeS47L8o5qBQWy+jIc3noLGDPDkvAG+vBT3/8H88YHiykEBm2alJ/+waG19o4X0g3keZPBiynpXQkmVGUftTOHZOfZmnNYmOg6epjOCKdzaQPnQDrmoHCDadI7ehe6+6WEhRpST1ur5bFhO5JIV5/G15sbdp8mWumWBbUkWKW+0fFrEwX2UhZ5Y9HUy51Nddce1IX7kBaXSL9N3HJGWhRJ2sPUzUNcrrRLPHfTyiT12GqpV++vRC4ARyVoM/CNwyAQCg5ibPBTy1QIvIeSfliHHQ/XwDl3cxSKWh1aNhYJzKH1F5KWpuAolP9oMVhbdGf+L/eZr4FkHewJ4obtHCuQWI5Ndggw6y+l+kkVMo64JpK1jB929ovov+Cu8RvSPPtyonenatinNRUQ0kAh11WvYxUJI44g4sIWn8gByIoO6vuOJ12ntJOh8+JRDcGDzi4gYbI+W9aRZS+tFkoFOvhqd8YdObClD9NBtdge/JwKOJmRBO2iqzyrEomjlV0/27X28oVp40rM/F/JOUt7R9PH9htrq5dDvCYRsH6/G34hf0uEhzzvhEfcl3rJ+JgVlwhJtMv5h43MsvzVUA65/LSXpdNKM2z5mSnMYqrzLAgvB7e2zKlvk3qWOjb6vPaT3YTgeHcjkApFSzQD/XpSTas0aW9feSRWHoaMIHYRE/WY/d13gvB8MavBKMvP/+uEmiEa8ztQOwhgJwT88lJOeOpx6yrNDE2nFkab9cSlmqJRvweQ4VS4t8q2nQr2VIFPewMqOQwb789NiLP91J6V5DA43wnlhpv4V+1Y9z+Lw2paIbMVsROJ0pA5jtNPKPkVa1cliSFEJoQM3wRmYyAV6f6wpcw+OjA8AuCZ8xefsFgfKL0M0Y+156gfdJp/y62MNpLiHfF6fvTXcp7dQnbbUwvFa3MwizgBBlm8Mrr4LA52Grqv/cWae3m4PUxnba20gYOvIo3lhOE9ILgAzZSK3XVELuR1h988faZusOailD9HSl2FBBdldKNFlMsLAUTzlqHx6fYGXu6FINOLVKKNzqChqbAocyNdRuwRjhTVDvjxrNdHDfaSVbD/he1XWhpB13gFcootR2ivSaCvlnSGWNXvfjOeTtGe8Yri/GrZB/f3/HE4BvLcr6+yW9TZo+W9HN1gxgVhIEDHDAo22axJvOBCKNT3YP35ebQV3Qm0bZQ36vH9MIjES3K/uMNv82ncndPXTiw36VP3PfJ35xPGuSpedda250dQIfouSTirtIB/FAQClkn03RsDa0ithNRV61nitjMa/MVIW1D0s45YmuyoF9igQFUHmdv+q9YNBSg/3kMQwPiY9drwNIXV14KQOC+xDIeGFboZAUF/FdrrZMCTo4cHWNP5hz/LHXGINGZURttYtTQwXi+US/ymtmC2hwdBdtxwx/RpNZdp0bs0nvmziTOCs9SPtgJY2UMz8oo77+crSFGEsxBNI+sV9vLSVa1kLh/FumZsgHxxb1PW7qy1t54ay9cDNGkKV0yxhsZ3LXw+oeSfm6NuuFBQNLXvvktvtlD9tsYwEdl5rRngRBnPHfOigOaHab1Adloz24hro9cZEZgITfDQfzORimBT3oDNvSSX5PYHancQokweLOGZ+/vsp/4iT3mQN3q3AqOOiW8nyQirvC9SPnnWJ9VHxkoMhPK6oWY/GfAj3+nyYdJGm+ry0mzH2lqqaOTs6SbQa2eq6fOrQqSRZ8dN3bGkPApz/Qf8959FXZuiTE7RtwRqxD+KdDKC3CWTt1UWKqt3aiyKYgUri7It/6B7lXSOnAsFbW0xeAeVCR7AhVGlsiR6wcnU+6LhJF1w4zFnfDnco5ROYgVkxtkCbueByubO9RW+o7PnKVkPtN1etckvero+v+Cdt1ZE8tdbbcyllH3Gz2reGUXFBiNZaWZmJ1FtECcCMtkg56E9AglDSOQV+pSwM+oK4gbzGGZiMhEwgPwNDMQgFPDxM+v2vdbbPj37d/wbyqrM29/lPMatcmVfILdS+oLs0BNGHXtzW8JjPlTBsk4UrOS9/orM9s/cIiHlPHUIv5tjsuJJt4PIOm6ykc/kCMeVwT2nvqsHqy/vghN2DtI7+QoI94IGdQSR7tjnFQ487bXH0+MGDJiBdp0RqkFKTBZju7IfvojAYY0uXWpko1pdgaMEqAuUhYEr/HVIG+0lq7IqVKGR5ZIR+BNwwSH0AS1jm4Hz9DZkcPc1X5SGOUy0vMw8O/zJpFrq7kgpsUWLOCpDBsL8C5U6YJ72vh/C3ZRXkq85McafvuAziH4FAvhqguny0PECmaqTdjszxUvRZmoW5u+VkFddqt1RwwyrG3/spM/d3v2DYyI5bbEh0nIO5ZfbZBD8twe2EheIUOqaW7TwuwYNpTT4PB9FLVNfkSVfUaMsDSWSnEXuwWhPZ37MTqconFKVhaKHRuX66DCYShb99ciOz/TQs8lRVCZhRDIjXEEn434O/VJog5hiUAUFBCmS3VqeFgaakS2mxn7s9ziht4dYjl9oGxJaV4KasqhS7QgLG5N75gNqilsMdggHgVLTCx2vI7Te7nCVjnsJlwQb4zK6Hy2fLR8LuFxeFGilGeaAW0wGAbznN8pEqSAjHACK+h5LdZtYhalCznap8sPJTlShOz5n5wC2lRk2dVG5l9J4VbnGd70Z84J2POpDhYcO1POtClm8AoUlR4+vSKZJncpXyNxAJUrAAyL4LWs06hbK45EL1ARZofc1/2Q9aM2I7ptlF9plLLg0dFjiVCPD/Iho7g93EZrXRo7Hb9Lc7+lM8Y7qxGSmIuc7LZfkEFfAhpwkGMS88IT5X7zShlEDd1MWmrw8kBMokWq9c60vrPNHBfyjfvZ0AbqUvR3kN4BSYfwtGVZdyfrBZzLEnbzpByBABNNxyJvNhgPmu7K+6GTuK6c1Wg7E0cHlFMF1rfBXQagsdEZZi5aq9mgcLwaFREzLNPHEBPu3oLLmCGuvuMkmEF+2PdG4f8qiOgtpcp2yH5zD3YCKoZTqkcO2wlPmAFTdG6XCtxyw9ao1xsnGBKESJ1oDEmN/eyEheI/5LF0H5OVPNLfEDeqlPTzvqP0hG3QImRFJTJpJb50kuxxtXTQ2KcyUhWdqyCpsxmyrh1jZMJmY5jNEV9MSz+roIUVayithK8CmsnXMY0LW6abZUNqyxhVhA5/AjmXHQIQkOvh9AXYCHh0InxUEhojiSr7GJCTXYzEIgnpaqCJLSb89d6hD7CqcGtpxbrC8fFGo+hjyo2wXBefNY9cT/icIwPLWJxeR2+gDv54d9kiJUDxBtL/swvSNqhrnbYY5+TS2JQtpapugmwmmPtsfQWR1DGioF+H6iRovLfFxFmoC4RkANx4WjP3FcecxF4rOl9naw3Rm6Y8aCK1n07LAVX+PaCVXrWS+OgrH2nytWMor6CIgCuT+HtZxQEWsR1WW1gUYeY3cM4HuecUiPoBH/b3f1tVsgq2tvo8cRZAfQKIm5io8m5GS87c/SRGdb34iwen12ugDe3bCTETCrxLbXKGOLVbDAfTXEVRH7fOdhMpBJ0etlGVeEe8CYZtAJHA65wi4/pqaPSLCTQB1WNMU3EhbBEemcYaNpIqlWEKM4byuNzJuhTvMvjJ0kLnGdJh2IDjcUe7zvvXLF+831xWCF1pGwrl2DSfrp9obvZviHLnvsypDY+GZZk3LeVeC0qKWrbcevFCAWuBwQNuNNk2eML95DAqprVhRuJHUgERrLv/VDOFykVXCx63Ryn2YLjcUO8E07LUdBC8Fa37tzyiDs8OM+jJH7xSbSY11L4fxNQ/Ge4gTr4tgYcIdS8k0zHYAr1jP5vYFEz1fIwycAesioSR7GtqQG+f27Cn+JX7yfJL6OqlhmKE9twKSyBIVC0tWOjr0ZuGt4hfcuMLXxFTzgp/dBCy1GRCnDPdefv/rCiLgmTEe4wEWb0Wt2pKDYnGIbzgm6qPiNyIahx/2VheOv7Ld/pATYoq+5jos0TQaiFUb30dolmLNGu/p4k+sqMWa1xX27cW6/CTMlkXuvbKlb8t27Fhxz8p2xVQFZaANI/PJbg1LBRWFfxnil/PoxK4t+L+Bm5BAHT2+iLsPnDoyZf2+sUiIpKey5KWczatuGrDr0eWrwC7ra1Hvjlg2+y9skUrLQrytqV+dgYB6hFlljElhYtvfiP6tolKlRUC0dbDIodChqf6gB5bkYKqmVCoGyNmR3d0mOS1VP77lgTy9r//mdpVn3pcPFOlSAvHZyBwKzX+vExlOSDWkalYfUqR6G6pUjpeOm7ZRBwaJ3d2k/k9oaZ/6IIGoh20OqMagvoGbZ1BEOFJPQboqWvKHh1qV96SGujmREnigHLYV9T5JWHPMvg7u0l0DfVCJxcRfUIsHltXx8zu1I+7LXhn+M8UYNwTloHOKjvfuxQEiTb8sxZlCgqJq+UJGQICTgl6Dgn16e94jFbzWwaeqRHOGbjrmxVtQjr9uZAD1htUhi1hCpIiNREMb7gfkFKLEkVphT5dduYTPKJ4h1jx09bIh2zlmsRCGaXcXbN2I6NqRPd/PTEXeFAoKcKCD2r7wxggDqadtAWzxQpj8EekAsEdlCFQK/JDTRUVP4laRNdM+0JULs5CefEfv8IAUvwS1QUnj8hJiwQkmhYXnkXReyb+yrqLOrg8zgi2FOqZORFwxB8lUxS38ToeTRPqlCxlBVS/1c5UX45v//HVAfrfUL0rOW5ox1njxcvn15KRgtnvwG5o9AJLr8PHrTzoHU9nZipHN+FmLx8xgogk6h9X5LUTXH0Oi4DOYaoCHqrvyUFMAjXnYtShwZ8LshiHryPglXuH0Jdr0KyAYdIB2pIwfcpQi7GB4ELxOOurBNiJoTB0x9jgob9uPcw84/PUatYq9zpxVh+kPX+bQWKiZYLqf8dd5YCuJ3LcENDb7yUMiGZRUlsaPKEWDWsVf6R/gZMl3q1Mxmhdkn6kK17y2U6i+rJOyAmWByLEcfIfVh8ND0S2BA4ryK0jfZrrMZH+jR4pNkM2DO2b615QS4DpmqQppql1YdTE8oYi0XcjsmvcPMJYkw6+x/MIaSwiISt/S/N7wsgSgbmt8tHfNwbsrVmnUH5cG7/ApT+ts65Zgm5G9sDvOpzOW8tdzs/g7kbHOliyeBavuSh0O2Up8h4lmiVTPv8jRWxikrqcYWrxow2O49vVDwNg+s3Pmih8ExmK59b4RQ+yl4Y4Ac1xndPI68Trl+Bj/CCrNIxV5zLJExnClxBhP+vfXfWvT0hU4SEerfRfn0VI85LQxb3GgKsMSPc5w9QXcmo4aqeMf1+aDXI60mY8LwNsT5QNLew7J+jWZ7OpsQje/STprFpEhO2VMJ5cqpDMAfHVw4zHrQkehNuF77uViQwztg885RWG+qDmVArUW4arOUvCQqW/bplOStNX5nKtgJ1wwNMQ0DSjYxs+8xmNVBHOzKhXeSzYJL7jcviO48lYAjhvv9tm/UbbuN8jDrVPlU+h9LSUapacJjNILawm9jCSNZO1FOZeaxv62COogIs1Hb5oRxRLZWLsJkvKsdgfjJ9HzMZ5i6KK7mtchngVbPymxJpz9tPndGheXKI55sJg8IgrSss77fL7POAAnaZgrPLN+TGsAN/W8cOfn3WfeVHHXXn13+UM8EWFk3RnSo6m7HCgeJgG4GfUci9lE1dldXzsO1UEoIvVndFtq+IEefML1uIZf4wWDcj+Iy6EjmC2fGK+VI/U018Fievgdn1qRLH7rPYBs7Nz2bTb6naT6UMBKfKJN43kAoRXYewtrLK/4dq4qWbfa9e6HBrlq+LZKvqhwFA9UuHYuWQAjAZfpP0qJ/xh0izHME2xOBLKEozc6qPAqfhbEIR+jhOWw0mhBb9OltVYOiEkrp9VjbzOdffZcNJXKQqYn5I3Mosuu45KszvFsBSfmF21NMuGxhhasPl0FsTygngr1jC9NhrtWFnhg13eJ3CLxVaryQCpJNaMrDu617ALxLZfFa1ryotN5vhiV5pmIeBqroeDRNIBitCJ5YEnsbzdmUphdi+PDKy/RdHfzznny7jQ24/i5D8UXkMzX55GlzJF9mdYEIALU/FzDYzX605mspu1pAUmX+MMP3z+iGDRDR6nH/dmTx65sJav4QrSZ2T0d/FJuFBQ4q8Lzt5jhp6hVWA0U4JF3i/oDyXGwTGbjMiQxgjTgZF7fu8L0ZahR4WDprNqYZRQaCIqp0bFqBwBQk6XG6nNnjKlOQk0ocqInT2/9V4AAYjwav4DCuEtWBzFcM8Zz0Z/SYpfaTWt4SgiRh95OpQs/W+gZHCw/6tlkOK4k74ty3pm/KUzgXrNGcN53kkUErgA01QT5eZGsJV6xcaprm7YgKJgrpqPw7F66f3deHTCRdehMLirS8o+KJXv+qtg9TDO1HHSXBkvKYm8QaXsAvVyVommSpdcSyTzuwBwrC8uCJhn8+rzKiJX2t4JtV1O+JW5S/9meP93wk+AX7ovifhRCG95V0Aq3FkluV0tb7P/HYbTaKRENjq9nbRM7/3HumuSC5bvsMVj/BAtmdsYFSy/I0ZN6kGDcQP3bxcRKP4usP4TbKErejQRDrWpZ/4cQdp88vdq784e5XXBWSwsVudbO9wsiPpcvvxfNqhIrglmxTvR4qcLwz6Nxgp7PGH91tfgAsPr8ea9PDk1ivV3JLVFQ9whxMVv3EFNnwuRJJrbNo/phuLYXb0o1ina+wcLa1vjt7HNVRmS0CG7ws202ef4sbhFuJzEZvZtmEQo33XI5yVa/NyIJC/YBpWsaKQP7bw0JME/Q/E5RK+KHEyVYg8gvrU3iZF5eSO68buR5OHxkTgXp5S2bbzaxFqiVi02eeckZ3/9ateM31M1c7EMmKtSC+yO3IzvyUaRmbeAsdIvkok//U0s5bbpx8/Fx1TG9I3aU1Q5JB2xwv9t4hgDFAR5RNPcnTkda6MyAzytLAFK34THuWg6WDKSwUirPR0xlR71M/81K2nT6yuFBxn1b13tgQI0jnwgD6r/zy1eWGFnoOv1qzjg+YY7dDmz6JwoEtkLmqQjetj7LnuzeGGuxX78jNfTXG07kJMQ2R+7E5I4zyXaLJZg/Hu/4pp/K+0v1YYi/yoiVjYOhdB0EbYrJDOdv4L8NhgHlgxFTPUyJAm78FRlcJfiS4+y6E3Lfg0YHVdX+qW3J+zXNIEbBvJNtEuTi7awJh68dawbZSSTJ/hnZ36NZcpv2yU8n3I6bRU1In7Hr218zW0lu0X9P4sylbu6tmiDDyJBBg9TVvKQxdm6fDMrdk6kBWwlQ+wERkUvKWaGtcJM7GQwEllHgIjtA1N0ZqH4r0sixE20P1x1ZP75RmnMkD5DHOn9YkgdUZzW0xnEQgpo0xY7WMpgOgUKlpa1ZUJFewVeuPcyfmuYIhz6XVlliZKxU4ZPDw3JKNWWIpmnhj6zg58SQ7gM4PUjMz96L7oyeFd83LIavoHaRLKqFlX6h/vbTFQ/LBMg2LpAFQIfNq57h0I6pSpGEiw5wm/PzIwr27m6Zlj6juyhdI7oPK7xbcL3/BYgZlbsQffFUw9yJxekfTJw2U7DNkz4tO</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      é¸¡æ±¤ æ€»ç»“
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://andyxw.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="å…¶ä»–" scheme="https://andyxw.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>React æŠ€æœ¯æ ˆ</title>
    <link href="https://andyxw.com/archives/4a9b.html"/>
    <id>https://andyxw.com/archives/4a9b.html</id>
    <published>2018-07-26T02:26:34.000Z</published>
    <updated>2018-08-17T08:25:22.939Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><h1 id="React-æŠ€æœ¯æ ˆ"><a href="#React-æŠ€æœ¯æ ˆ" class="headerlink" title="React æŠ€æœ¯æ ˆ"></a>React æŠ€æœ¯æ ˆ</h1><p>React æ˜¯ç›®å‰æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶ã€‚</p><ul><li>Facebook å…¬å¸2013å¹´æ¨å‡º</li><li>ç°åœ¨æœ€å¥½çš„ç¤¾åŒºæ”¯æŒå’Œç”Ÿæ€åœˆ</li><li>å¤§é‡çš„ç¬¬ä¸‰æ–¹å·¥å…·</li></ul><p><img src="./images/react-logo.png" alt=""></p><hr><h2 id="React-çš„ä¼˜ç‚¹"><a href="#React-çš„ä¼˜ç‚¹" class="headerlink" title="React çš„ä¼˜ç‚¹"></a>React çš„ä¼˜ç‚¹</h2><ul><li>ç»„ä»¶æ¨¡å¼ï¼šä»£ç å¤ç”¨å’Œå›¢é˜Ÿåˆ†å·¥</li><li>è™šæ‹Ÿ DOMï¼šæ€§èƒ½ä¼˜åŠ¿</li><li>ç§»åŠ¨ç«¯æ”¯æŒï¼šè·¨ç»ˆç«¯</li></ul><hr><h2 id="React-çš„ç¼ºç‚¹"><a href="#React-çš„ç¼ºç‚¹" class="headerlink" title="React çš„ç¼ºç‚¹"></a>React çš„ç¼ºç‚¹</h2><ul><li>å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­</li><li>å…¨æ–°çš„ä¸€å¥—æ¦‚å¿µï¼Œä¸å…¶ä»–æ‰€æœ‰æ¡†æ¶æˆªç„¶ä¸åŒ</li><li>åªæœ‰é‡‡ç”¨å®ƒçš„æ•´ä¸ªæŠ€æœ¯æ ˆï¼Œæ‰èƒ½å‘æŒ¥æœ€å¤§å¨åŠ›</li></ul><p>æ€»ç»“ï¼šReact éå¸¸å…ˆè¿›å’Œå¼ºå¤§ï¼Œä½†æ˜¯å­¦ä¹ å’Œå®ç°æˆæœ¬éƒ½ä¸ä½</p><hr><h2 id="JSX-è¯­æ³•"><a href="#JSX-è¯­æ³•" class="headerlink" title="JSX è¯­æ³•"></a>JSX è¯­æ³•</h2><p>React ä½¿ç”¨ JSX è¯­æ³•ï¼ŒJavaScript ä»£ç ä¸­å¯ä»¥å†™ HTML ä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myTitle = &lt;h1&gt;Hello, world!&lt;/h1&gt;;</span><br></pre></td></tr></table></figure><hr><h2 id="JSX-è¯­æ³•è§£é‡Š"><a href="#JSX-è¯­æ³•è§£é‡Š" class="headerlink" title="JSX è¯­æ³•è§£é‡Š"></a>JSX è¯­æ³•è§£é‡Š</h2><p>ï¼ˆ1ï¼‰JSX è¯­æ³•çš„æœ€å¤–å±‚ï¼Œåªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯</span></span><br><span class="line"><span class="keyword">let</span> myTitle = &lt;p&gt;Hello&lt;/p&gt;&lt;p&gt;World&lt;/p&gt;;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰JSX è¯­æ³•ä¸­å¯ä»¥æ’å…¥ JavaScript ä»£ç ï¼Œä½¿ç”¨å¤§æ‹¬å·ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myTitle = &lt;p&gt;&#123;'Hello ' + 'World'&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><hr><h2 id="Babel-è½¬ç å™¨"><a href="#Babel-è½¬ç å™¨" class="headerlink" title="Babel è½¬ç å™¨"></a>Babel è½¬ç å™¨</h2><p>JavaScript å¼•æ“ï¼ˆåŒ…æ‹¬æµè§ˆå™¨å’Œ Nodeï¼‰éƒ½ä¸è®¤è¯† JSXï¼Œéœ€è¦é¦–å…ˆä½¿ç”¨ Babel è½¬ç ï¼Œç„¶åæ‰èƒ½è¿è¡Œã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// ** Our code goes here! **</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>React éœ€è¦åŠ è½½ä¸¤ä¸ªåº“ï¼šReact å’Œ React-DOMï¼Œå‰è€…æ˜¯ React çš„æ ¸å¿ƒåº“ï¼Œåè€…æ˜¯ React çš„ DOM é€‚é…åº“ã€‚</p><p>Babel ç”¨æ¥åœ¨æµè§ˆå™¨è½¬æ¢ JSX è¯­æ³•ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»è½¬å¥½äº†ï¼Œæµè§ˆå™¨å°±ä¸éœ€è¦åŠ è½½è¿™ä¸ªåº“ã€‚</p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šJSX-è¯­æ³•"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šJSX-è¯­æ³•" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šJSX è¯­æ³•"></a>è¯¾å ‚ç»ƒä¹ ï¼šJSX è¯­æ³•</h2><p>æµè§ˆå™¨æ‰“å¼€<code>demos/jsx-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#jsx">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;span&gt;Hello World!<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><h2 id="ç¤ºä¾‹ï¼šReact-ç»„ä»¶"><a href="#ç¤ºä¾‹ï¼šReact-ç»„ä»¶" class="headerlink" title="ç¤ºä¾‹ï¼šReact ç»„ä»¶"></a>ç¤ºä¾‹ï¼šReact ç»„ä»¶</h2><p>React å…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„ç»„ä»¶ï¼Œæ’å…¥ç½‘é¡µã€‚</p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index1.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶è¯­æ³•">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;MyTitle/&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°"></a>è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°</h2><p>ç»„ä»¶å¯ä»¥ä»å¤–éƒ¨ä¼ å…¥å‚æ•°ï¼Œå†…éƒ¨ä½¿ç”¨<code>this.props</code>è·å–å‚æ•°ã€‚</p><p>æ‰“å¼€<code>demos/react-component-demo/index2.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„å‚æ•°">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span></span></span></span><br><span class="line"><span class="xml">      style=&#123;&#123;color: this.props.color&#125;&#125;</span></span><br><span class="line"><span class="xml">    &gt;Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;MyTitle color=<span class="string">"red"</span> /&gt;,</span><br></pre></td></tr></table></figure><hr><h2 id="ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€"><a href="#ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€" class="headerlink" title="ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€"></a>ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€</h2><p>ç»„ä»¶å¾€å¾€ä¼šæœ‰å†…éƒ¨çŠ¶æ€ï¼Œä½¿ç”¨<code>this.state</code>è¡¨ç¤ºã€‚</p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index3.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„çŠ¶æ€">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚</p><p><img src="./images/react-component-state.png" alt=""></p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šReact-ç»„ä»¶å®æˆ˜"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šReact-ç»„ä»¶å®æˆ˜" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šReact ç»„ä»¶å®æˆ˜"></a>è¯¾å ‚ç»ƒä¹ ï¼šReact ç»„ä»¶å®æˆ˜</h2><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index4.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶å®æˆ˜">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><hr><h2 id="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>React ä¸ºç»„ä»¶çš„ä¸åŒç”Ÿå‘½é˜¶æ®µï¼Œæä¾›äº†è¿‘åä¸ªé’©å­æ–¹æ³•ã€‚</p><ul><li><code>componentWillMount()</code>ï¼šç»„ä»¶åŠ è½½å‰è°ƒç”¨</li><li><code>componentDidMount()</code>ï¼šç»„ä»¶åŠ è½½åè°ƒç”¨</li><li><code>componentWillUpdate()</code>: ç»„ä»¶æ›´æ–°å‰è°ƒç”¨</li><li><code>componentDidUpdate()</code>: ç»„ä»¶æ›´æ–°åè°ƒç”¨</li><li><code>componentWillUnmount()</code>ï¼šç»„ä»¶å¸è½½å‰è°ƒç”¨</li><li><code>componentWillReceiveProps()</code>ï¼šç»„ä»¶æ¥å—æ–°çš„å‚æ•°æ—¶è°ƒç”¨</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›é’©å­ï¼Œè‡ªåŠ¨å®Œæˆä¸€äº›æ“ä½œã€‚</p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ç»„ä»¶å¯ä»¥é€šè¿‡ Ajax è¯·æ±‚ï¼Œä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚Ajax è¯·æ±‚ä¸€èˆ¬åœ¨<code>componentDidMount</code>æ–¹æ³•é‡Œé¢å‘å‡ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">'...'</span>;</span><br><span class="line">  $.getJSON(url)</span><br><span class="line">    .done()</span><br><span class="line">    .fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>demos/react-lifecycle-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><hr><h2 id="React-ç»„ä»¶åº“"><a href="#React-ç»„ä»¶åº“" class="headerlink" title="React ç»„ä»¶åº“"></a>React ç»„ä»¶åº“</h2><p>React çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œå°±æ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šå·²ç»å†™å¥½çš„ç»„ä»¶åº“ï¼Œå¯ä»¥ä½¿ç”¨ã€‚</p><p>React-Bootstrapï¼š<a href="https://react-bootstrap.github.io/" target="_blank" rel="noopener">https://react-bootstrap.github.io/</a></p><p><img src="./images/react-bootstrap.png" alt=""></p><hr><h2 id="ç¤ºä¾‹ï¼šReCharts"><a href="#ç¤ºä¾‹ï¼šReCharts" class="headerlink" title="ç¤ºä¾‹ï¼šReCharts"></a>ç¤ºä¾‹ï¼šReCharts</h2><p>ReCharts æ˜¯ä¸€ä¸ª React å›¾è¡¨ç»„ä»¶åº“ã€‚<a href="http://recharts.org/" target="_blank" rel="noopener">http://recharts.org/</a></p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/recharts-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#recharts">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ï¼Œä½“ä¼š JSX è¯­æ³•å¯¹è¡¨è¾¾å¤æ‚ç»„ä»¶çš„ä¼˜åŠ¿ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LineChart</span> <span class="attr">width</span>=<span class="string">&#123;1000&#125;</span> <span class="attr">height</span>=<span class="string">&#123;400&#125;</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">XAxis</span> <span class="attr">dataKey</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">YAxis</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CartesianGrid</span> <span class="attr">stroke</span>=<span class="string">"#eee"</span> <span class="attr">strokeDasharray</span>=<span class="string">"5 5"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Line</span> <span class="attr">type</span>=<span class="string">"monotone"</span> <span class="attr">dataKey</span>=<span class="string">"uv"</span> <span class="attr">stroke</span>=<span class="string">"#8884d8"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Line</span> <span class="attr">type</span>=<span class="string">"monotone"</span> <span class="attr">dataKey</span>=<span class="string">"pv"</span> <span class="attr">stroke</span>=<span class="string">"#82ca9d"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LineChart</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="React-çš„æ ¸å¿ƒæ€æƒ³"><a href="#React-çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="React çš„æ ¸å¿ƒæ€æƒ³"></a>React çš„æ ¸å¿ƒæ€æƒ³</h2><p>View æ˜¯ State çš„è¾“å‡ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view = f(state)</span><br></pre></td></tr></table></figure><p>ä¸Šå¼ä¸­ï¼Œ<code>f</code>è¡¨ç¤ºå‡½æ•°å…³ç³»ã€‚åªè¦ State å‘ç”Ÿå˜åŒ–ï¼ŒView ä¹Ÿè¦éšä¹‹å˜åŒ–ã€‚</p><hr><p>React çš„æœ¬è´¨æ˜¯å°†å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰å‡½æ•°åŒ–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  name: <span class="string">"michel"</span>,</span><br><span class="line">  age: <span class="number">31</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> &lt;h1&gt;&#123; person.name &#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App person=&#123;person&#125; /</span>&gt;, <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure><hr><h2 id="React-æ²¡æœ‰è§£å†³çš„é—®é¢˜"><a href="#React-æ²¡æœ‰è§£å†³çš„é—®é¢˜" class="headerlink" title="React æ²¡æœ‰è§£å†³çš„é—®é¢˜"></a>React æ²¡æœ‰è§£å†³çš„é—®é¢˜</h2><p>React æœ¬èº«åªæ˜¯ä¸€ä¸ª DOM çš„æŠ½è±¡å±‚ï¼Œä½¿ç”¨ç»„ä»¶æ„å»ºè™šæ‹Ÿ DOMã€‚</p><p>å¦‚æœå¼€å‘å¤§åº”ç”¨ï¼Œè¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ã€‚</p><ul><li>æ¶æ„ï¼šå¤§å‹åº”ç”¨ç¨‹åºåº”è¯¥å¦‚ä½•ç»„ç»‡ä»£ç ï¼Ÿ</li><li>é€šä¿¡ï¼šç»„ä»¶ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</li></ul><hr><h2 id="æ¶æ„é—®é¢˜"><a href="#æ¶æ„é—®é¢˜" class="headerlink" title="æ¶æ„é—®é¢˜"></a>æ¶æ„é—®é¢˜</h2><p>React åªæ˜¯è§†å›¾å±‚çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨äºä»»ä½•ä¸€ç§æ¶æ„ã€‚</p><ul><li>MVC</li><li>MVVM</li><li>Observer</li><li>Reactive</li><li>â€¦</li></ul><p>åˆ°åº•å“ªä¸€ç§æ¶æ„æœ€åˆé€‚ React ï¼Ÿ</p><hr><h2 id="é€šä¿¡é—®é¢˜"><a href="#é€šä¿¡é—®é¢˜" class="headerlink" title="é€šä¿¡é—®é¢˜"></a>é€šä¿¡é—®é¢˜</h2><p>ç»„ä»¶ä¼šå‘ç”Ÿä¸‰ç§é€šä¿¡ã€‚</p><ul><li>å‘å­ç»„ä»¶å‘æ¶ˆæ¯</li><li>å‘çˆ¶ç»„ä»¶å‘æ¶ˆæ¯</li><li>å‘å…¶ä»–ç»„ä»¶å‘æ¶ˆæ¯</li></ul><p>React åªæä¾›äº†ä¸€ç§é€šä¿¡æ‰‹æ®µï¼šä¼ å‚ã€‚å¯¹äºå¤§åº”ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚</p><hr><h2 id="çŠ¶æ€çš„åŒæ­¥"><a href="#çŠ¶æ€çš„åŒæ­¥" class="headerlink" title="çŠ¶æ€çš„åŒæ­¥"></a>çŠ¶æ€çš„åŒæ­¥</h2><p>é€šä¿¡çš„æœ¬è´¨æ˜¯çŠ¶æ€çš„åŒæ­¥ã€‚</p><p>React åŒæ­¥çŠ¶æ€çš„åŸºæœ¬æ–¹æ³•ï¼šæ‰¾åˆ°é€šä¿¡åŒæ–¹æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ï¼Œé€šè¿‡å®ƒçš„<code>state</code>ï¼Œä½¿å¾—å­ç»„ä»¶çš„çŠ¶æ€ä¿æŒåŒæ­¥ã€‚</p><hr><h2 id="Flux-æ¶æ„"><a href="#Flux-æ¶æ„" class="headerlink" title="Flux æ¶æ„"></a>Flux æ¶æ„</h2><p>Facebook æå‡º Flux æ¶æ„çš„æ¦‚å¿µï¼Œè¢«è®¤ä¸ºæ˜¯ React åº”ç”¨çš„æ ‡å‡†æ¶æ„ã€‚</p><p><img src="./images/flow.png" alt=""></p><p>æœ€å¤§ç‰¹ç‚¹ï¼šæ•°æ®å•å‘æµåŠ¨ã€‚ä¸ MVVM çš„æ•°æ®åŒå‘ç»‘å®šï¼Œå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><hr><h2 id="Flux-çš„æ ¸å¿ƒæ€æƒ³"><a href="#Flux-çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="Flux çš„æ ¸å¿ƒæ€æƒ³"></a>Flux çš„æ ¸å¿ƒæ€æƒ³</h2><ul><li>ä¸åŒç»„ä»¶çš„<code>state</code>ï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªå¤–éƒ¨çš„ã€å…¬å…±çš„ Store ä¸Šé¢ã€‚</li><li>ç»„ä»¶è®¢é˜… Store çš„ä¸åŒéƒ¨åˆ†ã€‚</li><li>ç»„ä»¶å‘é€ï¼ˆdispatchï¼‰åŠ¨ä½œï¼ˆactionï¼‰ï¼Œå¼•å‘ Store çš„æ›´æ–°ã€‚</li></ul><p>Flux åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæœ‰30å¤šç§å®ç°ã€‚</p><hr><h2 id="ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª-React-æ¶æ„"><a href="#ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª-React-æ¶æ„" class="headerlink" title="ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª React æ¶æ„"></a>ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª React æ¶æ„</h2><p>React æ¶æ„çš„æœ€é‡è¦ä½œç”¨ï¼šç®¡ç† Store ä¸ View ä¹‹é—´çš„å…³ç³»ã€‚</p><ul><li>MobXï¼šå“åº”å¼ï¼ˆReactiveï¼‰ç®¡ç†ï¼Œstate æ˜¯å¯å˜å¯¹è±¡ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®</li><li>Reduxï¼šå‡½æ•°å¼ï¼ˆFunctionalï¼‰ç®¡ç†ï¼Œstate æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œé€‚åˆå¤§å‹é¡¹ç›®</li></ul><hr><h2 id="MobX-æ¶æ„"><a href="#MobX-æ¶æ„" class="headerlink" title="MobX æ¶æ„"></a>MobX æ¶æ„</h2><p>MobX çš„æ ¸å¿ƒæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><ul><li>Store æ˜¯è¢«è§‚å¯Ÿè€…ï¼ˆobservableï¼‰</li><li>ç»„ä»¶æ˜¯è§‚å¯Ÿè€…ï¼ˆobserverï¼‰</li></ul><p>ä¸€æ—¦<code>Store</code>æœ‰å˜åŒ–ï¼Œä¼šç«‹åˆ»è¢«ç»„ä»¶è§‚å¯Ÿåˆ°ï¼Œä»è€Œå¼•å‘é‡æ–°æ¸²æŸ“ã€‚</p><hr><h2 id="MobX-çš„æœ€ç®€å•ä¾‹å­"><a href="#MobX-çš„æœ€ç®€å•ä¾‹å­" class="headerlink" title="MobX çš„æœ€ç®€å•ä¾‹å­"></a>MobX çš„æœ€ç®€å•ä¾‹å­</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;observable&#125; = mobx;</span><br><span class="line"><span class="keyword">const</span> &#123;observer&#125; = mobxReact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = observable(&#123;<span class="attr">name</span>: <span class="string">"å¼ ä¸‰"</span>, <span class="attr">age</span>: <span class="number">31</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = observer(</span><br><span class="line">  (&#123; person &#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123; person.name &#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span>, document.body);</span></span><br><span class="line"><span class="xml">person.name = "æå››";</span></span><br></pre></td></tr></table></figure><p>ä»£ç ï¼š<code>demos/mobx-demo/browser-demo</code>ç›®å½•</p><hr><h2 id="ç¤ºä¾‹ï¼šMobX"><a href="#ç¤ºä¾‹ï¼šMobX" class="headerlink" title="ç¤ºä¾‹ï¼šMobX"></a>ç¤ºä¾‹ï¼šMobX</h2><p>è¿›å…¥<code>demos/mobx-demo</code>ç›®å½•ï¼ŒæŒ‰ç…§<a href="../demos/README.md#mobx">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œç†è§£ MobX æ¡†æ¶ã€‚</p><hr><p>UI å±‚æ˜¯è§‚å¯Ÿè€…ï¼ŒStore æ˜¯è¢«è§‚å¯Ÿè€…ã€‚</p><p>Store æ‰€æœ‰çš„å±æ€§ï¼Œåˆ†æˆä¸¤å¤§ç±»ï¼šç›´æ¥è¢«è§‚å¯Ÿçš„å±æ€§å’Œè‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„å±æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  @observable name = <span class="string">'Bartek'</span>;</span><br><span class="line">  @computed get decorated() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is awesome!`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UI ä¼šè§‚å¯Ÿåˆ° Store çš„å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚</p><hr><h2 id="Redux-æ¶æ„"><a href="#Redux-æ¶æ„" class="headerlink" title="Redux æ¶æ„"></a>Redux æ¶æ„</h2><p>Redux çš„æ ¸å¿ƒæ¦‚å¿µ</p><ul><li>æ‰€æœ‰çš„çŠ¶æ€å­˜æ”¾åœ¨<code>Store</code>ã€‚ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“ï¼Œéƒ½å¿…é¡»ç”±çŠ¶æ€å˜åŒ–å¼•èµ·ã€‚</li><li>ç”¨æˆ·åœ¨ UI ä¸Šå‘å‡º<code>action</code>ã€‚</li><li><code>reducer</code>å‡½æ•°æ¥æ”¶<code>action</code>ï¼Œç„¶åæ ¹æ®å½“å‰çš„<code>state</code>ï¼Œè®¡ç®—å‡ºæ–°çš„<code>state</code>ã€‚</li></ul><p><img src="./images/redux-architecture.png" alt=""></p><hr><h2 id="Redux-åº”ç”¨çš„æ¶æ„"><a href="#Redux-åº”ç”¨çš„æ¶æ„" class="headerlink" title="Redux åº”ç”¨çš„æ¶æ„"></a>Redux åº”ç”¨çš„æ¶æ„</h2><p><img src="./images/architecture-redux.png" alt=""></p><p>Redux å±‚ä¿å­˜æ‰€æœ‰çŠ¶æ€ï¼ŒReact ç»„ä»¶æ‹¿åˆ°çŠ¶æ€ä»¥åï¼Œæ¸²æŸ“å‡º HTML ä»£ç ã€‚</p><hr><h2 id="ç¤ºä¾‹ï¼šRedux"><a href="#ç¤ºä¾‹ï¼šRedux" class="headerlink" title="ç¤ºä¾‹ï¼šRedux"></a>ç¤ºä¾‹ï¼šRedux</h2><p>è¿›å…¥<code>demos/redux-demo</code>ç›®å½•ï¼ŒæŒ‰ç…§<a href="../demos/README.md#redux">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œç†è§£ Redux æ¡†æ¶ã€‚</p><hr><ul><li>Redux å°†ç»„ä»¶åˆ†æˆ UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶ä¸¤ç±»ã€‚</li><li>UI ç»„ä»¶æ˜¯çº¯ç»„ä»¶ï¼Œä¸åŒ…å« state å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¸æ¶‰åŠç»„ä»¶çš„è¡Œä¸ºï¼Œåªæ¶‰åŠç»„ä»¶çš„å¤–è§‚ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"index"</span>&gt;</span><br><span class="line">  &lt;p&gt;&#123;<span class="keyword">this</span>.props.text&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;input</span></span><br><span class="line"><span class="regexp">    defaultValue=&#123;this.props.name&#125;</span></span><br><span class="line"><span class="regexp">    onChange=&#123;this.props.onChange&#125;</span></span><br><span class="line"><span class="regexp">  /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><hr><p>å®¹å™¨ç»„ä»¶æ­£å¥½ç›¸åã€‚</p><ul><li>ä¸æ¶‰åŠç»„ä»¶çš„å¤–è§‚ï¼Œåªæ¶‰åŠç»„ä»¶çš„è¡Œä¸ºã€‚</li><li>è´Ÿè´£è®¢é˜… Storeï¼Œå°† Store çš„æ•°æ®å¤„ç†ä»¥åï¼Œå†é€šè¿‡å‚æ•°ä¼ ç»™ UI ç»„ä»¶ã€‚</li><li>ç”¨æˆ·ç»™å‡ºé…ç½®ä»¥åï¼Œç”± Redux ç”Ÿæˆã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// MyComponent æ˜¯çº¯çš„ UI ç»„ä»¶</span><br><span class="line">const App = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(MyComponent);</span><br></pre></td></tr></table></figure><ul><li>mapStateToProps: å®šä¹‰ UI ç»„ä»¶å‚æ•°ä¸ State ä¹‹é—´çš„æ˜ å°„</li><li>mapDispatchToPropsï¼šå®šä¹‰ UI ç»„ä»¶ä¸ Action ä¹‹é—´çš„æ˜ å°„</li></ul><hr><h2 id="æ‹†åˆ†-UI-ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„"><a href="#æ‹†åˆ†-UI-ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„" class="headerlink" title="æ‹†åˆ† UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„"></a>æ‹†åˆ† UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„</h2><ul><li>UI ç»„ä»¶ä¸åå°æ•°æ®æ— å…³ï¼Œå¯ä»¥ç”±è®¾è®¡å¸ˆè´Ÿè´£</li><li>å®¹å™¨ç»„ä»¶åªè´Ÿè´£æ•°æ®å’Œè¡Œä¸ºï¼Œä¸€æ—¦ Store çš„æ•°æ®ç»“æ„å˜åŒ–ï¼Œåªè¦è°ƒæ•´å®¹å™¨ç»„ä»¶å³å¯</li><li>è¡¨ç°å±‚å’ŒåŠŸèƒ½å±‚è„±é’©ï¼Œæœ‰åˆ©äºä»£ç é‡ç”¨ï¼Œä¹Ÿæœ‰åˆ©äºçœ‹æ¸…åº”ç”¨çš„æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘</li></ul><hr><h2 id="Reducer-å‡½æ•°"><a href="#Reducer-å‡½æ•°" class="headerlink" title="Reducer å‡½æ•°"></a>Reducer å‡½æ•°</h2><p><code>reducer</code>æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶<code>action</code>ï¼Œç®—å‡ºæ–°çš„<code>state</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  text: <span class="string">'ä½ å¥½ï¼Œè®¿é—®è€…'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  name: <span class="string">'è®¿é—®è€…'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'change'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        name: action.payload,</span><br><span class="line">        text: <span class="string">'ä½ å¥½ï¼Œ'</span> + action.payload</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><code>Store</code>ç”± Redux æä¾›çš„<code>createStore</code>æ–¹æ³•ç”Ÿæˆï¼Œè¯¥æ–¹æ³•æ¥å—<code>reducer</code>ä½œä¸ºå‚æ•°ã€‚</li><li>ä¸ºäº†æŠŠ<code>Store</code>ä¼ å…¥ç»„ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ Redux æä¾›çš„<code>Provider</code>ç»„ä»¶åœ¨åº”ç”¨çš„æœ€å¤–é¢ï¼ŒåŒ…è£¹ä¸€å±‚ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.body.appendChild(document.createElement('div'))</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/4a9b.html">https://andyxw.com/archives/4a9b.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      ReactæŠ€æœ¯æ ˆâ€”â€”é˜®ä¸€å³°
    
    </summary>
    
      <category term="React" scheme="https://andyxw.com/categories/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React è®¾è®¡æ€æƒ³</title>
    <link href="https://andyxw.com/archives/7615.html"/>
    <id>https://andyxw.com/archives/7615.html</id>
    <published>2018-07-26T02:25:48.000Z</published>
    <updated>2018-08-17T07:35:48.233Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><h1 id="React-è®¾è®¡æ€æƒ³"><a href="#React-è®¾è®¡æ€æƒ³" class="headerlink" title="React è®¾è®¡æ€æƒ³"></a>React è®¾è®¡æ€æƒ³</h1><blockquote><p>è¯‘è€…åºï¼šæœ¬æ–‡æ˜¯ React æ ¸å¿ƒå¼€å‘è€…ã€æœ‰ React API ç»ˆç»“è€…ä¹‹ç§°çš„ Sebastian MarkbÃ¥ge æ’°å†™ï¼Œé˜è¿°äº†ä»–è®¾è®¡ React çš„åˆè¡·ã€‚é˜…è¯»æ­¤æ–‡ï¼Œä½ èƒ½ç«™åœ¨æ›´é«˜çš„é«˜åº¦æ€è€ƒ React çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‚åŸæ–‡åœ°å€ï¼š<a href="https://github.com/reactjs/react-basic" target="_blank" rel="noopener">https://github.com/reactjs/react-basic</a></p></blockquote><a id="more"></a><p>æˆ‘å†™æ­¤æ–‡æ˜¯æƒ³æ­£å¼åœ°é˜è¿°æˆ‘å¿ƒä¸­ React çš„<a href="http://baike.baidu.com/view/2333986.htm" target="_blank" rel="noopener">å¿ƒæ™ºæ¨¡å‹</a>ã€‚ç›®çš„æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šè¿™æ ·è®¾è®¡ Reactï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®è¿™äº›è®ºç‚¹åæ¨å‡º Reactã€‚</p><p>ä¸å¯å¦è®¤ï¼Œæ­¤æ–‡ä¸­çš„éƒ¨åˆ†è®ºæ®æˆ–å‰æå°šå­˜äº‰è®®ï¼Œè€Œä¸”éƒ¨åˆ†ç¤ºä¾‹çš„è®¾è®¡å¯èƒ½å­˜åœ¨ bug æˆ–ç–å¿½ã€‚è¿™åªæ˜¯æ­£å¼ç¡®å®šå®ƒçš„æœ€åˆé˜¶æ®µã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„å®Œå–„å®ƒçš„æƒ³æ³•å¯ä»¥éšæ—¶æäº¤ pull requestã€‚æœ¬æ–‡ä¸ä¼šä»‹ç»æ¡†æ¶ç»†èŠ‚ä¸­çš„å¥‡æŠ€æ·«å·§ï¼Œç›¸ä¿¡è¿™æ ·èƒ½æçº²æŒˆé¢†ï¼Œè®©ä½ çœ‹æ¸… React ç”±ç®€å•åˆ°å¤æ‚çš„è®¾è®¡è¿‡ç¨‹ã€‚</p><p>React.js çš„çœŸå®å®ç°ä¸­å……æ»¡äº†å…·ä½“é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ¸è¿›å¼çš„è§£æ³•ï¼Œç®—æ³•ä¼˜åŒ–ï¼Œå†å²é—ç•™ä»£ç ï¼Œdebug å·¥å…·ä»¥åŠå…¶ä»–ä¸€äº›å¯ä»¥è®©å®ƒçœŸçš„å…·æœ‰é«˜å¯ç”¨æ€§çš„å†…å®¹ã€‚è¿™äº›ä»£ç å¯èƒ½å¹¶ä¸ç¨³å®šï¼Œå› ä¸ºæœªæ¥æµè§ˆå™¨çš„å˜åŒ–å’ŒåŠŸèƒ½æƒé‡çš„å˜åŒ–éšæ—¶é¢ä¸´æ”¹å˜ã€‚æ‰€ä»¥å…·ä½“çš„ä»£ç å¾ˆéš¾å½»åº•è§£é‡Šæ¸…æ¥šã€‚</p><p>æˆ‘åå‘äºé€‰æ‹©ä¸€ç§æˆ‘èƒ½å®Œå…¨ hold ä½çš„ç®€æ´çš„å¿ƒæ™ºæ¨¡å‹æ¥ä½œä»‹ç»ã€‚</p><h2 id="å˜æ¢ï¼ˆTransformationï¼‰"><a href="#å˜æ¢ï¼ˆTransformationï¼‰" class="headerlink" title="å˜æ¢ï¼ˆTransformationï¼‰"></a>å˜æ¢ï¼ˆTransformationï¼‰</h2><p>è®¾è®¡ React çš„æ ¸å¿ƒå‰ææ˜¯è®¤ä¸º UI åªæ˜¯æŠŠæ•°æ®é€šè¿‡æ˜ å°„å…³ç³»å˜æ¢æˆå¦ä¸€ç§å½¢å¼çš„æ•°æ®ã€‚åŒæ ·çš„è¾“å…¥å¿…ä¼šæœ‰åŒæ ·çš„è¾“å‡ºã€‚è¿™æ°å¥½å°±æ˜¯çº¯å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameBox</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">fontWeight</span>: <span class="string">'bold'</span>, <span class="attr">labelContent</span>: name &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;Sebastian MarkbÃ¥ge&apos; -&gt;</span><br><span class="line">&#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;;</span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡ï¼ˆAbstractionï¼‰"><a href="#æŠ½è±¡ï¼ˆAbstractionï¼‰" class="headerlink" title="æŠ½è±¡ï¼ˆAbstractionï¼‰"></a>æŠ½è±¡ï¼ˆAbstractionï¼‰</h2><p>ä½ ä¸å¯èƒ½ä»…ç”¨ä¸€ä¸ªå‡½æ•°å°±èƒ½å®ç°å¤æ‚çš„ UIã€‚é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦æŠŠ UI æŠ½è±¡æˆå¤šä¸ªéšè—å†…éƒ¨ç»†èŠ‚ï¼Œåˆå¯å¤ç”¨çš„å‡½æ•°ã€‚é€šè¿‡åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ¥å®ç°å¤æ‚çš„ UIï¼Œè¿™å°±æ˜¯æŠ½è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">'1px solid blue'</span>,</span><br><span class="line">    childContent: [</span><br><span class="line">      <span class="string">'Name: '</span>,</span><br><span class="line">      NameBox(user.firstName + <span class="string">' '</span> + user.lastName)</span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; firstName: &apos;Sebastian&apos;, lastName: &apos;MarkbÃ¥ge&apos; &#125; -&gt;</span><br><span class="line">&#123;</span><br><span class="line">  borderStyle: &apos;1px solid blue&apos;,</span><br><span class="line">  childContent: [</span><br><span class="line">    &apos;Name: &apos;,</span><br><span class="line">    &#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆï¼ˆCompositionï¼‰"><a href="#ç»„åˆï¼ˆCompositionï¼‰" class="headerlink" title="ç»„åˆï¼ˆCompositionï¼‰"></a>ç»„åˆï¼ˆCompositionï¼‰</h2><p>ä¸ºäº†çœŸæ­£è¾¾åˆ°é‡ç”¨çš„ç‰¹æ€§ï¼Œåªé‡ç”¨å¶å­ç„¶åæ¯æ¬¡éƒ½ä¸ºä»–ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ˜¯ä¸å¤Ÿçš„ã€‚ä½ è¿˜éœ€è¦å¯ä»¥åŒ…å«å…¶ä»–æŠ½è±¡çš„å®¹å™¨å†æ¬¡è¿›è¡Œç»„åˆã€‚æˆ‘ç†è§£çš„â€œç»„åˆâ€å°±æ˜¯å°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„æŠ½è±¡åˆå¹¶ä¸ºä¸€ä¸ªã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">'1px solid blue'</span>,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>,</span><br><span class="line">    NameBox(user.firstName + <span class="string">' '</span> + user.lastName)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€ï¼ˆStateï¼‰"><a href="#çŠ¶æ€ï¼ˆStateï¼‰" class="headerlink" title="çŠ¶æ€ï¼ˆStateï¼‰"></a>çŠ¶æ€ï¼ˆStateï¼‰</h2><p>UI ä¸å•å•æ˜¯å¯¹æœåŠ¡å™¨ç«¯æˆ–ä¸šåŠ¡é€»è¾‘çŠ¶æ€çš„å¤åˆ¶ã€‚å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šçŠ¶æ€æ˜¯é’ˆå¯¹å…·ä½“çš„æ¸²æŸ“ç›®æ ‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª text field ä¸­æ‰“å­—ã€‚å®ƒä¸ä¸€å®šè¦å¤åˆ¶åˆ°å…¶ä»–é¡µé¢æˆ–è€…ä½ çš„æ‰‹æœºè®¾å¤‡ã€‚æ»šåŠ¨ä½ç½®è¿™ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½ å‡ ä¹ä¸ä¼šå¤åˆ¶åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡çš„ã€‚</p><p>æˆ‘ä»¬å€¾å‘äºä½¿ç”¨ä¸å¯å˜çš„æ•°æ®æ¨¡å‹ã€‚æˆ‘ä»¬æŠŠå¯ä»¥æ”¹å˜ state çš„å‡½æ•°ä¸²è”èµ·æ¥ä½œä¸ºåŸç‚¹æ”¾ç½®åœ¨é¡¶å±‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyNameBox</span>(<span class="params">user, likes, onClick</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>, NameBox(user.firstName + <span class="string">' '</span> + user.lastName),</span><br><span class="line">    <span class="string">'Likes: '</span>, LikeBox(likes),</span><br><span class="line">    LikeButton(onClick)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°ç»†èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likes = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOneMoreLike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  likes++;</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">FancyNameBox(</span><br><span class="line">  &#123; <span class="attr">firstName</span>: <span class="string">'Sebastian'</span>, <span class="attr">lastName</span>: <span class="string">'MarkbÃ¥ge'</span> &#125;,</span><br><span class="line">  likes,</span><br><span class="line">  addOneMoreLike</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šæœ¬ä¾‹æ›´æ–°çŠ¶æ€æ—¶ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼ˆaddOneMoreLike å‡½æ•°ä¸­ï¼‰ã€‚æˆ‘å®é™…çš„æƒ³æ³•æ˜¯å½“ä¸€ä¸ªâ€œupdateâ€ä¼ å…¥æ—¶æˆ‘ä»¬è¿”å›ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„çŠ¶æ€ï¼Œä½†é‚£æ ·ä¼šæ¯”è¾ƒå¤æ‚ã€‚æ­¤ç¤ºä¾‹å¾…æ›´æ–°</em></p><h2 id="Memoization"><a href="#Memoization" class="headerlink" title="Memoization"></a>Memoization</h2><p>å¯¹äºçº¯å‡½æ•°ï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°ä¸€æ¬¡æ¬¡è°ƒç”¨æœªå…å¤ªæµªè´¹èµ„æºã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„ memorized ç‰ˆæœ¬ï¼Œç”¨æ¥è¿½è¸ªæœ€åä¸€ä¸ªå‚æ•°å’Œç»“æœã€‚è¿™æ ·å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨åŒæ ·çš„å€¼ï¼Œå°±ä¸éœ€è¦åå¤æ‰§è¡Œå®ƒäº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cachedArg;</span><br><span class="line">  <span class="keyword">var</span> cachedResult;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cachedArg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedResult;</span><br><span class="line">    &#125;</span><br><span class="line">    cachedArg = arg;</span><br><span class="line">    cachedResult = fn(arg);</span><br><span class="line">    <span class="keyword">return</span> cachedResult;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MemoizedNameBox = memoize(NameBox);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameAndAgeBox</span>(<span class="params">user, currentTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>,</span><br><span class="line">    MemoizedNameBox(user.firstName + <span class="string">' '</span> + user.lastName),</span><br><span class="line">    <span class="string">'Age in milliseconds: '</span>,</span><br><span class="line">    currentTime - user.dateOfBirth</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨ï¼ˆListsï¼‰"><a href="#åˆ—è¡¨ï¼ˆListsï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆListsï¼‰"></a>åˆ—è¡¨ï¼ˆListsï¼‰</h2><p>å¤§éƒ¨åˆ† UI éƒ½æ˜¯å±•ç¤ºåˆ—è¡¨æ•°æ®ä¸­ä¸åŒ item çš„åˆ—è¡¨ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªå¤©ç„¶çš„å±‚çº§ã€‚</p><p>ä¸ºäº†ç®¡ç†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ª item çš„ state ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ª Map å®¹çº³å…·ä½“ item çš„ stateã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users, likesPerUser, updateUserLikes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> FancyNameBox(</span><br><span class="line">    user,</span><br><span class="line">    likesPerUser.get(user.id),</span><br><span class="line">    () =&gt; updateUserLikes(user.id, likesPerUser.get(user.id) + <span class="number">1</span>)</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likesPerUser = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUserLikes</span>(<span class="params">id, likeCount</span>) </span>&#123;</span><br><span class="line">  likesPerUser.set(id, likeCount);</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UserList(data.users, likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šç°åœ¨æˆ‘ä»¬å‘ FancyNameBox ä¼ äº†å¤šä¸ªä¸åŒçš„å‚æ•°ã€‚è¿™æ‰“ç ´äº†æˆ‘ä»¬çš„ memoization å› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªèƒ½å­˜å‚¨ä¸€ä¸ªå€¼ã€‚æ›´å¤šç›¸å…³å†…å®¹åœ¨ä¸‹é¢ã€‚</em></p><h2 id="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"><a href="#è¿ç»­æ€§ï¼ˆContinuationsï¼‰" class="headerlink" title="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"></a>è¿ç»­æ€§ï¼ˆContinuationsï¼‰</h2><p>ä¸å¹¸çš„æ˜¯ï¼Œè‡ªä» UI ä¸­æœ‰å¤ªå¤šçš„åˆ—è¡¨ï¼Œæ˜ç¡®çš„ç®¡ç†å°±éœ€è¦å¤§é‡çš„é‡å¤æ€§æ ·æ¿ä»£ç ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨è¿Ÿä¸€äº›å‡½æ•°çš„æ‰§è¡Œï¼Œè¿›è€ŒæŠŠä¸€äº›æ¨¡æ¿ç§»å‡ºä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨â€œæŸ¯é‡ŒåŒ–â€ï¼ˆJavaScript ä¸­çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener"><code>bind</code></a>ï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ ¸å¿ƒçš„å‡½æ•°å¤–é¢ä¼ é€’ stateï¼Œè¿™æ ·å°±æ²¡æœ‰æ ·æ¿ä»£ç äº†ã€‚</p><p>ä¸‹é¢è¿™æ ·å¹¶æ²¡æœ‰å‡å°‘æ ·æ¿ä»£ç ï¼Œä½†è‡³å°‘æŠŠå®ƒä»å…³é”®ä¸šåŠ¡é€»è¾‘ä¸­å‰¥ç¦»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    UserList.bind(<span class="literal">null</span>, users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> box = FancyUserList(data.users);</span><br><span class="line"><span class="keyword">const</span> resolvedChildren = box.children(likesPerUser, updateUserLikes);</span><br><span class="line"><span class="keyword">const</span> resolvedBox = &#123;</span><br><span class="line">  ...box,</span><br><span class="line">  children: resolvedChildren</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="State-Map"><a href="#State-Map" class="headerlink" title="State Map"></a>State Map</h2><p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ç»„åˆé¿å…é‡å¤æ‰§è¡Œç›¸åŒçš„ä¸œè¥¿è¿™æ ·ä¸€ç§é‡å¤æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå’Œä¼ é€’ state é€»è¾‘æŒªåŠ¨åˆ°è¢«å¤ç”¨å¾ˆå¤šçš„ä½å±‚çº§çš„å‡½æ•°ä¸­å»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    continuation: FancyNameBox.bind(<span class="literal">null</span>, user),</span><br><span class="line">    key: user.id</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBoxWithState.bind(<span class="literal">null</span>,</span><br><span class="line">    UserList(users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> continuation = FancyUserList(data.users);</span><br><span class="line">continuation(likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><h2 id="Memoization-Map"><a href="#Memoization-Map" class="headerlink" title="Memoization Map"></a>Memoization Map</h2><p>ä¸€æ—¦æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ª memoization åˆ—è¡¨ä¸­ memoize å¤šä¸ª item å°±ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚å› ä¸ºä½ éœ€è¦åˆ¶å®šå¤æ‚çš„ç¼“å­˜ç®—æ³•æ¥å¹³è¡¡è°ƒç”¨é¢‘ç‡å’Œå†…å­˜å æœ‰ç‡ã€‚</p><p>è¿˜å¥½ UI åœ¨åŒä¸€ä¸ªä½ç½®ä¼šç›¸å¯¹çš„ç¨³å®šã€‚ç›¸åŒçš„ä½ç½®ä¸€èˆ¬æ¯æ¬¡éƒ½ä¼šæ¥å—ç›¸åŒçš„å‚æ•°ã€‚è¿™æ ·ä»¥æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªé›†åˆæ¥åš memoization æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç­–ç•¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¯¹å¾… state åŒæ ·çš„æ–¹å¼ï¼Œåœ¨ç»„åˆçš„å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ª memoization ç¼“å­˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg, memoizationCache</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (memoizationCache.arg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> memoizationCache.result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> result = fn(arg);</span><br><span class="line">    memoizationCache.arg = arg;</span><br><span class="line">    memoizationCache.result = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState,</span></span></span><br><span class="line"><span class="function"><span class="params">  memoizationCache</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState,</span><br><span class="line">      memoizationCache.get(child.key)</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MemoizedFancyNameBox = memoize(FancyNameBox);</span><br></pre></td></tr></table></figure><h2 id="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰"><a href="#ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰" class="headerlink" title="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰"></a>ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰</h2><p>å¤šå±‚æŠ½è±¡éœ€è¦å…±äº«çç¢æ•°æ®æ—¶ï¼Œä¸€å±‚å±‚ä¼ é€’æ•°æ®éå¸¸éº»çƒ¦ã€‚å¦‚æœèƒ½æœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨å¤šå±‚æŠ½è±¡ä¸­å¿«æ·åœ°ä¼ é€’æ•°æ®ï¼ŒåŒæ—¶åˆä¸éœ€è¦ç‰µæ¶‰åˆ°ä¸­é—´å±‚çº§ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚React ä¸­æˆ‘ä»¬æŠŠå®ƒå«åšâ€œcontextâ€ã€‚</p><p>æœ‰æ—¶å€™æ•°æ®ä¾èµ–å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æŠ½è±¡æ ‘è‡ªä¸Šè€Œä¸‹è¿›è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¸ƒå±€ç®—æ³•ä¸­ï¼Œä½ éœ€è¦åœ¨å®ç°ä»–ä»¬çš„ä½ç½®ä¹‹å‰äº†è§£å­èŠ‚ç‚¹çš„å¤§å°ã€‚</p><p>ç°åœ¨ï¼Œè¿™ä¸ªä¾‹å­æœ‰ä¸€ç‚¹è¶…çº²ã€‚æˆ‘ä¼šä½¿ç”¨ <a href="http://math.andrej.com/eff/" target="_blank" rel="noopener">ä»£æ•°æ•ˆåº”</a> è¿™ä¸ªç”±æˆ‘å‘èµ·çš„ <a href="https://esdiscuss.org/topic/one-shot-delimited-continuations-with-effect-handlers" target="_blank" rel="noopener">ECMAScript æ–°ç‰¹æ€§æè®®</a>ã€‚å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹å¾ˆç†Ÿæ‚‰ï¼Œå®ƒä»¬ åœ¨é¿å…ç”± monad å¼ºåˆ¶å¼•å…¥çš„ä»ªå¼ä¸€æ ·çš„ç¼–ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemeBorderColorRequest</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> color = raise <span class="keyword">new</span> ThemeBorderColorRequest();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderWidth: <span class="string">'1px'</span>,</span><br><span class="line">    borderColor: color,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlueTheme</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">    children();</span><br><span class="line">  &#125; <span class="keyword">catch</span> effect ThemeBorderColorRequest -&gt; [, continuation] &#123;</span><br><span class="line">    continuation(<span class="string">'blue'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> BlueTheme(</span><br><span class="line">    FancyUserList.bind(<span class="literal">null</span>, data.users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/7615.html">https://andyxw.com/archives/7615.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Reactè®¾è®¡æ€æƒ³
    
    </summary>
    
      <category term="React" scheme="https://andyxw.com/categories/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactä¸­çš„stateå’Œprops</title>
    <link href="https://andyxw.com/archives/992.html"/>
    <id>https://andyxw.com/archives/992.html</id>
    <published>2018-07-26T02:23:10.000Z</published>
    <updated>2018-08-17T07:33:01.006Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Fri Aug 23 2019 19:10:49 GMT+0800 (GMT+08:00) --><p>æ•´ç†ä¸€ä¸‹Reactä¸­å…³äºstateå’Œpropsçš„çŸ¥è¯†ç‚¹ã€‚</p><hr><p>åœ¨ä»»ä½•åº”ç”¨ä¸­ï¼Œæ•°æ®éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æˆ‘ä»¬éœ€è¦ç›´æ¥çš„æ”¹å˜é¡µé¢ä¸Šä¸€å—çš„åŒºåŸŸæ¥ä½¿å¾—è§†å›¾çš„åˆ·æ–°ï¼Œæˆ–è€…é—´æ¥åœ°æ”¹å˜å…¶ä»–åœ°æ–¹çš„æ•°æ®ã€‚Reactçš„æ•°æ®æ˜¯è‡ªé¡¶å‘ä¸‹å•å‘æµåŠ¨çš„ï¼Œå³ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶ä¸­ï¼Œç»„ä»¶çš„æ•°æ®å­˜å‚¨åœ¨<code>props</code>å’Œ<code>state</code>ä¸­ï¼Œè¿™ä¸¤ä¸ªå±æ€§æœ‰å•¥å­åŒºåˆ«å‘¢ï¼Ÿ</p><a id="more"></a><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>Reactçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç»„ä»¶åŒ–æ€æƒ³ï¼Œé¡µé¢ä¼šè¢«åˆ‡åˆ†æˆä¸€äº›ç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚</p><p>ç»„ä»¶ä»æ¦‚å¿µä¸Šçœ‹å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºè¾“å…¥å€¼ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯<code>props</code>ï¼Œæ‰€ä»¥å¯ä»¥æŠŠ<code>props</code>ç†è§£ä¸ºä»å¤–éƒ¨ä¼ å…¥ç»„ä»¶å†…éƒ¨çš„æ•°æ®ã€‚ç”±äºReactæ˜¯å•å‘æ•°æ®æµï¼Œæ‰€ä»¥<code>props</code>åŸºæœ¬ä¸Šä¹Ÿå°±æ˜¯ä»æœçˆ¶çº§ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’çš„æ•°æ®ã€‚</p><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªåˆ—è¡¨ï¼Œæ ¹æ®Reactç»„ä»¶åŒ–æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ—è¡¨ä¸­çš„è¡Œå½“åšä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰è¿™æ ·ä¸¤ä¸ªç»„ä»¶ï¼š<code>&lt;ItemList/&gt;</code>å’Œ<code>&lt;Item/&gt;</code>ã€‚</p><p>å…ˆçœ‹çœ‹<code>&lt;ItemList/&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import Item from &quot;./item&quot;;</span><br><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  const itemList = data.map(item =&gt; &lt;Item item=item /&gt;);</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &#123;itemList&#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ—è¡¨çš„æ•°æ®æˆ‘ä»¬å°±æš‚æ—¶å…ˆå‡è®¾æ˜¯æ”¾åœ¨ä¸€ä¸ª<code>data</code>å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡<code>map</code>å‡½æ•°è¿”å›ä¸€ä¸ªæ¯ä¸€é¡¹éƒ½æ˜¯<code>&lt;Item item=&#39;æ•°æ®&#39;/&gt;</code>çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå…¶å®åŒ…å«äº†<code>data.length</code>ä¸ª<code>&lt;Item/&gt;</code>ç»„ä»¶ï¼Œæ•°æ®é€šè¿‡åœ¨ç»„ä»¶ä¸Šè‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚å½“ç„¶ï¼Œè¿™é‡Œæƒ³ä¼ é€’å‡ ä¸ªè‡ªå®šä¹‰å‚æ•°éƒ½å¯ä»¥ã€‚</p><p>åœ¨<code>&lt;Item /&gt;</code>ä¸­æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default class Item extends React.Component&#123;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;li&gt;&#123;this.props.item&#125;&lt;/li&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>render</code>å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œç»„ä»¶å†…éƒ¨æ˜¯ä½¿ç”¨<code>this.props</code>æ¥è·å–ä¼ é€’åˆ°è¯¥ç»„ä»¶çš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ‰€æœ‰ä½ å¯¹è¿™ä¸ªç»„ä»¶çš„é…ç½®ï¼Œç°åœ¨åªåŒ…å«äº†ä¸€ä¸ª<code>item</code>å±æ€§ï¼Œæ‰€ä»¥é€šè¿‡<code>this.props.item</code>æ¥è·å–å³å¯ã€‚</p><h3 id="åªè¯»æ€§"><a href="#åªè¯»æ€§" class="headerlink" title="åªè¯»æ€§"></a>åªè¯»æ€§</h3><p><code>props</code>ç»å¸¸è¢«ç”¨ä½œæ¸²æŸ“ç»„ä»¶å’Œåˆå§‹åŒ–çŠ¶æ€ï¼Œå½“ä¸€ä¸ªç»„ä»¶è¢«å®ä¾‹åŒ–ä¹‹åï¼Œå®ƒçš„<code>props</code>æ˜¯åªè¯»çš„ï¼Œä¸å¯æ”¹å˜çš„ã€‚å¦‚æœ<code>props</code>åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è¢«æ”¹å˜ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºçš„å½¢æ€å˜å¾—ä¸å¯é¢„æµ‹ã€‚åªæœ‰é€šè¿‡çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ‰å¯ä»¥æŠŠæ–°çš„<code>props</code>ä¼ å…¥ç»„ä»¶ä¸­ã€‚</p><h3 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h3><p>åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æœ€å¥½ä¸º<code>props</code>ä¸­çš„å‚æ•°è®¾ç½®ä¸€ä¸ª<code>defaultProps</code>ï¼Œå¹¶ä¸”åˆ¶å®šå®ƒçš„ç±»å‹ã€‚æ¯”å¦‚ï¼Œè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Item.defaultProps = &#123;</span><br><span class="line">  item: &apos;Hello Props&apos;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Item.propTypes = &#123;</span><br><span class="line">  item: PropTypes.string,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…³äº<code>propTypes</code>ï¼Œå¯ä»¥å£°æ˜ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">optionalArray: PropTypes.array,</span><br><span class="line">optionalBool: PropTypes.bool,</span><br><span class="line">optionalFunc: PropTypes.func,</span><br><span class="line">optionalNumber: PropTypes.number,</span><br><span class="line">optionalObject: PropTypes.object,</span><br><span class="line">optionalString: PropTypes.string,</span><br><span class="line">optionalSymbol: PropTypes.symbol,</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>bool</code>å’Œ<code>func</code>æ˜¯ç®€å†™ã€‚</p><p>è¿™äº›çŸ¥è¯†åŸºç¡€æ•°æ®ç±»å‹ï¼Œè¿˜æœ‰ä¸€äº›å¤æ‚çš„ï¼Œé™„ä¸Šé“¾æ¥ï¼š</p><p><a href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">https://facebook.github.io/react/docs/typechecking-with-proptypes.html</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>props</code>æ˜¯ä¸€ä¸ªä»å¤–éƒ¨ä¼ è¿›ç»„ä»¶çš„å‚æ•°ï¼Œä¸»è¦ä½œä¸ºå°±æ˜¯ä»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œå®ƒå…·æœ‰å¯è¯»æ€§å’Œä¸å˜æ€§ï¼Œåªèƒ½é€šè¿‡å¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„<code>props</code>æ¥é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œå¦åˆ™å­ç»„ä»¶çš„<code>props</code>ä»¥åŠå±•ç°å½¢å¼ä¸ä¼šæ”¹å˜ã€‚</p><h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p><code>state</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>State is similar to props, but it is private and fully controlled by the component.</p></blockquote><p>ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å¯ä»¥ç”±æ•°æ®çŠ¶æ€å’Œå¤–éƒ¨å‚æ•°æ‰€å†³å®šï¼Œå¤–éƒ¨å‚æ•°ä¹Ÿå°±æ˜¯<code>props</code>ï¼Œè€Œæ•°æ®çŠ¶æ€å°±æ˜¯<code>state</code>ã€‚</p><h3 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      itemList:&apos;ä¸€äº›æ•°æ®&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &#123;this.state.itemList&#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡<code>this.state</code>ç»™ç»„ä»¶è®¾å®šä¸€ä¸ªåˆå§‹çš„<code>state</code>ï¼Œåœ¨ç¬¬ä¸€æ¬¡<code>render</code>çš„æ—¶å€™å°±ä¼šç”¨è¿™ä¸ªæ•°æ®æ¥æ¸²æŸ“ç»„ä»¶ã€‚</p><h3 id="setState"><a href="#setState" class="headerlink" title="setState"></a>setState</h3><p><code>state</code>ä¸åŒäº<code>props</code>çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>state</code>æ˜¯å¯ä»¥è¢«æ”¹å˜çš„ã€‚ä¸è¿‡ï¼Œä¸å¯ä»¥ç›´æ¥é€šè¿‡<code>this.state=</code>çš„æ–¹å¼æ¥ä¿®æ”¹ï¼Œè€Œéœ€è¦é€šè¿‡<code>this.setState()</code>æ–¹æ³•æ¥ä¿®æ”¹<code>state</code>ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé€šè¿‡å¼‚æ­¥æ“ä½œæ¥è·å–æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>didMount</code>é˜¶æ®µæ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">  fetch(&apos;url&apos;)</span><br><span class="line">    .then(response =&gt; response.json())</span><br><span class="line">    .then((data) =&gt; &#123;</span><br><span class="line">      this.setState(&#123;itemList:item&#125;);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ•°æ®è·å–å®Œæˆåï¼Œé€šè¿‡<code>this.setState</code>æ¥ä¿®æ”¹æ•°æ®çŠ¶æ€ã€‚</p><p>å½“æˆ‘ä»¬è°ƒç”¨<code>this.setState</code>æ–¹æ³•æ—¶ï¼ŒReactä¼šæ›´æ–°ç»„ä»¶çš„æ•°æ®çŠ¶æ€<code>state</code>ï¼Œå¹¶ä¸”é‡æ–°è°ƒç”¨<code>render</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¹ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚</p><p><strong>æ³¨æ„ï¼šé€šè¿‡<code>this.state=</code>æ¥åˆå§‹åŒ–<code>state</code>ï¼Œä½¿ç”¨<code>this.setState</code>æ¥ä¿®æ”¹<code>state</code>ï¼Œ<code>constructor</code>æ˜¯å”¯ä¸€èƒ½å¤Ÿåˆå§‹åŒ–çš„åœ°æ–¹ã€‚</strong></p><p><code>setState</code>æ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªéœ€è¦ä¼ å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å³å¯ï¼Œä¸éœ€è¦ä¼ å…¥æ•´ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name:&apos;axuebin&apos;,</span><br><span class="line">      age:25,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount()&#123;</span><br><span class="line">    this.setState(&#123;age:18&#125;)  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œå®Œ<code>setState</code>ä¹‹åçš„<code>state</code>åº”è¯¥æ˜¯<code>{name:&#39;axuebin&#39;,age:18}</code>ã€‚</p><p><code>setState</code>è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨<code>setState</code>è°ƒç”¨å®Œæˆå¹¶ä¸”ç»„ä»¶å¼€å§‹é‡æ–°æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬æ¸²æŸ“æ˜¯å¦å®Œæˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.setState(&#123;</span><br><span class="line">  name:&apos;xb&apos;</span><br><span class="line">&#125;,()=&gt;console.log(&apos;setState finished&apos;))</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>state</code>çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜ã€æ§åˆ¶ä»¥åŠä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ï¼Œå®ƒåªèƒ½åœ¨<code>constructor</code>ä¸­åˆå§‹åŒ–ï¼Œå®ƒç®—æ˜¯ç»„ä»¶çš„ç§æœ‰å±æ€§ï¼Œä¸å¯é€šè¿‡å¤–éƒ¨è®¿é—®å’Œä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ç»„ä»¶å†…éƒ¨çš„<code>this.setState</code>æ¥ä¿®æ”¹ï¼Œä¿®æ”¹<code>state</code>å±æ€§ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><ol><li><code>state</code>æ˜¯ç»„ä»¶è‡ªå·±ç®¡ç†æ•°æ®ï¼Œæ§åˆ¶è‡ªå·±çš„çŠ¶æ€ï¼Œå¯å˜ï¼›</li><li><code>props</code>æ˜¯å¤–éƒ¨ä¼ å…¥çš„æ•°æ®å‚æ•°ï¼Œä¸å¯å˜ï¼›</li><li>æ²¡æœ‰<code>state</code>çš„å«åšæ— çŠ¶æ€ç»„ä»¶ï¼Œæœ‰<code>state</code>çš„å«åšæœ‰çŠ¶æ€ç»„ä»¶ï¼›</li><li>å¤šç”¨<code>props</code>ï¼Œå°‘ç”¨<code>state</code>ã€‚ä¹Ÿå°±æ˜¯å¤šå†™æ— çŠ¶æ€ç»„ä»¶ã€‚</li></ol><p><strong>æœ¬æ–‡ä½œè€…</strong>ï¼š Andy<br><strong>æœ¬æ–‡åœ°å€</strong>ï¼š <a href="https://andyxw.com/archives/992.html">https://andyxw.com/archives/992.html</a><br><strong>ç‰ˆæƒå£°æ˜</strong>ï¼š è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Reactä¸­çš„stateå’Œprops
    
    </summary>
    
      <category term="React" scheme="https://andyxw.com/categories/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Andy&#39;s Blog</title>
  
  <subtitle>Quick notes</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://andyxw.com/"/>
  <updated>2019-09-23T09:58:10.601Z</updated>
  <id>https://andyxw.com/</id>
  
  <author>
    <name>Andy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€Reactæ·±å…¥ã€‘ä»Mixinåˆ°HOCå†åˆ°Hook</title>
    <link href="https://andyxw.com/archives/90ac.html"/>
    <id>https://andyxw.com/archives/90ac.html</id>
    <published>2019-09-23T09:41:48.000Z</published>
    <updated>2019-09-23T09:58:10.601Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://juejin.im/post/5cad39b3f265da03502b1c0a#heading-35" target="_blank" rel="noopener">https://juejin.im/post/5cad39b3f265da03502b1c0a#heading-35</a></p></blockquote><h2 id="å¯¼è¯»"><a href="#å¯¼è¯»" class="headerlink" title="å¯¼è¯»"></a>å¯¼è¯»</h2><p>å‰ç«¯å‘å±•é€Ÿåº¦éå¸¸ä¹‹å¿«ï¼Œé¡µé¢å’Œç»„ä»¶å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¦‚ä½•æ›´å¥½çš„å®ç°<code>çŠ¶æ€é€»è¾‘å¤ç”¨</code>ä¸€ç›´éƒ½æ˜¯åº”ç”¨ç¨‹åºä¸­é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ç›´æ¥å…³ç³»ç€åº”ç”¨ç¨‹åºçš„è´¨é‡ä»¥åŠç»´æŠ¤çš„éš¾æ˜“ç¨‹åº¦ã€‚</p><p>æœ¬æ–‡ä»‹ç»äº†<code>React</code>é‡‡ç”¨çš„ä¸‰ç§å®ç°<code>çŠ¶æ€é€»è¾‘å¤ç”¨</code>çš„æŠ€æœ¯ï¼Œå¹¶åˆ†æäº†ä»–ä»¬çš„å®ç°åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€å®é™…åº”ç”¨ä»¥åŠå¦‚ä½•é€‰æ‹©ä½¿ç”¨ä»–ä»¬ã€‚</p><p>æœ¬æ–‡ç•¥é•¿ï¼Œä¸‹é¢æ˜¯æœ¬æ–‡çš„æ€ç»´å¯¼å›¾ï¼Œæ‚¨å¯ä»¥ä»å¤´å¼€å§‹é˜…è¯»ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ„Ÿå…´è¶£çš„éƒ¨åˆ†é˜…è¯»ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93f73ff19e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><h2 id="Mixin-è®¾è®¡æ¨¡å¼"><a href="#Mixin-è®¾è®¡æ¨¡å¼" class="headerlink" title="Mixin è®¾è®¡æ¨¡å¼"></a>Mixin è®¾è®¡æ¨¡å¼</h2><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93f7719481?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p><code>Mixin</code>ï¼ˆæ··å…¥ï¼‰æ˜¯ä¸€ç§é€šè¿‡æ‰©å±•æ”¶é›†åŠŸèƒ½çš„æ–¹å¼ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å°†ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ‹·è´åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Šé¢å»ï¼Œä¸è¿‡ä½ å¯ä»¥æ‹·è´<code>ä»»æ„å¤š</code>ä¸ªå¯¹è±¡çš„<code>ä»»æ„ä¸ª</code>æ–¹æ³•åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ä¸Šå»ï¼Œè¿™æ˜¯<code>ç»§æ‰¿</code>æ‰€ä¸èƒ½å®ç°çš„ã€‚å®ƒçš„å‡ºç°ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨é—®é¢˜ã€‚</p><p>å¾ˆå¤šå¼€æºåº“æä¾›äº†<code>Mixin</code>çš„å®ç°ï¼Œå¦‚<code>Underscore</code>çš„<code>_.extend</code>æ–¹æ³•ã€<code>JQuery</code>çš„<code>extend</code>æ–¹æ³•ã€‚</p><p>ä½¿ç”¨<code>_.extend</code>æ–¹æ³•å®ç°ä»£ç å¤ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var LogMixin = &#123;</span><br><span class="line">  actionLog: function() &#123;</span><br><span class="line">    console.log(&apos;action...&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line">  requestLog: function() &#123;</span><br><span class="line">    console.log(&apos;request...&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">function User() &#123;  /*..*/  &#125;</span><br><span class="line">function Goods() &#123;  /*..*/ &#125;</span><br><span class="line">_.extend(User.prototype, LogMixin);</span><br><span class="line">_.extend(Goods.prototype, LogMixin);</span><br><span class="line">var user = new User();</span><br><span class="line">var good = new Goods();</span><br><span class="line">user.actionLog();</span><br><span class="line">good.requestLog();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å°è¯•æ‰‹åŠ¨å†™ä¸€ä¸ªç®€å•çš„<code>Mixin</code>æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function setMixin(target, mixin) &#123;</span><br><span class="line">  if (arguments[2]) &#123;</span><br><span class="line">    for (var i = 2, len = arguments.length; i &lt; len; i++) &#123;</span><br><span class="line">      target.prototype[arguments[i]] = mixin.prototype[arguments[i]];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else &#123;</span><br><span class="line">    for (var methodName in mixin.prototype) &#123;</span><br><span class="line">      if (!Object.hasOwnProperty(target.prototype, methodName)) &#123;</span><br><span class="line">        target.prototype[methodName] = mixin.prototype[methodName];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">setMixin(User,LogMixin,&apos;actionLog&apos;);</span><br><span class="line">setMixin(Goods,LogMixin,&apos;requestLog&apos;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>setMixin</code>æ–¹æ³•å°†ä»»æ„å¯¹è±¡çš„ä»»æ„æ–¹æ³•æ‰©å±•åˆ°ç›®æ ‡å¯¹è±¡ä¸Šã€‚</p><h2 id="React-ä¸­åº”ç”¨-Mixin"><a href="#React-ä¸­åº”ç”¨-Mixin" class="headerlink" title="React ä¸­åº”ç”¨ Mixin"></a>React ä¸­åº”ç”¨ Mixin</h2><p><code>React</code>ä¹Ÿæä¾›äº†<code>Mixin</code>çš„å®ç°ï¼Œå¦‚æœå®Œå…¨ä¸åŒçš„ç»„ä»¶æœ‰ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥æ¥å®ç°ä»£ç å¤ç”¨ï¼Œå½“ç„¶åªæœ‰åœ¨ä½¿ç”¨<code>createClass</code>æ¥åˆ›å»º<code>React</code>ç»„ä»¶æ—¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºåœ¨<code>React</code>ç»„ä»¶çš„<code>es6</code>å†™æ³•ä¸­å®ƒå·²ç»è¢«åºŸå¼ƒæ‰äº†ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œå¾ˆå¤šç»„ä»¶æˆ–é¡µé¢éƒ½éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ€§èƒ½æŒ‡æ ‡ç­‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªç»„ä»¶éƒ½å¼•å…¥å†™æ—¥å¿—çš„é€»è¾‘ï¼Œä¼šäº§ç”Ÿå¤§é‡é‡å¤ä»£ç ï¼Œé€šè¿‡<code>Mixin</code>æˆ‘ä»¬å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var LogMixin = &#123;</span><br><span class="line">  log: function() &#123;</span><br><span class="line">    console.log(&apos;log&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line">  componentDidMount: function() &#123;</span><br><span class="line">    console.log(&apos;in&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line">  componentWillUnmount: function() &#123;</span><br><span class="line">    console.log(&apos;out&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var User = React.createClass(&#123;</span><br><span class="line">  mixins: [LogMixin],</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    return (&lt;div&gt;...&lt;/div&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var Goods = React.createClass(&#123;</span><br><span class="line">  mixins: [LogMixin],</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    return (&lt;div&gt;...&lt;/div&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="Mixin-å¸¦æ¥çš„å±å®³"><a href="#Mixin-å¸¦æ¥çš„å±å®³" class="headerlink" title="Mixin å¸¦æ¥çš„å±å®³"></a>Mixin å¸¦æ¥çš„å±å®³</h2><p><code>React</code>å®˜æ–¹æ–‡æ¡£åœ¨ <a href="https://link.juejin.im?target=https%3A%2F%2Freact.docschina.org%2Fblog%2F2016%2F07%2F13%2Fmixins-considered-harmful.html" target="_blank" rel="noopener">Mixins Considered Harmful</a> ä¸€æ–‡ä¸­æåˆ°äº†<code>Mixin</code>å¸¦æ¥äº†å±å®³ï¼š</p><ul><li><code>Mixin</code> å¯èƒ½ä¼šç›¸äº’ä¾èµ–ï¼Œç›¸äº’è€¦åˆï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤</li><li>ä¸åŒçš„<code>Mixin</code>ä¸­çš„æ–¹æ³•å¯èƒ½ä¼šç›¸äº’å†²çª</li><li><code>Mixin</code>éå¸¸å¤šæ—¶ï¼Œç»„ä»¶æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œç”šè‡³è¿˜è¦ä¸ºå…¶åšç›¸å…³å¤„ç†ï¼Œè¿™æ ·ä¼šç»™ä»£ç é€ æˆæ»šé›ªçƒå¼çš„å¤æ‚æ€§</li></ul><p><code>React</code>ç°åœ¨å·²ç»ä¸å†æ¨èä½¿ç”¨<code>Mixin</code>æ¥è§£å†³ä»£ç å¤ç”¨é—®é¢˜ï¼Œå› ä¸º<code>Mixin</code>å¸¦æ¥çš„å±å®³æ¯”ä»–äº§ç”Ÿçš„ä»·å€¼è¿˜è¦å·¨å¤§ï¼Œå¹¶ä¸”<code>React</code>å…¨é¢æ¨èä½¿ç”¨é«˜é˜¶ç»„ä»¶æ¥æ›¿ä»£å®ƒã€‚å¦å¤–ï¼Œé«˜é˜¶ç»„ä»¶è¿˜èƒ½å®ç°æ›´å¤šå…¶ä»–æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œåœ¨å­¦ä¹ é«˜é˜¶ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚</p><h2 id="è£…é¥°æ¨¡å¼"><a href="#è£…é¥°æ¨¡å¼" class="headerlink" title="è£…é¥°æ¨¡å¼"></a>è£…é¥°æ¨¡å¼</h2><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93f7d6879a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è£…é¥°è€… (<code>decorator</code>) æ¨¡å¼èƒ½å¤Ÿåœ¨ä¸æ”¹å˜å¯¹è±¡è‡ªèº«çš„åŸºç¡€ä¸Šï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç»™å¯¹åƒåŠ¨æ€çš„æ·»åŠ èŒè´£ã€‚ä¸ç»§æ‰¿ç›¸æ¯”ï¼Œè£…é¥°è€…æ˜¯ä¸€ç§æ›´è½»ä¾¿çµæ´»çš„åšæ³•ã€‚</p><h2 id="é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰"><a href="#é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰" class="headerlink" title="é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰"></a>é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</h2><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93f959e716?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>é«˜é˜¶ç»„ä»¶å¯ä»¥çœ‹ä½œ<code>React</code>å¯¹è£…é¥°æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œé«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚</p><blockquote><p>é«˜é˜¶ç»„ä»¶ï¼ˆ<code>HOC</code>ï¼‰æ˜¯<code>React</code>ä¸­çš„é«˜çº§æŠ€æœ¯ï¼Œç”¨æ¥é‡ç”¨ç»„ä»¶é€»è¾‘ã€‚ä½†é«˜é˜¶ç»„ä»¶æœ¬èº«å¹¶ä¸æ˜¯<code>React API</code>ã€‚å®ƒåªæ˜¯ä¸€ç§æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯ç”±<code>React</code>è‡ªèº«çš„ç»„åˆæ€§è´¨å¿…ç„¶äº§ç”Ÿçš„ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function visible(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const &#123; visible, ...props &#125; = this.props;</span><br><span class="line">      if (visible === false) return null;</span><br><span class="line">      return &lt;WrappedComponent &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ª<code>HOC</code>çš„ç®€å•åº”ç”¨ï¼Œå‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°ç»„ä»¶ï¼Œæ–°ç»„å»ºå¯ä»¥æ¥æ”¶ä¸€ä¸ª<code>visible props</code>ï¼Œæ ¹æ®<code>visible</code>çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æ¸²æŸ“ Visibleã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»ä»¥ä¸‹å‡ æ–¹é¢æ¥å…·ä½“æ¢ç´¢<code>HOC</code>ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93f9a729dc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><h2 id="HOC-çš„å®ç°æ–¹å¼"><a href="#HOC-çš„å®ç°æ–¹å¼" class="headerlink" title="HOC çš„å®ç°æ–¹å¼"></a>HOC çš„å®ç°æ–¹å¼</h2><h3 id="å±æ€§ä»£ç†"><a href="#å±æ€§ä»£ç†" class="headerlink" title="å±æ€§ä»£ç†"></a>å±æ€§ä»£ç†</h3><p>å‡½æ•°è¿”å›ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç»„ä»¶ï¼Œç„¶ååœ¨<code>render</code>ä¸­è¿”å›è¦åŒ…è£¹çš„ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»£ç†æ‰€æœ‰ä¼ å…¥çš„<code>props</code>ï¼Œå¹¶ä¸”å†³å®šå¦‚ä½•æ¸²æŸ“ï¼Œå®é™…ä¸Š ï¼Œè¿™ç§æ–¹å¼ç”Ÿæˆçš„é«˜é˜¶ç»„ä»¶å°±æ˜¯åŸç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œä¸Šé¢çš„å‡½æ•°<code>visible</code>å°±æ˜¯ä¸€ä¸ª<code>HOC</code>å±æ€§ä»£ç†çš„å®ç°æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function proxyHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼š</p><ul><li>å¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„<code>props</code></li><li>å¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</li><li>å¯æ“ä½œç»„ä»¶çš„<code>static</code>æ–¹æ³•</li><li>è·å–<code>refs</code></li></ul><h3 id="åå‘ç»§æ‰¿"><a href="#åå‘ç»§æ‰¿" class="headerlink" title="åå‘ç»§æ‰¿"></a>åå‘ç»§æ‰¿</h3><p>è¿”å›ä¸€ä¸ªç»„ä»¶ï¼Œç»§æ‰¿åŸç»„ä»¶ï¼Œåœ¨<code>render</code>ä¸­è°ƒç”¨åŸç»„ä»¶çš„<code>render</code>ã€‚ç”±äºç»§æ‰¿äº†åŸç»„ä»¶ï¼Œèƒ½é€šè¿‡ this è®¿é—®åˆ°åŸç»„ä»¶çš„<code>ç”Ÿå‘½å‘¨æœŸã€propsã€stateã€render</code>ç­‰ï¼Œç›¸æ¯”å±æ€§ä»£ç†å®ƒèƒ½æ“ä½œæ›´å¤šçš„å±æ€§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function inheritHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return super.render();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å¯¹æ¯”åŸç”Ÿç»„ä»¶å¢å¼ºçš„é¡¹ï¼š</p><ul><li>å¯æ“ä½œæ‰€æœ‰ä¼ å…¥çš„<code>props</code></li><li>å¯æ“ä½œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</li><li>å¯æ“ä½œç»„ä»¶çš„<code>static</code>æ–¹æ³•</li><li>è·å–<code>refs</code></li><li>å¯æ“ä½œ<code>state</code></li><li>å¯ä»¥æ¸²æŸ“åŠ«æŒ</li></ul><h2 id="HOC-å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½"><a href="#HOC-å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½" class="headerlink" title="HOC å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½"></a>HOC å¯ä»¥å®ç°ä»€ä¹ˆåŠŸèƒ½</h2><h3 id="ç»„åˆæ¸²æŸ“"><a href="#ç»„åˆæ¸²æŸ“" class="headerlink" title="ç»„åˆæ¸²æŸ“"></a>ç»„åˆæ¸²æŸ“</h3><p>å¯ä½¿ç”¨ä»»ä½•å…¶ä»–ç»„ä»¶å’ŒåŸç»„ä»¶è¿›è¡Œç»„åˆæ¸²æŸ“ï¼Œè¾¾åˆ°æ ·å¼ã€å¸ƒå±€å¤ç”¨ç­‰æ•ˆæœã€‚</p><blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function stylHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return (&lt;div&gt;</span><br><span class="line">        &lt;div class&gt;&#123;this.props.title&#125;&lt;/div&gt;</span><br><span class="line">        &lt;WrappedComponent &#123;...this.props&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function styleHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;div&gt;</span><br><span class="line">        &lt;div class&gt;&#123;this.props.title&#125;&lt;/div&gt;</span><br><span class="line">        &#123;super.render()&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h3><p>æ ¹æ®ç‰¹å®šçš„å±æ€§å†³å®šåŸç»„ä»¶æ˜¯å¦æ¸²æŸ“</p><blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function visibleHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      if (this.props.visible === false) return null;</span><br><span class="line">      return &lt;WrappedComponent &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function visibleHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      if (this.props.visible === false) &#123;</span><br><span class="line">        return null</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return super.render()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="æ“ä½œ-props"><a href="#æ“ä½œ-props" class="headerlink" title="æ“ä½œ props"></a>æ“ä½œ props</h3><p>å¯ä»¥å¯¹ä¼ å…¥ç»„ä»¶çš„<code>props</code>è¿›è¡Œå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤æˆ–è€…æ ¹æ®ç‰¹å®šçš„<code>props</code>è¿›è¡Œç‰¹æ®Šçš„æ“ä½œã€‚</p><blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function proxyHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const newProps = &#123;</span><br><span class="line">        ...this.props,</span><br><span class="line">        user: &apos;ConardLi&apos;</span><br><span class="line">      &#125;</span><br><span class="line">      return &lt;WrappedComponent &#123;...newProps&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="è·å–-refs"><a href="#è·å–-refs" class="headerlink" title="è·å– refs"></a>è·å– refs</h3><p>é«˜é˜¶ç»„ä»¶ä¸­å¯è·å–åŸç»„ä»¶çš„<code>ref</code>ï¼Œé€šè¿‡<code>ref</code>è·å–ç»„ä»¶å®åŠ›ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œå½“ç¨‹åºåˆå§‹åŒ–å®Œæˆåè°ƒç”¨åŸç»„ä»¶çš„ log æ–¹æ³•ã€‚(ä¸çŸ¥é“ refs æ€ä¹ˆç”¨ï¼Œè¯·ğŸ‘‡<a href="https://link.juejin.im?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Frefs-and-the-dom.html" target="_blank" rel="noopener">Refs &amp; DOM</a>)</p><blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function refHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">      this.wapperRef.log()</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; ref=&#123;ref =&gt; &#123; this.wapperRef = ref &#125;&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ï¼šè°ƒç”¨é«˜é˜¶ç»„ä»¶çš„æ—¶å€™å¹¶ä¸èƒ½è·å–åˆ°åŸç»„ä»¶çš„çœŸå®<code>ref</code>ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œä¼ é€’ï¼Œå…·ä½“è¯·çœ‹<a href="#%E4%BC%A0%E9%80%92refs">ä¼ é€’ refs</a></p><h3 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h3><p>å°†åŸç»„ä»¶çš„çŠ¶æ€æå–åˆ°<code>HOC</code>ä¸­è¿›è¡Œç®¡ç†ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†<code>Input</code>çš„<code>value</code>æå–åˆ°<code>HOC</code>ä¸­è¿›è¡Œç®¡ç†ï¼Œä½¿å®ƒå˜æˆå—æ§ç»„ä»¶ï¼ŒåŒæ—¶ä¸å½±å“å®ƒä½¿ç”¨<code>onChange</code>æ–¹æ³•è¿›è¡Œä¸€äº›å…¶ä»–æ“ä½œã€‚åŸºäºè¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„<code>åŒå‘ç»‘å®š</code>ï¼Œå…·ä½“è¯·çœ‹<a href="#%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A">åŒå‘ç»‘å®š</a>ã€‚</p><blockquote><p>é€šè¿‡å±æ€§ä»£ç†å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">function proxyHoc(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">      super(props);</span><br><span class="line">      this.state = &#123; value: &apos;&apos; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onChange = (event) =&gt; &#123;</span><br><span class="line">      const &#123; onChange &#125; = this.props;</span><br><span class="line">      this.setState(&#123;</span><br><span class="line">        value: event.target.value,</span><br><span class="line">      &#125;, () =&gt; &#123;</span><br><span class="line">        if(typeof onChange ===&apos;function&apos;)&#123;</span><br><span class="line">          onChange(event);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      const newProps = &#123;</span><br><span class="line">        value: this.state.value,</span><br><span class="line">        onChange: this.onChange,</span><br><span class="line">      &#125;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; &#123;...newProps&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class HOC extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;input &#123;...this.props&#125;&gt;&lt;/input&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default proxyHoc(HOC);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="æ“ä½œ-state"><a href="#æ“ä½œ-state" class="headerlink" title="æ“ä½œ state"></a>æ“ä½œ state</h3><p>ä¸Šé¢çš„ä¾‹å­é€šè¿‡å±æ€§ä»£ç†åˆ©ç”¨ HOC çš„ state å¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¸€å®šçš„å¢å¼ºï¼Œä½†å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶åŸç»„ä»¶çš„<code>state</code>ï¼Œè€Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œåŸç»„ä»¶çš„<code>state</code>ã€‚ä½†æ˜¯å¹¶ä¸æ¨èç›´æ¥ä¿®æ”¹æˆ–æ·»åŠ åŸç»„ä»¶çš„<code>state</code>ï¼Œå› ä¸ºè¿™æ ·æœ‰å¯èƒ½å’Œç»„ä»¶å†…éƒ¨çš„æ“ä½œæ„æˆå†²çªã€‚</p><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function debugHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      console.log(&apos;props&apos;, this.props);</span><br><span class="line">      console.log(&apos;state&apos;, this.state);</span><br><span class="line">      return (</span><br><span class="line">        &lt;div class&gt;</span><br><span class="line">          &#123;super.render()&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„<code>HOC</code>åœ¨<code>render</code>ä¸­å°†<code>props</code>å’Œ<code>state</code>æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä½œè°ƒè¯•é˜¶æ®µï¼Œå½“ç„¶ä½ å¯ä»¥åœ¨é‡Œé¢å†™æ›´å¤šçš„è°ƒè¯•ä»£ç ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåªéœ€è¦åœ¨æˆ‘ä»¬æƒ³è¦è°ƒè¯•çš„ç»„ä»¶ä¸ŠåŠ ä¸Š<code>@debug</code>å°±å¯ä»¥å¯¹è¯¥ç»„ä»¶è¿›è¡Œè°ƒè¯•ï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡è°ƒè¯•çš„æ—¶å€™å†™å¾ˆå¤šå†—ä½™ä»£ç ã€‚(å¦‚æœä½ è¿˜ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨ HOCï¼Œè¯·ğŸ‘‡<a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8HOC">å¦‚ä½•ä½¿ç”¨ HOC</a>)</p><h3 id="æ¸²æŸ“åŠ«æŒ"><a href="#æ¸²æŸ“åŠ«æŒ" class="headerlink" title="æ¸²æŸ“åŠ«æŒ"></a>æ¸²æŸ“åŠ«æŒ</h3><p>é«˜é˜¶ç»„ä»¶å¯ä»¥åœ¨ render å‡½æ•°ä¸­åšéå¸¸å¤šçš„æ“ä½œï¼Œä»è€Œæ§åˆ¶åŸç»„ä»¶çš„æ¸²æŸ“è¾“å‡ºã€‚åªè¦æ”¹å˜äº†åŸç»„ä»¶çš„æ¸²æŸ“ï¼Œæˆ‘ä»¬éƒ½å°†å®ƒç§°ä¹‹ä¸ºä¸€ç§<code>æ¸²æŸ“åŠ«æŒ</code>ã€‚</p><p>å®é™…ä¸Šï¼Œä¸Šé¢çš„<a href="#%E7%BB%84%E5%90%88%E6%B8%B2%E6%9F%93">ç»„åˆæ¸²æŸ“</a>å’Œ<a href="#%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93">æ¡ä»¶æ¸²æŸ“</a>éƒ½æ˜¯<code>æ¸²æŸ“åŠ«æŒ</code>çš„ä¸€ç§ï¼Œé€šè¿‡åå‘ç»§æ‰¿ï¼Œä¸ä»…å¯ä»¥å®ç°ä»¥ä¸Šä¸¤ç‚¹ï¼Œè¿˜å¯ç›´æ¥<code>å¢å¼º</code>ç”±åŸç»„ä»¶<code>render</code>å‡½æ•°äº§ç”Ÿçš„<code>Reactå…ƒç´ </code>ã€‚</p><blockquote><p>é€šè¿‡åå‘ç»§æ‰¿å®ç°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function hijackHOC(WrappedComponent) &#123;</span><br><span class="line">  return class extends WrappedComponent &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const tree = super.render();</span><br><span class="line">      let newProps = &#123;&#125;;</span><br><span class="line">      if (tree &amp;&amp; tree.type === &apos;input&apos;) &#123;</span><br><span class="line">        newProps = &#123; value: &apos;æ¸²æŸ“è¢«åŠ«æŒäº†&apos; &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      const props = Object.assign(&#123;&#125;, tree.props, newProps);</span><br><span class="line">      const newTree = React.cloneElement(tree, props, tree.props.children);</span><br><span class="line">      return newTree;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢çš„è¯´æ˜æˆ‘ç”¨çš„æ˜¯<code>å¢å¼º</code>è€Œä¸æ˜¯<code>æ›´æ”¹</code>ã€‚<code>render</code>å‡½æ•°å†…å®é™…ä¸Šæ˜¯è°ƒç”¨<code>React.creatElement</code>äº§ç”Ÿçš„<code>Reactå…ƒç´ </code>ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a93fa0c3651?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è™½ç„¶æˆ‘ä»¬èƒ½æ‹¿åˆ°å®ƒï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒé‡Œé¢çš„å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡</p><p><code>getOwnPropertyDescriptors</code></p><p>å‡½æ•°æ¥æ‰“å°ä¸‹å®ƒçš„é…ç½®é¡¹ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a947a775967?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>å¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„<code>writable</code>å±æ€§å‡è¢«é…ç½®ä¸ºäº†<code>false</code>ï¼Œå³æ‰€æœ‰å±æ€§æ˜¯ä¸å¯å˜çš„ã€‚ï¼ˆå¯¹è¿™äº›é…ç½®é¡¹æœ‰ç–‘é—®ï¼Œè¯·ğŸ‘‡<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FObject%2FdefineProperty" target="_blank" rel="noopener">defineProperty</a>ï¼‰</p><p>ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<code>cloneElement</code>æ–¹æ³•æ¥åœ¨åŸç»„ä»¶çš„åŸºç¡€ä¸Šå¢å¼ºä¸€ä¸ªæ–°ç»„ä»¶ï¼š</p><blockquote><p><code>React.cloneElement()</code>å…‹éš†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„<code>Reactå…ƒç´ </code>ï¼Œä½¿ç”¨<code>element</code>ä½œä¸ºèµ·ç‚¹ã€‚ç”Ÿæˆçš„å…ƒç´ å°†ä¼šæ‹¥æœ‰åŸå§‹å…ƒç´  props ä¸æ–° props çš„æµ…åˆå¹¶ã€‚æ–°çš„å­çº§ä¼šæ›¿æ¢ç°æœ‰çš„å­çº§ã€‚æ¥è‡ªåŸå§‹å…ƒç´ çš„ key å’Œ ref å°†ä¼šä¿ç•™ã€‚</p></blockquote><p><code>React.cloneElement()</code>å‡ ä¹ç›¸å½“äºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;element.type &#123;...element.props&#125; &#123;...props&#125;&gt;&#123;children&#125;&lt;/element.type&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä½¿ç”¨-HOC"><a href="#å¦‚ä½•ä½¿ç”¨-HOC" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ HOC"></a>å¦‚ä½•ä½¿ç”¨ HOC</h2><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç éƒ½å†™çš„æ˜¯å¦‚ä½•å£°æ˜ä¸€ä¸ª<code>HOC</code>ï¼Œ<code>HOC</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¦å¢å¼ºçš„ç»„ä»¶ä½œä¸ºå‚æ•°è°ƒç”¨<code>HOC</code>å‡½æ•°ï¼Œå¾—åˆ°å¢å¼ºåçš„ç»„ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class myComponent extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (&lt;span&gt;åŸç»„ä»¶&lt;/span&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default inheritHOC(myComponent);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸€ä¸ªç»„ä»¶å¯èƒ½è¢«å¤šä¸ª<code>HOC</code>å¢å¼ºï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è¢«æ‰€æœ‰çš„<code>HOC</code>å¢å¼ºåçš„ç»„ä»¶ï¼Œå€Ÿç”¨ä¸€å¼ <code>è£…é¥°æ¨¡å¼</code>çš„å›¾æ¥è¯´æ˜ï¼Œå¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a949cfeb119?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰<code>logger</code>ï¼Œ<code>visible</code>ï¼Œ<code>style</code>ç­‰å¤šä¸ª<code>HOC</code>ï¼Œç°åœ¨è¦åŒæ—¶å¢å¼ºä¸€ä¸ª<code>Input</code>ç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logger(visible(style(Input)))</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™ç§ä»£ç éå¸¸çš„éš¾ä»¥é˜…è¯»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°è£…ä¸€ä¸ªç®€å•çš„å‡½æ•°ç»„åˆå·¥å…·ï¼Œå°†å†™æ³•æ”¹å†™å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const compose = (...fns) =&gt; fns.reduce((f, g) =&gt; (...args) =&gt; g(f(...args)));</span><br><span class="line">compose(logger,visible,style)(Input);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>compose</code>å‡½æ•°è¿”å›ä¸€ä¸ªæ‰€æœ‰å‡½æ•°ç»„åˆåçš„å‡½æ•°ï¼Œ<code>compose(f, g, h)</code> å’Œ <code>(...args) =&gt; f(g(h(...args)))</code>æ˜¯ä¸€æ ·çš„ã€‚</p><p>å¾ˆå¤šç¬¬ä¸‰æ–¹åº“éƒ½æä¾›äº†ç±»ä¼¼<code>compose</code>çš„å‡½æ•°ï¼Œä¾‹å¦‚<code>lodash.flowRight</code>ï¼Œ<code>Redux</code>æä¾›çš„<code>combineReducers</code>å‡½æ•°ç­‰ã€‚</p><h3 id="Decorators"><a href="#Decorators" class="headerlink" title="Decorators"></a>Decorators</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©<code>ES7</code>ä¸ºæˆ‘ä»¬æä¾›çš„<code>Decorators</code>æ¥è®©æˆ‘ä»¬çš„å†™æ³•å˜çš„æ›´åŠ ä¼˜é›…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@logger</span><br><span class="line">@visible</span><br><span class="line">@style</span><br><span class="line">class Input extends Component &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>Decorators</code>æ˜¯<code>ES7</code>çš„ä¸€ä¸ªææ¡ˆï¼Œè¿˜æ²¡æœ‰è¢«æ ‡å‡†åŒ–ï¼Œä½†ç›®å‰<code>Babel</code>è½¬ç å™¨å·²ç»æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦æå‰é…ç½®<code>babel-plugin-transform-decorators-legacy</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;]</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ç»“åˆä¸Šé¢çš„<code>compose</code>å‡½æ•°ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const hoc = compose(logger, visible, style);</span><br><span class="line">@hoc</span><br><span class="line">class Input extends Component &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="HOC-çš„å®é™…åº”ç”¨"><a href="#HOC-çš„å®é™…åº”ç”¨" class="headerlink" title="HOC çš„å®é™…åº”ç”¨"></a>HOC çš„å®é™…åº”ç”¨</h2><p>ä¸‹é¢æ˜¯ä¸€äº›æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…å¯¹<code>HOC</code>çš„å®é™…åº”ç”¨åœºæ™¯ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç ç»è¿‡å¾ˆå¤šç®€åŒ–ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼š</p><h3 id="æ—¥å¿—æ‰“ç‚¹"><a href="#æ—¥å¿—æ‰“ç‚¹" class="headerlink" title="æ—¥å¿—æ‰“ç‚¹"></a>æ—¥å¿—æ‰“ç‚¹</h3><p>å®é™…ä¸Šè¿™å±äºä¸€ç±»æœ€å¸¸è§çš„åº”ç”¨ï¼Œå¤šä¸ªç»„ä»¶æ‹¥æœ‰ç±»ä¼¼çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¦å¯¹é‡å¤çš„é€»è¾‘è¿›è¡Œå¤ç”¨ï¼Œ å®˜æ–¹æ–‡æ¡£ä¸­<code>CommentList</code>çš„ç¤ºä¾‹ä¹Ÿæ˜¯è§£å†³äº†ä»£ç å¤ç”¨é—®é¢˜ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œæœ‰å…´è¶£å¯ä»¥ğŸ‘‡<a href="https://link.juejin.im?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhigher-order-components.html%23%25E4%25BD%25BF%25E7%2594%25A8%25E9%25AB%2598%25E9%2598%25B6%25E7%25BB%2584%25E4%25BB%25B6%25EF%25BC%2588hoc%25EF%25BC%2589%25E8%25A7%25A3%25E5%2586%25B3%25E6%25A8%25AA%25E5%2588%2587%25E5%2585%25B3%25E6%25B3%25A8%25E7%2582%25B9" target="_blank" rel="noopener">ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹</a>ã€‚</p><p>æŸäº›é¡µé¢éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ€§èƒ½æŒ‡æ ‡ç­‰ç­‰ï¼Œé€šè¿‡é«˜é˜¶ç»„ä»¶åšè¿™äº›äº‹æƒ…å¯ä»¥çœå»å¾ˆå¤šé‡å¤ä»£ç ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function logHoc(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">      this.start = Date.now();</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">      this.end = Date.now();</span><br><span class="line">      console.log(`$&#123;WrappedComponent.dispalyName&#125; æ¸²æŸ“æ—¶é—´ï¼š$&#123;this.end - this.start&#125; ms`);</span><br><span class="line">      console.log(`$&#123;user&#125;è¿›å…¥$&#123;WrappedComponent.dispalyName&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">      console.log(`$&#123;user&#125;é€€å‡º$&#123;WrappedComponent.dispalyName&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; /&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="å¯ç”¨ã€æƒé™æ§åˆ¶"><a href="#å¯ç”¨ã€æƒé™æ§åˆ¶" class="headerlink" title="å¯ç”¨ã€æƒé™æ§åˆ¶"></a>å¯ç”¨ã€æƒé™æ§åˆ¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function auth(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const &#123; visible, auth, display = null, ...props &#125; = this.props;</span><br><span class="line">      if (visible === false || (auth &amp;&amp; authList.indexOf(auth) === -1)) &#123;</span><br><span class="line">        return display</span><br><span class="line">      &#125;</span><br><span class="line">      return &lt;WrappedComponent &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>authList</code>æ˜¯æˆ‘ä»¬åœ¨è¿›å…¥ç¨‹åºæ—¶å‘åç«¯è¯·æ±‚çš„æ‰€æœ‰æƒé™åˆ—è¡¨ï¼Œå½“ç»„ä»¶æ‰€éœ€è¦çš„æƒé™ä¸åˆ—è¡¨ä¸­ï¼Œæˆ–è€…è®¾ç½®çš„ <code>visible</code>æ˜¯<code>false</code>ï¼Œæˆ‘ä»¬å°†å…¶æ˜¾ç¤ºä¸ºä¼ å…¥çš„ç»„ä»¶æ ·å¼ï¼Œæˆ–è€…<code>null</code>ã€‚æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒçš„ç»„ä»¶åº”ç”¨<code>HOC</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  @auth</span><br><span class="line">  class Input extends Component &#123;  ...  &#125;</span><br><span class="line">  @auth</span><br><span class="line">  class Button extends Component &#123;  ...  &#125;</span><br><span class="line"></span><br><span class="line">  &lt;Button auth=&quot;user/addUser&quot;&gt;æ·»åŠ ç”¨æˆ·&lt;/Button&gt;</span><br><span class="line">  &lt;Input auth=&quot;user/search&quot; visible=&#123;false&#125; &gt;æ·»åŠ ç”¨æˆ·&lt;/Input&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" class="headerlink" title="åŒå‘ç»‘å®š"></a>åŒå‘ç»‘å®š</h3><p>åœ¨<code>vue</code>ä¸­ï¼Œç»‘å®šä¸€ä¸ªå˜é‡åå¯å®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œå³è¡¨å•ä¸­çš„å€¼æ”¹å˜åç»‘å®šçš„å˜é‡ä¹Ÿä¼šè‡ªåŠ¨æ”¹å˜ã€‚è€Œ<code>React</code>ä¸­æ²¡æœ‰åšè¿™æ ·çš„å¤„ç†ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¡¨å•å…ƒç´ éƒ½æ˜¯<code>éå—æ§ç»„ä»¶</code>ã€‚ç»™è¡¨å•å…ƒç´ ç»‘å®šä¸€ä¸ªçŠ¶æ€åï¼Œå¾€å¾€éœ€è¦æ‰‹åŠ¨ä¹¦å†™<code>onChange</code>æ–¹æ³•æ¥å°†å…¶æ”¹å†™ä¸º<code>å—æ§ç»„ä»¶</code>ï¼Œåœ¨è¡¨å•å…ƒç´ éå¸¸å¤šçš„æƒ…å†µä¸‹è¿™äº›é‡å¤æ“ä½œæ˜¯éå¸¸ç—›è‹¦çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©é«˜é˜¶ç»„ä»¶æ¥å®ç°ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šï¼Œä»£ç ç•¥é•¿ï¼Œå¯ä»¥ç»“åˆä¸‹é¢çš„æ€ç»´å¯¼å›¾è¿›è¡Œç†è§£ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94a5328c3b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª<code>Form</code>ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨äºåŒ…è£¹æ‰€æœ‰éœ€è¦åŒ…è£¹çš„è¡¨å•ç»„ä»¶ï¼Œé€šè¿‡<code>contex</code>å‘å­ç»„ä»¶æš´éœ²ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li><code>model</code>ï¼šå½“å‰<code>Form</code>ç®¡æ§çš„æ‰€æœ‰æ•°æ®ï¼Œç”±è¡¨å•<code>name</code>å’Œ<code>value</code>ç»„æˆï¼Œå¦‚<code>{name:&#39;ConardLi&#39;,pwd:&#39;123&#39;}</code>ã€‚<code>model</code>å¯ç”±å¤–éƒ¨ä¼ å…¥ï¼Œä¹Ÿå¯è‡ªè¡Œç®¡æ§ã€‚</li><li><code>changeModel</code>ï¼šæ”¹å˜<code>model</code>ä¸­æŸä¸ª<code>name</code>çš„å€¼ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class Form extends Component &#123;</span><br><span class="line">  static childContextTypes = &#123;</span><br><span class="line">    model: PropTypes.object,</span><br><span class="line">    changeModel: PropTypes.func</span><br><span class="line">  &#125;</span><br><span class="line">  constructor(props, context) &#123;</span><br><span class="line">    super(props, context);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      model: props.model || &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    if (nextProps.model) &#123;</span><br><span class="line">      this.setState(&#123;</span><br><span class="line">        model: nextProps.model</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  changeModel = (name, value) =&gt; &#123;</span><br><span class="line">    this.setState(&#123;</span><br><span class="line">      model: &#123; ...this.state.model, [name]: value &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      changeModel: this.changeModel,</span><br><span class="line">      model: this.props.model || this.state.model</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  onSubmit = () =&gt; &#123;</span><br><span class="line">    console.log(this.state.model);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;div&gt;</span><br><span class="line">      &#123;this.props.children&#125;</span><br><span class="line">      &lt;button onClick=&#123;this.onSubmit&#125;&gt;æäº¤&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸‹é¢å®šä¹‰ç”¨äºåŒå‘ç»‘å®šçš„<code>HOC</code>ï¼Œå…¶ä»£ç†äº†è¡¨å•çš„<code>onChange</code>å±æ€§å’Œ<code>value</code>å±æ€§ï¼š</p><ul><li>å‘ç”Ÿ<code>onChange</code>äº‹ä»¶æ—¶è°ƒç”¨ä¸Šå±‚<code>Form</code>çš„<code>changeModel</code>æ–¹æ³•æ¥æ”¹å˜<code>context</code>ä¸­çš„<code>model</code>ã€‚</li><li>åœ¨æ¸²æŸ“æ—¶å°†<code>value</code>æ”¹ä¸ºä»<code>context</code>ä¸­å–å‡ºçš„å€¼ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">function proxyHoc(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    static contextTypes = &#123;</span><br><span class="line">      model: PropTypes.object,</span><br><span class="line">      changeModel: PropTypes.func</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onChange = (event) =&gt; &#123;</span><br><span class="line">      const &#123; changeModel &#125; = this.context;</span><br><span class="line">      const &#123; onChange &#125; = this.props;</span><br><span class="line">      const &#123; v_model &#125; = this.props;</span><br><span class="line">      changeModel(v_model, event.target.value);</span><br><span class="line">      if(typeof onChange === &apos;function&apos;)&#123;onChange(event);&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      const &#123; model &#125; = this.context;</span><br><span class="line">      const &#123; v_model &#125; = this.props;</span><br><span class="line">      return &lt;WrappedComponent</span><br><span class="line">        &#123;...this.props&#125;</span><br><span class="line">        value=&#123;model[v_model]&#125;</span><br><span class="line">        onChange=&#123;this.onChange&#125;</span><br><span class="line">      /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@proxyHoc</span><br><span class="line">class Input extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;input &#123;...this.props&#125;&gt;&lt;/input&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åªæ˜¯ç®€ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œé™¤äº†<code>input</code>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†<code>HOC</code>åº”ç”¨åœ¨<code>select</code>ç­‰å…¶ä»–è¡¨å•ç»„ä»¶ï¼Œç”šè‡³è¿˜å¯ä»¥å°†ä¸Šé¢çš„<code>HOC</code>å…¼å®¹åˆ°<code>spanã€table</code>ç­‰å±•ç¤ºç»„ä»¶ï¼Œè¿™æ ·åšå¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ï¼Œè®©æˆ‘ä»¬çœå»äº†å¾ˆå¤šçŠ¶æ€ç®¡ç†çš„å·¥ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export default class extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Form &gt;</span><br><span class="line">        &lt;Input v_model=&quot;name&quot;&gt;&lt;/Input&gt;</span><br><span class="line">        &lt;Input v_model=&quot;pwd&quot;&gt;&lt;/Input&gt;</span><br><span class="line">      &lt;/Form&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="è¡¨å•æ ¡éªŒ"><a href="#è¡¨å•æ ¡éªŒ" class="headerlink" title="è¡¨å•æ ¡éªŒ"></a>è¡¨å•æ ¡éªŒ</h3><p>åŸºäºä¸Šé¢çš„åŒå‘ç»‘å®šçš„ä¾‹å­ï¼Œæˆ‘ä»¬å†æ¥ä¸€ä¸ªè¡¨å•éªŒè¯å™¨ï¼Œè¡¨å•éªŒè¯å™¨å¯ä»¥åŒ…å«éªŒè¯å‡½æ•°ä»¥åŠæç¤ºä¿¡æ¯ï¼Œå½“éªŒè¯ä¸é€šè¿‡æ—¶ï¼Œå±•ç¤ºé”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function validateHoc(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">      super(props);</span><br><span class="line">      this.state = &#123; error: &apos;&apos; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    onChange = (event) =&gt; &#123;</span><br><span class="line">      const &#123; validator &#125; = this.props;</span><br><span class="line">      if (validator &amp;&amp; typeof validator.func === &apos;function&apos;) &#123;</span><br><span class="line">        if (!validator.func(event.target.value)) &#123;</span><br><span class="line">          this.setState(&#123; error: validator.msg &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.setState(&#123; error: &apos;&apos; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;div&gt;</span><br><span class="line">        &lt;WrappedComponent onChange=&#123;this.onChange&#125;  &#123;...this.props&#125; /&gt;</span><br><span class="line">        &lt;div&gt;&#123;this.state.error || &apos;&apos;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const validatorName = &#123;</span><br><span class="line">  func: (val) =&gt; val &amp;&amp; !isNaN(val),</span><br><span class="line">  msg: &apos;è¯·è¾“å…¥æ•°å­—&apos;</span><br><span class="line">&#125;</span><br><span class="line">const validatorPwd = &#123;</span><br><span class="line">  func: (val) =&gt; val &amp;&amp; val.length &gt; 6,</span><br><span class="line">  msg: &apos;å¯†ç å¿…é¡»å¤§äº6ä½&apos;</span><br><span class="line">&#125;</span><br><span class="line">&lt;HOCInput validator=&#123;validatorName&#125; v_model=&quot;name&quot;&gt;&lt;/HOCInput&gt;</span><br><span class="line">&lt;HOCInput validator=&#123;validatorPwd&#125; v_model=&quot;pwd&quot;&gt;&lt;/HOCInput&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿˜å¯ä»¥åœ¨<code>Form</code>æäº¤çš„æ—¶å€™åˆ¤æ–­æ‰€æœ‰éªŒè¯å™¨æ˜¯å¦é€šè¿‡ï¼ŒéªŒè¯å™¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæ•°ç»„ç­‰ç­‰ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç è¢«ç®€åŒ–äº†å¾ˆå¤šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å®ç°ã€‚</p><h2 id="Redux-çš„-connect"><a href="#Redux-çš„-connect" class="headerlink" title="Redux çš„ connect"></a>Redux çš„ connect</h2><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94af19db54?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>redux ä¸­çš„<code>connect</code>ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª<code>HOC</code>ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„<code>connect</code>å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">export const connect = (mapStateToProps, mapDispatchToProps) =&gt; (WrappedComponent) =&gt; &#123;</span><br><span class="line">  class Connect extends Component &#123;</span><br><span class="line">    static contextTypes = &#123;</span><br><span class="line">      store: PropTypes.object</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    constructor () &#123;</span><br><span class="line">      super()</span><br><span class="line">      this.state = &#123;</span><br><span class="line">        allProps: &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount () &#123;</span><br><span class="line">      const &#123; store &#125; = this.context</span><br><span class="line">      this._updateProps()</span><br><span class="line">      store.subscribe(() =&gt; this._updateProps())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _updateProps () &#123;</span><br><span class="line">      const &#123; store &#125; = this.context</span><br><span class="line">      let stateProps = mapStateToProps ? mapStateToProps(store.getState(), this.props): &#123;&#125; </span><br><span class="line">      let dispatchProps = mapDispatchToProps? mapDispatchToProps(store.dispatch, this.props) : &#123;&#125; </span><br><span class="line">      this.setState(&#123;</span><br><span class="line">        allProps: &#123;</span><br><span class="line">          ...stateProps,</span><br><span class="line">          ...dispatchProps,</span><br><span class="line">          ...this.props</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render () &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.state.allProps&#125; /&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return Connect</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä»£ç éå¸¸æ¸…æ™°ï¼Œ<code>connect</code>å‡½æ•°å…¶å®å°±åšäº†ä¸€ä»¶äº‹ï¼Œå°†<code>mapStateToProps</code>å’Œ<code>mapDispatchToProps</code>åˆ†åˆ«è§£æ„åä¼ ç»™åŸç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åŸç»„ä»¶å†…å°±å¯ä»¥ç›´æ¥ç”¨<code>props</code>è·å–<code>state</code>ä»¥åŠ<code>dispatch</code>å‡½æ•°äº†ã€‚</p><h2 id="ä½¿ç”¨-HOC-çš„æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨-HOC-çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨ HOC çš„æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨ HOC çš„æ³¨æ„äº‹é¡¹</h2><h3 id="å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´"><a href="#å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´" class="headerlink" title="å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´"></a>å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´</h3><p>å½“æˆ‘ä»¬åº”ç”¨<code>HOC</code>å»å¢å¼ºå¦ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„ç»„ä»¶å·²ç»ä¸æ˜¯åŸç»„ä»¶äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿ä¸åˆ°åŸç»„ä»¶çš„ä»»ä½•é™æ€å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>HOC</code>çš„ç»“å°¾æ‰‹åŠ¨æ‹·è´ä»–ä»¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function proxyHOC(WrappedComponent) &#123;</span><br><span class="line">  class HOCComponent extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  HOCComponent.staticMethod = WrappedComponent.staticMethod;</span><br><span class="line">  // ... </span><br><span class="line">  return HOCComponent;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å¦‚æœåŸç»„ä»¶æœ‰éå¸¸å¤šçš„é™æ€å±æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸ç—›è‹¦çš„ï¼Œè€Œä¸”ä½ éœ€è¦å»äº†è§£éœ€è¦å¢å¼ºçš„æ‰€æœ‰ç»„ä»¶çš„é™æ€å±æ€§æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fmridgway%2Fhoist-non-react-statics" target="_blank" rel="noopener"><code>hoist-non-react-statics</code></a>æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ‹·è´æ‰€æœ‰é<code>React</code>çš„é™æ€æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import hoistNonReactStatic from &apos;hoist-non-react-statics&apos;;</span><br><span class="line">function proxyHOC(WrappedComponent) &#123;</span><br><span class="line">  class HOCComponent extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent &#123;...this.props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  hoistNonReactStatic(HOCComponent,WrappedComponent);</span><br><span class="line">  return HOCComponent;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="å‘Šè¯«â€”ä¼ é€’-refs"><a href="#å‘Šè¯«â€”ä¼ é€’-refs" class="headerlink" title="å‘Šè¯«â€”ä¼ é€’ refs"></a>å‘Šè¯«â€”ä¼ é€’ refs</h3><p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶åï¼Œè·å–åˆ°çš„<code>ref</code>å®é™…ä¸Šæ˜¯æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œè€ŒéåŸç»„ä»¶ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç”¨åˆ°åŸç»„ä»¶çš„<code>ref</code>ã€‚</p><p>é«˜é˜¶ç»„ä»¶å¹¶ä¸èƒ½åƒé€ä¼ <code>props</code>é‚£æ ·å°†<code>refs</code>é€ä¼ ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å®Œæˆ<code>ref</code>çš„ä¼ é€’ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function hoc(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    getWrappedRef = () =&gt; this.wrappedRef;</span><br><span class="line">    render() &#123;</span><br><span class="line">      return &lt;WrappedComponent ref=&#123;ref =&gt; &#123; this.wrappedRef = ref &#125;&#125; &#123;...this.props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@hoc</span><br><span class="line">class Input extends Component &#123;</span><br><span class="line">  render() &#123; return &lt;input&gt;&lt;/input&gt; &#125;</span><br><span class="line">&#125;</span><br><span class="line">class App extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;Input ref=&#123;ref =&gt; &#123; this.inpitRef = ref.getWrappedRef() &#125;&#125; &gt;&lt;/Input&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>React 16.3</code>ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ª<code>forwardRef API</code>æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ<code>refs</code>ä¼ é€’ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶ä¸Šè·å–çš„<code>ref</code>å°±æ˜¯åŸç»„ä»¶çš„<code>ref</code>äº†ï¼Œè€Œä¸éœ€è¦å†æ‰‹åŠ¨ä¼ é€’ï¼Œå¦‚æœä½ çš„<code>React</code>ç‰ˆæœ¬å¤§äº<code>16.3</code>ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function hoc(WrappedComponent) &#123;</span><br><span class="line">  class HOC extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const &#123; forwardedRef, ...props &#125; = this.props;</span><br><span class="line">      return &lt;WrappedComponent ref=&#123;forwardedRef&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return React.forwardRef((props, ref) =&gt; &#123;</span><br><span class="line">    return &lt;HOC forwardedRef=&#123;ref&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="å‘Šè¯«â€”ä¸è¦åœ¨-render-æ–¹æ³•å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶"><a href="#å‘Šè¯«â€”ä¸è¦åœ¨-render-æ–¹æ³•å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶" class="headerlink" title="å‘Šè¯«â€”ä¸è¦åœ¨ render æ–¹æ³•å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶"></a>å‘Šè¯«â€”ä¸è¦åœ¨ render æ–¹æ³•å†…åˆ›å»ºé«˜é˜¶ç»„ä»¶</h3><p><code>React</code> <code>Diff</code>ç®—æ³•çš„åŸåˆ™æ˜¯ï¼š</p><ul><li>ä½¿ç”¨ç»„ä»¶æ ‡è¯†ç¡®å®šæ˜¯å¸è½½è¿˜æ˜¯æ›´æ–°ç»„ä»¶</li><li>å¦‚æœç»„ä»¶çš„å’Œå‰ä¸€æ¬¡æ¸²æŸ“æ—¶æ ‡è¯†æ˜¯ç›¸åŒçš„ï¼Œé€’å½’æ›´æ–°å­ç»„ä»¶</li><li>å¦‚æœæ ‡è¯†ä¸åŒå¸è½½ç»„ä»¶é‡æ–°æŒ‚è½½æ–°ç»„ä»¶</li></ul><p>æ¯æ¬¡è°ƒç”¨é«˜é˜¶ç»„ä»¶ç”Ÿæˆçš„éƒ½æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ï¼Œç»„ä»¶çš„å”¯ä¸€æ ‡è¯†å“åº”çš„ä¹Ÿä¼šæ”¹å˜ï¼Œå¦‚æœåœ¨<code>render</code>æ–¹æ³•è°ƒç”¨äº†é«˜é˜¶ç»„ä»¶ï¼Œè¿™ä¼šå¯¼è‡´ç»„ä»¶æ¯æ¬¡éƒ½ä¼šè¢«å¸è½½åé‡æ–°æŒ‚è½½ã€‚</p><h3 id="çº¦å®š-ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶"><a href="#çº¦å®š-ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶" class="headerlink" title="çº¦å®š - ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶"></a>çº¦å®š - ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶</h3><p>å®˜æ–¹æ–‡æ¡£å¯¹é«˜é˜¶ç»„ä»¶çš„è¯´æ˜ï¼š</p><blockquote><p>é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚</p></blockquote><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹çº¯å‡½æ•°çš„å®šä¹‰ï¼š</p><blockquote><p>å¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚ è¯¥å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡æˆ–æ•°æ®çªå˜ã€‚</p></blockquote><p>å¦‚æœæˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶å¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InputComponent.prototype.componentWillReceiveProps = function(nextProps) &#123; ... &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ç ´åäº†æˆ‘ä»¬å¯¹é«˜é˜¶ç»„ä»¶çš„çº¦å®šï¼ŒåŒæ—¶ä¹Ÿæ”¹å˜äº†ä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„åˆè¡·ï¼šæˆ‘ä»¬ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ˜¯ä¸ºäº†<code>å¢å¼º</code>è€Œé<code>æ”¹å˜</code>åŸç»„ä»¶ã€‚</p><h3 id="çº¦å®š-é€ä¼ ä¸ç›¸å…³çš„-props"><a href="#çº¦å®š-é€ä¼ ä¸ç›¸å…³çš„-props" class="headerlink" title="çº¦å®š - é€ä¼ ä¸ç›¸å…³çš„ props"></a>çº¦å®š - é€ä¼ ä¸ç›¸å…³çš„ props</h3><p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»£ç†æ‰€æœ‰çš„<code>props</code>ï¼Œä½†å¾€å¾€ç‰¹å®šçš„<code>HOC</code>åªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ª<code>props</code>ã€‚æˆ‘ä»¬éœ€è¦æŠŠå…¶ä»–ä¸ç›¸å…³çš„<code>props</code>é€ä¼ ç»™åŸç»„ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function visible(WrappedComponent) &#123;</span><br><span class="line">  return class extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      const &#123; visible, ...props &#125; = this.props;</span><br><span class="line">      if (visible === false) return null;</span><br><span class="line">      return &lt;WrappedComponent &#123;...props&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªä½¿ç”¨<code>visible</code>å±æ€§æ¥æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºå¯éšè—ï¼ŒæŠŠå…¶ä»–<code>props</code>é€ä¼ ä¸‹å»ã€‚</p><h3 id="çº¦å®š-displayName"><a href="#çº¦å®š-displayName" class="headerlink" title="çº¦å®š - displayName"></a>çº¦å®š - displayName</h3><p>åœ¨ä½¿ç”¨<code>React Developer Tools</code>è¿›è¡Œè°ƒè¯•æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†<code>HOC</code>ï¼Œè°ƒè¯•ç•Œé¢å¯èƒ½å˜å¾—éå¸¸éš¾ä»¥é˜…è¯»ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@visible</span><br><span class="line">class Show extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;h1&gt;æˆ‘æ˜¯ä¸€ä¸ªæ ‡ç­¾&lt;/h1&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@visible</span><br><span class="line">class Title extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;h1&gt;æˆ‘æ˜¯ä¸€ä¸ªæ ‡é¢˜&lt;/h1&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94c5d5a8dc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¸º<code>HOC</code>æŒ‡å®šä¸€ä¸ª<code>displayName</code>ï¼Œå®˜æ–¹æ¨èä½¿ç”¨<code>HOCName(WrappedComponentName)</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">static displayName = `Visible($&#123;WrappedComponent.displayName&#125;)`</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94cdafad9e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è¿™ä¸ªçº¦å®šå¸®åŠ©ç¡®ä¿é«˜é˜¶ç»„ä»¶æœ€å¤§ç¨‹åº¦çš„çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p><h2 id="ä½¿ç”¨-HOC-çš„åŠ¨æœº"><a href="#ä½¿ç”¨-HOC-çš„åŠ¨æœº" class="headerlink" title="ä½¿ç”¨ HOC çš„åŠ¨æœº"></a>ä½¿ç”¨ HOC çš„åŠ¨æœº</h2><p>å›é¡¾ä¸‹ä¸Šæ–‡æåˆ°çš„ <code>Mixin</code> å¸¦æ¥çš„é£é™©ï¼š</p><ul><li><code>Mixin</code> å¯èƒ½ä¼šç›¸äº’ä¾èµ–ï¼Œç›¸äº’è€¦åˆï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤</li><li>ä¸åŒçš„<code>Mixin</code>ä¸­çš„æ–¹æ³•å¯èƒ½ä¼šç›¸äº’å†²çª</li><li><code>Mixin</code>éå¸¸å¤šæ—¶ï¼Œç»„ä»¶æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œç”šè‡³è¿˜è¦ä¸ºå…¶åšç›¸å…³å¤„ç†ï¼Œè¿™æ ·ä¼šç»™ä»£ç é€ æˆæ»šé›ªçƒå¼çš„å¤æ‚æ€§</li></ul><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94cd939f75?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è€Œ<code>HOC</code>çš„å‡ºç°å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ï¼š</p><ul><li>é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œå„ä¸ªé«˜é˜¶ç»„ä»¶ä¸ä¼šäº’ç›¸ä¾èµ–è€¦åˆ</li><li>é«˜é˜¶ç»„ä»¶ä¹Ÿæœ‰å¯èƒ½é€ æˆå†²çªï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹é¿å…è¿™äº›è¡Œä¸º</li><li>é«˜é˜¶ç»„ä»¶å¹¶ä¸å…³å¿ƒæ•°æ®ä½¿ç”¨çš„æ–¹å¼å’ŒåŸå› ï¼Œè€Œè¢«åŒ…è£¹çš„ç»„ä»¶ä¹Ÿä¸å…³å¿ƒæ•°æ®æ¥è‡ªä½•å¤„ã€‚é«˜é˜¶ç»„ä»¶çš„å¢åŠ ä¸ä¼šä¸ºåŸç»„ä»¶å¢åŠ è´Ÿæ‹…</li></ul><h2 id="HOC-çš„ç¼ºé™·"><a href="#HOC-çš„ç¼ºé™·" class="headerlink" title="HOC çš„ç¼ºé™·"></a>HOC çš„ç¼ºé™·</h2><ul><li><code>HOC</code>éœ€è¦åœ¨åŸç»„ä»¶ä¸Šè¿›è¡ŒåŒ…è£¹æˆ–è€…åµŒå¥—ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨<code>HOC</code>ï¼Œå°†ä¼šäº§ç”Ÿéå¸¸å¤šçš„åµŒå¥—ï¼Œè¿™è®©è°ƒè¯•å˜å¾—éå¸¸å›°éš¾ã€‚</li><li><code>HOC</code>å¯ä»¥åŠ«æŒ<code>props</code>ï¼Œåœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½é€ æˆå†²çªã€‚</li></ul><h2 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h2><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94d2268081?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p><code>Hooks</code>æ˜¯<code>React v16.7.0-alpha</code>ä¸­åŠ å…¥çš„æ–°ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨<code>class</code>ä»¥å¤–ä½¿ç”¨<code>state</code>å’Œå…¶ä»–<code>React</code>ç‰¹æ€§ã€‚</p><p>ä½¿ç”¨<code>Hooks</code>ï¼Œä½ å¯ä»¥åœ¨å°†å«æœ‰<code>state</code>çš„é€»è¾‘ä»ç»„ä»¶ä¸­æŠ½è±¡å‡ºæ¥ï¼Œè¿™å°†å¯ä»¥è®©è¿™äº›é€»è¾‘å®¹æ˜“è¢«æµ‹è¯•ã€‚åŒæ—¶ï¼Œ<code>Hooks</code>å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸é‡å†™ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨è¿™äº›é€»è¾‘ã€‚æ‰€ä»¥ï¼Œå®ƒä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§å®ç°<code>çŠ¶æ€é€»è¾‘å¤ç”¨</code>çš„æ–¹æ¡ˆã€‚</p><p>é˜…è¯»ä¸‹é¢çš„ç« èŠ‚<a href="#%E4%BD%BF%E7%94%A8Hook%E7%9A%84%E5%8A%A8%E6%9C%BA">ä½¿ç”¨ Hook çš„åŠ¨æœº</a>ä½ å¯ä»¥å‘ç°ï¼Œå®ƒå¯ä»¥åŒæ—¶è§£å†³<code>Mixin</code>å’Œ<code>HOC</code>å¸¦æ¥çš„é—®é¢˜ã€‚</p><h2 id="å®˜æ–¹æä¾›çš„-Hooks"><a href="#å®˜æ–¹æä¾›çš„-Hooks" class="headerlink" title="å®˜æ–¹æä¾›çš„ Hooks"></a>å®˜æ–¹æä¾›çš„ Hooks</h2><h3 id="State-Hook"><a href="#State-Hook" class="headerlink" title="State Hook"></a>State Hook</h3><p>æˆ‘ä»¬è¦ä½¿ç”¨<code>class</code>ç»„ä»¶å®ç°ä¸€ä¸ª<code>è®¡æ•°å™¨</code>åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">export default class Count extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; count: 0 &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; &#123; this.setState(&#123; count: this.state.count + 1 &#125;) &#125;&#125;&gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>useState</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ä¹Ÿèƒ½å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default function HookTest() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; &#123; setCount(count + 1); setNumber(number + 1); &#125;&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>useState</code>æ˜¯ä¸€ä¸ªé’©å­ï¼Œä»–å¯ä»¥ä¸ºå‡½æ•°å¼ç»„ä»¶å¢åŠ ä¸€äº›çŠ¶æ€ï¼Œå¹¶ä¸”æä¾›æ”¹å˜è¿™äº›çŠ¶æ€çš„å‡½æ•°ï¼ŒåŒæ—¶å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä½œä¸ºçŠ¶æ€çš„é»˜è®¤å€¼ã€‚</p><h3 id="Effect-Hook"><a href="#Effect-Hook" class="headerlink" title="Effect Hook"></a>Effect Hook</h3><blockquote><p>Effect Hook å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œä¸€äº›å…·æœ‰ side effectï¼ˆå‰¯ä½œç”¨ï¼‰çš„æ“ä½œ</p></blockquote><p><strong>å‚æ•°</strong></p><p><code>useEffect</code>æ–¹æ³•æ¥æ”¶ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li><ol><li>å›è°ƒå‡½æ•°ï¼šåœ¨ç¬¬ç»„ä»¶ä¸€æ¬¡<code>render</code>å’Œä¹‹åçš„æ¯æ¬¡<code>update</code>åè¿è¡Œï¼Œ<code>React</code>ä¿è¯åœ¨<code>DOM</code>å·²ç»æ›´æ–°å®Œæˆä¹‹åæ‰ä¼šè¿è¡Œå›è°ƒã€‚</li></ol></li><li><ol start="2"><li>çŠ¶æ€ä¾èµ– (æ•°ç»„)ï¼šå½“é…ç½®äº†çŠ¶æ€ä¾èµ–é¡¹åï¼Œåªæœ‰æ£€æµ‹åˆ°é…ç½®çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ã€‚</li></ol></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // åªè¦ç»„ä»¶renderåå°±ä¼šæ‰§è¡Œ</span><br><span class="line">  &#125;);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // åªæœ‰countæ”¹å˜æ—¶æ‰ä¼šæ‰§è¡Œ</span><br><span class="line">  &#125;,[count]);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><strong>å›è°ƒè¿”å›å€¼</strong></p><p><code>useEffect</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå½“é¡µé¢æ¸²æŸ“äº†ä¸‹ä¸€æ¬¡æ›´æ–°çš„ç»“æœåï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡<code>useEffect</code>ä¹‹å‰ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¸¸å¸¸ç”¨æ¥å¯¹ä¸Šä¸€æ¬¡è°ƒç”¨<code>useEffect</code>è¿›è¡Œæ¸…ç†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">export default function HookTest() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;æ‰§è¡Œ...&apos;, count);</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      console.log(&apos;æ¸…ç†...&apos;, count);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; &#123; setCount(count + 1); setNumber(number + 1); &#125;&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¹¶ç‚¹å‡»å‡ æ¬¡æŒ‰é’®ï¼Œä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><p><img src="https://user-gold-cdn.xitu.io/2019/4/10/16a04a94e8279309?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>æ³¨æ„ï¼Œå¦‚æœåŠ ä¸Šæµè§ˆå™¨æ¸²æŸ“çš„æƒ…å†µï¼Œç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> é¡µé¢æ¸²æŸ“...1</span><br><span class="line"> æ‰§è¡Œ... 1</span><br><span class="line"> é¡µé¢æ¸²æŸ“...2</span><br><span class="line"> æ¸…ç†... 1</span><br><span class="line"> æ‰§è¡Œ... 2</span><br><span class="line"> é¡µé¢æ¸²æŸ“...3</span><br><span class="line"> æ¸…ç†... 2</span><br><span class="line"> æ‰§è¡Œ... 3</span><br><span class="line"> é¡µé¢æ¸²æŸ“...4</span><br><span class="line"> æ¸…ç†... 3</span><br><span class="line"> æ‰§è¡Œ... 4</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨æµè§ˆå™¨æ¸²æŸ“å®Œåï¼Œå†æ‰§è¡Œæ¸…ç†çš„æ–¹æ³•è¿˜èƒ½æ‰¾åˆ°ä¸Šæ¬¡çš„<code>state</code>å‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨<code>useEffect</code>ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™å½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™èƒ½ä¿è¯æˆ‘ä»¬ä¸Šä¸€æ¬¡æ‰§è¡Œå‡½æ•°å­˜å‚¨çš„å˜é‡ä¸è¢«é”€æ¯å’Œæ±¡æŸ“ã€‚</p><p>ä½ å¯ä»¥å°è¯•ä¸‹é¢çš„ä»£ç å¯èƒ½æ›´å¥½ç†è§£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    var flag = 1;</span><br><span class="line">    var clean;</span><br><span class="line">    function effect(flag) &#123;</span><br><span class="line">      return function () &#123;</span><br><span class="line">        console.log(flag);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    clean = effect(flag);</span><br><span class="line">    flag = 2;</span><br><span class="line">    clean();</span><br><span class="line">    clean = effect(flag);</span><br><span class="line">    flag = 3;</span><br><span class="line">    clean();</span><br><span class="line">    clean = effect(flag);</span><br><span class="line"></span><br><span class="line">    // æ‰§è¡Œç»“æœ</span><br><span class="line"></span><br><span class="line">    effect... 1</span><br><span class="line">    clean... 1</span><br><span class="line">    effect... 2</span><br><span class="line">    clean... 2</span><br><span class="line">    effect... 3</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><strong>æ¨¡æ‹Ÿ componentDidMount</strong></p><p><code>componentDidMount</code>ç­‰ä»·äº<code>useEffect</code>çš„å›è°ƒä»…åœ¨é¡µé¢åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œä¸€æ¬¡ï¼Œå½“<code>useEffect</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„æ—¶å¯ä»¥å®ç°è¿™ä¸ªæ•ˆæœã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function useDidMount(callback) &#123;</span><br><span class="line">  useEffect(callback, []);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><blockquote><p>å®˜æ–¹ä¸æ¨èä¸Šé¢è¿™ç§å†™æ³•ï¼Œå› ä¸ºè¿™æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›é”™è¯¯ã€‚</p></blockquote><p><strong>æ¨¡æ‹Ÿ componentWillUnmount</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function useUnMount(callback) &#123;</span><br><span class="line">  useEffect(() =&gt; callback, []);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><blockquote><p>ä¸åƒ componentDidMount æˆ–è€… componentDidUpdateï¼ŒuseEffect ä¸­ä½¿ç”¨çš„ effect å¹¶ä¸ä¼šé˜»æ»æµè§ˆå™¨æ¸²æŸ“é¡µé¢ã€‚è¿™è®©ä½ çš„ app çœ‹èµ·æ¥æ›´åŠ æµç•…ã€‚</p></blockquote><h3 id="ref-Hook"><a href="#ref-Hook" class="headerlink" title="ref Hook"></a>ref Hook</h3><p>ä½¿ç”¨<code>useRef Hook</code>ï¼Œä½ å¯ä»¥è½»æ¾çš„è·å–åˆ°<code>dom</code>çš„<code>ref</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default function Input() &#123;</span><br><span class="line">  const inputEl = useRef(null);</span><br><span class="line">  const onButtonClick = () =&gt; &#123;</span><br><span class="line">    inputEl.current.focus();</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input ref=&#123;inputEl&#125; type=&quot;text&quot; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>useRef()</code>å¹¶ä¸ä»…ä»…å¯ä»¥ç”¨æ¥å½“ä½œè·å–<code>ref</code>ä½¿ç”¨ï¼Œä½¿ç”¨<code>useRef</code>äº§ç”Ÿçš„<code>ref</code>çš„<code>current</code>å±æ€§æ˜¯å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨å®ƒæ¥ä¿å­˜ä¸€ä¸ªä»»æ„å€¼ã€‚</p><p><strong>æ¨¡æ‹Ÿ componentDidUpdate</strong></p><p><code>componentDidUpdate</code>å°±ç›¸å½“äºé™¤å»ç¬¬ä¸€æ¬¡è°ƒç”¨çš„<code>useEffect</code>ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<code>useRef</code>ç”Ÿæˆä¸€ä¸ªæ ‡è¯†ï¼Œæ¥è®°å½•æ˜¯å¦ä¸ºç¬¬ä¸€æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function useDidUpdate(callback, prop) &#123;</span><br><span class="line">  const init = useRef(true);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (init.current) &#123;</span><br><span class="line">      init.current = false;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return callback();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, prop);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨-Hook-çš„æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨-Hook-çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨ Hook çš„æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨ Hook çš„æ³¨æ„äº‹é¡¹</h2><h3 id="ä½¿ç”¨èŒƒå›´"><a href="#ä½¿ç”¨èŒƒå›´" class="headerlink" title="ä½¿ç”¨èŒƒå›´"></a>ä½¿ç”¨èŒƒå›´</h3><ul><li>åªèƒ½åœ¨<code>React</code>å‡½æ•°å¼ç»„ä»¶æˆ–è‡ªå®šä¹‰<code>Hook</code>ä¸­ä½¿ç”¨<code>Hook</code>ã€‚</li></ul><p><code>Hook</code>çš„æå‡ºä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³<code>class</code>ç»„ä»¶çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨<code>class</code>ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚</p><h3 id="å£°æ˜çº¦æŸ"><a href="#å£°æ˜çº¦æŸ" class="headerlink" title="å£°æ˜çº¦æŸ"></a>å£°æ˜çº¦æŸ</h3><ul><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚</li></ul><p><code>Hook</code>é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œæ¯æ¬¡<code>useState</code> éƒ½ä¼šæ”¹å˜ä¸‹æ ‡ï¼Œ<code>React</code>éœ€è¦åˆ©ç”¨è°ƒç”¨é¡ºåºæ¥æ­£ç¡®æ›´æ–°ç›¸åº”çš„çŠ¶æ€ï¼Œå¦‚æœ<code>useState</code> è¢«åŒ…è£¹å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ä¸­ï¼Œé‚£æ¯å°±å¯èƒ½ä¼šå¼•èµ·è°ƒç”¨é¡ºåºçš„é”™ä¹±ï¼Œä»è€Œé€ æˆæ„æƒ³ä¸åˆ°çš„é”™è¯¯ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸ª<code>eslint</code>æ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬é¿å…è¿™äº›é—®é¢˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…</span><br><span class="line">npm install eslint-plugin-react-hooks --save-dev</span><br><span class="line">// é…ç½®</span><br><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    // ...</span><br><span class="line">    &quot;react-hooks&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    // ...</span><br><span class="line">    &quot;react-hooks/rules-of-hooks&quot;: &quot;error&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰-Hook"><a href="#è‡ªå®šä¹‰-Hook" class="headerlink" title="è‡ªå®šä¹‰ Hook"></a>è‡ªå®šä¹‰ Hook</h2><p>åƒä¸Šé¢ä»‹ç»çš„<code>HOC</code>å’Œ<code>mixin</code>ä¸€æ ·ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„<code>Hook</code>å°†ç»„ä»¶ä¸­ç±»ä¼¼çš„çŠ¶æ€é€»è¾‘æŠ½å–å‡ºæ¥ã€‚</p><p>è‡ªå®šä¹‰<code>Hook</code>éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æŠŠç›¸åº”éœ€è¦çš„çŠ¶æ€å’Œ<code>effect</code>å°è£…è¿›å»ï¼ŒåŒæ—¶ï¼Œ<code>Hook</code>ä¹‹é—´ä¹Ÿæ˜¯å¯ä»¥ç›¸äº’å¼•ç”¨çš„ã€‚ä½¿ç”¨<code>use</code>å¼€å¤´å‘½åè‡ªå®šä¹‰<code>Hook</code>ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿<code>eslint</code>è¿›è¡Œæ£€æŸ¥ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬çœ‹å‡ ä¸ªå…·ä½“çš„<code>Hook</code>å°è£…ï¼š</p><h3 id="æ—¥å¿—æ‰“ç‚¹-1"><a href="#æ—¥å¿—æ‰“ç‚¹-1" class="headerlink" title="æ—¥å¿—æ‰“ç‚¹"></a>æ—¥å¿—æ‰“ç‚¹</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢å°è£…çš„ç”Ÿå‘½å‘¨æœŸ<code>Hook</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const useLogger = (componentName, ...params) =&gt; &#123;</span><br><span class="line">  useDidMount(() =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;componentName&#125;åˆå§‹åŒ–`, ...params);</span><br><span class="line">  &#125;);</span><br><span class="line">  useUnMount(() =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;componentName&#125;å¸è½½`, ...params);</span><br><span class="line">  &#125;)</span><br><span class="line">  useDidUpdate(() =&gt; &#123;</span><br><span class="line">    console.log(`$&#123;componentName&#125;æ›´æ–°`, ...params);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function Page1(props)&#123;</span><br><span class="line">  useLogger(&apos;Page1&apos;,props);</span><br><span class="line">  return (&lt;div&gt;...&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹-title"><a href="#ä¿®æ”¹-title" class="headerlink" title="ä¿®æ”¹ title"></a>ä¿®æ”¹ title</h3><p>æ ¹æ®ä¸åŒçš„é¡µé¢åç§°ä¿®æ”¹é¡µé¢<code>title</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function useTitle(title) &#123;</span><br><span class="line">  useEffect(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      document.title = title;</span><br><span class="line">      return () =&gt; (document.title = &quot;ä¸»é¡µ&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">    [title]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">function Page1(props)&#123;</span><br><span class="line">  useTitle(&apos;Page1&apos;);</span><br><span class="line">  return (&lt;div&gt;...&lt;/div&gt;)</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="åŒå‘ç»‘å®š-1"><a href="#åŒå‘ç»‘å®š-1" class="headerlink" title="åŒå‘ç»‘å®š"></a>åŒå‘ç»‘å®š</h3><p>æˆ‘ä»¬å°†è¡¨å•<code>onChange</code>çš„é€»è¾‘æŠ½å–å‡ºæ¥å°è£…æˆä¸€ä¸ª<code>Hook</code>ï¼Œè¿™æ ·æ‰€æœ‰éœ€è¦è¿›è¡ŒåŒå‘ç»‘å®šçš„è¡¨å•ç»„ä»¶éƒ½å¯ä»¥è¿›è¡Œå¤ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function useBind(init) &#123;</span><br><span class="line">  let [value, setValue] = useState(init);</span><br><span class="line">  let onChange = useCallback(function(event) &#123;</span><br><span class="line">    setValue(event.currentTarget.value);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return &#123;</span><br><span class="line">    value,</span><br><span class="line">    onChange</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">function Page1(props)&#123;</span><br><span class="line">  let value = useBind(&apos;&apos;);</span><br><span class="line">  return &lt;input &#123;...value&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ å¯ä»¥å‘ä¸Šé¢çš„<code>HOC</code>é‚£æ ·ï¼Œç»“åˆ<code>context</code>å’Œ<code>form</code>æ¥å°è£…ä¸€ä¸ªæ›´é€šç”¨çš„åŒå‘ç»‘å®šï¼Œæœ‰å…´è¶£å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸‹ã€‚</p><h2 id="ä½¿ç”¨-Hook-çš„åŠ¨æœº"><a href="#ä½¿ç”¨-Hook-çš„åŠ¨æœº" class="headerlink" title="ä½¿ç”¨ Hook çš„åŠ¨æœº"></a>ä½¿ç”¨ Hook çš„åŠ¨æœº</h2><h3 id="å‡å°‘çŠ¶æ€é€»è¾‘å¤ç”¨çš„é£é™©"><a href="#å‡å°‘çŠ¶æ€é€»è¾‘å¤ç”¨çš„é£é™©" class="headerlink" title="å‡å°‘çŠ¶æ€é€»è¾‘å¤ç”¨çš„é£é™©"></a>å‡å°‘çŠ¶æ€é€»è¾‘å¤ç”¨çš„é£é™©</h3><p><code>Hook</code>å’Œ<code>Mixin</code>åœ¨ç”¨æ³•ä¸Šæœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯<code>Mixin</code>å¼•å…¥çš„é€»è¾‘å’ŒçŠ¶æ€æ˜¯å¯ä»¥ç›¸äº’è¦†ç›–çš„ï¼Œè€Œå¤šä¸ª<code>Hook</code>ä¹‹é—´äº’ä¸å½±å“ï¼Œè¿™è®©æˆ‘ä»¬ä¸éœ€è¦åœ¨æŠŠä¸€éƒ¨åˆ†ç²¾åŠ›æ”¾åœ¨é˜²æ­¢é¿å…é€»è¾‘å¤ç”¨çš„å†²çªä¸Šã€‚</p><p>åœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä½¿ç”¨<code>HOC</code>ä¹Ÿæœ‰å¯èƒ½å¸¦æ¥ä¸€å®šå†²çªï¼Œæ¯”å¦‚<code>props</code>è¦†ç›–ç­‰ç­‰ï¼Œä½¿ç”¨<code>Hook</code>åˆ™å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p><h3 id="é¿å…åœ°ç‹±å¼åµŒå¥—"><a href="#é¿å…åœ°ç‹±å¼åµŒå¥—" class="headerlink" title="é¿å…åœ°ç‹±å¼åµŒå¥—"></a>é¿å…åœ°ç‹±å¼åµŒå¥—</h3><p>å¤§é‡ä½¿ç”¨<code>HOC</code>çš„æƒ…å†µä¸‹è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—åµŒå¥—å±‚çº§éå¸¸æ·±ï¼Œä½¿ç”¨<code>Hook</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ‰å¹³å¼çš„çŠ¶æ€é€»è¾‘å¤ç”¨ï¼Œè€Œé¿å…äº†å¤§é‡çš„ç»„ä»¶åµŒå¥—ã€‚</p><h3 id="è®©ç»„ä»¶æ›´å®¹æ˜“ç†è§£"><a href="#è®©ç»„ä»¶æ›´å®¹æ˜“ç†è§£" class="headerlink" title="è®©ç»„ä»¶æ›´å®¹æ˜“ç†è§£"></a>è®©ç»„ä»¶æ›´å®¹æ˜“ç†è§£</h3><p>åœ¨ä½¿ç”¨<code>class</code>ç»„ä»¶æ„å»ºæˆ‘ä»¬çš„ç¨‹åºæ—¶ï¼Œä»–ä»¬å„è‡ªæ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œä¸šåŠ¡é€»è¾‘çš„å¤æ‚ä½¿è¿™äº›ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œå„ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¼šè°ƒç”¨è¶Šæ¥è¶Šå¤šçš„é€»è¾‘ï¼Œè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚ä½¿ç”¨<code>Hook</code>ï¼Œå¯ä»¥è®©ä½ æ›´å¤§é™åº¦çš„å°†å…¬ç”¨é€»è¾‘æŠ½ç¦»ï¼Œå°†ä¸€ä¸ªç»„ä»¶åˆ†å‰²æˆæ›´å°çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶åŸºäºç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¿›è¡Œåˆ†å‰²ã€‚</p><h3 id="ä½¿ç”¨å‡½æ•°ä»£æ›¿-class"><a href="#ä½¿ç”¨å‡½æ•°ä»£æ›¿-class" class="headerlink" title="ä½¿ç”¨å‡½æ•°ä»£æ›¿ class"></a>ä½¿ç”¨å‡½æ•°ä»£æ›¿ class</h3><p>ç›¸æ¯”å‡½æ•°ï¼Œç¼–å†™ä¸€ä¸ª<code>class</code>å¯èƒ½éœ€è¦æŒæ¡æ›´å¤šçš„çŸ¥è¯†ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹ä¹Ÿè¶Šå¤šï¼Œæ¯”å¦‚<code>this</code>æŒ‡å‘ã€ç»‘å®šäº‹ä»¶ç­‰ç­‰ã€‚å¦å¤–ï¼Œè®¡ç®—æœºç†è§£ä¸€ä¸ªå‡½æ•°æ¯”ç†è§£ä¸€ä¸ª<code>class</code>æ›´å¿«ã€‚<code>Hooks</code>è®©ä½ å¯ä»¥åœ¨<code>classes</code>ä¹‹å¤–ä½¿ç”¨æ›´å¤š<code>React</code>çš„æ–°ç‰¹æ€§ã€‚</p><h2 id="ç†æ€§çš„é€‰æ‹©"><a href="#ç†æ€§çš„é€‰æ‹©" class="headerlink" title="ç†æ€§çš„é€‰æ‹©"></a>ç†æ€§çš„é€‰æ‹©</h2><p>å®é™…ä¸Šï¼Œ<code>Hook</code>åœ¨<code>react 16.8.0</code>æ‰æ­£å¼å‘å¸ƒ<code>Hook</code>ç¨³å®šç‰ˆæœ¬ï¼Œç¬”è€…ä¹Ÿè¿˜æœªåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œç›®å‰ç¬”è€…åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨çš„æœ€å¤šçš„æ˜¯<code>HOC</code>ã€‚</p><p><code>React</code>å®˜æ–¹å®Œå…¨æ²¡æœ‰æŠŠ<code>classes</code>ä»<code>React</code>ä¸­ç§»é™¤çš„æ‰“ç®—ï¼Œ<code>class</code>ç»„ä»¶å’Œ<code>Hook</code>å®Œå…¨å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå®˜æ–¹ä¹Ÿå»ºè®®é¿å…ä»»ä½• â€œå¤§èŒƒå›´é‡æ„â€ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€ä¸ªéå¸¸æ–°çš„ç‰ˆæœ¬ï¼Œå¦‚æœä½ å–œæ¬¢å®ƒï¼Œå¯ä»¥åœ¨æ–°çš„éå…³é”®æ€§çš„ä»£ç ä¸­ä½¿ç”¨<code>Hook</code>ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><code>mixin</code>å·²è¢«æŠ›å¼ƒï¼Œ<code>HOC</code>æ­£å½“å£®å¹´ï¼Œ<code>Hook</code>åˆéœ²é”‹èŠ’ï¼Œå‰ç«¯åœˆå°±æ˜¯è¿™æ ·ï¼ŒæŠ€æœ¯è¿­ä»£é€Ÿåº¦éå¸¸ä¹‹å¿«ï¼Œä½†æˆ‘ä»¬åœ¨å­¦ä¹ è¿™äº›çŸ¥è¯†ä¹‹æ—¶ä¸€å®šè¦æ˜ç™½ä¸ºä»€ä¹ˆè¦å­¦ï¼Œå­¦äº†æœ‰æ²¡æœ‰ç”¨ï¼Œè¦ä¸è¦ç”¨ã€‚ä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚</p><p>æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œè°¢è°¢é˜…è¯»ã€‚</p><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://juejin.im/post/5c71050ef265da2db27938b5" target="_blank" rel="noopener">ã€React æ·±å…¥ã€‘setState çš„æ‰§è¡Œæœºåˆ¶</a></li><li><a href="https://juejin.im/post/5c7df2e7f265da2d8a55d49d" target="_blank" rel="noopener">ã€React æ·±å…¥ã€‘React äº‹ä»¶æœºåˆ¶</a></li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»äº† React é‡‡ç”¨çš„ä¸‰ç§å®ç° çŠ¶æ€é€»è¾‘å¤ç”¨ çš„æŠ€æœ¯ï¼Œå¹¶åˆ†æäº†ä»–ä»¬çš„å®ç°åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€å®é™…åº”ç”¨ä»¥åŠå¦‚ä½•é€‰æ‹©ä½¿ç”¨ä»–ä»¬ã€‚
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>30åˆ†é’Ÿç²¾é€šReact Hooks</title>
    <link href="https://andyxw.com/archives/66c2.html"/>
    <id>https://andyxw.com/archives/66c2.html</id>
    <published>2019-09-23T09:31:15.000Z</published>
    <updated>2019-09-23T09:40:01.459Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://juejin.im/post/5be3ea136fb9a049f9121014" target="_blank" rel="noopener">https://juejin.im/post/5be3ea136fb9a049f9121014</a></p></blockquote><p>ä½ è¿˜åœ¨ä¸ºè¯¥ä½¿ç”¨æ— çŠ¶æ€ç»„ä»¶ï¼ˆFunctionï¼‰è¿˜æ˜¯æœ‰çŠ¶æ€ç»„ä»¶ï¼ˆClassï¼‰è€Œçƒ¦æ¼å—ï¼Ÿ â€”â€”æ‹¥æœ‰äº† hooksï¼Œä½ å†ä¹Ÿä¸éœ€è¦å†™ Class äº†ï¼Œä½ çš„æ‰€æœ‰ç»„ä»¶éƒ½å°†æ˜¯ Functionã€‚</p><p>ä½ è¿˜åœ¨ä¸ºæä¸æ¸…ä½¿ç”¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°è€Œæ—¥å¤œéš¾çœ å—ï¼Ÿ â€”â€”æ‹¥æœ‰äº† Hooksï¼Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å¯ä»¥å…ˆä¸¢ä¸€è¾¹äº†ã€‚</p><p>ä½ åœ¨è¿˜åœ¨ä¸ºç»„ä»¶ä¸­çš„ this æŒ‡å‘è€Œæ™•å¤´è½¬å‘å—ï¼Ÿ â€”â€”æ—¢ç„¶ Class éƒ½ä¸¢æ‰äº†ï¼Œå“ªé‡Œè¿˜æœ‰ thisï¼Ÿä½ çš„äººç”Ÿç¬¬ä¸€æ¬¡ä¸å†éœ€è¦é¢å¯¹ thisã€‚</p><p>è¿™æ ·çœ‹æ¥ï¼Œè¯´ React Hooks æ˜¯ä»Šå¹´æœ€åŠ²çˆ†çš„æ–°ç‰¹æ€§çœŸçš„æ¯«ä¸å¤¸å¼ ã€‚å¦‚æœä½ ä¹Ÿå¯¹ react æ„Ÿå…´è¶£ï¼Œæˆ–è€…æ­£åœ¨ä½¿ç”¨ react è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œç­”åº”æˆ‘ï¼Œè¯·ä¸€å®šæŠ½å‡ºè‡³å°‘ 30 åˆ†é’Ÿçš„æ—¶é—´æ¥é˜…è¯»æœ¬æ–‡å¥½å—ï¼Ÿ</p><h2 id="ä¸€ä¸ªæœ€ç®€å•çš„-Hooks"><a href="#ä¸€ä¸ªæœ€ç®€å•çš„-Hooks" class="headerlink" title="ä¸€ä¸ªæœ€ç®€å•çš„ Hooks"></a>ä¸€ä¸ªæœ€ç®€å•çš„ Hooks</h2><p>é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Example extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ hooks åçš„ç‰ˆæœ¬ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç®€å•å¤šäº†ï¼å¯ä»¥çœ‹åˆ°ï¼Œ<code>Example</code>å˜æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°å´æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆcountï¼‰ï¼ŒåŒæ—¶å®ƒè¿˜å¯ä»¥æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼ˆsetCountï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥è¿™ä¹ˆäº†ä¸å¾—ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ³¨å…¥äº†ä¸€ä¸ª hookâ€“<code>useState</code>ï¼Œå°±æ˜¯è¿™ä¸ª hook è®©æˆ‘ä»¬çš„å‡½æ•°å˜æˆäº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„å‡½æ•°ã€‚</p><p>é™¤äº†<code>useState</code>è¿™ä¸ª hook å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šåˆ«çš„ hookï¼Œæ¯”å¦‚<code>useEffect</code>æä¾›äº†ç±»ä¼¼äº<code>componentDidMount</code>ç­‰ç”Ÿå‘½å‘¨æœŸé’©å­çš„åŠŸèƒ½ï¼Œ<code>useContext</code>æä¾›äº†ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰çš„åŠŸèƒ½ç­‰ç­‰ã€‚</p><p>Hooks æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥ä¸ºä½ çš„å‡½æ•°å‹ç»„ä»¶ï¼ˆfunction componentï¼‰æ³¨å…¥ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚å’¦ï¼Ÿè¿™å¬èµ·æ¥æœ‰ç‚¹åƒè¢«è¯Ÿç—…çš„ Mixins å•Šï¼Ÿéš¾é“æ˜¯ Mixins è¦åœ¨ react ä¸­æ­»ç°å¤ç‡ƒäº†å—ï¼Ÿå½“ç„¶ä¸ä¼šäº†ï¼Œç­‰ä¼šæˆ‘ä»¬å†æ¥è°ˆä¸¤è€…çš„åŒºåˆ«ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè¿™äº› hooks çš„ç›®æ ‡å°±æ˜¯è®©ä½ ä¸å†å†™ classï¼Œè®© function ä¸€ç»Ÿæ±Ÿæ¹–ã€‚</p><h2 id="React-ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª-Hooksï¼Ÿ"><a href="#React-ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª-Hooksï¼Ÿ" class="headerlink" title="React ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª Hooksï¼Ÿ"></a>React ä¸ºä»€ä¹ˆè¦æä¸€ä¸ª Hooksï¼Ÿ</h2><h3 id="æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼"><a href="#æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼" class="headerlink" title="æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼"></a>æƒ³è¦å¤ç”¨ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶å¤ªéº»çƒ¦äº†ï¼</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ react éƒ½æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå°†ä¸€ä¸ªé¡µé¢æ‹†æˆä¸€å †ç‹¬ç«‹çš„ï¼Œå¯å¤ç”¨çš„ç»„ä»¶ï¼Œå¹¶ä¸”ç”¨è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµçš„å½¢å¼å°†è¿™äº›ç»„ä»¶ä¸²è”èµ·æ¥ã€‚ä½†å‡å¦‚ä½ åœ¨å¤§å‹çš„å·¥ä½œé¡¹ç›®ä¸­ç”¨ reactï¼Œä½ ä¼šå‘ç°ä½ çš„é¡¹ç›®ä¸­å®é™…ä¸Šå¾ˆå¤š react ç»„ä»¶å†—é•¿ä¸”éš¾ä»¥å¤ç”¨ã€‚å°¤å…¶æ˜¯é‚£äº›å†™æˆ class çš„ç»„ä»¶ï¼Œå®ƒä»¬æœ¬èº«åŒ…å«äº†çŠ¶æ€ï¼ˆstateï¼‰ï¼Œæ‰€ä»¥å¤ç”¨è¿™ç±»ç»„ä»¶å°±å˜å¾—å¾ˆéº»çƒ¦ã€‚</p><p>é‚£ä¹‹å‰ï¼Œå®˜æ–¹æ¨èæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<a href="https://link.juejin.im?target=https%3A%2F%2Freactjs.org%2Fdocs%2Frender-props.html" target="_blank" rel="noopener">æ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰</a>å’Œ<a href="https://link.juejin.im?target=https%3A%2F%2Freactjs.org%2Fdocs%2Fhigher-order-components.html" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentsï¼‰</a>ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®è·‘ä¸‹é¢˜ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸¤ç§æ¨¡å¼ã€‚</p><p>æ¸²æŸ“å±æ€§æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„ prop æ¥ä¼ é€’éœ€è¦åŠ¨æ€æ¸²æŸ“çš„ nodes æˆ–ç»„ä»¶ã€‚å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„<code>DataProvider</code>ç»„ä»¶åŒ…å«äº†æ‰€æœ‰è·ŸçŠ¶æ€ç›¸å…³çš„ä»£ç ï¼Œè€Œ<code>Cat</code>ç»„ä»¶åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„å±•ç¤ºå‹ç»„ä»¶ï¼Œè¿™æ ·ä¸€æ¥<code>DataProvider</code>å°±å¯ä»¥å•ç‹¬å¤ç”¨äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import Cat from &apos;components/cat&apos;</span><br><span class="line">class DataProvider extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123; target: &apos;Zac&apos; &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;this.props.render(this.state)&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;DataProvider render=&#123;data =&gt; (</span><br><span class="line">  &lt;Cat target=&#123;data.target&#125; /&gt;</span><br><span class="line">)&#125;/&gt;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è™½ç„¶è¿™ä¸ªæ¨¡å¼å« Render Propsï¼Œä½†ä¸æ˜¯è¯´éç”¨ä¸€ä¸ªå« render çš„ props ä¸å¯ï¼Œä¹ æƒ¯ä¸Šå¤§å®¶æ›´å¸¸å†™æˆä¸‹é¢è¿™ç§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;DataProvider&gt;</span><br><span class="line">  &#123;data =&gt; (</span><br><span class="line">    &lt;Cat target=&#123;data.target&#125; /&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/DataProvider&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é«˜é˜¶ç»„ä»¶è¿™ä¸ªæ¦‚å¿µå°±æ›´å¥½ç†è§£äº†ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç»è¿‡ä¸€ç³»åˆ—åŠ å·¥åï¼Œæœ€åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚çœ‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼Œ<code>withUser</code>å‡½æ•°å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å…·æœ‰äº†å®ƒæä¾›çš„è·å–ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const withUser = WrappedComponent =&gt; &#123;</span><br><span class="line">  const user = sessionStorage.getItem(&quot;user&quot;);</span><br><span class="line">  return props =&gt; &lt;WrappedComponent user=&#123;user&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const UserPage = props =&gt; (</span><br><span class="line">  &lt;div class=&quot;user-container&quot;&gt;</span><br><span class="line">    &lt;p&gt;My name is &#123;props.user&#125;!&lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default withUser(UserPage);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿™ä¸¤ç§æ¨¡å¼çœ‹ä¸Šå»éƒ½æŒºä¸é”™çš„ï¼Œå¾ˆå¤šåº“ä¹Ÿè¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ React Routerã€‚ä½†æˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸¤ç§æ¨¡å¼ï¼Œä¼šå‘ç°å®ƒä»¬ä¼šå¢åŠ æˆ‘ä»¬ä»£ç çš„å±‚çº§å…³ç³»ã€‚æœ€ç›´è§‚çš„ä½“ç°ï¼Œæ‰“å¼€ devtool çœ‹çœ‹ä½ çš„ç»„ä»¶å±‚çº§åµŒå¥—æ˜¯ä¸æ˜¯å¾ˆå¤¸å¼ å§ã€‚è¿™æ—¶å€™å†å›è¿‡å¤´çœ‹æˆ‘ä»¬ä¸Šä¸€èŠ‚ç»™å‡ºçš„ hooks ä¾‹å­ï¼Œæ˜¯ä¸æ˜¯ç®€æ´å¤šäº†ï¼Œæ²¡æœ‰å¤šä½™çš„å±‚çº§åµŒå¥—ã€‚æŠŠå„ç§æƒ³è¦çš„åŠŸèƒ½å†™æˆä¸€ä¸ªä¸€ä¸ªå¯å¤ç”¨çš„è‡ªå®šä¹‰ hookï¼Œå½“ä½ çš„ç»„ä»¶æƒ³ç”¨ä»€ä¹ˆåŠŸèƒ½æ—¶ï¼Œç›´æ¥åœ¨ç»„ä»¶é‡Œè°ƒç”¨è¿™ä¸ª hook å³å¯ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2018/11/9/166f7bc8480d53c6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><h3 id="ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼"></a>ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±äº†å§ï¼</h3><p>æˆ‘ä»¬é€šå¸¸å¸Œæœ›ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…ï¼Œä½†æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œé€šå¸¸åŒæ—¶åšäº†å¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨<code>componentDidMount</code>ä¸­å‘èµ· ajax è¯·æ±‚è·å–æ•°æ®ï¼Œç»‘å®šä¸€äº›äº‹ä»¶ç›‘å¬ç­‰ç­‰ã€‚åŒæ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>componentDidUpdate</code>åšä¸€éåŒæ ·çš„äº‹æƒ…ã€‚å½“é¡¹ç›®å˜å¤æ‚åï¼Œè¿™ä¸€å—çš„ä»£ç ä¹Ÿå˜å¾—ä¸é‚£ä¹ˆç›´è§‚ã€‚</p><h3 id="classes-çœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼"><a href="#classes-çœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼" class="headerlink" title="classes çœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼"></a>classes çœŸçš„å¤ªè®©äººå›°æƒ‘äº†ï¼</h3><p>æˆ‘ä»¬ç”¨ class æ¥åˆ›å»º react ç»„ä»¶æ—¶ï¼Œè¿˜æœ‰ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œå°±æ˜¯ this çš„æŒ‡å‘é—®é¢˜ã€‚ä¸ºäº†ä¿è¯ this çš„æŒ‡å‘æ­£ç¡®ï¼Œæˆ‘ä»¬è¦ç»å¸¸å†™è¿™æ ·çš„ä»£ç ï¼š<code>this.handleClick = this.handleClick.bind(this)</code>ï¼Œæˆ–è€…æ˜¯è¿™æ ·çš„ä»£ç ï¼š<code>&lt;button onClick={() =&gt; this.handleClick(e)}&gt;</code>ã€‚ä¸€æ—¦æˆ‘ä»¬ä¸å°å¿ƒå¿˜äº†ç»‘å®š thisï¼Œå„ç§ bug å°±éšä¹‹è€Œæ¥ï¼Œå¾ˆéº»çƒ¦ã€‚</p><p>è¿˜æœ‰ä¸€ä»¶è®©æˆ‘å¾ˆè‹¦æ¼çš„äº‹æƒ…ã€‚æˆ‘åœ¨ä¹‹å‰çš„ react ç³»åˆ—æ–‡ç« å½“ä¸­æ›¾ç»è¯´è¿‡ï¼Œå°½å¯èƒ½æŠŠä½ çš„ç»„ä»¶å†™æˆæ— çŠ¶æ€ç»„ä»¶çš„å½¢å¼ï¼Œå› ä¸ºå®ƒä»¬æ›´æ–¹ä¾¿å¤ç”¨ï¼Œå¯ç‹¬ç«‹æµ‹è¯•ã€‚ç„¶è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç”¨ function å†™äº†ä¸€ä¸ªç®€æ´å®Œç¾çš„æ— çŠ¶æ€ç»„ä»¶ï¼Œåæ¥å› ä¸ºéœ€æ±‚å˜åŠ¨è¿™ä¸ªç»„ä»¶å¿…é¡»å¾—æœ‰è‡ªå·±çš„ stateï¼Œæˆ‘ä»¬åˆå¾—å¾ˆéº»çƒ¦çš„æŠŠ function æ”¹æˆ classã€‚</p><p>åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒHooks ä¾¿æ¨ªç©ºå‡ºä¸–äº†ï¼</p><h2 id="ä»€ä¹ˆæ˜¯-State-Hooksï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-State-Hooksï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ State Hooksï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ State Hooksï¼Ÿ</h2><p>å›åˆ°ä¸€å¼€å§‹æˆ‘ä»¬ç”¨çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ†è§£æ¥çœ‹åˆ°åº• state hooks åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡"><a href="#å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡" class="headerlink" title="å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡"></a>å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p><code>useState</code>æ˜¯ react è‡ªå¸¦çš„ä¸€ä¸ª hook å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å£°æ˜çŠ¶æ€å˜é‡ã€‚<code>useState</code>è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯æˆ‘ä»¬çš„çŠ¶æ€åˆå§‹å€¼ï¼ˆinitial stateï¼‰ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬<code>[0]</code>é¡¹æ˜¯å½“å‰å½“å‰çš„çŠ¶æ€å€¼ï¼Œç¬¬<code>[1]</code>é¡¹æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åšçš„äº‹æƒ…å…¶å®å°±æ˜¯ï¼Œå£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ countï¼ŒæŠŠå®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥æ›´æ”¹ count çš„å‡½æ•° setCountã€‚</p><p>ä¸Šé¢è¿™ç§è¡¨è¾¾å½¢å¼ï¼Œæ˜¯å€Ÿç”¨äº† es6 çš„æ•°ç»„è§£æ„ï¼ˆ<a href="https://link.juejin.im?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FDestructuring_assignment%23Array_destructuring" target="_blank" rel="noopener">array destructuring</a>ï¼‰ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ã€‚ä¸æ¸…æ¥šè¿™ç§ç”¨æ³•çš„å¯ä»¥å…ˆå»çœ‹ä¸‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  <a href="https://link.juejin.im?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000004365693" target="_blank" rel="noopener">30 åˆ†é’ŸæŒæ¡ ES6/ES2015 æ ¸å¿ƒå†…å®¹ï¼ˆä¸Šï¼‰</a>ã€‚</p><p>å¦‚æœä¸ç”¨æ•°ç»„è§£æ„çš„è¯ï¼Œå¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚å®é™…ä¸Šæ•°ç»„è§£æ„æ˜¯ä¸€ä»¶å¼€é”€å¾ˆå¤§çš„äº‹æƒ…ï¼Œç”¨ä¸‹é¢è¿™ç§å†™æ³•ï¼Œæˆ–è€…æ”¹ç”¨å¯¹è±¡è§£æ„ï¼Œæ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚å…·ä½“å¯ä»¥å»è¿™ç¯‡æ–‡ç« çš„åˆ†æ <a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1hWb-lQW4NSG9yRpyyiAA_9Ktytd5lypLnVLhPX9vamE%2Fedit%23" target="_blank" rel="noopener">Array destructuring for multi-value returns (in light of React hooks)</a>ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€ï¼Œæˆ‘ä»¬å°±æŒ‰ç…§å®˜æ–¹æ¨èä½¿ç”¨æ•°ç»„è§£æ„å°±å¥½ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let _useState = useState(0);</span><br><span class="line">let count = _useState[0];</span><br><span class="line">let setCount = _useState[1];</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="è¯»å–çŠ¶æ€å€¼"><a href="#è¯»å–çŠ¶æ€å€¼" class="headerlink" title="è¯»å–çŠ¶æ€å€¼"></a>è¯»å–çŠ¶æ€å€¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯è¶…ç®€å•ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€ count å°±æ˜¯ä¸€ä¸ªå•çº¯çš„å˜é‡è€Œå·²ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸éœ€è¦å†™æˆ<code>{this.state.count}</code>è¿™æ ·äº†ã€‚</p><h3 id="æ›´æ–°çŠ¶æ€"><a href="#æ›´æ–°çŠ¶æ€" class="headerlink" title="æ›´æ–°çŠ¶æ€"></a>æ›´æ–°çŠ¶æ€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">    Click me</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ setCount å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¿®æ”¹è¿‡çš„æ–°çŠ¶æ€å€¼ã€‚æ¥ä¸‹æ¥çš„äº‹æƒ…å°±äº¤ç»™ react äº†ï¼Œreact å°†ä¼šé‡æ–°æ¸²æŸ“æˆ‘ä»¬çš„ Example ç»„ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯æ›´æ–°åçš„æ–°çš„çŠ¶æ€ï¼Œå³ count=1ã€‚è¿™é‡Œæˆ‘ä»¬è¦åœä¸‹æ¥æ€è€ƒä¸€ä¸‹ï¼ŒExample æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆå®ƒå¯ä»¥è®°ä½ä¹‹å‰çš„çŠ¶æ€ï¼Ÿ</p><h3 id="ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜"><a href="#ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜" class="headerlink" title="ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜"></a>ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜</h3><p>è¿™é‡Œæˆ‘ä»¬å°±å‘ç°äº†é—®é¢˜ï¼Œé€šå¸¸æ¥è¯´æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼Œå½“å‡½æ•°è¿è¡Œå®Œæˆåï¼Œè¿™ä¸ªå˜é‡ä¹Ÿå°±é”€æ¯äº†ï¼ˆè¿™é‡Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘é—­åŒ…ç­‰æƒ…å†µï¼‰ï¼Œæ¯”å¦‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function add(n) &#123;</span><br><span class="line">    const result = 0;</span><br><span class="line">    return result + 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(1); //1</span><br><span class="line">add(1); //1</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸ç®¡æˆ‘ä»¬åå¤è°ƒç”¨ add å‡½æ•°å¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ 1ã€‚å› ä¸ºæ¯ä¸€æ¬¡æˆ‘ä»¬è°ƒç”¨ add æ—¶ï¼Œresult å˜é‡éƒ½æ˜¯ä»åˆå§‹å€¼ 0 å¼€å§‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆä¸Šé¢çš„ Example å‡½æ•°æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‹¿çš„ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œçš„çŠ¶æ€å€¼ä½œä¸ºåˆå§‹å€¼ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ˜¯ react å¸®æˆ‘ä»¬è®°ä½çš„ã€‚è‡³äº react æ˜¯ç”¨ä»€ä¹ˆæœºåˆ¶è®°ä½çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ€è€ƒä¸€ä¸‹ã€‚</p><h3 id="å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ"><a href="#å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ"></a>å‡å¦‚ä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªçŠ¶æ€å€¼æ€ä¹ˆåŠï¼Ÿ</h3><p>é¦–å…ˆï¼ŒuseState æ˜¯å¯ä»¥å¤šæ¬¡è°ƒç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function ExampleWithManyStates() &#123;</span><br><span class="line">  const [age, setAge] = useState(42);</span><br><span class="line">  const [fruit, setFruit] = useState(&apos;banana&apos;);</span><br><span class="line">  const [todos, setTodos] = useState([&#123; text: &apos;Learn Hooks&apos; &#125;]);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼ŒuseState æ¥æ”¶çš„åˆå§‹å€¼æ²¡æœ‰è§„å®šä¸€å®šè¦æ˜¯ string/number/boolean è¿™ç§ç®€å•æ•°æ®ç±»å‹ï¼Œå®ƒå®Œå…¨å¯ä»¥æ¥æ”¶å¯¹è±¡æˆ–è€…æ•°ç»„ä½œä¸ºå‚æ•°ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œä¹‹å‰æˆ‘ä»¬çš„<code>this.setState</code>åšçš„æ˜¯åˆå¹¶çŠ¶æ€åè¿”å›ä¸€ä¸ªæ–°çŠ¶æ€ï¼Œè€Œ<code>useState</code>æ˜¯ç›´æ¥æ›¿æ¢è€çŠ¶æ€åè¿”å›æ–°çŠ¶æ€ã€‚æœ€åï¼Œreact ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª useReducer çš„ hookï¼Œå¦‚æœä½ æ›´å–œæ¬¢ redux å¼çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆçš„è¯ã€‚</p><p>ä» ExampleWithManyStates å‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒuseState æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>å…¶å®æˆ‘ä»¬çœ‹ hook çš„ â€œå½¢æ€â€ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¹‹å‰è¢«å®˜æ–¹å¦å®šæ‰çš„ Mixins è¿™ç§æ–¹æ¡ˆï¼Œéƒ½æ˜¯æä¾›ä¸€ç§â€œæ’æ‹”å¼çš„åŠŸèƒ½æ³¨å…¥â€ çš„èƒ½åŠ›ã€‚è€Œ mixins ä¹‹æ‰€ä»¥è¢«å¦å®šï¼Œæ˜¯å› ä¸º Mixins æœºåˆ¶æ˜¯è®©å¤šä¸ª Mixins å…±äº«ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ç©ºé—´ï¼Œè¿™æ ·å°±å¾ˆéš¾ç¡®ä¿ä¸åŒ Mixins ä¾èµ–çš„çŠ¶æ€ä¸å‘ç”Ÿå†²çªã€‚</p><p>è€Œç°åœ¨æˆ‘ä»¬çš„ hookï¼Œä¸€æ–¹é¢å®ƒæ˜¯ç›´æ¥ç”¨åœ¨ function å½“ä¸­ï¼Œè€Œä¸æ˜¯ classï¼›å¦ä¸€æ–¹é¢æ¯ä¸€ä¸ª hook éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸åŒç»„ä»¶è°ƒç”¨åŒä¸€ä¸ª hook ä¹Ÿèƒ½ä¿è¯å„è‡ªçŠ¶æ€çš„ç‹¬ç«‹æ€§ã€‚è¿™å°±æ˜¯ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«äº†ã€‚</p><h3 id="react-æ˜¯æ€ä¹ˆä¿è¯å¤šä¸ª-useState-çš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ"><a href="#react-æ˜¯æ€ä¹ˆä¿è¯å¤šä¸ª-useState-çš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ" class="headerlink" title="react æ˜¯æ€ä¹ˆä¿è¯å¤šä¸ª useState çš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ"></a>react æ˜¯æ€ä¹ˆä¿è¯å¤šä¸ª useState çš„ç›¸äº’ç‹¬ç«‹çš„ï¼Ÿ</h3><p>è¿˜æ˜¯çœ‹ä¸Šé¢ç»™å‡ºçš„ ExampleWithManyStates ä¾‹å­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸‰æ¬¡ useStateï¼Œæ¯æ¬¡æˆ‘ä»¬ä¼ çš„å‚æ•°åªæ˜¯ä¸€ä¸ªå€¼ï¼ˆå¦‚ 42ï¼Œâ€˜bananaâ€™ï¼‰ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å‘Šè¯‰ react è¿™äº›å€¼å¯¹åº”çš„ key æ˜¯å“ªä¸ªï¼Œé‚£ react æ˜¯æ€ä¹ˆä¿è¯è¿™ä¸‰ä¸ª useState æ‰¾åˆ°å®ƒå¯¹åº”çš„ state å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œreact æ˜¯æ ¹æ® useState å‡ºç°çš„é¡ºåºæ¥å®šçš„ã€‚æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  //ç¬¬ä¸€æ¬¡æ¸²æŸ“</span><br><span class="line">  useState(42);  //å°†ageåˆå§‹åŒ–ä¸º42</span><br><span class="line">  useState(&apos;banana&apos;);  //å°†fruitåˆå§‹åŒ–ä¸ºbanana</span><br><span class="line">  useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //...</span><br><span class="line"></span><br><span class="line">  //ç¬¬äºŒæ¬¡æ¸²æŸ“</span><br><span class="line">  useState(42);  //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰</span><br><span class="line">  useState(&apos;banana&apos;);  //è¯»å–çŠ¶æ€å˜é‡fruitçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°bananaç›´æ¥è¢«å¿½ç•¥ï¼‰</span><br><span class="line">  useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //...</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let showFruit = true;</span><br><span class="line">function ExampleWithManyStates() &#123;</span><br><span class="line">  const [age, setAge] = useState(42);</span><br><span class="line">  </span><br><span class="line">  if(showFruit) &#123;</span><br><span class="line">    const [fruit, setFruit] = useState(&apos;banana&apos;);</span><br><span class="line">    showFruit = false;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  const [todos, setTodos] = useState([&#123; text: &apos;Learn Hooks&apos; &#125;]);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  //ç¬¬ä¸€æ¬¡æ¸²æŸ“</span><br><span class="line">  useState(42);  //å°†ageåˆå§‹åŒ–ä¸º42</span><br><span class="line">  useState(&apos;banana&apos;);  //å°†fruitåˆå§‹åŒ–ä¸ºbanana</span><br><span class="line">  useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //...</span><br><span class="line"></span><br><span class="line">  //ç¬¬äºŒæ¬¡æ¸²æŸ“</span><br><span class="line">  useState(42);  //è¯»å–çŠ¶æ€å˜é‡ageçš„å€¼ï¼ˆè¿™æ—¶å€™ä¼ çš„å‚æ•°42ç›´æ¥è¢«å¿½ç•¥ï¼‰</span><br><span class="line">  // useState(&apos;banana&apos;);  </span><br><span class="line">  useState([&#123; text: &apos;Learn Hooks&apos; &#125;]); //è¯»å–åˆ°çš„å´æ˜¯çŠ¶æ€å˜é‡fruitçš„å€¼ï¼Œå¯¼è‡´æŠ¥é”™</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é‰´äºæ­¤ï¼Œreact è§„å®šæˆ‘ä»¬å¿…é¡»æŠŠ hooks å†™åœ¨å‡½æ•°çš„æœ€å¤–å±‚ï¼Œä¸èƒ½å†™åœ¨ ifelse ç­‰æ¡ä»¶è¯­å¥å½“ä¸­ï¼Œæ¥ç¡®ä¿ hooks çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Effect-Hooks"><a href="#ä»€ä¹ˆæ˜¯-Effect-Hooks" class="headerlink" title="ä»€ä¹ˆæ˜¯ Effect Hooks?"></a>ä»€ä¹ˆæ˜¯ Effect Hooks?</h2><p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çš„ä¾‹å­ä¸­å¢åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  // ç±»ä¼¼äºcomponentDidMount å’Œ componentDidUpdate:</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜</span><br><span class="line">    document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹æ¯”ç€çœ‹ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ hooksï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå†™ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Example extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    document.title = `You clicked $&#123;this.state.count&#125; times`;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate() &#123;</span><br><span class="line">    document.title = `You clicked $&#123;this.state.count&#125; times`;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†™çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œé€šå¸¸ä¼šäº§ç”Ÿå¾ˆå¤šçš„å‰¯ä½œç”¨ï¼ˆside effectï¼‰ï¼Œæ¯”å¦‚å‘èµ· ajax è¯·æ±‚è·å–æ•°æ®ï¼Œæ·»åŠ ä¸€äº›ç›‘å¬çš„æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œï¼Œæ‰‹åŠ¨ä¿®æ”¹ dom ç­‰ç­‰ã€‚æˆ‘ä»¬ä¹‹å‰éƒ½æŠŠè¿™äº›å‰¯ä½œç”¨çš„å‡½æ•°å†™åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°é’©å­é‡Œï¼Œæ¯”å¦‚ componentDidMountï¼ŒcomponentDidUpdate å’Œ componentWillUnmountã€‚è€Œç°åœ¨çš„ useEffect å°±ç›¸å½“ä¸è¿™äº›å£°æ˜å‘¨æœŸå‡½æ•°é’©å­çš„é›†åˆä½“ã€‚å®ƒä»¥ä¸€æŠµä¸‰ã€‚</p><p>åŒæ—¶ï¼Œç”±äºå‰æ–‡æ‰€è¯´ hooks å¯ä»¥åå¤å¤šæ¬¡ä½¿ç”¨ï¼Œç›¸äº’ç‹¬ç«‹ã€‚æ‰€ä»¥æˆ‘ä»¬åˆç†çš„åšæ³•æ˜¯ï¼Œç»™æ¯ä¸€ä¸ªå‰¯ä½œç”¨ä¸€ä¸ªå•ç‹¬çš„ useEffect é’©å­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›å‰¯ä½œç”¨ä¸å†ä¸€è‚¡è„‘å †åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œï¼Œä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ã€‚</p><h3 id="useEffect-åšäº†ä»€ä¹ˆï¼Ÿ"><a href="#useEffect-åšäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="useEffect åšäº†ä»€ä¹ˆï¼Ÿ"></a>useEffect åšäº†ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ä»¬å†æ¢³ç†ä¸€éä¸‹é¢ä»£ç çš„é€»è¾‘ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">  &#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡<code>count</code>ï¼Œå°†å®ƒçš„åˆå§‹å€¼è®¾ä¸º 0ã€‚ç„¶åæˆ‘ä»¬å‘Šè¯‰ reactï¼Œæˆ‘ä»¬çš„è¿™ä¸ªç»„ä»¶æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ã€‚æˆ‘ä»¬ç»™<code>useEffect</code>hook ä¼ äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬çš„å‰¯ä½œç”¨æ˜¯è°ƒç”¨ browser API æ¥ä¿®æ”¹æ–‡æ¡£æ ‡é¢˜ã€‚å½“ react è¦æ¸²æŸ“æˆ‘ä»¬çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šå…ˆè®°ä½æˆ‘ä»¬ç”¨åˆ°çš„å‰¯ä½œç”¨ã€‚ç­‰ react æ›´æ–°äº† DOM ä¹‹åï¼Œå®ƒå†ä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š ç¬¬ä¸€ï¼Œreact é¦–æ¬¡æ¸²æŸ“å’Œä¹‹åçš„æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ä¸€éä¼ ç»™ useEffect çš„å‡½æ•°ã€‚è€Œä¹‹å‰æˆ‘ä»¬è¦ç”¨ä¸¤ä¸ªå£°æ˜å‘¨æœŸå‡½æ•°æ¥åˆ†åˆ«è¡¨ç¤ºé¦–æ¬¡æ¸²æŸ“ï¼ˆcomponentDidMountï¼‰ï¼Œå’Œä¹‹åçš„æ›´æ–°å¯¼è‡´çš„é‡æ–°æ¸²æŸ“ï¼ˆcomponentDidUpdateï¼‰ã€‚</p><p>ç¬¬äºŒï¼ŒuseEffect ä¸­å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œä¸ä¼šé˜»ç¢æµè§ˆå™¨æ›´æ–°è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè€Œä¹‹å‰çš„ componentDidMount æˆ– componentDidUpdate ä¸­çš„ä»£ç åˆ™æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚è¿™ç§å®‰æ’å¯¹å¤§å¤šæ•°å‰¯ä½œç”¨è¯´éƒ½æ˜¯åˆç†çš„ï¼Œä½†æœ‰çš„æƒ…å†µé™¤å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å…ˆæ ¹æ® DOM è®¡ç®—å‡ºæŸä¸ªå…ƒç´ çš„å°ºå¯¸å†é‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¸Œæœ›è¿™æ¬¡é‡æ–°æ¸²æŸ“æ˜¯åŒæ­¥å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåœ¨æµè§ˆå™¨çœŸçš„å»ç»˜åˆ¶è¿™ä¸ªé¡µé¢å‰å‘ç”Ÿã€‚</p><h3 id="useEffect-æ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨"><a href="#useEffect-æ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨" class="headerlink" title="useEffect æ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨"></a>useEffect æ€ä¹ˆè§£ç»‘ä¸€äº›å‰¯ä½œç”¨</h3><p>è¿™ç§åœºæ™¯å¾ˆå¸¸è§ï¼Œå½“æˆ‘ä»¬åœ¨ componentDidMount é‡Œæ·»åŠ äº†ä¸€ä¸ªæ³¨å†Œï¼Œæˆ‘ä»¬å¾—é©¬ä¸Šåœ¨ componentWillUnmount ä¸­ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶è¢«æ³¨é”€ä¹‹å‰æ¸…é™¤æ‰æˆ‘ä»¬æ·»åŠ çš„æ³¨å†Œï¼Œå¦åˆ™å†…å­˜æ³„æ¼çš„é—®é¢˜å°±å‡ºç°äº†ã€‚</p><p>æ€ä¹ˆæ¸…é™¤å‘¢ï¼Ÿè®©æˆ‘ä»¬ä¼ ç»™ useEffect çš„å‰¯ä½œç”¨å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å³å¯ã€‚è¿™ä¸ªæ–°çš„å‡½æ•°å°†ä¼šåœ¨ç»„ä»¶ä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚è¿™ç§æ¨¡å¼åœ¨ä¸€äº› pubsub æ¨¡å¼çš„å®ç°ä¸­å¾ˆå¸¸è§ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function FriendStatus(props) &#123;</span><br><span class="line">  const [isOnline, setIsOnline] = useState(null);</span><br><span class="line"></span><br><span class="line">  function handleStatusChange(status) &#123;</span><br><span class="line">    setIsOnline(status.isOnline);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</span><br><span class="line">    // ä¸€å®šæ³¨æ„ä¸‹è¿™ä¸ªé¡ºåºï¼šå‘Šè¯‰reactåœ¨ä¸‹æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼ŒåŒæ—¶æ˜¯ä¸‹æ¬¡è°ƒç”¨ChatAPI.subscribeToFriendStatusä¹‹å‰æ‰§è¡Œcleanup</span><br><span class="line">    return function cleanup() &#123;</span><br><span class="line">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  if (isOnline === null) &#123;</span><br><span class="line">    return &apos;Loading...&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹éœ€è¦é‡è§†ï¼è¿™ç§è§£ç»‘çš„æ¨¡å¼è·Ÿ componentWillUnmount ä¸ä¸€æ ·ã€‚componentWillUnmount åªä¼šåœ¨ç»„ä»¶è¢«é”€æ¯å‰æ‰§è¡Œä¸€æ¬¡è€Œå·²ï¼Œè€Œ useEffect é‡Œçš„å‡½æ•°ï¼Œæ¯æ¬¡ç»„ä»¶æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œä¸€éï¼ŒåŒ…æ‹¬å‰¯ä½œç”¨å‡½æ•°è¿”å›çš„è¿™ä¸ªæ¸…ç†å‡½æ•°ä¹Ÿä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è®©å‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½æ‰§è¡Œä¸€éï¼Ÿ</h3><p>æˆ‘ä»¬å…ˆçœ‹ä»¥å‰çš„æ¨¡å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  componentDidMount() &#123;</span><br><span class="line">    ChatAPI.subscribeToFriendStatus(</span><br><span class="line">      this.props.friend.id,</span><br><span class="line">      this.handleStatusChange</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(</span><br><span class="line">      this.props.friend.id,</span><br><span class="line">      this.handleStatusChange</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å¾ˆæ¸…é™¤ï¼Œæˆ‘ä»¬åœ¨ componentDidMount æ³¨å†Œï¼Œå†åœ¨ componentWillUnmount æ¸…é™¤æ³¨å†Œã€‚ä½†å‡å¦‚è¿™æ—¶å€™<code>props.friend.id</code>å˜äº†æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¸å¾—ä¸å†æ·»åŠ ä¸€ä¸ª componentDidUpdate æ¥å¤„ç†è¿™ç§æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    // å…ˆæŠŠä¸Šä¸€ä¸ªfriend.idè§£ç»‘</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(</span><br><span class="line">      prevProps.friend.id,</span><br><span class="line">      this.handleStatusChange</span><br><span class="line">    );</span><br><span class="line">    // å†é‡æ–°æ³¨å†Œæ–°ä½†friend.id</span><br><span class="line">    ChatAPI.subscribeToFriendStatus(</span><br><span class="line">      this.props.friend.id,</span><br><span class="line">      this.handleStatusChange</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>çœ‹åˆ°äº†å—ï¼Ÿå¾ˆç¹çï¼Œè€Œæˆ‘ä»¬ä½† useEffect åˆ™æ²¡è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°åéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éã€‚æ‰€ä»¥ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.é¡µé¢é¦–æ¬¡æ¸²æŸ“</span><br><span class="line">2.æ›¿friend.id=1çš„æœ‹å‹æ³¨å†Œ</span><br><span class="line"></span><br><span class="line">3.çªç„¶friend.idå˜æˆäº†2</span><br><span class="line">4.é¡µé¢é‡æ–°æ¸²æŸ“</span><br><span class="line">5.æ¸…é™¤friend.id=1çš„ç»‘å®š</span><br><span class="line">6.æ›¿friend.id=2çš„æœ‹å‹æ³¨å†Œ</span><br><span class="line">...</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°"><a href="#æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°" class="headerlink" title="æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°"></a>æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å‰¯ä½œç”¨å‡½æ•°</h3><p>æŒ‰ç…§ä¸Šä¸€èŠ‚çš„æ€è·¯ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½è¦æ‰§è¡Œä¸€éè¿™äº›å‰¯ä½œç”¨å‡½æ•°ï¼Œæ˜¾ç„¶æ˜¯ä¸ç»æµçš„ã€‚æ€ä¹ˆè·³è¿‡ä¸€äº›ä¸å¿…è¦çš„è®¡ç®—å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç»™ useEffect ä¼ ç¬¬äºŒä¸ªå‚æ•°å³å¯ã€‚ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥å‘Šè¯‰ react åªæœ‰å½“è¿™ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰æ‰§è¡Œæˆ‘ä»¬ä¼ çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">&#125;, [count]); // åªæœ‰å½“countçš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°æ‰§è¡Œ`document.title`è¿™ä¸€å¥</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬ç¬¬äºŒä¸ªå‚æ•°ä¼ ä¸€ä¸ªç©ºæ•°ç»„ [] æ—¶ï¼Œå…¶å®å°±ç›¸å½“äºåªåœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯ componentDidMount åŠ  componentWillUnmount çš„æ¨¡å¼ã€‚ä¸è¿‡è¿™ç§ç”¨æ³•å¯èƒ½å¸¦æ¥ bugï¼Œå°‘ç”¨ã€‚</p><h2 id="è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„-Effect-Hooks"><a href="#è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„-Effect-Hooks" class="headerlink" title="è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„ Effect Hooks?"></a>è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„ Effect Hooks?</h2><p>é™¤äº†ä¸Šæ–‡é‡ç‚¹ä»‹ç»çš„ useState å’Œ useEffectï¼Œreact è¿˜ç»™æˆ‘ä»¬æä¾›æ¥å¾ˆå¤šæœ‰ç”¨çš„ hooksï¼š</p><p>useContext useReducer useCallback useMemo useRef useImperativeMethods useMutationEffect useLayoutEffect</p><p>æˆ‘ä¸å†ä¸€ä¸€ä»‹ç»ï¼Œå¤§å®¶è‡ªè¡Œå»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p><h2 id="æ€ä¹ˆå†™è‡ªå®šä¹‰çš„-Effect-Hooks"><a href="#æ€ä¹ˆå†™è‡ªå®šä¹‰çš„-Effect-Hooks" class="headerlink" title="æ€ä¹ˆå†™è‡ªå®šä¹‰çš„ Effect Hooks?"></a>æ€ä¹ˆå†™è‡ªå®šä¹‰çš„ Effect Hooks?</h2><p>ä¸ºä»€ä¹ˆè¦è‡ªå·±å»å†™ä¸€ä¸ª Effect Hooks? è¿™æ ·æˆ‘ä»¬æ‰èƒ½æŠŠå¯ä»¥å¤ç”¨çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªä¸ªå¯ä»¥éšæ„æ’æ‹”çš„ â€œæ’é”€â€ï¼Œå“ªä¸ªç»„ä»¶è¦ç”¨æ¥ï¼Œæˆ‘å°±æ’è¿›å“ªä¸ªç»„ä»¶é‡Œï¼Œso easyï¼çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œä½ å°±æ˜ç™½äº†ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢å†™çš„ FriendStatus ç»„ä»¶ä¸­åˆ¤æ–­æœ‹å‹æ˜¯å¦åœ¨çº¿çš„åŠŸèƒ½æŠ½å‡ºæ¥ï¼Œæ–°å»ºä¸€ä¸ª useFriendStatus çš„ hook ä¸“é—¨ç”¨æ¥åˆ¤æ–­æŸä¸ª id æ˜¯å¦åœ¨çº¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function useFriendStatus(friendID) &#123;</span><br><span class="line">  const [isOnline, setIsOnline] = useState(null);</span><br><span class="line"></span><br><span class="line">  function handleStatusChange(status) &#123;</span><br><span class="line">    setIsOnline(status.isOnline);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return isOnline;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ FriendStatus ç»„ä»¶å°±å¯ä»¥ç®€å†™ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function FriendStatus(props) &#123;</span><br><span class="line">  const isOnline = useFriendStatus(props.friend.id);</span><br><span class="line"></span><br><span class="line">  if (isOnline === null) &#123;</span><br><span class="line">    return &apos;Loading...&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  return isOnline ? &apos;Online&apos; : &apos;Offline&apos;;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç®€ç›´ Perfectï¼å‡å¦‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆæœ‰ä¸€ä¸ªæœ‹å‹åˆ—è¡¨ä¹Ÿéœ€è¦æ˜¾ç¤ºæ˜¯å¦åœ¨çº¿çš„ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function FriendListItem(props) &#123;</span><br><span class="line">  const isOnline = useFriendStatus(props.friend.id);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;li style=&#123;&#123; color: isOnline ? &apos;green&apos; : &apos;black&apos; &#125;&#125;&gt;</span><br><span class="line">      &#123;props.friend.name&#125;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç®€ç›´ Fabulous!</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>ä¸çŸ¥é“ä½ é˜…è¯»å®Œæ•´ç¯‡æ–‡ç« çš„æ„Ÿå—å¦‚ä½•ï¼Œæˆ–è€…å¯¹ hooks æœ‰ä»»ä½•è§’åº¦çš„çœ‹æ³•å’Œæ€è€ƒéƒ½æ¬¢è¿åœ¨è¯„è®ºåŒºä¸€èµ·è®¨è®ºã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      30åˆ†é’Ÿç²¾é€šReact Hooks
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Git è®¾ç½®ä»£ç†å’Œå–æ¶ˆä»£ç†</title>
    <link href="https://andyxw.com/archives/a16d.html"/>
    <id>https://andyxw.com/archives/a16d.html</id>
    <published>2019-09-23T09:22:30.000Z</published>
    <updated>2019-09-23T09:26:30.555Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p>å¦‚æœä»£ç†ç±»å‹æ˜¯ socks5 è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy socks5://127.0.0.1:1080</span><br><span class="line">git config --global https.proxy socks5://127.0.0.1:1080</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæ˜¯æ™®é€šçš„ http/https è¿›è¡Œå¦‚ä¸‹è®¾ç½®å³å¯ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global https.proxy http://127.0.0.1:1080</span><br><span class="line">git config --global https.proxy https://127.0.0.1:1080</span><br></pre></td></tr></table></figure><p></p><p>å–æ¶ˆä»£ç†è®¾ç½®ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure><p></p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æé«˜ git clone é€Ÿåº¦
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</title>
    <link href="https://andyxw.com/archives/6df4.html"/>
    <id>https://andyxw.com/archives/6df4.html</id>
    <published>2019-09-04T13:10:11.000Z</published>
    <updated>2019-09-04T13:24:13.135Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">https://juejin.im/post/5d045350f265da1b695d5bf2</a></p></blockquote><p>æœ¬æ–‡æ¥æºäºå…¬å¸å†…éƒ¨çš„ä¸€æ¬¡é—ªç”µåˆ†äº«ï¼Œç¨ä½œæ¶¦è‰²åˆ†äº«å‡ºæ¥ã€‚ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚<strong>å¦‚æœä½ è§‰å¾—å¯ä»¥ï¼Œè¯·å¤šç‚¹èµï¼Œé¼“åŠ±æˆ‘å†™å‡ºæ›´ç²¾å½©çš„æ–‡ç« </strong>ğŸ™ã€‚</p><p>React æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ä¸‰ä¸ªæ–¹å‘ï¼Œå…¶å®ä¹Ÿé€‚ç”¨äºå…¶ä»–è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œè¿™ä¸‰ä¸ªæ–¹å‘åˆ†åˆ«æ˜¯:</p><ul><li><strong>å‡å°‘è®¡ç®—çš„é‡</strong>ã€‚ -&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ æˆ–è€… é™ä½ç»„ä»¶æ¸²æŸ“çš„å¤æ‚åº¦</strong></li><li><strong>åˆ©ç”¨ç¼“å­˜</strong>ã€‚-&gt; å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>å¦‚ä½•é¿å…é‡æ–°æ¸²æŸ“ï¼Œåˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ memo æ–¹å¼æ¥é¿å…ç»„ä»¶é‡æ–°æ¸²æŸ“</strong></li><li><strong>ç²¾ç¡®é‡æ–°è®¡ç®—çš„èŒƒå›´</strong>ã€‚ å¯¹åº”åˆ° React ä¸­å°±æ˜¯<strong>ç»‘å®šç»„ä»¶å’ŒçŠ¶æ€å…³ç³», ç²¾ç¡®åˆ¤æ–­æ›´æ–°çš„â€™æ—¶æœºâ€™å’Œâ€™èŒƒå›´â€™. åªé‡æ–°æ¸²æŸ“â€™è„â€™çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´é™ä½æ¸²æŸ“èŒƒå›´</strong></li></ul><p><strong>ç›®å½•</strong></p><ul><li><a href="#%E5%87%8F%E5%B0%91%E6%B8%B2%E6%9F%93%E7%9A%84%E8%8A%82%E7%82%B9%E9%99%8D%E4%BD%8E%E6%B8%B2%E6%9F%93%E8%AE%A1%E7%AE%97%E9%87%8F%E5%A4%8D%E6%9D%82%E5%BA%A6">å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ / é™ä½æ¸²æŸ“è®¡ç®—é‡ (å¤æ‚åº¦)</a><ul><li><a href="#0%EF%B8%8F%E2%83%A3-%E4%B8%8D%E8%A6%81%E5%9C%A8%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E9%83%BD%E8%BF%9B%E8%A1%8C%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E8%AE%A1%E7%AE%97">0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</a></li><li><a href="#1%EF%B8%8F%E2%83%A3-%E5%87%8F%E5%B0%91%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%B5%8C%E5%A5%97">1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</a></li><li><a href="#2%EF%B8%8F%E2%83%A3-%E8%99%9A%E6%8B%9F%E5%88%97%E8%A1%A8">2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</a></li><li><a href="#3%EF%B8%8F%E2%83%A3-%E6%83%B0%E6%80%A7%E6%B8%B2%E6%9F%93">3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</a></li><li><a href="#4%EF%B8%8F%E2%83%A3-%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E6%A0%B7%E5%BC%8F%E6%96%B9%E6%A1%88">4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</a></li></ul></li><li><a href="#%E9%81%BF%E5%85%8D%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93">é¿å…é‡æ–°æ¸²æŸ“</a><ul><li><a href="#0%EF%B8%8F%E2%83%A3-%E7%AE%80%E5%8C%96-props">0ï¸âƒ£ ç®€åŒ– props</a></li><li><a href="#1%EF%B8%8F%E2%83%A3-%E4%B8%8D%E5%8F%98%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8">1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</a></li><li><a href="#2%EF%B8%8F%E2%83%A3-%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE">2ï¸âƒ£ ä¸å¯å˜æ•°æ®</a></li><li><a href="#3%EF%B8%8F%E2%83%A3-%E7%AE%80%E5%8C%96-state">3ï¸âƒ£ ç®€åŒ– state</a></li><li><a href="#4%EF%B8%8F%E2%83%A3-%E4%BD%BF%E7%94%A8-recompose-%E7%B2%BE%E7%BB%86%E5%8C%96%E6%AF%94%E5%AF%B9">4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</a></li></ul></li><li><a href="#%E7%B2%BE%E7%BB%86%E5%8C%96%E6%B8%B2%E6%9F%93">ç²¾ç»†åŒ–æ¸²æŸ“</a><ul><li><a href="#0%EF%B8%8F%E2%83%A3-%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%9A%84%E7%B2%BE%E7%BB%86%E5%8C%96%E6%B8%B2%E6%9F%93">0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</a></li><li><a href="#1%EF%B8%8F%E2%83%A3-%E4%B8%8D%E8%A6%81%E6%BB%A5%E7%94%A8-context">1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</a></li></ul></li><li><a href="#%E6%89%A9%E5%B1%95">æ‰©å±•</a></li></ul><h2 id="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦"><a href="#å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹-é™ä½æ¸²æŸ“è®¡ç®—é‡-å¤æ‚åº¦" class="headerlink" title="å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ / é™ä½æ¸²æŸ“è®¡ç®—é‡ (å¤æ‚åº¦)"></a>å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ / é™ä½æ¸²æŸ“è®¡ç®—é‡ (å¤æ‚åº¦)</h2><p>é¦–å…ˆä»è®¡ç®—çš„é‡ä¸Šä¸‹åŠŸå¤«ï¼Œå‡å°‘èŠ‚ç‚¹æ¸²æŸ“çš„æ•°é‡æˆ–è€…é™ä½æ¸²æŸ“çš„è®¡ç®—é‡å¯ä»¥æ˜¾è‘—çš„æé«˜ç»„ä»¶æ¸²æŸ“æ€§èƒ½ã€‚</p><h3 id="0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"><a href="#0ï¸âƒ£-ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—" class="headerlink" title="0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—"></a>0ï¸âƒ£ ä¸è¦åœ¨æ¸²æŸ“å‡½æ•°éƒ½è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—</h3><p>æ¯”å¦‚ä¸è¦åœ¨æ¸²æŸ“å‡½æ•° (render) ä¸­è¿›è¡Œæ•°ç»„æ’åºã€æ•°æ®è½¬æ¢ã€è®¢é˜…äº‹ä»¶ã€åˆ›å»ºäº‹ä»¶å¤„ç†å™¨ç­‰ç­‰. <strong>æ¸²æŸ“å‡½æ•°ä¸­ä¸åº”è¯¥æ”¾ç½®å¤ªå¤šå‰¯ä½œç”¨</strong></p><h3 id="1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"><a href="#1ï¸âƒ£-å‡å°‘ä¸å¿…è¦çš„åµŒå¥—" class="headerlink" title="1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—"></a>1ï¸âƒ£ å‡å°‘ä¸å¿…è¦çš„åµŒå¥—</h3><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e532d863b10?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>æˆ‘ä»¬å›¢é˜Ÿæ˜¯é‡åº¦çš„ <code>styled-components</code> ç”¨æˆ·ï¼Œ<strong>å…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦è¿™ä¸ªç©æ„</strong>ï¼Œæ¯”å¦‚çº¯é™æ€çš„æ ·å¼è§„åˆ™ï¼Œä»¥åŠéœ€è¦é‡åº¦æ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ã€‚é™¤äº†æ€§èƒ½é—®é¢˜ï¼Œå¦å¤–ä¸€ä¸ªå›°æ‰°æˆ‘ä»¬çš„æ˜¯å®ƒå¸¦æ¥çš„èŠ‚ç‚¹åµŒå¥—åœ°ç‹± (å¦‚ä¸Šå›¾)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç†æ€§åœ°é€‰æ‹©ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚ä½¿ç”¨åŸç”Ÿçš„ CSSï¼Œå‡å°‘ React è¿è¡Œæ—¶çš„è´Ÿæ‹….</p><p><strong>ä¸€èˆ¬ä¸å¿…è¦çš„èŠ‚ç‚¹åµŒå¥—éƒ½æ˜¯æ»¥ç”¨é«˜é˜¶ç»„ä»¶ / RenderProps å¯¼è‡´çš„ã€‚æ‰€ä»¥è¿˜æ˜¯é‚£å¥è¯â€˜åªæœ‰åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ xxxâ€™</strong>ã€‚ æœ‰å¾ˆå¤šç§æ–¹å¼æ¥ä»£æ›¿é«˜é˜¶ç»„ä»¶ / RenderPropsï¼Œä¾‹å¦‚ä¼˜å…ˆä½¿ç”¨ propsã€React Hooks</p><h3 id="2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨"><a href="#2ï¸âƒ£-è™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨"></a>2ï¸âƒ£ è™šæ‹Ÿåˆ—è¡¨</h3><p>è™šæ‹Ÿåˆ—è¡¨æ˜¯å¸¸è§çš„â€˜é•¿åˆ—è¡¨â€™å’Œâ€™å¤æ‚ç»„ä»¶æ ‘â€™ä¼˜åŒ–æ–¹å¼ï¼Œå®ƒä¼˜åŒ–çš„æœ¬è´¨å°±æ˜¯å‡å°‘æ¸²æŸ“çš„èŠ‚ç‚¹ã€‚</p><p>è™šæ‹Ÿåˆ—è¡¨åªæ¸²æŸ“å½“å‰è§†å£å¯è§å…ƒç´ :</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e532e72f064?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è™šæ‹Ÿåˆ—è¡¨æ¸²æŸ“æ€§èƒ½å¯¹æ¯”:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e532ca493d0?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è™šæ‹Ÿåˆ—è¡¨å¸¸ç”¨äºä»¥ä¸‹ç»„ä»¶åœºæ™¯:</p><ul><li>æ— é™æ»šåŠ¨åˆ—è¡¨ï¼Œgrid, è¡¨æ ¼ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼Œspreadsheets</li><li>æ— é™åˆ‡æ¢çš„æ—¥å†æˆ–è½®æ’­å›¾</li><li>å¤§æ•°æ®é‡æˆ–æ— é™åµŒå¥—çš„æ ‘</li><li>èŠå¤©çª—ï¼Œæ•°æ®æµ (feed), æ—¶é—´è½´</li><li>ç­‰ç­‰</li></ul><p>ç›¸å…³ç»„ä»¶æ–¹æ¡ˆ:</p><ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fbvaughn%2Freact-virtualized" target="_blank" rel="noopener">react-virtualized</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fbvaughn%2Freact-window" target="_blank" rel="noopener">react-window</a> æ›´è½»é‡çš„ react-virtualized, åŒå‡ºä¸€ä¸ªä½œè€…</li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fbvaughn%2Freact-virtualized%23friends" target="_blank" rel="noopener">æ›´å¤š</a></li></ul><p>æ‰©å±•ï¼š</p><ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Fbvaughn.github.io%2Fforward-js-2017%2F%23%2F0%2F0" target="_blank" rel="noopener">Creating more efficient React views with windowing</a></li><li><a href="https://link.juejin.im?target=https%3A%2F%2Faddyosmani.com%2Fblog%2Freact-window%2F" target="_blank" rel="noopener">Rendering large lists with react-window</a></li></ul><h3 id="3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“"><a href="#3ï¸âƒ£-æƒ°æ€§æ¸²æŸ“" class="headerlink" title="3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“"></a>3ï¸âƒ£ æƒ°æ€§æ¸²æŸ“</h3><p><strong>æƒ°æ€§æ¸²æŸ“çš„åˆè¡·æœ¬è´¨ä¸Šå’Œè™šè¡¨ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªåœ¨å¿…è¦æ—¶æ‰å»æ¸²æŸ“å¯¹åº”çš„èŠ‚ç‚¹</strong>ã€‚</p><p>ä¸¾ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸¸ç”¨ Tab ç»„ä»¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸€å¼€å§‹å°±å°†æ‰€æœ‰ Tab çš„ panel éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œæ˜¯ç­‰åˆ°è¯¥ Tab è¢«æ¿€æ´»æ—¶æ‰å»æƒ°æ€§æ¸²æŸ“ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šåœºæ™¯ä¼šç”¨åˆ°æƒ°æ€§æ¸²æŸ“ï¼Œä¾‹å¦‚æ ‘å½¢é€‰æ‹©å™¨ï¼Œæ¨¡æ€å¼¹çª—ï¼Œä¸‹æ‹‰åˆ—è¡¨ï¼ŒæŠ˜å ç»„ä»¶ç­‰ç­‰ã€‚</p><p>è¿™é‡Œå°±ä¸ä¸¾å…·ä½“çš„ä»£ç ä¾‹å­äº†ï¼Œç•™ç»™è¯»è€…å»æ€è€ƒ.</p><h3 id="4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"><a href="#4ï¸âƒ£-é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ" class="headerlink" title="4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ"></a>4ï¸âƒ£ é€‰æ‹©åˆé€‚çš„æ ·å¼æ–¹æ¡ˆ</h3><p><img src="https://user-gold-cdn.xitu.io/2019/6/16/16b5dd10a46eceb2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>å¦‚å›¾ (å›¾ç‰‡æ¥æºäº <a href="https://link.juejin.im?target=https%3A%2F%2Fblog.primehammer.com%2Fthe-performance-of-styled-react-components%2F" target="_blank" rel="noopener">THE PERFORMANCE OF STYLED REACT COMPONENTS</a>), è¿™ä¸ªå›¾ç‰‡æ˜¯ 17 å¹´çš„äº†ï¼Œä½†æ˜¯å¤§æŠµçš„è¶‹åŠ¿è¿˜æ˜¯è¿™æ ·ã€‚</p><p>æ‰€ä»¥åœ¨æ ·å¼è¿è¡Œæ—¶æ€§èƒ½æ–¹é¢å¤§æ¦‚å¯ä»¥æ€»ç»“ä¸ºï¼š<code>CSS &gt; å¤§éƒ¨åˆ†CSS-in-js &gt; inline style</code></p><h2 id="é¿å…é‡æ–°æ¸²æŸ“"><a href="#é¿å…é‡æ–°æ¸²æŸ“" class="headerlink" title="é¿å…é‡æ–°æ¸²æŸ“"></a>é¿å…é‡æ–°æ¸²æŸ“</h2><p>å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ä¹Ÿæ˜¯ React ç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹å‘. ä¸ºäº†é¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡æ–°æ¸²æŸ“éœ€è¦åœ¨åšåˆ°ä¸¤ç‚¹:</p><ol><li>ä¿è¯ç»„ä»¶çº¯ç²¹æ€§ã€‚å³æ§åˆ¶ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œå¦‚æœç»„ä»¶æœ‰å‰¯ä½œç”¨åˆ™æ— æ³•å®‰å…¨åœ°ç¼“å­˜æ¸²æŸ“ç»“æœ</li><li>é€šè¿‡<code>shouldComponentUpdate</code>ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ¥æ¯”å¯¹ state å’Œ props, ç¡®å®šæ˜¯å¦è¦é‡æ–°æ¸²æŸ“ã€‚å¯¹äºå‡½æ•°ç»„ä»¶å¯ä»¥ä½¿ç”¨<code>React.memo</code>åŒ…è£…</li></ol><p>å¦å¤–è¿™äº›æªæ–½ä¹Ÿå¯ä»¥å¸®åŠ©ä½ æ›´å®¹æ˜“åœ°ä¼˜åŒ–ç»„ä»¶é‡æ–°æ¸²æŸ“:</p><h3 id="0ï¸âƒ£-ç®€åŒ–-props"><a href="#0ï¸âƒ£-ç®€åŒ–-props" class="headerlink" title="0ï¸âƒ£ ç®€åŒ– props"></a>0ï¸âƒ£ ç®€åŒ– props</h3><p><strong>â‘  å¦‚æœä¸€ä¸ªç»„ä»¶çš„ props å¤ªå¤æ‚ä¸€èˆ¬æ„å‘³ç€è¿™ä¸ªç»„ä»¶å·²ç»è¿èƒŒäº†â€˜å•ä¸€èŒè´£â€™ï¼Œé¦–å…ˆåº”è¯¥å°è¯•å¯¹ç»„ä»¶è¿›è¡Œæ‹†è§£</strong>. <strong>â‘¡ å¦å¤–å¤æ‚çš„ props ä¹Ÿä¼šå˜å¾—éš¾ä»¥ç»´æŠ¤, æ¯”å¦‚ä¼šå½±å“<code>shallowCompare</code>æ•ˆç‡, è¿˜ä¼šè®©ç»„ä»¶çš„å˜åŠ¨å˜å¾—éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•</strong>.</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­, ä¸ºäº†åˆ¤æ–­åˆ—è¡¨é¡¹æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œè¿™é‡Œä¼ å…¥äº†ä¸€ä¸ªå½“å‰æ¿€æ´»çš„ id:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53250b584f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç³Ÿç³•çš„è®¾è®¡ï¼Œä¸€æ—¦æ¿€æ´» id å˜åŠ¨ï¼Œæ‰€æœ‰åˆ—è¡¨é¡¹éƒ½ä¼šé‡æ–°åˆ·æ–°. æ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ç±»ä¼¼<code>actived</code>è¿™æ ·çš„å¸ƒå°”å€¼ prop. actived ç°åœ¨åªæœ‰ä¸¤ç§å˜åŠ¨æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´æ¿€æ´» id çš„å˜åŠ¨ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“.</p><p><strong>ç®€åŒ–çš„ props æ›´å®¹æ˜“ç†è§£, ä¸”å¯ä»¥æé«˜ç»„ä»¶ç¼“å­˜çš„å‘½ä¸­ç‡</strong></p><h3 id="1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"><a href="#1ï¸âƒ£-ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨" class="headerlink" title="1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨"></a>1ï¸âƒ£ ä¸å˜çš„äº‹ä»¶å¤„ç†å™¨</h3><p>â‘ <strong>é¿å…ä½¿ç”¨ç®­å¤´å‡½æ•°å½¢å¼çš„äº‹ä»¶å¤„ç†å™¨</strong>, ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;ComplexComponent onClick=&#123;evt =&gt; onClick(evt.id)&#125; otherProps=&#123;values&#125; /&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å‡è®¾ ComplexComponent æ˜¯ä¸€ä¸ªå¤æ‚çš„ PureComponent, è¿™é‡Œä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå…¶å®æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¼šå¯¼è‡´ ComplexComponent å§‹ç»ˆä¼šè¢«é‡æ–°æ¸²æŸ“.</p><p>æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨å®ä¾‹æ–¹æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class MyComponent extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    &lt;ComplexComponent onClick=&#123;this.handleClick&#125; otherProps=&#123;values&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleClick = () =&gt; &#123;</span><br><span class="line">    /*...*/</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>â‘¡ å³ä½¿ç°åœ¨ä½¿ç”¨<code>hooks</code>ï¼Œæˆ‘ä¾ç„¶ä¼š<strong>ä½¿ç”¨<code>useCallback</code>æ¥åŒ…è£…äº‹ä»¶å¤„ç†å™¨</strong>ï¼Œå°½é‡ç»™ä¸‹çº§ç»„ä»¶æš´éœ²ä¸€ä¸ªé™æ€çš„å‡½æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const handleClick = useCallback(() =&gt; &#123;</span><br><span class="line">  /*...*/</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">return &lt;ComplexComponent onClick=&#123;handleClick&#125; otherProps=&#123;values&#125; /&gt;;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœ<code>useCallback</code>ä¾èµ–äºå¾ˆå¤šçŠ¶æ€ï¼Œä½ çš„<code>useCallback</code>å¯èƒ½ä¼šå˜æˆè¿™æ ·:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const handleClick = useCallback(() =&gt; &#123;</span><br><span class="line">  /*...*/</span><br><span class="line">  // ğŸ¤­</span><br><span class="line">&#125;, [foo, bar, baz, bazz, bazzzz]);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å®åœ¨è®©äººéš¾ä»¥æ¥å—ï¼Œè¿™æ—¶å€™è°è¿˜ç®¡ä»€ä¹ˆå‡½æ•°å¼éå‡½æ•°å¼çš„ã€‚æˆ‘æ˜¯è¿™æ ·å¤„ç†çš„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function useRefProps&lt;T&gt;(props: T) &#123;</span><br><span class="line">  const ref = useRef &lt; T &gt; props;</span><br><span class="line">  // æ¯æ¬¡æ¸²æŸ“æ›´æ–°props</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ref.current = props;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function MyComp(props) &#123;</span><br><span class="line">  const propsRef = useRefProps(props);</span><br><span class="line"></span><br><span class="line">  // ç°åœ¨handleClickæ˜¯å§‹ç»ˆä¸å˜çš„</span><br><span class="line">  const handleClick = useCallback(() =&gt; &#123;</span><br><span class="line">    const &#123; foo, bar, baz, bazz, bazzzz &#125; = propsRef.current;</span><br><span class="line">    // do something</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>â‘¢<strong>è®¾è®¡æ›´æ–¹ä¾¿å¤„ç†çš„ Event Props</strong>. æœ‰æ—¶å€™æˆ‘ä»¬ä¼šè¢«é€¼çš„ä¸å¾—ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥ä½œä¸ºäº‹ä»¶å¤„ç†å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;List&gt;</span><br><span class="line">  &#123;list.map(i =&gt; (</span><br><span class="line">    &lt;Item key=&#123;i.id&#125; onClick=&#123;() =&gt; handleDelete(i.id)&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">  ))&#125;</span><br><span class="line">&lt;/List&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ onClick æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å®ç°ï¼Œå®ƒæ²¡æœ‰æºå¸¦ä»»ä½•ä¿¡æ¯æ¥æ ‡è¯†äº‹ä»¶æ¥æºï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½ä½¿ç”¨é—­åŒ…å½¢å¼ï¼Œæ›´å¥½çš„è®¾è®¡å¯èƒ½æ˜¯è¿™æ ·çš„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// onClickä¼ é€’äº‹ä»¶æ¥æºä¿¡æ¯</span><br><span class="line">const handleDelete = useCallback((id: string) =&gt; &#123;</span><br><span class="line">  /*åˆ é™¤æ“ä½œ*/</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">return (</span><br><span class="line">  &lt;List&gt;</span><br><span class="line">    &#123;list.map(i =&gt; (</span><br><span class="line">      &lt;Item key=&#123;i.id&#125; id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;/List&gt;</span><br><span class="line">);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–è€… DOM ç»„ä»¶å‘¢? å®åœ¨ä¸è¡Œï¼Œçœ‹èƒ½ä¸èƒ½ä¼ é€’<code>data-*</code>å±æ€§:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const handleDelete = useCallback(event =&gt; &#123;</span><br><span class="line">  const id = event.dataset.id;</span><br><span class="line">  /*åˆ é™¤æ“ä½œ*/</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">return (</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &#123;list.map(i =&gt; (</span><br><span class="line">      &lt;li key=&#123;i.id&#125; data-id=&#123;i.id&#125; onClick=&#123;handleDelete&#125; value=&#123;i.value&#125; /&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h3 id="2ï¸âƒ£-ä¸å¯å˜æ•°æ®"><a href="#2ï¸âƒ£-ä¸å¯å˜æ•°æ®" class="headerlink" title="2ï¸âƒ£ ä¸å¯å˜æ•°æ®"></a>2ï¸âƒ£ ä¸å¯å˜æ•°æ®</h3><p>ä¸å¯å˜æ•°æ®å¯ä»¥è®©çŠ¶æ€å˜å¾—å¯é¢„æµ‹ï¼Œä¹Ÿè®© shouldComponentUpdate â€˜æµ…æ¯”è¾ƒâ€™å˜å¾—æ›´å¯é å’Œé«˜æ•ˆ. ç¬”è€…åœ¨ <a href="https://juejin.im/post/5cdc2f54e51d453b0c35930d#heading-8" target="_blank" rel="noopener">React ç»„ä»¶è®¾è®¡å®è·µæ€»ç»“ 04 - ç»„ä»¶çš„æ€ç»´</a>ä»‹ç»è¿‡ä¸å¯å˜æ•°æ®ï¼Œæœ‰å…´è¶£è¯»è€…å¯ä»¥çœ‹çœ‹.</p><p>ç›¸å…³çš„å·¥å…·æœ‰ <a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Fimmutable-js" target="_blank" rel="noopener">Immutable.js</a>ã€<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fmweststrate%2Fimmer" target="_blank" rel="noopener">Immer</a>ã€immutability-helper ä»¥åŠ seamless-immutableã€‚</p><h3 id="3ï¸âƒ£-ç®€åŒ–-state"><a href="#3ï¸âƒ£-ç®€åŒ–-state" class="headerlink" title="3ï¸âƒ£ ç®€åŒ– state"></a>3ï¸âƒ£ ç®€åŒ– state</h3><p><strong>ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ”¾åœ¨ç»„ä»¶çš„ state ä¸­</strong>. ä¾‹å¦‚ç¼“å­˜æ•°æ®ã€‚æŒ‰ç…§æˆ‘çš„åŸåˆ™æ˜¯ï¼š<strong>å¦‚æœéœ€è¦ç»„ä»¶å“åº”å®ƒçš„å˜åŠ¨, æˆ–è€…éœ€è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­çš„æ•°æ®æ‰åº”è¯¥æ”¾åˆ° state ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å˜åŠ¨å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“.</strong></p><h3 id="4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹"><a href="#4ï¸âƒ£-ä½¿ç”¨-recompose-ç²¾ç»†åŒ–æ¯”å¯¹" class="headerlink" title="4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹"></a>4ï¸âƒ£ ä½¿ç”¨ recompose ç²¾ç»†åŒ–æ¯”å¯¹</h3><p>å°½ç®¡ hooks å‡ºæ¥åï¼Œrecompose å®£ç§°ä¸å†æ›´æ–°äº†ï¼Œä½†è¿˜æ˜¯ä¸å½±å“æˆ‘ä»¬ä½¿ç”¨ recompose æ¥æ§åˆ¶<code>shouldComponentUpdate</code>æ–¹æ³•, æ¯”å¦‚å®ƒæä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥ç²¾ç»†æ§åˆ¶åº”è¯¥æ¯”è¾ƒå“ªäº› props:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> /* ç›¸å½“äºReact.memo */</span><br><span class="line"> pure()</span><br><span class="line"> /* è‡ªå®šä¹‰æ¯”è¾ƒ */</span><br><span class="line"> shouldUpdate(test: (props: Object, nextProps: Object) =&gt; boolean): HigherOrderComponent</span><br><span class="line"> /* åªæ¯”è¾ƒæŒ‡å®škey */</span><br><span class="line"> onlyUpdateForKeys( propKeys: Array&lt;string&gt;): HigherOrderComponent</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜å¯ä»¥å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¯”å¦‚<code>omitUpdateForKeys</code>å¿½ç•¥æ¯”å¯¹æŸäº› key.</p><h2 id="ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="ç²¾ç»†åŒ–æ¸²æŸ“"></a>ç²¾ç»†åŒ–æ¸²æŸ“</h2><p>æ‰€è°“ç²¾ç»†åŒ–æ¸²æŸ“æŒ‡çš„æ˜¯<strong>åªæœ‰ä¸€ä¸ªæ•°æ®æ¥æºå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</strong>, æ¯”å¦‚è¯´ A åªä¾èµ–äº a æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰åœ¨ a æ•°æ®å˜åŠ¨æ—¶æ‰æ¸²æŸ“ A, å…¶ä»–çŠ¶æ€å˜åŒ–ä¸åº”è¯¥å½±å“ç»„ä»¶ Aã€‚</p><p>Vue å’Œ Mobx å®£ç§°è‡ªå·±æ€§èƒ½å¥½çš„ä¸€éƒ¨åˆ†åŸå› æ˜¯å®ƒä»¬çš„â€™å“åº”å¼ç³»ç»Ÿâ€™, <strong>å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€äº›â€˜å“åº”å¼æ•°æ®â€™ï¼Œå½“è¿™äº›å“åº”æ•°æ®å˜åŠ¨æ—¶ï¼Œä¾èµ–è¿™äº›å“åº”å¼æ•°æ®è§†å›¾å°±ä¼šé‡æ–°æ¸²æŸ“</strong>. æ¥çœ‹çœ‹ Vue å®˜æ–¹æ˜¯å¦‚ä½•æè¿°çš„:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e532d4abd3c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><h3 id="0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#0ï¸âƒ£-å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“"></a>0ï¸âƒ£ å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ¸²æŸ“</h3><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå“åº”å¼æ•°æ®å¯ä»¥å®ç°è§†å›¾ç²¾ç»†åŒ–çš„æ¸²æŸ“, ä½†å®ƒè¿˜æ˜¯ä¸èƒ½é¿å…å¼€å‘è€…å†™å‡ºä½æ•ˆçš„ç¨‹åº</strong>. <strong>æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºç»„ä»¶è¿èƒŒâ€˜å•ä¸€èŒè´£â€™</strong>.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰ä¸€ä¸ª MyComponent ç»„ä»¶ï¼Œä¾èµ–äº Aã€Bã€C ä¸‰ä¸ªæ•°æ®æºï¼Œæ¥æ„å»ºä¸€ä¸ª vdom æ ‘ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨åªè¦ Aã€Bã€C ä»»æ„ä¸€ä¸ªå˜åŠ¨ï¼Œé‚£ä¹ˆ MyComponent æ•´ä¸ªå°±ä¼šé‡æ–°æ¸²æŸ“:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e532546f6d6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>æ›´å¥½çš„åšæ³•æ˜¯è®©ç»„ä»¶çš„èŒè´£æ›´å•ä¸€ï¼Œç²¾ç»†åŒ–åœ°ä¾èµ–å“åº”å¼æ•°æ®ï¼Œæˆ–è€…è¯´å¯¹å“åº”å¼æ•°æ®è¿›è¡Œâ€˜éš”ç¦»â€™. å¦‚ä¸‹å›¾, Aã€Bã€C éƒ½æŠ½å–å„è‡ªçš„ç»„ä»¶ä¸­äº†ï¼Œç°åœ¨ A å˜åŠ¨åªä¼šæ¸²æŸ“ A ç»„ä»¶æœ¬èº«ï¼Œè€Œä¸ä¼šå½±å“çˆ¶ç»„ä»¶å’Œ Bã€C ç»„ä»¶:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53ae748821?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œåˆ—è¡¨æ¸²æŸ“:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; observable &#125; from &apos;mobx&apos;;</span><br><span class="line">import &#123; observer &#125; from &apos;mobx-react-lite&apos;;</span><br><span class="line"></span><br><span class="line">const initialList = [];</span><br><span class="line">for (let i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">  initialList.push(&#123; id: i, name: `name-$&#123;i&#125;`, value: 0 &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const store = observable(&#123;</span><br><span class="line">  list: initialList,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export const List = observer(() =&gt; &#123;</span><br><span class="line">  const list = store.list;</span><br><span class="line">  console.log(&apos;Listæ¸²æŸ“&apos;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map((i, idx) =&gt; (</span><br><span class="line">          &lt;div class key=&#123;i.id&#125;&gt;</span><br><span class="line">            &#123;/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */&#125;</span><br><span class="line">            &#123;console.log(&apos;render&apos;, i.id)&#125;</span><br><span class="line">            &lt;span class&gt;&#123;i.name&#125; &lt;/span&gt;</span><br><span class="line">            &lt;span class&gt;&#123;i.value&#125; &lt;/span&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              class</span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                i.value++;</span><br><span class="line">                console.log(&apos;é€’å¢&apos;);</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              é€’å¢</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">              class</span><br><span class="line">              onClick=&#123;() =&gt; &#123;</span><br><span class="line">                if (idx &lt; list.length - 1) &#123;</span><br><span class="line">                  console.log(&apos;ç§»ä½&apos;);</span><br><span class="line">                  let t = list[idx];</span><br><span class="line">                  list[idx] = list[idx + 1];</span><br><span class="line">                  list[idx + 1] = t;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              ä¸‹ç§»</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ä¾‹å­æ˜¯å­˜åœ¨æ€§èƒ½é—®é¢˜çš„ï¼Œå•ä¸ª list-item çš„é€’å¢å’Œç§»ä½éƒ½ä¼šå¯¼è‡´æ•´ä¸ªåˆ—è¡¨çš„é‡æ–°æ¸²æŸ“:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53c9978c97?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>åŸå› å¤§æ¦‚èƒ½çŒœå‡ºæ¥å§? å¯¹äº Vue æˆ–è€… Mobx æ¥è¯´ï¼Œ<strong>ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å°±æ˜¯ä¸€ä¸ªä¾èµ–æ”¶é›†çš„ä¸Šä¸‹æ–‡</strong>ã€‚ä¸Šé¢ List ç»„ä»¶æ¸²æŸ“å‡½æ•°å†…â€™è®¿é—®â€™äº†æ‰€æœ‰çš„åˆ—è¡¨é¡¹æ•°æ®ï¼Œé‚£ä¹ˆ Vue æˆ– Mobx å°±ä¼šè®¤ä¸ºä½ è¿™ä¸ªç»„ä»¶ä¾èµ–äºæ‰€æœ‰çš„åˆ—è¡¨é¡¹ï¼Œè¿™æ ·å°±å¯¼è‡´ï¼Œåªè¦ä»»æ„ä¸€ä¸ªåˆ—è¡¨é¡¹çš„å±æ€§å€¼å˜åŠ¨å°±ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ª List ç»„ä»¶ã€‚</p><p>è§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†æ•°æ®éš”ç¦»æŠ½å–åˆ°å•ä¸€èŒè´£çš„ç»„ä»¶ä¸­ã€‚<strong>å¯¹äº Vue æˆ– Mobx æ¥è¯´ï¼Œè¶Šç»†ç²’åº¦çš„ç»„ä»¶ï¼Œå¯ä»¥æ”¶è·æ›´é«˜çš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœ</strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">export const ListItem = observer(props =&gt; &#123;</span><br><span class="line">  const &#123; item, onShiftDown &#125; = props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div class&gt;</span><br><span class="line">      &#123;console.log(&apos;render&apos;, item.id)&#125;</span><br><span class="line">      &#123;/* å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ */&#125;</span><br><span class="line">      &lt;span class&gt;&#123;item.name&#125; &lt;/span&gt;</span><br><span class="line">      &lt;span class&gt;&#123;item.value&#125; &lt;/span&gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        class</span><br><span class="line">        onClick=&#123;() =&gt; &#123;</span><br><span class="line">          item.value++;</span><br><span class="line">          console.log(&apos;é€’å¢&apos;);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        é€’å¢</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button class onClick=&#123;() =&gt; onShiftDown(item)&#125;&gt;</span><br><span class="line">        ä¸‹ç§»</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export const List = observer(() =&gt; &#123;</span><br><span class="line">  const list = store.list;</span><br><span class="line">  const handleShiftDown = useCallback(item =&gt; &#123;</span><br><span class="line">    const idx = list.findIndex(i =&gt; i.id === item.id);</span><br><span class="line">    if (idx !== -1 &amp;&amp; idx &lt; list.length - 1) &#123;</span><br><span class="line">      console.log(&apos;ç§»ä½&apos;);</span><br><span class="line">      let t = list[idx];</span><br><span class="line">      list[idx] = list[idx + 1];</span><br><span class="line">      list[idx + 1] = t;</span><br><span class="line">    &#125;</span><br><span class="line">    // eslint-disable-next-line react-hooks/exhaustive-deps</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  console.log(&apos;List æ¸²æŸ“&apos;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div class&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;list.map((i, idx) =&gt; (</span><br><span class="line">          &lt;ListItem key=&#123;i.id&#125; item=&#123;i&#125; onShiftDown=&#123;handleShiftDown&#125; /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ•ˆæœå¾ˆæ˜æ˜¾, list-item é€’å¢åªä¼šé‡æ–°æ¸²æŸ“æœ¬èº«; è€Œç§»ä½åªä¼šé‡æ–°æ¸²æŸ“ Listï¼Œ å› ä¸ºåˆ—è¡¨é¡¹æ²¡æœ‰å˜åŠ¨, æ‰€ä»¥ä¸‹çº§ list-item ä¹Ÿä¸éœ€è¦é‡æ–°æ¸²æŸ“:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53aea289bf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><h3 id="1ï¸âƒ£-ä¸è¦æ»¥ç”¨-Context"><a href="#1ï¸âƒ£-ä¸è¦æ»¥ç”¨-Context" class="headerlink" title="1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context"></a>1ï¸âƒ£ ä¸è¦æ»¥ç”¨ Context</h3><p><strong>å…¶å® Context çš„ç”¨æ³•å’Œå“åº”å¼æ•°æ®æ­£å¥½ç›¸å</strong>ã€‚ç¬”è€…ä¹Ÿçœ‹è¿‡ä¸å°‘æ»¥ç”¨ Context API çš„ä¾‹å­, è¯´åˆ°åº•è¿˜æ˜¯æ²¡æœ‰å¤„ç†å¥½â€˜çŠ¶æ€çš„ä½œç”¨åŸŸé—®é¢˜â€™.</p><p>é¦–å…ˆè¦ç†è§£ Context API çš„æ›´æ–°ç‰¹ç‚¹ï¼Œ<strong>å®ƒæ˜¯å¯ä»¥ç©¿é€<code>React.memo</code>æˆ–è€…<code>shouldComponentUpdate</code>çš„æ¯”å¯¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä¾èµ–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdate</strong>.</p><p><strong>è¿™ä¸ªå’Œ Mobx å’Œ Vue çš„å“åº”å¼ç³»ç»Ÿä¸åŒï¼ŒContext API å¹¶ä¸èƒ½ç»†ç²’åº¦åœ°æ£€æµ‹å“ªäº›ç»„ä»¶ä¾èµ–å“ªäº›çŠ¶æ€ï¼Œæ‰€ä»¥è¯´ä¸ŠèŠ‚æåˆ°çš„â€˜ç²¾ç»†åŒ–æ¸²æŸ“â€™ç»„ä»¶æ¨¡å¼ï¼Œåœ¨ Context è¿™é‡Œå°±æˆä¸ºäº†â€˜åæ¨¡å¼â€™</strong>.</p><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ Context API è¦éµå¾ªä¸€ä¸‹åŸåˆ™:</p><ul><li><p><strong>æ˜ç¡®çŠ¶æ€ä½œç”¨åŸŸ, Context åªæ”¾ç½®å¿…è¦çš„ï¼Œå…³é”®çš„ï¼Œè¢«å¤§å¤šæ•°ç»„ä»¶æ‰€å…±äº«çš„çŠ¶æ€</strong>ã€‚æ¯”è¾ƒå…¸å‹çš„æ˜¯é‰´æƒçŠ¶æ€</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53c17cd5e1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53c9bdc0b3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p><p>æ‰©å±•ï¼šContext å…¶å®æœ‰ä¸ªå®éªŒæ€§æˆ–è€…è¯´éå…¬å¼€çš„é€‰é¡¹<code>observedBits</code>, å¯ä»¥ç”¨äºæ§åˆ¶ ContextConsumer æ˜¯å¦éœ€è¦æ›´æ–°. è¯¦ç»†å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  &lt;<a href="https://link.juejin.im?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F51073183" target="_blank" rel="noopener">ObservedBits: React Context çš„ç§˜å¯†åŠŸèƒ½</a> &gt;. ä¸è¿‡ä¸æ¨èåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ª API ä¹Ÿæ¯”è¾ƒéš¾ç”¨ï¼Œä¸å¦‚ç›´æ¥ä¸Š mobxã€‚</p></li><li><p><strong>ç²—ç²’åº¦åœ°è®¢é˜… Context</strong></p><p>å¦‚ä¸‹å›¾. ç»†ç²’åº¦çš„ Context è®¢é˜…ä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“, æ‰€ä»¥è¿™é‡Œæ¨èç²—ç²’åº¦çš„è®¢é˜…. æ¯”å¦‚åœ¨çˆ¶çº§è®¢é˜… Contextï¼Œç„¶åå†é€šè¿‡ props ä¼ é€’ç»™ä¸‹çº§ã€‚</p><p><img src="https://user-gold-cdn.xitu.io/2019/6/15/16b58e53c08a377e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt=""></p></li></ul><p>å¦å¤–ç¨‹å¢¨ Morgan åœ¨<a href="https://link.juejin.im?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F50336226" target="_blank" rel="noopener">é¿å… React Context å¯¼è‡´çš„é‡å¤æ¸²æŸ“</a>ä¸€æ–‡ä¸­ä¹Ÿæåˆ° ContextAPI çš„ä¸€ä¸ªé™·é˜±:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context.Provider</span><br><span class="line">  value=&#123;&#123; theme: this.state.theme, switchTheme: this.switchTheme &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;div class&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;Content /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/Context.Provider&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç»„ä»¶ä¼šåœ¨ state å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œè‡³äºä¸ºä»€ä¹ˆç•™ç»™è¯»è€…å»æ€è€ƒã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¸ä¼šè£¸éœ²åœ°ä½¿ç”¨ Context.Provider, è€Œæ˜¯å°è£…ä¸ºç‹¬ç«‹çš„ Provider ç»„ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export function ThemeProvider(props) &#123;</span><br><span class="line">  const [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  return (</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/Context.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é¡ºä¾¿æš´éœ²useTheme, è®©å¤–éƒ¨å¿…é¡»ç›´æ¥ä½¿ç”¨Context</span><br><span class="line">export function useTheme() &#123;</span><br><span class="line">  return useContext(Context);</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ç°åœ¨ theme å˜åŠ¨å°±ä¸ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶æ ‘ï¼Œå› ä¸º props.children ç”±å¤–éƒ¨ä¼ é€’è¿›æ¥ï¼Œå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ã€‚</p><p><strong>å…¶å®ä¸Šé¢çš„ä»£ç è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¯”è¾ƒéš¾å‘ç°çš„é™·é˜± (å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰<a href="https://link.juejin.im?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fcontext.html%23caveats" target="_blank" rel="noopener">æåˆ°</a>)</strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function ThemeProvider(props) &#123;</span><br><span class="line">  const [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  return (</span><br><span class="line">    &#123;/* ğŸ‘‡ ğŸ’£è¿™é‡Œæ¯ä¸€æ¬¡æ¸²æŸ“ThemeProvider, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„value(å³ä½¿themeå’ŒswitchThemeæ²¡æœ‰å˜åŠ¨),</span><br><span class="line">        ä»è€Œå¯¼è‡´å¼ºåˆ¶æ¸²æŸ“æ‰€æœ‰ä¾èµ–è¯¥Contextçš„ç»„ä»¶ */&#125;</span><br><span class="line">    &lt;Context.Provider value=&#123;&#123; theme, switchTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;/Context.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>æ‰€ä»¥<strong>ä¼ é€’ç»™ Context çš„ value æœ€å¥½åšä¸€ä¸‹ç¼“å­˜</strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export function ThemeProvider(props) &#123;</span><br><span class="line">  const [theme, switchTheme] = useState(redTheme);</span><br><span class="line">  const value = useMemo(() =&gt; (&#123; theme, switchTheme &#125;), [theme]);</span><br><span class="line">  return &lt;Context.Provider value=&#123;value&#125;&gt;&#123;props.children&#125;&lt;/Context.Provider&gt;;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://link.juejin.im?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Foptimizing-performance.html" target="_blank" rel="noopener">Optimizing Performance</a> React å®˜æ–¹æ–‡æ¡£ï¼Œæœ€å¥½çš„æ•™ç¨‹, åˆ©ç”¨å¥½ React çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</li><li><a href="https://link.juejin.im?target=https%3A%2F%2Fmedium.com%2F%40paularmstrong%2Ftwitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3" target="_blank" rel="noopener">Twitter Lite and High Performance React Progressive Web Apps at Scale</a> çœ‹çœ‹ Twitter å¦‚ä½•ä¼˜åŒ–çš„</li></ul><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      ä¸»è¦è®¨è®º React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å°æŠ€å·§ã€‚
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="https://andyxw.com/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>ç²¾è¯»ã€ŠFunction VS Class ç»„ä»¶ã€‹</title>
    <link href="https://andyxw.com/archives/ecb7.html"/>
    <id>https://andyxw.com/archives/ecb7.html</id>
    <published>2019-09-04T13:08:02.000Z</published>
    <updated>2019-09-04T13:22:48.998Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://zhuanlan.zhihu.com/p/59558396" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/59558396</a></p></blockquote><ol><li>å¼•è¨€</li></ol><hr><p>ä¸ºä»€ä¹ˆè¦äº†è§£ Function å†™æ³•çš„ç»„ä»¶å‘¢ï¼Ÿå› ä¸ºå®ƒæ­£åœ¨å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚</p><p>é‚£ä¹ˆ React ä¸­ <strong>Function Component ä¸ Class Component æœ‰ä½•ä¸åŒï¼Ÿ</strong></p><p><a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">how-are-function-components-different-from-classes</a> è¿™ç¯‡æ–‡ç« å¸¦æ¥äº†ä¸€ä¸ªç‹¬ç‰¹çš„è§†è§’ã€‚</p><blockquote><p>é¡ºå¸¦ä¸€æï¼Œä»¥åä¼šç”¨ Function Component ä»£æ›¿ Stateless Component çš„è¯´æ³•ï¼ŒåŸå› æ˜¯ï¼šè‡ªä» Hooks å‡ºç°ï¼Œå‡½æ•°å¼ç»„ä»¶åŠŸèƒ½åœ¨ä¸æ–­ä¸°å¯Œï¼Œå‡½æ•°å¼ç»„ä»¶ä¸å†éœ€è¦å¼ºè°ƒå…¶æ— çŠ¶æ€ç‰¹æ€§ï¼Œå› æ­¤å« Function Component æ›´ä¸ºæ°å½“ã€‚</p></blockquote><ol start="2"><li>æ¦‚è¿°</li></ol><hr><p>åŸæ–‡äº‹å…ˆç”³æ˜ï¼šå¹¶æ²¡æœ‰å¯¹ Function ä¸ Classes è¿›è¡Œä¼˜åŠ£å¯¹æ¯”ï¼Œè€Œä»…ä»…è¿›è¡Œç‰¹æ€§å¯¹æ¯”ï¼Œæ‰€ä»¥ä¸æ¥å—ä»»ä½•åæ§½ã€‚</p><blockquote><p>è¿™ä¸¤ç§å†™æ³•æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œæ€§èƒ½å·®è·ä¹Ÿå‡ ä¹å¯ä»¥å¿½ç•¥ï¼Œè€Œä¸” React ä¼šé•¿æœŸæ”¯æŒè¿™ä¸¤ç§å†™æ³•ã€‚</p></blockquote><h2 id="Capture-props"><a href="#Capture-props" class="headerlink" title="Capture props"></a>Capture props</h2><p>å¯¹æ¯”ä¸‹é¢ä¸¤æ®µä»£ç ã€‚</p><p><strong>Class Component:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class ProfilePage extends React.Component &#123;</span><br><span class="line">  showMessage = () =&gt; &#123;</span><br><span class="line">    alert(&quot;Followed &quot; + this.props.user);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleClick = () =&gt; &#123;</span><br><span class="line">    setTimeout(this.showMessage, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;button onClick=&#123;this.handleClick&#125;&gt;Follow&lt;/button&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Function Component:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function ProfilePage(props) &#123;</span><br><span class="line">  const showMessage = () =&gt; &#123;</span><br><span class="line">    alert(&quot;Followed &quot; + props.user);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleClick = () =&gt; &#123;</span><br><span class="line">    setTimeout(showMessage, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return &lt;button onClick=&#123;handleClick&#125;&gt;Follow&lt;/button&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ<a href="https://codesandbox.io/s/pjqnl16lm7" target="_blank" rel="noopener">åœ¨çº¿ Demo</a>ï¼‰</p><p>è¿™ä¸¤ä¸ªç»„ä»¶éƒ½æè¿°äº†åŒä¸€ä¸ªé€»è¾‘ï¼šç‚¹å‡»æŒ‰é’® 3 ç§’å <code>alert</code> çˆ¶çº§ä¼ å…¥çš„ç”¨æˆ·åã€‚</p><p>å¦‚ä¸‹çˆ¶çº§ç»„ä»¶çš„è°ƒç”¨æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProfilePageFunction user=&#123;this.state.user&#125; /&gt;</span><br><span class="line">&lt;ProfilePageClass user=&#123;this.state.user&#125; /&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“ç‚¹å‡»æŒ‰é’®åçš„ 3 ç§’å†…ï¼Œçˆ¶çº§ä¿®æ”¹äº† <code>this.state.user</code>ï¼Œå¼¹å‡ºçš„ç”¨æˆ·åæ˜¯ä¿®æ”¹å‰çš„è¿˜æ˜¯ä¿®æ”¹åçš„å‘¢ï¼Ÿ</p><p><strong>Class Component å±•ç¤ºçš„æ˜¯ä¿®æ”¹åçš„å€¼ï¼š</strong></p><p>&lt;img src=â€<a href="https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.gif" target="_blank" rel="noopener">https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.gif</a>â€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€950â€data-rawheight=â€351â€data-thumbnail=â€<a href="https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.jpg" target="_blank" rel="noopener">https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.jpg</a>â€œwidth=â€950â€data-original=â€<a href="https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_r.jpg" target="_blank" rel="noopener">https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_r.jpg</a>â€œ/&gt;<img src="https://pic4.zhimg.com/v2-9d9d77bb138395301509792d9ae9acbf_b.jpg" alt=""></p><p><strong>Function Component å±•ç¤ºçš„æ˜¯ä¿®æ”¹å‰çš„å€¼ï¼š</strong></p><p>&lt;img src=â€<a href="https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.gif" target="_blank" rel="noopener">https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.gif</a>â€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€901â€data-rawheight=â€293â€data-thumbnail=â€<a href="https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.jpg" target="_blank" rel="noopener">https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.jpg</a>â€œwidth=â€901â€data-original=â€<a href="https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_r.jpg" target="_blank" rel="noopener">https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_r.jpg</a>â€œ/&gt;<img src="https://pic3.zhimg.com/v2-84396c4b3982827bead96912a947904e_b.jpg" alt=""></p><p>é‚£ä¹ˆ React æ–‡æ¡£ä¸­æè¿°çš„ <code>props</code> ä¸æ˜¯ä¸å¯å˜ï¼ˆImmutableï¼‰ æ•°æ®å—ï¼Ÿä¸ºå•¥åœ¨è¿è¡Œæ—¶è¿˜ä¼šå‘ç”Ÿå˜åŒ–å‘¢ï¼Ÿ</p><p>åŸå› åœ¨äºï¼Œè™½ç„¶ <code>props</code> ä¸å¯å˜ï¼Œæ˜¯ <code>this</code> åœ¨ Class Component ä¸­æ˜¯å¯å˜çš„ï¼Œå› æ­¤ <code>this.props</code> çš„è°ƒç”¨ä¼šå¯¼è‡´æ¯æ¬¡éƒ½è®¿é—®æœ€æ–°çš„ <code>props</code>ã€‚</p><p>è€Œ Function Component ä¸å­˜åœ¨ <code>this.props</code> çš„è¯­æ³•ï¼Œå› æ­¤ <code>props</code> æ€»æ˜¯ä¸å¯å˜çš„ã€‚</p><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œç¬”è€…è¡¥å……ä¸€äº›ä»£ç æ³¨è§£ï¼š</p><p><strong>Function Component:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function ProfilePage(props) &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    // å°±ç®—çˆ¶ç»„ä»¶ reRenderï¼Œè¿™é‡Œæ‹¿åˆ°çš„ props ä¹Ÿæ˜¯åˆå§‹çš„</span><br><span class="line">    console.log(props);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Class Component:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class ProfilePage extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      // å¦‚æœçˆ¶ç»„ä»¶ reRenderï¼Œthis.props æ‹¿åˆ°çš„æ°¸è¿œæ˜¯æœ€æ–°çš„ã€‚</span><br><span class="line">      // å¹¶ä¸æ˜¯ props å˜äº†ï¼Œè€Œæ˜¯ this.props æŒ‡å‘äº†æ–°çš„ propsï¼Œæ—§çš„ props æ‰¾ä¸åˆ°äº†</span><br><span class="line">      console.log(this.props);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›åœ¨ Class Component æ•è·ç¬æ—¶ Propsï¼Œå¯ä»¥ï¼š <code>const props = this.props;</code>ï¼Œä½†è¿™æ ·çš„ä»£ç å¾ˆè¹©è„šï¼Œæ‰€ä»¥å¦‚æœå¸Œæœ›æ‹¿åˆ°ç¨³å®šçš„ <code>props</code>ï¼Œä½¿ç”¨ Function Component æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><h2 id="Hooks-ä¹Ÿå…·æœ‰-capture-value-ç‰¹æ€§"><a href="#Hooks-ä¹Ÿå…·æœ‰-capture-value-ç‰¹æ€§" class="headerlink" title="Hooks ä¹Ÿå…·æœ‰ capture value ç‰¹æ€§"></a>Hooks ä¹Ÿå…·æœ‰ capture value ç‰¹æ€§</h2><p>çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function MessageThread() &#123;</span><br><span class="line">  const [message, setMessage] = useState(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">  const showMessage = () =&gt; &#123;</span><br><span class="line">    alert(&quot;You said: &quot; + message);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleSendClick = () =&gt; &#123;</span><br><span class="line">    setTimeout(showMessage, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleMessageChange = e =&gt; &#123;</span><br><span class="line">    setMessage(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;input value=&#123;message&#125; onChange=&#123;handleMessageChange&#125; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSendClick&#125;&gt;Send&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ<a href="https://codesandbox.io/s/93m5mz9w24" target="_blank" rel="noopener">åœ¨çº¿ Demo</a>ï¼‰</p><p>åœ¨ç‚¹å‡» <code>Send</code> æŒ‰é’®åï¼Œå†æ¬¡ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼ï¼Œ3 ç§’åçš„è¾“å‡ºä¾ç„¶æ˜¯ <strong>ç‚¹å‡»å‰è¾“å…¥æ¡†çš„å€¼</strong>ã€‚è¿™è¯´æ˜ Hooks åŒæ ·å…·æœ‰ capture value çš„ç‰¹æ€§ã€‚</p><p>åˆ©ç”¨ <code>useRef</code> å¯ä»¥è§„é¿ capture value ç‰¹æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function MessageThread() &#123;</span><br><span class="line">  const latestMessage = useRef(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">  const showMessage = () =&gt; &#123;</span><br><span class="line">    alert(&quot;You said: &quot; + latestMessage.current);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleSendClick = () =&gt; &#123;</span><br><span class="line">    setTimeout(showMessage, 3000);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const handleMessageChange = e =&gt; &#123;</span><br><span class="line">    latestMessage.current = e.target.value;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦å°†èµ‹å€¼ä¸å–å€¼çš„å¯¹è±¡å˜æˆ <code>useRef</code>ï¼Œè€Œä¸æ˜¯ <code>useState</code>ï¼Œå°±å¯ä»¥èº²è¿‡ capture value ç‰¹æ€§ï¼Œåœ¨ 3 ç§’åå¾—åˆ°æœ€æ–°çš„å€¼ã€‚</p><p>è¿™è¯´æ˜äº†åˆ©ç”¨ Function Component + Hooks å¯ä»¥å®ç° Class Component åšä¸åˆ°çš„ capture propsã€capture valueï¼Œè€Œä¸” React å®˜æ–¹ä¹Ÿæ¨è <a href="https://reactjs.org/docs/hooks-faq.html#do-i-need-to-rewrite-all-my-class-components" target="_blank" rel="noopener">æ–°çš„ä»£ç ä½¿ç”¨ Hooks ç¼–å†™</a>ã€‚</p><ol start="3"><li>ç²¾è¯»</li></ol><hr><p>åŸæ–‡ <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">how-are-function-components-different-from-classes</a> ä»ä¸€ä¸ªä¾§é¢è®²è¿°äº† Function Component ä¸ Class Component çš„ä¸åŒç‚¹ï¼Œä¹‹æ‰€ä»¥å°† Function Component ä¸ Class Component ç›¸æå¹¶è®ºï¼Œå‡ ä¹éƒ½è¦å½’åŠŸäº Hooks API çš„å‡ºç°ï¼Œæœ‰äº† Hooksï¼ŒFunction Component çš„èƒ½åŠ›æ‰å¾—ä»¥å‘ Class Component çœ‹é½ã€‚</p><p>å…³äº React Hooksï¼Œä¹‹å‰çš„ä¸¤ç¯‡ç²¾è¯»åˆ†åˆ«æœ‰è¿‡ä»‹ç»ï¼š</p><ul><li><a href="https://github.com/dt-fe/weekly/blob/master/79.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Hooks%E3%80%8B.md" target="_blank" rel="noopener">ç²¾è¯»ã€ŠReact Hooksã€‹</a></li><li><a href="https://github.com/dt-fe/weekly/blob/master/80.%E7%B2%BE%E8%AF%BB%E3%80%8A%E6%80%8E%E4%B9%88%E7%94%A8%20React%20Hooks%20%E9%80%A0%E8%BD%AE%E5%AD%90%E3%80%8B.md" target="_blank" rel="noopener">ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹</a></li></ul><p>ä½†æ˜¯ï¼Œè™½ç„¶ Hook å·²ç»å‘å¸ƒäº†ç¨³å®šç‰ˆæœ¬ï¼Œä½†å‘¨è¾¹ç”Ÿæ€è·Ÿè¿›è¿˜éœ€è¦æ—¶é—´ï¼ˆæ¯”å¦‚ <code>useRouter</code>ï¼‰ã€æœ€ä½³å®è·µæ•´ç†è¿˜éœ€è¦æ—¶é—´ï¼Œå› æ­¤ä¸å»ºè®®é‡æ„è€ä»£ç ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ Function Componentï¼Œå»ºè®®æ—¶å¸¸ä¸ Class Component çš„åŠŸèƒ½åšå¯¹æ¯”ï¼Œæ–¹ä¾¿ç†è§£å’Œè®°å¿†ã€‚</p><p>ä¸‹é¢æ•´ç†ä¸€äº›å¸¸è§çš„ Function Component é—®é¢˜ï¼š</p><blockquote><p>éå¸¸å»ºè®®å®Œæ•´é˜…è¯» <a href="https://reactjs.org/docs/hooks-faq.html#do-i-need-to-rewrite-all-my-class-components" target="_blank" rel="noopener">React Hooks FAQ</a>ã€‚</p></blockquote><h2 id="æ€ä¹ˆæ›¿ä»£-shouldComponentUpdate"><a href="#æ€ä¹ˆæ›¿ä»£-shouldComponentUpdate" class="headerlink" title="æ€ä¹ˆæ›¿ä»£ shouldComponentUpdate"></a>æ€ä¹ˆæ›¿ä»£ shouldComponentUpdate</h2><p>è¯´å®è¯ï¼ŒFunction Component æ›¿ä»£ <code>shouldComponentUpdate</code> çš„æ–¹æ¡ˆå¹¶æ²¡æœ‰ Class Component ä¼˜é›…ï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const Button = React.memo(props =&gt; &#123;</span><br><span class="line">  // your component</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨çˆ¶çº§å°±ç›´æ¥ç”Ÿæˆä¸€ä¸ªè‡ªå¸¦ <code>memo</code> çš„å­å…ƒç´ ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function Parent(&#123; a, b &#125;) &#123;</span><br><span class="line">  // Only re-rendered if `a` changes:</span><br><span class="line">  const child1 = useMemo(() =&gt; &lt;Child1 a=&#123;a&#125; /&gt;, [a]);</span><br><span class="line">  // Only re-rendered if `b` changes:</span><br><span class="line">  const child2 = useMemo(() =&gt; &lt;Child2 b=&#123;b&#125; /&gt;, [b]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;child1&#125;</span><br><span class="line">      &#123;child2&#125;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒClass Component çš„å†™æ³•é€šå¸¸æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class Button extends React.PureComponent &#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è‡ªå¸¦äº† <code>shallowEqual</code> çš„ <code>shouldComponentUpdate</code>ã€‚</p><h2 id="æ€ä¹ˆæ›¿ä»£-componentDidUpdate"><a href="#æ€ä¹ˆæ›¿ä»£-componentDidUpdate" class="headerlink" title="æ€ä¹ˆæ›¿ä»£ componentDidUpdate"></a>æ€ä¹ˆæ›¿ä»£ componentDidUpdate</h2><p>ç”±äº <code>useEffect</code> æ¯æ¬¡ Render éƒ½ä¼šæ‰§è¡Œï¼Œå› æ­¤éœ€è¦æ¨¡æ‹Ÿä¸€ä¸ª <code>useUpdate</code> å‡½æ•°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const mounting = useRef(true);</span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  if (mounting.current) &#123;</span><br><span class="line">    mounting.current = false;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    fn();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ›´å¤šå¯ä»¥æŸ¥çœ‹ <a href="https://github.com/dt-fe/weekly/blob/master/80.%E7%B2%BE%E8%AF%BB%E3%80%8A%E6%80%8E%E4%B9%88%E7%94%A8%20React%20Hooks%20%E9%80%A0%E8%BD%AE%E5%AD%90%E3%80%8B.md#componentdidupdate" target="_blank" rel="noopener">ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹</a></p><h2 id="æ€ä¹ˆæ›¿ä»£-forceUpdate"><a href="#æ€ä¹ˆæ›¿ä»£-forceUpdate" class="headerlink" title="æ€ä¹ˆæ›¿ä»£ forceUpdate"></a>æ€ä¹ˆæ›¿ä»£ forceUpdate</h2><p>React å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸€ç§æ–¹æ¡ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const [ignored, forceUpdate] = useReducer(x =&gt; x + 1, 0);</span><br><span class="line"></span><br><span class="line">function handleClick() &#123;</span><br><span class="line">  forceUpdate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡æ‰§è¡Œ <code>dispatch</code> æ—¶ï¼Œåªè¦ <code>state</code> å˜åŒ–å°±ä¼šè§¦å‘ç»„ä»¶æ›´æ–°ã€‚å½“ç„¶ <code>useState</code> ä¹ŸåŒæ ·å¯ä»¥æ¨¡æ‹Ÿï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const useUpdate = () =&gt; useState(0)[1];</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ <code>useState</code> ä¸‹æ ‡ä¸º 1 çš„é¡¹æ˜¯ç”¨æ¥æ›´æ–°æ•°æ®çš„ï¼Œè€Œä¸”å°±ç®—æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œè°ƒç”¨äº†ä¹Ÿä¼šåˆ·æ–°ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠè¿”å›ä¸€ä¸ªæ²¡æœ‰ä¿®æ”¹æ•°å€¼çš„ <code>setValue</code>ï¼Œè¿™æ ·å®ƒçš„åŠŸèƒ½å°±ä»…å‰©ä¸‹åˆ·æ–°ç»„ä»¶äº†ã€‚</p><p>æ›´å¤šå¯ä»¥æŸ¥çœ‹ <a href="https://github.com/dt-fe/weekly/blob/master/80.%E7%B2%BE%E8%AF%BB%E3%80%8A%E6%80%8E%E4%B9%88%E7%94%A8%20React%20Hooks%20%E9%80%A0%E8%BD%AE%E5%AD%90%E3%80%8B.md#force-update" target="_blank" rel="noopener">ç²¾è¯»ã€Šæ€ä¹ˆç”¨ React Hooks é€ è½®å­ã€‹</a></p><h2 id="state-æ‹†åˆ†è¿‡å¤š"><a href="#state-æ‹†åˆ†è¿‡å¤š" class="headerlink" title="state æ‹†åˆ†è¿‡å¤š"></a>state æ‹†åˆ†è¿‡å¤š</h2><p><code>useState</code> ç›®å‰çš„ä¸€ç§å®è·µï¼Œæ˜¯å°†å˜é‡åæ‰“å¹³ï¼Œè€Œéåƒ Class Component ä¸€æ ·å†™åœ¨ä¸€ä¸ª State å¯¹è±¡é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class ClassComponent extends React.PureComponent &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    left: 0,</span><br><span class="line">    top: 0,</span><br><span class="line">    width: 100,</span><br><span class="line">    height: 100</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// VS</span><br><span class="line"></span><br><span class="line">function FunctionComponent &#123;</span><br><span class="line">  const [left,setLeft] = useState(0)</span><br><span class="line">  const [top,setTop] = useState(0)</span><br><span class="line">  const [width,setWidth] = useState(100)</span><br><span class="line">  const [height,setHeight] = useState(100)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šåœ¨ Function Component ä¸­ä¹Ÿå¯ä»¥èšåˆç®¡ç† Stateï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function FunctionComponent() &#123;</span><br><span class="line">  const [state, setState] = useState(&#123;</span><br><span class="line">    left: 0,</span><br><span class="line">    top: 0,</span><br><span class="line">    width: 100,</span><br><span class="line">    height: 100</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæ˜¯æ›´æ–°çš„æ—¶å€™ï¼Œä¸å†ä¼šè‡ªåŠ¨ mergeï¼Œè€Œéœ€è¦ä½¿ç”¨ <code>...state</code> è¯­æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setState(state =&gt; (&#123; ...state, left: e.pageX, top: e.pageY &#125;));</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ›´å°‘çš„é»‘é­”æ³•ï¼Œæ›´å¯é¢„æœŸçš„ç»“æœã€‚</p><h2 id="è·å–ä¸Šä¸€ä¸ª-props"><a href="#è·å–ä¸Šä¸€ä¸ª-props" class="headerlink" title="è·å–ä¸Šä¸€ä¸ª props"></a>è·å–ä¸Šä¸€ä¸ª props</h2><p>è™½ç„¶ä¸æ€ä¹ˆå¸¸ç”¨ï¼Œä½†æ˜¯æ¯•ç«Ÿ Class Component å¯ä»¥é€šè¿‡ <code>componentWillReceiveProps</code> æ‹¿åˆ° <code>previousProps</code> ä¸ <code>nextProps</code>ï¼Œå¯¹äº Function Componentï¼Œæœ€å¥½é€šè¿‡è‡ªå®šä¹‰ Hooks æ–¹å¼æ‹¿åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const prevCount = usePrevious(count);</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1&gt;</span><br><span class="line">      Now: &#123;count&#125;, before: &#123;prevCount&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function usePrevious(value) &#123;</span><br><span class="line">  const ref = useRef();</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    ref.current = value;</span><br><span class="line">  &#125;);</span><br><span class="line">  return ref.current;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code>useEffect</code> åœ¨ç»„ä»¶æ¸²æŸ“å®Œæ¯•åå†æ‰§è¡Œçš„ç‰¹æ€§ï¼Œå†åˆ©ç”¨ <code>useRef</code> çš„å¯å˜ç‰¹æ€§ï¼Œè®© <code>usePrevious</code> çš„è¿”å›å€¼æ˜¯ â€œä¸Šä¸€æ¬¡â€ Render æ—¶çš„ã€‚</p><p>å¯è§ï¼Œåˆç†è¿ç”¨ <code>useEffect</code> <code>useRef</code>ï¼Œå¯ä»¥åšè®¸å¤šäº‹æƒ…ï¼Œè€Œä¸”å°è£…æˆ CustomHook åä½¿ç”¨èµ·æ¥ä»ç„¶å¾ˆæ–¹ä¾¿ã€‚</p><blockquote><p>æœªæ¥ <code>usePrevious</code> å¯èƒ½æˆä¸ºå®˜æ–¹ Hooks ä¹‹ä¸€ã€‚</p></blockquote><h2 id="æ€§èƒ½æ³¨æ„äº‹é¡¹"><a href="#æ€§èƒ½æ³¨æ„äº‹é¡¹" class="headerlink" title="æ€§èƒ½æ³¨æ„äº‹é¡¹"></a>æ€§èƒ½æ³¨æ„äº‹é¡¹</h2><p><code>useState</code> å‡½æ•°çš„å‚æ•°è™½ç„¶æ˜¯åˆå§‹å€¼ï¼Œä½†ç”±äºæ•´ä¸ªå‡½æ•°éƒ½æ˜¯ Renderï¼Œå› æ­¤æ¯æ¬¡åˆå§‹åŒ–éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœåˆå§‹å€¼è®¡ç®—éå¸¸æ¶ˆè€—æ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨å‡½æ•°ä¼ å…¥ï¼Œè¿™æ ·åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function FunctionComponent(props) &#123;</span><br><span class="line">  const [rows, setRows] = useState(() =&gt; createRows(props.count));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>useRef</code> ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ï¼Œéœ€è¦<a href="https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily" target="_blank" rel="noopener">å†™ä¸€äº›å†—ä½™çš„å‡½åˆ¤å®šæ˜¯å¦è¿›è¡Œè¿‡åˆå§‹åŒ–</a>ã€‚</p></blockquote><p>æŒæ¡äº†è¿™äº›ï¼ŒFunction Component ä½¿ç”¨èµ·æ¥ä¸ Class Component å°±å‡ ä¹æ²¡æœ‰å·®åˆ«äº†ï¼</p><ol start="4"><li>æ€»ç»“</li></ol><hr><p>Function Component åŠŸèƒ½å·²ç»å¯ä»¥ä¸ Class Component åª²ç¾äº†ï¼Œä½†ç›®å‰æœ€ä½³å®è·µæ¯”è¾ƒé›¶æ•£ï¼Œå®˜æ–¹æ–‡æ¡£æ¨èçš„ä¸€äº›è§£å†³æ€è·¯ç”šè‡³ä¸æ¯”ç¤¾åŒºç¬¬ä¸‰æ–¹åº“çš„æ›´å¥½ï¼Œå¯ä»¥é¢„æ–™åˆ°ï¼ŒClass Component çš„åŠŸèƒ½ä¼šè¢«äº”èŠ±å…«é—¨çš„å®ç°å‡ºæ¥ï¼Œé‚£äº›æ²¡æœ‰è¢«æ”¶çº³è¿›å®˜æ–¹çš„ Hooks ä¹çœ‹ä¸Šå»å¯èƒ½ä¼šçœ¼èŠ±ç¼­ä¹±ã€‚</p><p>æ€»ä¹‹é€‰æ‹©äº† Function Component å°±åŒæ—¶é€‰æ‹©äº†å‡½æ•°å¼çš„å¥½ä¸åã€‚<strong>å¥½å¤„æ˜¯åŠŸèƒ½å¼ºå¤§ï¼Œå‡ ä¹å¯ä»¥æ¨¡æ‹Ÿå‡ºä»»ä½•æƒ³è¦çš„åŠŸèƒ½</strong>ï¼Œ<strong>åå¤„æ˜¯ç”±äºå¯ä»¥çµæ´»ç»„åˆï¼Œå¦‚æœè‡ªå®šä¹‰ Hooks å‘½åå’Œå®ç°ä¸å¤Ÿæ ‡å‡†ï¼Œå‡½æ•°ä¸å‡½æ•°ä¹‹é—´å¯¹æ¥çš„æ²Ÿé€šæˆæœ¬ä¼šæ›´å¤§ã€‚</strong></p><blockquote><p>è®¨è®ºåœ°å€æ˜¯ï¼š<a href="https://github.com/dt-fe/weekly/issues/137" target="_blank" rel="noopener">ç²¾è¯»ã€ŠStateless VS Class ç»„ä»¶ã€‹ Â· Issue #137 Â· dt-fe/weekly</a></p></blockquote><p><strong>å¦‚æœä½ æƒ³å‚ä¸è®¨è®ºï¼Œè¯·</strong> <strong><a href="https://github.com/dt-fe/weekly" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡Œ</a>ï¼Œæ¯å‘¨éƒ½æœ‰æ–°çš„ä¸»é¢˜ï¼Œå‘¨æœ«æˆ–å‘¨ä¸€å‘å¸ƒã€‚å‰ç«¯ç²¾è¯» - å¸®ä½ ç­›é€‰é è°±çš„å†…å®¹ã€‚</strong></p><blockquote><p>å…³æ³¨ <strong>å‰ç«¯ç²¾è¯»å¾®ä¿¡å…¬ä¼—å·</strong></p></blockquote><p>&lt;img src=â€<a href="https://pic3.zhimg.com/v2-d817340c54185469ec4df17c0938742e_b.jpg" target="_blank" rel="noopener">https://pic3.zhimg.com/v2-d817340c54185469ec4df17c0938742e_b.jpg</a>â€œ data-caption=â€â€data-size=â€normalâ€data-rawwidth=â€258â€data-rawheight=â€258â€width=â€258â€/&gt;<img src="https://pic3.zhimg.com/80/v2-d817340c54185469ec4df17c0938742e_hd.jpg" alt=""></p><p><strong>special Sponsors</strong></p><ul><li><a href="https://e.coding.net/?utm_source=weekly" target="_blank" rel="noopener">DevOps å…¨æµç¨‹å¹³å°</a></li></ul><blockquote><p>ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½ - éå•†ç”¨ - éè¡ç”Ÿ - ä¿æŒç½²åï¼ˆ<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" rel="noopener">åˆ›æ„å…±äº« 3.0 è®¸å¯è¯</a>ï¼‰</p></blockquote><p>å†™ä¸‹ä½ çš„è¯„è®ºâ€¦</p><p>åœ¨çº¿ Demo æŒ‚äº†~</p><p>ä¿®å¤äº†</p><p>class çš„è¿™ä¸ª bug Dan å¥½åƒæè¿‡ ç”¨ const {XXX} = this.props å¯ä»¥è§£å†³</p><p>ä½ åœ¨æ–‡ä¸­å¥½åƒæäº† æˆ‘æ²¡ä»”ç»†çœ‹ ä¸å¥½æ„æ€</p><p><img src="https://pic1.zhimg.com/v2-12562ad40366818a1ea39bcecb2599a0_r.gif" alt=""></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ hooksâ€¦</p><p>ç”Ÿå‘½åœ¨äºä¸æ¯</p><p>æˆ‘è§‰å¾—é‚£æ®µ props immutable è§£é‡Šçš„æ˜¯ä¸æ˜¯æœ‰ç‚¹æ­§ä¹‰ã€‚ã€‚æ¯”å¦‚ï¼Œinstance çš„ this æ˜¯å¯å˜çš„ï¼Œthis åœ¨å®Œæ•´çš„ç»„ä»¶å£°æ˜å‘¨æœŸé‡Œå¹¶ä¸ä¼šä¿®æ”¹å•Šï¼Œåªæ˜¯ this ä¸Šçš„ props å¯èƒ½ä¼šä¿®æ”¹æŒ‡å‘ã€‚ç„¶åã€‚ä¸‹æ–‡ç”¨ setTimeout è¿™æ®µè¡¨è¾¾çš„å…¶å®æ˜¯é—­åŒ…é’ˆå¯¹å˜é‡çš„æ•è·å§ï¼Œè¿™ä¸ªå’Œæ˜¯ä¸æ˜¯ immutable å…³ç³»å¹¶ä¸å¤§å§ ï¼ˆæˆ‘è§‰å¾—è¿™é‡Œå®Œå…¨å°±æ˜¯é—­åŒ…çš„é—®é¢˜ï¼‰ï¼Ÿ</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      ä¸ºä»€ä¹ˆè¦äº†è§£ Function å†™æ³•çš„ç»„ä»¶å‘¢ï¼Ÿå› ä¸ºå®ƒæ­£åœ¨å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="Reactç»„ä»¶" scheme="https://andyxw.com/tags/React%E7%BB%84%E4%BB%B6/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šç°ä»£ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜</title>
    <link href="https://andyxw.com/archives/35c4.html"/>
    <id>https://andyxw.com/archives/35c4.html</id>
    <published>2019-09-04T13:04:09.000Z</published>
    <updated>2019-09-04T13:23:28.974Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/" target="_blank" rel="noopener">https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/</a></p></blockquote><p>ç½‘ç»œæµè§ˆå™¨å¾ˆå¯èƒ½æ˜¯ä½¿ç”¨æœ€å¹¿çš„è½¯ä»¶ã€‚åœ¨è¿™ç¯‡å…¥é—¨æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šä»‹ç»å®ƒä»¬çš„å¹•åå·¥ä½œåŸç†ã€‚æˆ‘ä»¬ä¼šäº†è§£åˆ°ï¼Œä»æ‚¨åœ¨åœ°å€æ è¾“å…¥ <code>google.com</code> ç›´åˆ°æ‚¨åœ¨æµè§ˆå™¨å±å¹•ä¸Šçœ‹åˆ° Google é¦–é¡µçš„æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†äº›ä»€ä¹ˆã€‚</p><h3 id="æˆ‘ä»¬è¦è®¨è®ºçš„æµè§ˆå™¨"><a href="#æˆ‘ä»¬è¦è®¨è®ºçš„æµè§ˆå™¨" class="headerlink" title="æˆ‘ä»¬è¦è®¨è®ºçš„æµè§ˆå™¨"></a>æˆ‘ä»¬è¦è®¨è®ºçš„æµè§ˆå™¨</h3><p>ç›®å‰ä½¿ç”¨çš„ä¸»æµæµè§ˆå™¨æœ‰äº”ä¸ªï¼šInternet Explorerã€Firefoxã€Safariã€Chrome æµè§ˆå™¨å’Œ Operaã€‚æœ¬æ–‡ä¸­ä»¥å¼€æ”¾æºä»£ç æµè§ˆå™¨ä¸ºä¾‹ï¼Œå³ Firefoxã€Chrome æµè§ˆå™¨å’Œ Safariï¼ˆéƒ¨åˆ†å¼€æºï¼‰ã€‚æ ¹æ® <a href="http://gs.statcounter.com/" target="_blank" rel="noopener">StatCounter æµè§ˆå™¨ç»Ÿè®¡æ•°æ®</a>ï¼Œç›®å‰ï¼ˆ2011 å¹´ 8 æœˆï¼‰Firefoxã€Safari å’Œ Chrome æµè§ˆå™¨çš„æ€»å¸‚åœºå æœ‰ç‡å°†è¿‘ 60%ã€‚ç”±æ­¤å¯è§ï¼Œå¦‚ä»Šå¼€æ”¾æºä»£ç æµè§ˆå™¨åœ¨æµè§ˆå™¨å¸‚åœºä¸­å æ®äº†éå¸¸åšå®çš„éƒ¨åˆ†ã€‚</p><h3 id="æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½"><a href="#æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½" class="headerlink" title="æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½"></a>æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½</h3><p>æµè§ˆå™¨çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåœ¨æµè§ˆå™¨çª—å£ä¸­å±•ç¤ºæ‚¨é€‰æ‹©çš„ç½‘ç»œèµ„æºã€‚è¿™é‡Œæ‰€è¯´çš„èµ„æºä¸€èˆ¬æ˜¯æŒ‡ HTML æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ˜¯ PDFã€å›¾ç‰‡æˆ–å…¶ä»–çš„ç±»å‹ã€‚èµ„æºçš„ä½ç½®ç”±ç”¨æˆ·ä½¿ç”¨ URIï¼ˆç»Ÿä¸€èµ„æºæ ‡ç¤ºç¬¦ï¼‰æŒ‡å®šã€‚</p><p>æµè§ˆå™¨è§£é‡Šå¹¶æ˜¾ç¤º HTML æ–‡ä»¶çš„æ–¹å¼æ˜¯åœ¨ HTML å’Œ CSS è§„èŒƒä¸­æŒ‡å®šçš„ã€‚è¿™äº›è§„èŒƒç”±ç½‘ç»œæ ‡å‡†åŒ–ç»„ç»‡ W3Cï¼ˆä¸‡ç»´ç½‘è”ç›Ÿï¼‰è¿›è¡Œç»´æŠ¤ã€‚<br>å¤šå¹´ä»¥æ¥ï¼Œå„æµè§ˆå™¨éƒ½æ²¡æœ‰å®Œå…¨éµä»è¿™äº›è§„èŒƒï¼ŒåŒæ—¶è¿˜åœ¨å¼€å‘è‡ªå·±ç‹¬æœ‰çš„æ‰©å±•ç¨‹åºï¼Œè¿™ç»™ç½‘ç»œå¼€å‘äººå‘˜å¸¦æ¥äº†ä¸¥é‡çš„å…¼å®¹æ€§é—®é¢˜ã€‚å¦‚ä»Šï¼Œå¤§å¤šæ•°çš„æµè§ˆå™¨éƒ½æ˜¯æˆ–å¤šæˆ–å°‘åœ°éµä»è§„èŒƒã€‚</p><p>æµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢æœ‰å¾ˆå¤šå½¼æ­¤ç›¸åŒçš„å…ƒç´ ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li>ç”¨æ¥è¾“å…¥ URI çš„åœ°å€æ </li><li>å‰è¿›å’Œåé€€æŒ‰é’®</li><li>ä¹¦ç­¾è®¾ç½®é€‰é¡¹</li><li>ç”¨äºåˆ·æ–°å’Œåœæ­¢åŠ è½½å½“å‰æ–‡æ¡£çš„åˆ·æ–°å’Œåœæ­¢æŒ‰é’®</li><li>ç”¨äºè¿”å›ä¸»é¡µçš„ä¸»é¡µæŒ‰é’®</li></ul><p>å¥‡æ€ªçš„æ˜¯ï¼Œæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¹¶æ²¡æœ‰ä»»ä½•æ­£å¼çš„è§„èŒƒï¼Œè¿™æ˜¯å¤šå¹´æ¥çš„æœ€ä½³å®è·µè‡ªç„¶å‘å±•ä»¥åŠå½¼æ­¤ä¹‹é—´ç›¸äº’æ¨¡ä»¿çš„ç»“æœã€‚HTML5 ä¹Ÿæ²¡æœ‰å®šä¹‰æµè§ˆå™¨å¿…é¡»å…·æœ‰çš„ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼Œä½†åˆ—å‡ºäº†ä¸€äº›é€šç”¨çš„å…ƒç´ ï¼Œä¾‹å¦‚åœ°å€æ ã€çŠ¶æ€æ å’Œå·¥å…·æ ç­‰ã€‚å½“ç„¶ï¼Œå„æµè§ˆå™¨ä¹Ÿå¯ä»¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ Firefox çš„ä¸‹è½½ç®¡ç†å™¨ã€‚</p><h3 id="æµè§ˆå™¨çš„é«˜å±‚ç»“æ„"><a href="#æµè§ˆå™¨çš„é«˜å±‚ç»“æ„" class="headerlink" title="æµè§ˆå™¨çš„é«˜å±‚ç»“æ„"></a>æµè§ˆå™¨çš„é«˜å±‚ç»“æ„</h3><p>æµè§ˆå™¨çš„ä¸»è¦ç»„ä»¶ä¸º (<a href="#1_1">1.1</a>)ï¼š</p><ol><li><strong>ç”¨æˆ·ç•Œé¢</strong> - åŒ…æ‹¬åœ°å€æ ã€å‰è¿› / åé€€æŒ‰é’®ã€ä¹¦ç­¾èœå•ç­‰ã€‚é™¤äº†æµè§ˆå™¨ä¸»çª—å£æ˜¾ç¤ºçš„æ‚¨è¯·æ±‚çš„é¡µé¢å¤–ï¼Œå…¶ä»–æ˜¾ç¤ºçš„å„ä¸ªéƒ¨åˆ†éƒ½å±äºç”¨æˆ·ç•Œé¢ã€‚</li><li><strong>æµè§ˆå™¨å¼•æ“</strong> - åœ¨ç”¨æˆ·ç•Œé¢å’Œå‘ˆç°å¼•æ“ä¹‹é—´ä¼ é€æŒ‡ä»¤ã€‚</li><li><strong>å‘ˆç°å¼•æ“</strong> - è´Ÿè´£æ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚å¦‚æœè¯·æ±‚çš„å†…å®¹æ˜¯ HTMLï¼Œå®ƒå°±è´Ÿè´£è§£æ HTML å’Œ CSS å†…å®¹ï¼Œå¹¶å°†è§£æåçš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</li><li><strong>ç½‘ç»œ</strong> - ç”¨äºç½‘ç»œè°ƒç”¨ï¼Œæ¯”å¦‚ HTTP è¯·æ±‚ã€‚å…¶æ¥å£ä¸å¹³å°æ— å…³ï¼Œå¹¶ä¸ºæ‰€æœ‰å¹³å°æä¾›åº•å±‚å®ç°ã€‚</li><li><strong>ç”¨æˆ·ç•Œé¢åç«¯</strong> - ç”¨äºç»˜åˆ¶åŸºæœ¬çš„çª—å£å°éƒ¨ä»¶ï¼Œæ¯”å¦‚ç»„åˆæ¡†å’Œçª—å£ã€‚å…¶å…¬å¼€äº†ä¸å¹³å°æ— å…³çš„é€šç”¨æ¥å£ï¼Œè€Œåœ¨åº•å±‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢æ–¹æ³•ã€‚</li><li><strong>JavaScript è§£é‡Šå™¨</strong>ã€‚ç”¨äºè§£æå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>æ•°æ®å­˜å‚¨</strong>ã€‚è¿™æ˜¯æŒä¹…å±‚ã€‚æµè§ˆå™¨éœ€è¦åœ¨ç¡¬ç›˜ä¸Šä¿å­˜å„ç§æ•°æ®ï¼Œä¾‹å¦‚ Cookieã€‚æ–°çš„ HTML è§„èŒƒ (HTML5) å®šä¹‰äº† â€œç½‘ç»œæ•°æ®åº“â€ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ï¼ˆä½†æ˜¯è½»ä¾¿ï¼‰çš„æµè§ˆå™¨å†…æ•°æ®åº“ã€‚</li></ol><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/layers.png" alt=""> å›¾ï¼šæµè§ˆå™¨çš„ä¸»è¦ç»„ä»¶ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå’Œå¤§å¤šæ•°æµè§ˆå™¨ä¸åŒï¼ŒChrome æµè§ˆå™¨çš„æ¯ä¸ªæ ‡ç­¾é¡µéƒ½åˆ†åˆ«å¯¹åº”ä¸€ä¸ªå‘ˆç°å¼•æ“å®ä¾‹ã€‚æ¯ä¸ªæ ‡ç­¾é¡µéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚</p><h2 id="å‘ˆç°å¼•æ“"><a href="#å‘ˆç°å¼•æ“" class="headerlink" title="å‘ˆç°å¼•æ“"></a>å‘ˆç°å¼•æ“</h2><p>å‘ˆç°å¼•æ“çš„ä½œç”¨å˜›â€¦ å½“ç„¶å°±æ˜¯ â€œå‘ˆç°â€ äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨æµè§ˆå™¨çš„å±å¹•ä¸Šæ˜¾ç¤ºè¯·æ±‚çš„å†…å®¹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ˆç°å¼•æ“å¯æ˜¾ç¤º HTML å’Œ XML æ–‡æ¡£ä¸å›¾ç‰‡ã€‚é€šè¿‡æ’ä»¶ï¼ˆæˆ–æµè§ˆå™¨æ‰©å±•ç¨‹åºï¼‰ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºå…¶ä»–ç±»å‹çš„å†…å®¹ï¼›ä¾‹å¦‚ï¼Œä½¿ç”¨ PDF æŸ¥çœ‹å™¨æ’ä»¶å°±èƒ½æ˜¾ç¤º PDF æ–‡æ¡£ã€‚ä½†æ˜¯åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†é›†ä¸­ä»‹ç»å…¶ä¸»è¦ç”¨é€”ï¼šæ˜¾ç¤ºä½¿ç”¨ CSS æ ¼å¼åŒ–çš„ HTML å†…å®¹å’Œå›¾ç‰‡ã€‚</p><h3 id="å‘ˆç°å¼•æ“-1"><a href="#å‘ˆç°å¼•æ“-1" class="headerlink" title="å‘ˆç°å¼•æ“"></a>å‘ˆç°å¼•æ“</h3><p>æœ¬æ–‡æ‰€è®¨è®ºçš„æµè§ˆå™¨ï¼ˆFirefoxã€Chrome æµè§ˆå™¨å’Œ Safariï¼‰æ˜¯åŸºäºä¸¤ç§å‘ˆç°å¼•æ“æ„å»ºçš„ã€‚Firefox ä½¿ç”¨çš„æ˜¯ Geckoï¼Œè¿™æ˜¯ Mozilla å…¬å¸ â€œè‡ªåˆ¶â€ çš„å‘ˆç°å¼•æ“ã€‚è€Œ Safari å’Œ Chrome æµè§ˆå™¨ä½¿ç”¨çš„éƒ½æ˜¯ WebKitã€‚</p><p>WebKit æ˜¯ä¸€ç§å¼€æ”¾æºä»£ç å‘ˆç°å¼•æ“ï¼Œèµ·åˆç”¨äº Linux å¹³å°ï¼Œéšåç”± Apple å…¬å¸è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œæ”¯æŒè‹¹æœæœºå’Œ Windowsã€‚æœ‰å…³è¯¦æƒ…ï¼Œè¯·å‚é˜… <a href="http://webkit.org/" target="_blank" rel="noopener">webkit.org</a>ã€‚</p><h3 id="ä¸»æµç¨‹"><a href="#ä¸»æµç¨‹" class="headerlink" title="ä¸»æµç¨‹"></a>ä¸»æµç¨‹</h3><p>å‘ˆç°å¼•æ“ä¸€å¼€å§‹ä¼šä»ç½‘ç»œå±‚è·å–è¯·æ±‚æ–‡æ¡£çš„å†…å®¹ï¼Œå†…å®¹çš„å¤§å°ä¸€èˆ¬é™åˆ¶åœ¨ 8000 ä¸ªå—ä»¥å†…ã€‚</p><p>ç„¶åè¿›è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„åŸºæœ¬æµç¨‹ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/flow.png" alt=""> å›¾ï¼šå‘ˆç°å¼•æ“çš„åŸºæœ¬æµç¨‹ã€‚</p><p>å‘ˆç°å¼•æ“å°†å¼€å§‹è§£æ HTML æ–‡æ¡£ï¼Œå¹¶å°†å„æ ‡è®°é€ä¸ªè½¬åŒ–æˆ â€œå†…å®¹æ ‘â€ ä¸Šçš„ <a href="#DOM">DOM</a> èŠ‚ç‚¹ã€‚åŒæ—¶ä¹Ÿä¼šè§£æå¤–éƒ¨ CSS æ–‡ä»¶ä»¥åŠæ ·å¼å…ƒç´ ä¸­çš„æ ·å¼æ•°æ®ã€‚HTML ä¸­è¿™äº›å¸¦æœ‰è§†è§‰æŒ‡ä»¤çš„æ ·å¼ä¿¡æ¯å°†ç”¨äºåˆ›å»ºå¦ä¸€ä¸ªæ ‘ç»“æ„ï¼š<a href="#Render_tree_construction">å‘ˆç°æ ‘</a>ã€‚</p><p>å‘ˆç°æ ‘åŒ…å«å¤šä¸ªå¸¦æœ‰è§†è§‰å±æ€§ï¼ˆå¦‚é¢œè‰²å’Œå°ºå¯¸ï¼‰çš„çŸ©å½¢ã€‚è¿™äº›çŸ©å½¢çš„æ’åˆ—é¡ºåºå°±æ˜¯å®ƒä»¬å°†åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„é¡ºåºã€‚</p><p>å‘ˆç°æ ‘æ„å»ºå®Œæ¯•ä¹‹åï¼Œè¿›å…¥ â€œ<a href="#layout">å¸ƒå±€</a>â€ å¤„ç†é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªåº”å‡ºç°åœ¨å±å¹•ä¸Šçš„ç¡®åˆ‡åæ ‡ã€‚ä¸‹ä¸€ä¸ªé˜¶æ®µæ˜¯<a href="#Painting">ç»˜åˆ¶</a> - å‘ˆç°å¼•æ“ä¼šéå†å‘ˆç°æ ‘ï¼Œç”±ç”¨æˆ·ç•Œé¢åç«¯å±‚å°†æ¯ä¸ªèŠ‚ç‚¹ç»˜åˆ¶å‡ºæ¥ã€‚</p><p>éœ€è¦ç€é‡æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ã€‚ä¸ºè¾¾åˆ°æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå‘ˆç°å¼•æ“ä¼šåŠ›æ±‚å°½å¿«å°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒä¸å¿…ç­‰åˆ°æ•´ä¸ª HTML æ–‡æ¡£è§£æå®Œæ¯•ä¹‹åï¼Œå°±ä¼šå¼€å§‹æ„å»ºå‘ˆç°æ ‘å’Œè®¾ç½®å¸ƒå±€ã€‚åœ¨ä¸æ–­æ¥æ”¶å’Œå¤„ç†æ¥è‡ªç½‘ç»œçš„å…¶ä½™å†…å®¹çš„åŒæ—¶ï¼Œå‘ˆç°å¼•æ“ä¼šå°†éƒ¨åˆ†å†…å®¹è§£æå¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p><h4 id="ä¸»æµç¨‹ç¤ºä¾‹"><a href="#ä¸»æµç¨‹ç¤ºä¾‹" class="headerlink" title="ä¸»æµç¨‹ç¤ºä¾‹"></a>ä¸»æµç¨‹ç¤ºä¾‹</h4><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/webkitflow.png" alt=""> å›¾ï¼šWebKit ä¸»æµç¨‹ <img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image008.jpg" alt=""> å›¾ï¼šMozilla çš„ Gecko å‘ˆç°å¼•æ“ä¸»æµç¨‹ (<a href="#3_6">3.6</a>)</p><p>ä»å›¾ 3 å’Œå›¾ 4 å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶ WebKit å’Œ Gecko ä½¿ç”¨çš„æœ¯è¯­ç•¥æœ‰ä¸åŒï¼Œä½†æ•´ä½“æµç¨‹æ˜¯åŸºæœ¬ç›¸åŒçš„ã€‚</p><p>Gecko å°†è§†è§‰æ ¼å¼åŒ–å…ƒç´ ç»„æˆçš„æ ‘ç§°ä¸º â€œæ¡†æ¶æ ‘â€ã€‚æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚WebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯â€œå‘ˆç°æ ‘â€ï¼Œå®ƒç”±â€œå‘ˆç°å¯¹è±¡â€ ç»„æˆã€‚å¯¹äºå…ƒç´ çš„æ”¾ç½®ï¼ŒWebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯ â€œå¸ƒå±€â€ï¼Œè€Œ Gecko ç§°ä¹‹ä¸ºâ€œé‡æ’â€ã€‚å¯¹äºè¿æ¥ DOM èŠ‚ç‚¹å’Œå¯è§†åŒ–ä¿¡æ¯ä»è€Œåˆ›å»ºå‘ˆç°æ ‘çš„è¿‡ç¨‹ï¼ŒWebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯â€œé™„åŠ â€ã€‚æœ‰ä¸€ä¸ªç»†å¾®çš„éè¯­ä¹‰å·®åˆ«ï¼Œå°±æ˜¯ Gecko åœ¨ HTML ä¸ DOM æ ‘ä¹‹é—´è¿˜æœ‰ä¸€ä¸ªç§°ä¸ºâ€œå†…å®¹æ§½â€ çš„å±‚ï¼Œç”¨äºç”Ÿæˆ DOM å…ƒç´ ã€‚æˆ‘ä»¬ä¼šé€ä¸€è®ºè¿°æµç¨‹ä¸­çš„æ¯ä¸€éƒ¨åˆ†ï¼š</p><h3 id="è§£æ-ç»¼è¿°"><a href="#è§£æ-ç»¼è¿°" class="headerlink" title="è§£æ - ç»¼è¿°"></a>è§£æ - ç»¼è¿°</h3><p>è§£ææ˜¯å‘ˆç°å¼•æ“ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬è¦æ›´æ·±å…¥åœ°è®²è§£ã€‚é¦–å…ˆï¼Œæ¥ä»‹ç»ä¸€ä¸‹è§£æã€‚</p><p>è§£ææ–‡æ¡£æ˜¯æŒ‡å°†æ–‡æ¡£è½¬åŒ–æˆä¸ºæœ‰æ„ä¹‰çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å¯è®©ä»£ç ç†è§£å’Œä½¿ç”¨çš„ç»“æ„ã€‚è§£æå¾—åˆ°çš„ç»“æœé€šå¸¸æ˜¯ä»£è¡¨äº†æ–‡æ¡£ç»“æ„çš„èŠ‚ç‚¹æ ‘ï¼Œå®ƒç§°ä½œè§£ææ ‘æˆ–è€…è¯­æ³•æ ‘ã€‚</p><p>ç¤ºä¾‹ - è§£æ 2 + 3 - 1 è¿™ä¸ªè¡¨è¾¾å¼ï¼Œä¼šè¿”å›ä¸‹é¢çš„æ ‘ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image009.png" alt=""> å›¾ï¼šæ•°å­¦è¡¨è¾¾å¼æ ‘èŠ‚ç‚¹</p><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><p>è§£ææ˜¯ä»¥æ–‡æ¡£æ‰€éµå¾ªçš„è¯­æ³•è§„åˆ™ï¼ˆç¼–å†™æ–‡æ¡£æ‰€ç”¨çš„è¯­è¨€æˆ–æ ¼å¼ï¼‰ä¸ºåŸºç¡€çš„ã€‚æ‰€æœ‰å¯ä»¥è§£æçš„æ ¼å¼éƒ½å¿…é¡»å¯¹åº”ç¡®å®šçš„è¯­æ³•ï¼ˆç”±è¯æ±‡å’Œè¯­æ³•è§„åˆ™æ„æˆï¼‰ã€‚è¿™ç§°ä¸º<a href="#context_free_grammar">ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•</a>ã€‚äººç±»è¯­è¨€å¹¶ä¸å±äºè¿™æ ·çš„è¯­è¨€ï¼Œå› æ­¤æ— æ³•ç”¨å¸¸è§„çš„è§£ææŠ€æœ¯è¿›è¡Œè§£æã€‚</p><h4 id="è§£æå™¨å’Œè¯æ³•åˆ†æå™¨çš„ç»„åˆ"><a href="#è§£æå™¨å’Œè¯æ³•åˆ†æå™¨çš„ç»„åˆ" class="headerlink" title="è§£æå™¨å’Œè¯æ³•åˆ†æå™¨çš„ç»„åˆ"></a>è§£æå™¨å’Œè¯æ³•åˆ†æå™¨çš„ç»„åˆ</h4><p>è§£æçš„è¿‡ç¨‹å¯ä»¥åˆ†æˆä¸¤ä¸ªå­è¿‡ç¨‹ï¼šè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚</p><p>è¯æ³•åˆ†ææ˜¯å°†è¾“å…¥å†…å®¹åˆ†å‰²æˆå¤§é‡æ ‡è®°çš„è¿‡ç¨‹ã€‚æ ‡è®°æ˜¯è¯­è¨€ä¸­çš„è¯æ±‡ï¼Œå³æ„æˆå†…å®¹çš„å•ä½ã€‚åœ¨äººç±»è¯­è¨€ä¸­ï¼Œå®ƒç›¸å½“äºè¯­è¨€å­—å…¸ä¸­çš„å•è¯ã€‚</p><p>è¯­æ³•åˆ†ææ˜¯åº”ç”¨è¯­è¨€çš„è¯­æ³•è§„åˆ™çš„è¿‡ç¨‹ã€‚</p><p>è§£æå™¨é€šå¸¸å°†è§£æå·¥ä½œåˆ†ç»™ä»¥ä¸‹ä¸¤ä¸ªç»„ä»¶æ¥å¤„ç†ï¼š<strong>è¯æ³•åˆ†æå™¨</strong>ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºæ ‡è®°ç”Ÿæˆå™¨ï¼‰ï¼Œè´Ÿè´£å°†è¾“å…¥å†…å®¹åˆ†è§£æˆä¸€ä¸ªä¸ªæœ‰æ•ˆæ ‡è®°ï¼›è€Œ<strong>è§£æå™¨</strong>è´Ÿè´£æ ¹æ®è¯­è¨€çš„è¯­æ³•è§„åˆ™åˆ†ææ–‡æ¡£çš„ç»“æ„ï¼Œä»è€Œæ„å»ºè§£ææ ‘ã€‚è¯æ³•åˆ†æå™¨çŸ¥é“å¦‚ä½•å°†æ— å…³çš„å­—ç¬¦ï¼ˆæ¯”å¦‚ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼‰åˆ†ç¦»å‡ºæ¥ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image011.png" alt=""> å›¾ï¼šä»æºæ–‡æ¡£åˆ°è§£ææ ‘</p><p>è§£ææ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ã€‚é€šå¸¸ï¼Œè§£æå™¨ä¼šå‘è¯æ³•åˆ†æå™¨è¯·æ±‚ä¸€ä¸ªæ–°æ ‡è®°ï¼Œå¹¶å°è¯•å°†å…¶ä¸æŸæ¡è¯­æ³•è§„åˆ™è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœå‘ç°äº†åŒ¹é…è§„åˆ™ï¼Œè§£æå™¨ä¼šå°†ä¸€ä¸ªå¯¹åº”äºè¯¥æ ‡è®°çš„èŠ‚ç‚¹æ·»åŠ åˆ°è§£ææ ‘ä¸­ï¼Œç„¶åç»§ç»­è¯·æ±‚ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚</p><p>å¦‚æœæ²¡æœ‰è§„åˆ™å¯ä»¥åŒ¹é…ï¼Œè§£æå™¨å°±ä¼šå°†æ ‡è®°å­˜å‚¨åˆ°å†…éƒ¨ï¼Œå¹¶ç»§ç»­è¯·æ±‚æ ‡è®°ï¼Œç›´è‡³æ‰¾åˆ°å¯ä¸æ‰€æœ‰å†…éƒ¨å­˜å‚¨çš„æ ‡è®°åŒ¹é…çš„è§„åˆ™ã€‚å¦‚æœæ‰¾ä¸åˆ°ä»»ä½•åŒ¹é…è§„åˆ™ï¼Œè§£æå™¨å°±ä¼šå¼•å‘ä¸€ä¸ªå¼‚å¸¸ã€‚è¿™æ„å‘³ç€æ–‡æ¡£æ— æ•ˆï¼ŒåŒ…å«è¯­æ³•é”™è¯¯ã€‚</p><h4 id="ç¿»è¯‘"><a href="#ç¿»è¯‘" class="headerlink" title="ç¿»è¯‘"></a>ç¿»è¯‘</h4><p>å¾ˆå¤šæ—¶å€™ï¼Œè§£ææ ‘è¿˜ä¸æ˜¯æœ€ç»ˆäº§å“ã€‚è§£æé€šå¸¸æ˜¯åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼Œè€Œç¿»è¯‘æ˜¯æŒ‡å°†è¾“å…¥æ–‡æ¡£è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ã€‚ç¼–è¯‘å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚ç¼–è¯‘å™¨å¯å°†æºä»£ç ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œå…·ä½“è¿‡ç¨‹æ˜¯é¦–å…ˆå°†æºä»£ç è§£ææˆè§£ææ ‘ï¼Œç„¶åå°†è§£ææ ‘ç¿»è¯‘æˆæœºå™¨ä»£ç æ–‡æ¡£ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image013.png" alt=""> å›¾ï¼šç¼–è¯‘æµç¨‹</p><h4 id="è§£æç¤ºä¾‹"><a href="#è§£æç¤ºä¾‹" class="headerlink" title="è§£æç¤ºä¾‹"></a>è§£æç¤ºä¾‹</h4><p>åœ¨å›¾ 5 ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼å»ºç«‹äº†è§£ææ ‘ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯•ç€å®šä¹‰ä¸€ä¸ªç®€å•çš„æ•°å­¦è¯­è¨€ï¼Œç”¨æ¥æ¼”ç¤ºè§£æçš„è¿‡ç¨‹ã€‚</p><p>è¯æ±‡ï¼šæˆ‘ä»¬ç”¨çš„è¯­è¨€å¯åŒ…å«æ•´æ•°ã€åŠ å·å’Œå‡å·ã€‚</p><p>è¯­æ³•ï¼š</p><ol><li>æ„æˆè¯­è¨€çš„è¯­æ³•å•ä½æ˜¯è¡¨è¾¾å¼ã€é¡¹å’Œè¿ç®—ç¬¦ã€‚</li><li>æˆ‘ä»¬ç”¨çš„è¯­è¨€å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„è¡¨è¾¾å¼ã€‚</li><li>è¡¨è¾¾å¼çš„å®šä¹‰æ˜¯ï¼šä¸€ä¸ª â€œé¡¹â€ æ¥ä¸€ä¸ªâ€œè¿ç®—ç¬¦â€ï¼Œç„¶åå†æ¥ä¸€ä¸ªâ€œé¡¹â€ã€‚</li><li>è¿ç®—ç¬¦æ˜¯åŠ å·æˆ–å‡å·ã€‚</li><li>é¡¹æ˜¯ä¸€ä¸ªæ•´æ•°æˆ–ä¸€ä¸ªè¡¨è¾¾å¼ã€‚</li></ol><p>è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹ 2 + 3 - 1ã€‚<br>åŒ¹é…è¯­æ³•è§„åˆ™çš„ç¬¬ä¸€ä¸ªå­ä¸²æ˜¯ 2ï¼Œè€Œæ ¹æ®ç¬¬ 5 æ¡è¯­æ³•è§„åˆ™ï¼Œè¿™æ˜¯ä¸€ä¸ªé¡¹ã€‚åŒ¹é…è¯­æ³•è§„åˆ™çš„ç¬¬äºŒä¸ªå­ä¸²æ˜¯ 2 + 3ï¼Œè€Œæ ¹æ®ç¬¬ 3 æ¡è§„åˆ™ï¼ˆä¸€ä¸ªé¡¹æ¥ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç„¶åå†æ¥ä¸€ä¸ªé¡¹ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹å·²ç»åˆ°äº†è¾“å…¥çš„ç»“æŸã€‚2 + 3 - 1 æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“ 2 + 3 æ˜¯ä¸€ä¸ªé¡¹ï¼Œè¿™æ ·å°±ç¬¦åˆ â€œä¸€ä¸ªé¡¹æ¥ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç„¶åå†æ¥ä¸€ä¸ªé¡¹â€ çš„è§„åˆ™ã€‚2 + + ä¸ä¸ä»»ä½•è§„åˆ™åŒ¹é…ï¼Œå› æ­¤æ˜¯æ— æ•ˆçš„è¾“å…¥ã€‚</p><h4 id="è¯æ±‡å’Œè¯­æ³•çš„æ­£å¼å®šä¹‰"><a href="#è¯æ±‡å’Œè¯­æ³•çš„æ­£å¼å®šä¹‰" class="headerlink" title="è¯æ±‡å’Œè¯­æ³•çš„æ­£å¼å®šä¹‰"></a>è¯æ±‡å’Œè¯­æ³•çš„æ­£å¼å®šä¹‰</h4><p>è¯æ±‡é€šå¸¸ç”¨<a href="http://www.regular-expressions.info/" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼</a>è¡¨ç¤ºã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹è¯­è¨€å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INTEGER :0|[1-9][0-9]*</span><br><span class="line">PLUS : +</span><br><span class="line">MINUS: -</span><br></pre></td></tr></table></figure><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™é‡Œç”¨æ­£åˆ™è¡¨è¾¾å¼ç»™å‡ºäº†æ•´æ•°çš„å®šä¹‰ã€‚</p><p>è¯­æ³•é€šå¸¸ä½¿ç”¨ä¸€ç§ç§°ä¸º <a href="http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form" target="_blank" rel="noopener">BNF</a> çš„æ ¼å¼æ¥å®šä¹‰ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹è¯­è¨€å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expression :=  term  operation  term</span><br><span class="line">operation :=  PLUS | MINUS</span><br><span class="line">term := INTEGER | expression</span><br></pre></td></tr></table></figure><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚æœè¯­è¨€çš„è¯­æ³•æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼Œå°±å¯ä»¥ç”±å¸¸è§„è§£æå™¨è¿›è¡Œè§£æã€‚ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•çš„ç›´è§‚å®šä¹‰å°±æ˜¯å¯ä»¥å®Œå…¨ç”¨ BNF æ ¼å¼è¡¨è¾¾çš„è¯­æ³•ã€‚æœ‰å…³æ­£å¼å®šä¹‰ï¼Œè¯·å‚é˜…<a href="http://en.wikipedia.org/wiki/Context-free_grammar" target="_blank" rel="noopener">å…³äºä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•çš„ç»´åŸºç™¾ç§‘æ–‡ç« </a>ã€‚</p><h4 id="è§£æå™¨ç±»å‹"><a href="#è§£æå™¨ç±»å‹" class="headerlink" title="è§£æå™¨ç±»å‹"></a>è§£æå™¨ç±»å‹</h4><p>æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹çš„è§£æå™¨ï¼šè‡ªä¸Šè€Œä¸‹è§£æå™¨å’Œè‡ªä¸‹è€Œä¸Šè§£æå™¨ã€‚ç›´è§‚åœ°æ¥è¯´ï¼Œè‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ä»è¯­æ³•çš„é«˜å±‚ç»“æ„å‡ºå‘ï¼Œå°è¯•ä»ä¸­æ‰¾åˆ°åŒ¹é…çš„ç»“æ„ã€‚è€Œè‡ªä¸‹è€Œä¸Šçš„è§£æå™¨ä»ä½å±‚è§„åˆ™å‡ºå‘ï¼Œå°†è¾“å…¥å†…å®¹é€æ­¥è½¬åŒ–ä¸ºè¯­æ³•è§„åˆ™ï¼Œç›´è‡³æ»¡è¶³é«˜å±‚è§„åˆ™ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ç§è§£æå™¨ä¼šå¦‚ä½•è§£ææˆ‘ä»¬çš„ç¤ºä¾‹ï¼š</p><p>è‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ä¼šä»é«˜å±‚çš„è§„åˆ™å¼€å§‹ï¼šé¦–å…ˆå°† 2 + 3 æ ‡è¯†ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç„¶åå°† 2 + 3 - 1 æ ‡è¯†ä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆæ ‡è¯†è¡¨è¾¾å¼çš„è¿‡ç¨‹æ¶‰åŠåˆ°åŒ¹é…å…¶ä»–è§„åˆ™ï¼Œä½†æ˜¯èµ·ç‚¹æ˜¯æœ€é«˜çº§åˆ«çš„è§„åˆ™ï¼‰ã€‚</p><p>è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨å°†æ‰«æè¾“å…¥å†…å®¹ï¼Œæ‰¾åˆ°åŒ¹é…çš„è§„åˆ™åï¼Œå°†åŒ¹é…çš„è¾“å…¥å†…å®¹æ›¿æ¢æˆè§„åˆ™ã€‚å¦‚æ­¤ç»§ç»­æ›¿æ¢ï¼Œç›´åˆ°è¾“å…¥å†…å®¹çš„ç»“å°¾ã€‚éƒ¨åˆ†åŒ¹é…çš„è¡¨è¾¾å¼ä¿å­˜åœ¨è§£æå™¨çš„å †æ ˆä¸­ã€‚</p><table><thead><tr><th>å †æ ˆ</th><th>è¾“å…¥</th></tr></thead><tbody><tr><td></td><td>2 + 3 - 1</td></tr><tr><td>é¡¹</td><td>+ 3 - 1</td></tr><tr><td>é¡¹è¿ç®—</td><td>3 - 1</td></tr><tr><td>è¡¨è¾¾å¼</td><td>- 1</td></tr><tr><td>è¡¨è¾¾å¼è¿ç®—ç¬¦</td><td>1</td></tr><tr><td>è¡¨è¾¾å¼</td></tr></tbody></table><p>è¿™ç§è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨ç§°ä¸ºç§»ä½å½’çº¦è§£æå™¨ï¼Œå› ä¸ºè¾“å…¥åœ¨å‘å³ç§»ä½ï¼ˆè®¾æƒ³æœ‰ä¸€ä¸ªæŒ‡é’ˆä»è¾“å…¥å†…å®¹çš„å¼€å¤´ç§»åŠ¨åˆ°ç»“å°¾ï¼‰ï¼Œå¹¶ä¸”é€æ¸å½’çº¦åˆ°è¯­æ³•è§„åˆ™ä¸Šã€‚</p><h4 id="è‡ªåŠ¨ç”Ÿæˆè§£æå™¨"><a href="#è‡ªåŠ¨ç”Ÿæˆè§£æå™¨" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆè§£æå™¨"></a>è‡ªåŠ¨ç”Ÿæˆè§£æå™¨</h4><p>æœ‰ä¸€äº›å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨ç”Ÿæˆè§£æå™¨ï¼Œå®ƒä»¬ç§°ä¸ºè§£æå™¨ç”Ÿæˆå™¨ã€‚æ‚¨åªè¦å‘å…¶æä¾›æ‚¨æ‰€ç”¨è¯­è¨€çš„è¯­æ³•ï¼ˆè¯æ±‡å’Œè¯­æ³•è§„åˆ™ï¼‰ï¼Œå®ƒå°±ä¼šç”Ÿæˆç›¸åº”çš„è§£æå™¨ã€‚åˆ›å»ºè§£æå™¨éœ€è¦å¯¹è§£ææœ‰æ·±åˆ»ç†è§£ï¼Œè€Œäººå·¥åˆ›å»ºå¹¶ä¼˜åŒ–è§£æå™¨å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œæ‰€ä»¥è§£æå™¨ç”Ÿæˆå™¨æ˜¯éå¸¸å®ç”¨çš„ã€‚</p><p>WebKit ä½¿ç”¨äº†ä¸¤ç§éå¸¸æœ‰åçš„è§£æå™¨ç”Ÿæˆå™¨ï¼šç”¨äºåˆ›å»ºè¯æ³•åˆ†æå™¨çš„ <a href="http://en.wikipedia.org/wiki/Flex_lexical_analyser" target="_blank" rel="noopener">Flex</a> ä»¥åŠç”¨äºåˆ›å»ºè§£æå™¨çš„ <a href="http://www.gnu.org/software/bison/" target="_blank" rel="noopener">Bison</a>ï¼ˆæ‚¨ä¹Ÿå¯èƒ½é‡åˆ° Lex å’Œ Yacc è¿™æ ·çš„åˆ«åï¼‰ã€‚Flex çš„è¾“å…¥æ˜¯åŒ…å«æ ‡è®°çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„æ–‡ä»¶ã€‚Bison çš„è¾“å…¥æ˜¯é‡‡ç”¨ BNF æ ¼å¼çš„è¯­è¨€è¯­æ³•è§„åˆ™ã€‚</p><h3 id="HTML-è§£æå™¨"><a href="#HTML-è§£æå™¨" class="headerlink" title="HTML è§£æå™¨"></a>HTML è§£æå™¨</h3><p>HTML è§£æå™¨çš„ä»»åŠ¡æ˜¯å°† HTML æ ‡è®°è§£ææˆè§£ææ ‘ã€‚</p><h4 id="HTML-è¯­æ³•å®šä¹‰"><a href="#HTML-è¯­æ³•å®šä¹‰" class="headerlink" title="HTML è¯­æ³•å®šä¹‰"></a>HTML è¯­æ³•å®šä¹‰</h4><p>HTML çš„è¯æ±‡å’Œè¯­æ³•åœ¨ W3C ç»„ç»‡åˆ›å»ºçš„<a href="#w3c">è§„èŒƒ</a>ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚å½“å‰çš„ç‰ˆæœ¬æ˜¯ HTML4ï¼ŒHTML5 æ­£åœ¨å¤„ç†è¿‡ç¨‹ä¸­ã€‚</p><h4 id="éä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•"><a href="#éä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•" class="headerlink" title="éä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•"></a>éä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•</h4><p>æ­£å¦‚æˆ‘ä»¬åœ¨è§£æè¿‡ç¨‹çš„ç®€ä»‹ä¸­å·²ç»äº†è§£åˆ°çš„ï¼Œè¯­æ³•å¯ä»¥ç”¨ BNF ç­‰æ ¼å¼è¿›è¡Œæ­£å¼å®šä¹‰ã€‚</p><p>å¾ˆé—æ†¾ï¼Œæ‰€æœ‰çš„å¸¸è§„è§£æå™¨éƒ½ä¸é€‚ç”¨äº HTMLï¼ˆæˆ‘å¹¶ä¸æ˜¯å¼€ç©ç¬‘ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºè§£æ CSS å’Œ JavaScriptï¼‰ã€‚HTML å¹¶ä¸èƒ½å¾ˆå®¹æ˜“åœ°ç”¨è§£æå™¨æ‰€éœ€çš„ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•æ¥å®šä¹‰ã€‚</p><p>æœ‰ä¸€ç§å¯ä»¥å®šä¹‰ HTML çš„æ­£è§„æ ¼å¼ï¼šDTDï¼ˆDocument Type Definitionï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰ï¼Œä½†å®ƒä¸æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ã€‚</p><p>è¿™åˆçœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼šHTML å’Œ XML éå¸¸ç›¸ä¼¼ã€‚æœ‰å¾ˆå¤š XML è§£æå™¨å¯ä»¥ä½¿ç”¨ã€‚HTML å­˜åœ¨ä¸€ä¸ª XML å˜ä½“ (XHTML)ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆå¤§çš„åŒºåˆ«å‘¢ï¼Ÿ</p><p>åŒºåˆ«åœ¨äº HTML çš„å¤„ç†æ›´ä¸º â€œå®½å®¹â€ï¼Œå®ƒå…è®¸æ‚¨çœç•¥æŸäº›éšå¼æ·»åŠ çš„æ ‡è®°ï¼Œæœ‰æ—¶è¿˜èƒ½çœç•¥ä¸€äº›èµ·å§‹æˆ–è€…ç»“æŸæ ‡è®°ç­‰ç­‰ã€‚å’Œ XML ä¸¥æ ¼çš„è¯­æ³•ä¸åŒï¼ŒHTML æ•´ä½“æ¥çœ‹æ˜¯ä¸€ç§â€œè½¯æ€§â€ çš„è¯­æ³•ã€‚</p><p>æ˜¾ç„¶ï¼Œè¿™ç§çœ‹ä¸Šå»ç»†å¾®çš„å·®åˆ«å®é™…ä¸Šå´å¸¦æ¥äº†å·¨å¤§çš„å½±å“ã€‚ä¸€æ–¹é¢ï¼Œè¿™æ˜¯ HTML å¦‚æ­¤æµè¡Œçš„åŸå› ï¼šå®ƒèƒ½åŒ…å®¹æ‚¨çš„é”™è¯¯ï¼Œç®€åŒ–ç½‘ç»œå¼€å‘ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆéš¾ç¼–å†™æ­£å¼çš„è¯­æ³•ã€‚æ¦‚æ‹¬åœ°è¯´ï¼ŒHTML æ— æ³•å¾ˆå®¹æ˜“åœ°é€šè¿‡å¸¸è§„è§£æå™¨è§£æï¼ˆå› ä¸ºå®ƒçš„è¯­æ³•ä¸æ˜¯ä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼‰ï¼Œä¹Ÿæ— æ³•é€šè¿‡ XML è§£æå™¨æ¥è§£æã€‚</p><h4 id="HTML-DTD"><a href="#HTML-DTD" class="headerlink" title="HTML DTD"></a>HTML DTD</h4><p>HTML çš„å®šä¹‰é‡‡ç”¨äº† DTD æ ¼å¼ã€‚æ­¤æ ¼å¼å¯ç”¨äºå®šä¹‰ <a href="http://en.wikipedia.org/wiki/Standard_Generalized_Markup_Language" target="_blank" rel="noopener">SGML</a> æ—çš„è¯­è¨€ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰å…è®¸ä½¿ç”¨çš„å…ƒç´ åŠå…¶å±æ€§å’Œå±‚æ¬¡ç»“æ„çš„å®šä¹‰ã€‚å¦‚ä¸Šæ–‡æ‰€è¿°ï¼ŒHTML DTD æ— æ³•æ„æˆä¸ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ã€‚</p><p>DTD å­˜åœ¨ä¸€äº›å˜ä½“ã€‚ä¸¥æ ¼æ¨¡å¼å®Œå…¨éµå®ˆ HTML è§„èŒƒï¼Œè€Œå…¶ä»–æ¨¡å¼å¯æ”¯æŒä»¥å‰çš„æµè§ˆå™¨æ‰€ä½¿ç”¨çš„æ ‡è®°ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ç¡®ä¿å‘ä¸‹å…¼å®¹ä¸€äº›æ—©æœŸç‰ˆæœ¬çš„å†…å®¹ã€‚æœ€æ–°çš„ä¸¥æ ¼æ¨¡å¼ DTD å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a href="http://www.w3.org/TR/html4/strict.dtd" target="_blank" rel="noopener">www.w3.org/TR/html4/strict.dtd</a></p><h4 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h4><p>è§£æå™¨çš„è¾“å‡º â€œè§£ææ ‘â€ æ˜¯ç”± DOM å…ƒç´ å’Œå±æ€§èŠ‚ç‚¹æ„æˆçš„æ ‘ç»“æ„ã€‚DOM æ˜¯æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (Document Object Model) çš„ç¼©å†™ã€‚å®ƒæ˜¯ HTML æ–‡æ¡£çš„å¯¹è±¡è¡¨ç¤ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤–éƒ¨å†…å®¹ï¼ˆä¾‹å¦‚ JavaScriptï¼‰ä¸ HTML å…ƒç´ ä¹‹é—´çš„æ¥å£ã€‚<br>è§£ææ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯ â€œ<a href="http://www.w3.org/TR/1998/REC-DOM-Level-1-19981001/level-one-core.html#i-Document" target="_blank" rel="noopener">Document</a>â€ å¯¹è±¡ã€‚</p><p>DOM ä¸æ ‡è®°ä¹‹é—´å‡ ä¹æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µæ ‡è®°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">      Hello World</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;div&gt; &lt;img src=&quot;example.png&quot;/&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å¯ç¿»è¯‘æˆå¦‚ä¸‹çš„ DOM æ ‘ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image015.png" alt=""> å›¾ï¼šç¤ºä¾‹æ ‡è®°çš„ DOM æ ‘</p><p>å’Œ HTML ä¸€æ ·ï¼ŒDOM ä¹Ÿæ˜¯ç”± W3C ç»„ç»‡æŒ‡å®šçš„ã€‚è¯·å‚è§ <a href="http://www.w3.org/DOM/DOMTR" target="_blank" rel="noopener">www.w3.org/DOM/DOMTR</a>ã€‚è¿™æ˜¯å…³äºæ–‡æ¡£æ“ä½œçš„é€šç”¨è§„èŒƒã€‚å…¶ä¸­ä¸€ä¸ªç‰¹å®šæ¨¡å—æè¿°é’ˆå¯¹ HTML çš„å…ƒç´ ã€‚HTML çš„å®šä¹‰å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a href="http://www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/idl-definitions.html" target="_blank" rel="noopener">www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/idl-definitions.html</a>ã€‚</p><p>æˆ‘æ‰€è¯´çš„æ ‘åŒ…å« DOM èŠ‚ç‚¹ï¼ŒæŒ‡çš„æ˜¯æ ‘æ˜¯ç”±å®ç°äº†æŸä¸ª DOM æ¥å£çš„å…ƒç´ æ„æˆçš„ã€‚æµè§ˆå™¨åœ¨å…·ä½“çš„å®ç°ä¸­ä¼šæœ‰ä¸€äº›ä¾›å†…éƒ¨ä½¿ç”¨çš„å…¶ä»–å±æ€§ã€‚</p><h4 id="è§£æç®—æ³•"><a href="#è§£æç®—æ³•" class="headerlink" title="è§£æç®—æ³•"></a>è§£æç®—æ³•</h4><p>æˆ‘ä»¬åœ¨ä¹‹å‰ç« èŠ‚å·²ç»è¯´è¿‡ï¼ŒHTML æ— æ³•ç”¨å¸¸è§„çš„è‡ªä¸Šè€Œä¸‹æˆ–è‡ªä¸‹è€Œä¸Šçš„è§£æå™¨è¿›è¡Œè§£æã€‚</p><p>åŸå› åœ¨äºï¼š</p><ol><li>è¯­è¨€çš„å®½å®¹æœ¬è´¨ã€‚</li><li>æµè§ˆå™¨å†æ¥å¯¹ä¸€äº›å¸¸è§çš„æ— æ•ˆ HTML ç”¨æ³•é‡‡å–åŒ…å®¹æ€åº¦ã€‚</li><li>è§£æè¿‡ç¨‹éœ€è¦ä¸æ–­åœ°åå¤ã€‚æºå†…å®¹åœ¨è§£æè¿‡ç¨‹ä¸­é€šå¸¸ä¸ä¼šæ”¹å˜ï¼Œä½†æ˜¯åœ¨ HTML ä¸­ï¼Œè„šæœ¬æ ‡è®°å¦‚æœåŒ…å« <code>document.write</code>ï¼Œå°±ä¼šæ·»åŠ é¢å¤–çš„æ ‡è®°ï¼Œè¿™æ ·è§£æè¿‡ç¨‹å®é™…ä¸Šå°±æ›´æ”¹äº†è¾“å…¥å†…å®¹ã€‚</li></ol><p>ç”±äºä¸èƒ½ä½¿ç”¨å¸¸è§„çš„è§£ææŠ€æœ¯ï¼Œæµè§ˆå™¨å°±åˆ›å»ºäº†è‡ªå®šä¹‰çš„è§£æå™¨æ¥è§£æ HTMLã€‚</p><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/parsing.html" target="_blank" rel="noopener">HTML5 è§„èŒƒè¯¦ç»†åœ°æè¿°äº†è§£æç®—æ³•</a>ã€‚æ­¤ç®—æ³•ç”±ä¸¤ä¸ªé˜¶æ®µç»„æˆï¼šæ ‡è®°åŒ–å’Œæ ‘æ„å»ºã€‚</p><p>æ ‡è®°åŒ–æ˜¯è¯æ³•åˆ†æè¿‡ç¨‹ï¼Œå°†è¾“å…¥å†…å®¹è§£ææˆå¤šä¸ªæ ‡è®°ã€‚HTML æ ‡è®°åŒ…æ‹¬èµ·å§‹æ ‡è®°ã€ç»“æŸæ ‡è®°ã€å±æ€§åç§°å’Œå±æ€§å€¼ã€‚</p><p>æ ‡è®°ç”Ÿæˆå™¨è¯†åˆ«æ ‡è®°ï¼Œä¼ é€’ç»™æ ‘æ„é€ å™¨ï¼Œç„¶åæ¥å—ä¸‹ä¸€ä¸ªå­—ç¬¦ä»¥è¯†åˆ«ä¸‹ä¸€ä¸ªæ ‡è®°ï¼›å¦‚æ­¤åå¤ç›´åˆ°è¾“å…¥çš„ç»“æŸã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image017.png" alt=""> å›¾ï¼šHTML è§£ææµç¨‹ï¼ˆæ‘˜è‡ª HTML5 è§„èŒƒï¼‰</p><h4 id="æ ‡è®°åŒ–ç®—æ³•"><a href="#æ ‡è®°åŒ–ç®—æ³•" class="headerlink" title="æ ‡è®°åŒ–ç®—æ³•"></a>æ ‡è®°åŒ–ç®—æ³•</h4><p>è¯¥ç®—æ³•çš„è¾“å‡ºç»“æœæ˜¯ HTML æ ‡è®°ã€‚è¯¥ç®—æ³•ä½¿ç”¨çŠ¶æ€æœºæ¥è¡¨ç¤ºã€‚æ¯ä¸€ä¸ªçŠ¶æ€æ¥æ”¶æ¥è‡ªè¾“å…¥ä¿¡æ¯æµçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¹¶æ ¹æ®è¿™äº›å­—ç¬¦æ›´æ–°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å½“å‰çš„æ ‡è®°åŒ–çŠ¶æ€å’Œæ ‘ç»“æ„çŠ¶æ€ä¼šå½±å“è¿›å…¥ä¸‹ä¸€çŠ¶æ€çš„å†³å®šã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿æ¥æ”¶çš„å­—ç¬¦ç›¸åŒï¼Œå¯¹äºä¸‹ä¸€ä¸ªæ­£ç¡®çš„çŠ¶æ€ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œå…·ä½“å–å†³äºå½“å‰çš„çŠ¶æ€ã€‚è¯¥ç®—æ³•ç›¸å½“å¤æ‚ï¼Œæ— æ³•åœ¨æ­¤è¯¦è¿°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥å¸®åŠ©å¤§å®¶ç†è§£å…¶åŸç†ã€‚</p><p>åŸºæœ¬ç¤ºä¾‹ - å°†ä¸‹é¢çš„ HTML ä»£ç æ ‡è®°åŒ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    Hello world</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åˆå§‹çŠ¶æ€æ˜¯æ•°æ®çŠ¶æ€ã€‚é‡åˆ°å­—ç¬¦ <code>&lt;</code> æ—¶ï¼ŒçŠ¶æ€æ›´æ”¹ä¸º <strong>â€œæ ‡è®°æ‰“å¼€çŠ¶æ€â€</strong>ã€‚æ¥æ”¶ä¸€ä¸ª <code>a-z</code> å­—ç¬¦ä¼šåˆ›å»º â€œèµ·å§‹æ ‡è®°â€ï¼ŒçŠ¶æ€æ›´æ”¹ä¸º <strong>â€œæ ‡è®°åç§°çŠ¶æ€â€</strong>ã€‚è¿™ä¸ªçŠ¶æ€ä¼šä¸€ç›´ä¿æŒåˆ°æ¥æ”¶ <code>&gt;</code> å­—ç¬¦ã€‚åœ¨æ­¤æœŸé—´æ¥æ”¶çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¼šé™„åŠ åˆ°æ–°çš„æ ‡è®°åç§°ä¸Šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ ‡è®°æ˜¯ <code>html</code> æ ‡è®°ã€‚</p><p>é‡åˆ° <code>&gt;</code> æ ‡è®°æ—¶ï¼Œä¼šå‘é€å½“å‰çš„æ ‡è®°ï¼ŒçŠ¶æ€æ”¹å› <strong>â€œæ•°æ®çŠ¶æ€â€</strong>ã€‚<code>&lt;body&gt;</code> æ ‡è®°ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚ç›®å‰ <code>html</code> å’Œ <code>body</code> æ ‡è®°å‡å·²å‘å‡ºã€‚ç°åœ¨æˆ‘ä»¬å›åˆ° <strong>â€œæ•°æ®çŠ¶æ€â€</strong>ã€‚æ¥æ”¶åˆ° <code>Hello world</code> ä¸­çš„ <code>H</code> å­—ç¬¦æ—¶ï¼Œå°†åˆ›å»ºå¹¶å‘é€å­—ç¬¦æ ‡è®°ï¼Œç›´åˆ°æ¥æ”¶ <code>&lt;/body&gt;</code> ä¸­çš„ <code>&lt;</code>ã€‚æˆ‘ä»¬å°†ä¸º <code>Hello world</code> ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½å‘é€ä¸€ä¸ªå­—ç¬¦æ ‡è®°ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å›åˆ° <strong>â€œæ ‡è®°æ‰“å¼€çŠ¶æ€â€</strong>ã€‚æ¥æ”¶ä¸‹ä¸€ä¸ªè¾“å…¥å­—ç¬¦ <code>/</code> æ—¶ï¼Œä¼šåˆ›å»º <code>end tag token</code> å¹¶æ”¹ä¸º <strong>â€œæ ‡è®°åç§°çŠ¶æ€â€</strong>ã€‚æˆ‘ä»¬ä¼šå†æ¬¡ä¿æŒè¿™ä¸ªçŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶ <code>&gt;</code>ã€‚ç„¶åå°†å‘é€æ–°çš„æ ‡è®°ï¼Œå¹¶å›åˆ° <strong>â€œæ•°æ®çŠ¶æ€â€</strong>ã€‚<code>&lt;/html&gt;</code> è¾“å…¥ä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„å¤„ç†ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image019.png" alt=""> å›¾ï¼šå¯¹ç¤ºä¾‹è¾“å…¥è¿›è¡Œæ ‡è®°åŒ–</p><h4 id="æ ‘æ„å»ºç®—æ³•"><a href="#æ ‘æ„å»ºç®—æ³•" class="headerlink" title="æ ‘æ„å»ºç®—æ³•"></a>æ ‘æ„å»ºç®—æ³•</h4><p>åœ¨åˆ›å»ºè§£æå™¨çš„åŒæ—¶ï¼Œä¹Ÿä¼šåˆ›å»º Document å¯¹è±¡ã€‚åœ¨æ ‘æ„å»ºé˜¶æ®µï¼Œä»¥ Document ä¸ºæ ¹èŠ‚ç‚¹çš„ DOM æ ‘ä¹Ÿä¼šä¸æ–­è¿›è¡Œä¿®æ”¹ï¼Œå‘å…¶ä¸­æ·»åŠ å„ç§å…ƒç´ ã€‚æ ‡è®°ç”Ÿæˆå™¨å‘é€çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”±æ ‘æ„å»ºå™¨è¿›è¡Œå¤„ç†ã€‚è§„èŒƒä¸­å®šä¹‰äº†æ¯ä¸ªæ ‡è®°æ‰€å¯¹åº”çš„ DOM å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ä¼šåœ¨æ¥æ”¶åˆ°ç›¸åº”çš„æ ‡è®°æ—¶åˆ›å»ºã€‚è¿™äº›å…ƒç´ ä¸ä»…ä¼šæ·»åŠ åˆ° DOM æ ‘ä¸­ï¼Œè¿˜ä¼šæ·»åŠ åˆ°å¼€æ”¾å…ƒç´ çš„å †æ ˆä¸­ã€‚æ­¤å †æ ˆç”¨äºçº æ­£åµŒå¥—é”™è¯¯å’Œå¤„ç†æœªå…³é—­çš„æ ‡è®°ã€‚å…¶ç®—æ³•ä¹Ÿå¯ä»¥ç”¨çŠ¶æ€æœºæ¥æè¿°ã€‚è¿™äº›çŠ¶æ€ç§°ä¸º â€œæ’å…¥æ¨¡å¼â€ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç¤ºä¾‹è¾“å…¥çš„æ ‘æ„å»ºè¿‡ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    Hello world</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>æ ‘æ„å»ºé˜¶æ®µçš„è¾“å…¥æ˜¯ä¸€ä¸ªæ¥è‡ªæ ‡è®°åŒ–é˜¶æ®µçš„æ ‡è®°åºåˆ—ã€‚ç¬¬ä¸€ä¸ªæ¨¡å¼æ˜¯ <strong>â€œinitial modeâ€</strong>ã€‚æ¥æ”¶ HTML æ ‡è®°åè½¬ä¸º <strong>â€œbefore htmlâ€</strong> æ¨¡å¼ï¼Œå¹¶åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹é‡æ–°å¤„ç†æ­¤æ ‡è®°ã€‚è¿™æ ·ä¼šåˆ›å»ºä¸€ä¸ª HTMLHtmlElement å…ƒç´ ï¼Œå¹¶å°†å…¶é™„åŠ åˆ° Document æ ¹å¯¹è±¡ä¸Šã€‚</p><p>ç„¶åçŠ¶æ€å°†æ”¹ä¸º <strong>â€œbefore headâ€</strong>ã€‚æ­¤æ—¶æˆ‘ä»¬æ¥æ”¶ â€œbodyâ€ æ ‡è®°ã€‚å³ä½¿æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ²¡æœ‰ â€œheadâ€ æ ‡è®°ï¼Œç³»ç»Ÿä¹Ÿä¼šéšå¼åˆ›å»ºä¸€ä¸ª HTMLHeadElementï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ ‘ä¸­ã€‚</p><p>ç°åœ¨æˆ‘ä»¬è¿›å…¥äº† <strong>â€œin headâ€</strong> æ¨¡å¼ï¼Œç„¶åè½¬å…¥ <strong>â€œafter headâ€</strong> æ¨¡å¼ã€‚ç³»ç»Ÿå¯¹ body æ ‡è®°è¿›è¡Œé‡æ–°å¤„ç†ï¼Œåˆ›å»ºå¹¶æ’å…¥ HTMLBodyElementï¼ŒåŒæ—¶æ¨¡å¼è½¬å˜ä¸º <strong>â€œin bodyâ€</strong>ã€‚</p><p>ç°åœ¨ï¼Œæ¥æ”¶ç”± â€œHello worldâ€ å­—ç¬¦ä¸²ç”Ÿæˆçš„ä¸€ç³»åˆ—å­—ç¬¦æ ‡è®°ã€‚æ¥æ”¶ç¬¬ä¸€ä¸ªå­—ç¬¦æ—¶ä¼šåˆ›å»ºå¹¶æ’å…¥ â€œTextâ€ èŠ‚ç‚¹ï¼Œè€Œå…¶ä»–å­—ç¬¦ä¹Ÿå°†é™„åŠ åˆ°è¯¥èŠ‚ç‚¹ã€‚</p><p>æ¥æ”¶ body ç»“æŸæ ‡è®°ä¼šè§¦å‘ <strong>â€œafter bodyâ€</strong> æ¨¡å¼ã€‚ç°åœ¨æˆ‘ä»¬å°†æ¥æ”¶ HTML ç»“æŸæ ‡è®°ï¼Œç„¶åè¿›å…¥ <strong>â€œafter after bodyâ€</strong> æ¨¡å¼ã€‚æ¥æ”¶åˆ°æ–‡ä»¶ç»“æŸæ ‡è®°åï¼Œè§£æè¿‡ç¨‹å°±æ­¤ç»“æŸã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image022.gif" alt=""> å›¾ï¼šç¤ºä¾‹ HTML çš„æ ‘æ„å»º</p><h4 id="è§£æç»“æŸåçš„æ“ä½œ"><a href="#è§£æç»“æŸåçš„æ“ä½œ" class="headerlink" title="è§£æç»“æŸåçš„æ“ä½œ"></a>è§£æç»“æŸåçš„æ“ä½œ</h4><p>åœ¨æ­¤é˜¶æ®µï¼Œæµè§ˆå™¨ä¼šå°†æ–‡æ¡£æ ‡æ³¨ä¸ºäº¤äº’çŠ¶æ€ï¼Œå¹¶å¼€å§‹è§£æé‚£äº›å¤„äº â€œdeferredâ€ æ¨¡å¼çš„è„šæœ¬ï¼Œä¹Ÿå°±æ˜¯é‚£äº›åº”åœ¨æ–‡æ¡£è§£æå®Œæˆåæ‰æ‰§è¡Œçš„è„šæœ¬ã€‚ç„¶åï¼Œæ–‡æ¡£çŠ¶æ€å°†è®¾ç½®ä¸º â€œå®Œæˆâ€ï¼Œä¸€ä¸ªâ€œåŠ è½½â€ äº‹ä»¶å°†éšä¹‹è§¦å‘ã€‚</p><p>æ‚¨å¯ä»¥<a href="http://www.w3.org/TR/html5/syntax.html#html-parser" target="_blank" rel="noopener">åœ¨ HTML5 è§„èŒƒä¸­æŸ¥çœ‹æ ‡è®°åŒ–å’Œæ ‘æ„å»ºçš„å®Œæ•´ç®—æ³•</a></p><h4 id="æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶"><a href="#æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶" class="headerlink" title="æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶"></a>æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶</h4><p>æ‚¨åœ¨æµè§ˆ HTML ç½‘é¡µæ—¶ä»æ¥ä¸ä¼šçœ‹åˆ° â€œè¯­æ³•æ— æ•ˆâ€ çš„é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ä¼šçº æ­£ä»»ä½•æ— æ•ˆå†…å®¹ï¼Œç„¶åç»§ç»­å·¥ä½œã€‚</p><p>ä»¥ä¸‹é¢çš„ HTML ä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;mytag&gt;</span><br><span class="line">  &lt;/mytag&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">  &lt;p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    Really lousy HTML</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘å·²ç»è¿åäº†å¾ˆå¤šè¯­æ³•è§„åˆ™ï¼ˆâ€œmytagâ€ä¸æ˜¯æ ‡å‡†çš„æ ‡è®°ï¼Œâ€œpâ€å’Œ â€œdivâ€ å…ƒç´ ä¹‹é—´çš„åµŒå¥—æœ‰è¯¯ç­‰ç­‰ï¼‰ï¼Œä½†æ˜¯æµè§ˆå™¨ä»ç„¶ä¼šæ­£ç¡®åœ°æ˜¾ç¤ºè¿™äº›å†…å®¹ï¼Œå¹¶ä¸”æ¯«æ— æ€¨è¨€ã€‚å› ä¸ºæœ‰å¤§é‡çš„è§£æå™¨ä»£ç ä¼šçº æ­£ HTML ç½‘é¡µä½œè€…çš„é”™è¯¯ã€‚</p><p>ä¸åŒæµè§ˆå™¨çš„é”™è¯¯å¤„ç†æœºåˆ¶ç›¸å½“ä¸€è‡´ï¼Œä½†ä»¤äººç§°å¥‡çš„æ˜¯ï¼Œè¿™ç§æœºåˆ¶å¹¶ä¸æ˜¯ HTML å½“å‰è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å’Œä¹¦ç­¾ç®¡ç†ä»¥åŠå‰è¿› / åé€€æŒ‰é’®ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯æµè§ˆå™¨åœ¨å¤šå¹´å‘å±•ä¸­çš„äº§ç‰©ã€‚å¾ˆå¤šç½‘ç«™éƒ½æ™®éå­˜åœ¨ç€ä¸€äº›å·²çŸ¥çš„æ— æ•ˆ HTML ç»“æ„ï¼Œæ¯ä¸€ç§æµè§ˆå™¨éƒ½ä¼šå°è¯•é€šè¿‡å’Œå…¶ä»–æµè§ˆå™¨ä¸€æ ·çš„æ–¹å¼æ¥ä¿®å¤è¿™äº›æ— æ•ˆç»“æ„ã€‚</p><p>HTML5 è§„èŒƒå®šä¹‰äº†ä¸€éƒ¨åˆ†è¿™æ ·çš„è¦æ±‚ã€‚WebKit åœ¨ HTML è§£æå™¨ç±»çš„å¼€å¤´æ³¨é‡Šä¸­å¯¹æ­¤åšäº†å¾ˆå¥½çš„æ¦‚æ‹¬ã€‚</p><blockquote><p>è§£æå™¨å¯¹æ ‡è®°åŒ–è¾“å…¥å†…å®¹è¿›è¡Œè§£æï¼Œä»¥æ„å»ºæ–‡æ¡£æ ‘ã€‚å¦‚æœæ–‡æ¡£çš„æ ¼å¼æ­£ç¡®ï¼Œå°±ç›´æ¥è¿›è¡Œè§£æã€‚</p><p>é—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å¤„ç†å¾ˆå¤šæ ¼å¼é”™è¯¯çš„ HTML æ–‡æ¡£ï¼Œæ‰€ä»¥è§£æå™¨å¿…é¡»å…·å¤‡ä¸€å®šçš„å®¹é”™æ€§ã€‚</p><p>æˆ‘ä»¬è‡³å°‘è¦èƒ½å¤Ÿå¤„ç†ä»¥ä¸‹é”™è¯¯æƒ…å†µï¼š</p><ol><li>æ˜æ˜¾ä¸èƒ½åœ¨æŸäº›å¤–éƒ¨æ ‡è®°ä¸­æ·»åŠ çš„å…ƒç´ ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å…³é—­æ‰€æœ‰æ ‡è®°ï¼Œç›´åˆ°å‡ºç°ç¦æ­¢æ·»åŠ çš„å…ƒç´ ï¼Œç„¶åå†åŠ å…¥è¯¥å…ƒç´ ã€‚</li><li>æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ·»åŠ çš„å…ƒç´ ã€‚è¿™å¾ˆå¯èƒ½æ˜¯ç½‘é¡µä½œè€…å¿˜è®°æ·»åŠ äº†å…¶ä¸­çš„ä¸€äº›æ ‡è®°ï¼ˆæˆ–è€…å…¶ä¸­çš„æ ‡è®°æ˜¯å¯é€‰çš„ï¼‰ã€‚è¿™äº›æ ‡ç­¾å¯èƒ½åŒ…æ‹¬ï¼šHTML HEAD BODY TBODY TR TD LIï¼ˆè¿˜æœ‰é—æ¼çš„å—ï¼Ÿï¼‰ã€‚</li><li>å‘ inline å…ƒç´ å†…æ·»åŠ  block å…ƒç´ ã€‚å…³é—­æ‰€æœ‰ inline å…ƒç´ ï¼Œç›´åˆ°å‡ºç°ä¸‹ä¸€ä¸ªè¾ƒé«˜çº§çš„ block å…ƒç´ ã€‚</li><li>å¦‚æœè¿™æ ·ä»ç„¶æ— æ•ˆï¼Œå¯å…³é—­æ‰€æœ‰å…ƒç´ ï¼Œç›´åˆ°å¯ä»¥æ·»åŠ å…ƒç´ ä¸ºæ­¢ï¼Œæˆ–è€…å¿½ç•¥è¯¥æ ‡è®°ã€‚</li></ol></blockquote><p>è®©æˆ‘ä»¬çœ‹ä¸€äº› WebKit å®¹é”™çš„ç¤ºä¾‹ï¼š</p><h5 id="ä½¿ç”¨äº†-è€Œä¸æ˜¯"><a href="#ä½¿ç”¨äº†-è€Œä¸æ˜¯" class="headerlink" title="ä½¿ç”¨äº†  è€Œä¸æ˜¯ "></a>ä½¿ç”¨äº†<br>è€Œä¸æ˜¯<br></h5><p>æœ‰äº›ç½‘ç«™ä½¿ç”¨äº†<br>è€Œä¸æ˜¯<br>ã€‚ä¸ºäº†ä¸ IE å’Œ Firefox å…¼å®¹ï¼ŒWebKit å°†å…¶ä¸<br>åšåŒæ ·çš„å¤„ç†ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (t-&gt;isCloseTag(brTag) &amp;&amp; m_document-&gt;inCompatMode()) &#123;</span><br><span class="line">     reportError(MalformedBRError);</span><br><span class="line">     t-&gt;beginTag = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œé”™è¯¯å¤„ç†æ˜¯åœ¨å†…éƒ¨è¿›è¡Œçš„ï¼Œç”¨æˆ·å¹¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h5 id="ç¦»æ•£è¡¨æ ¼"><a href="#ç¦»æ•£è¡¨æ ¼" class="headerlink" title="ç¦»æ•£è¡¨æ ¼"></a>ç¦»æ•£è¡¨æ ¼</h5><p>ç¦»æ•£è¡¨æ ¼æ˜¯æŒ‡ä½äºå…¶ä»–è¡¨æ ¼å†…å®¹ä¸­ï¼Œä½†åˆä¸åœ¨ä»»ä½•ä¸€ä¸ªå•å…ƒæ ¼å†…çš„è¡¨æ ¼ã€‚<br>æ¯”å¦‚ä»¥ä¸‹çš„ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure><p>WebKit ä¼šå°†å…¶å±‚æ¬¡ç»“æ„æ›´æ”¹ä¸ºä¸¤ä¸ªåŒçº§è¡¨æ ¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (m_inStrayTableContent &amp;&amp; localName == tableTag)</span><br><span class="line">        popBlock(tableTag);</span><br></pre></td></tr></table></figure><p>WebKit ä½¿ç”¨ä¸€ä¸ªå †æ ˆæ¥ä¿å­˜å½“å‰çš„å…ƒç´ å†…å®¹ï¼Œå®ƒä¼šä»å¤–éƒ¨è¡¨æ ¼çš„å †æ ˆä¸­å¼¹å‡ºå†…éƒ¨è¡¨æ ¼ã€‚ç°åœ¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ ¼å°±å˜æˆäº†åŒçº§å…³ç³»ã€‚</p><h5 id="åµŒå¥—çš„è¡¨å•å…ƒç´ "><a href="#åµŒå¥—çš„è¡¨å•å…ƒç´ " class="headerlink" title="åµŒå¥—çš„è¡¨å•å…ƒç´ "></a>åµŒå¥—çš„è¡¨å•å…ƒç´ </h5><p>å¦‚æœç”¨æˆ·åœ¨ä¸€ä¸ªè¡¨å•å…ƒç´ ä¸­åˆæ”¾å…¥äº†å¦ä¸€ä¸ªè¡¨å•ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè¡¨å•å°†è¢«å¿½ç•¥ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!m_currentFormElement) &#123;</span><br><span class="line">        m_currentFormElement = new HTMLFormElement(formTag,    m_document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¿‡äºå¤æ‚çš„æ ‡è®°å±‚æ¬¡ç»“æ„"><a href="#è¿‡äºå¤æ‚çš„æ ‡è®°å±‚æ¬¡ç»“æ„" class="headerlink" title="è¿‡äºå¤æ‚çš„æ ‡è®°å±‚æ¬¡ç»“æ„"></a>è¿‡äºå¤æ‚çš„æ ‡è®°å±‚æ¬¡ç»“æ„</h5><p>ä»£ç çš„æ³¨é‡Šå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bool HTMLParser::allowNestedRedundantTag(const AtomicString&amp; tagName)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">unsigned i = 0;</span><br><span class="line">for (HTMLStackElem* curr = m_blockStack;</span><br><span class="line">         i &lt; cMaxRedundantTagDepth &amp;&amp; curr &amp;&amp; curr-&gt;tagName == tagName;</span><br><span class="line">     curr = curr-&gt;next, i++) &#123; &#125;</span><br><span class="line">return i != cMaxRedundantTagDepth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ”¾é”™ä½ç½®çš„-html-æˆ–è€…-body-ç»“æŸæ ‡è®°"><a href="#æ”¾é”™ä½ç½®çš„-html-æˆ–è€…-body-ç»“æŸæ ‡è®°" class="headerlink" title="æ”¾é”™ä½ç½®çš„ html æˆ–è€… body ç»“æŸæ ‡è®°"></a>æ”¾é”™ä½ç½®çš„ html æˆ–è€… body ç»“æŸæ ‡è®°</h5><p>åŒæ ·ï¼Œä»£ç çš„æ³¨é‡Šå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ã€‚</p><blockquote><p>æ”¯æŒæ ¼å¼éå¸¸ç³Ÿç³•çš„ HTML ä»£ç ã€‚æˆ‘ä»¬ä»ä¸å…³é—­ body æ ‡è®°ï¼Œå› ä¸ºä¸€äº›æ„šè ¢çš„ç½‘é¡µä¼šåœ¨å®é™…æ–‡æ¡£ç»“æŸä¹‹å‰å°±å…³é—­ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨ end() æ¥æ‰§è¡Œå…³é—­æ“ä½œã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (t-&gt;tagName == htmlTag || t-&gt;tagName == bodyTag )</span><br><span class="line">        return;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ç½‘é¡µä½œè€…éœ€è¦æ³¨æ„ï¼Œé™¤éæ‚¨æƒ³ä½œä¸ºåé¢æ•™æå‡ºç°åœ¨ WebKit å®¹é”™ä»£ç æ®µçš„ç¤ºä¾‹ä¸­ï¼Œå¦åˆ™è¿˜è¯·ç¼–å†™æ ¼å¼æ­£ç¡®çš„ HTML ä»£ç ã€‚</p><h3 id="CSS-è§£æ"><a href="#CSS-è§£æ" class="headerlink" title="CSS è§£æ"></a>CSS è§£æ</h3><p>è¿˜è®°å¾—ç®€ä»‹ä¸­è§£æçš„æ¦‚å¿µå—ï¼Ÿå’Œ HTML ä¸åŒï¼ŒCSS æ˜¯ä¸Šä¸‹æ–‡æ— å…³çš„è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ç®€ä»‹ä¸­æè¿°çš„å„ç§è§£æå™¨è¿›è¡Œè§£æã€‚äº‹å®ä¸Šï¼Œ<a href="http://www.w3.org/TR/CSS2/grammar.html" target="_blank" rel="noopener">CSS è§„èŒƒå®šä¹‰äº† CSS çš„è¯æ³•å’Œè¯­æ³•</a>ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç¤ºä¾‹ï¼š<br>è¯æ³•è¯­æ³•ï¼ˆè¯æ±‡ï¼‰æ˜¯é’ˆå¯¹å„ä¸ªæ ‡è®°ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">comment   \/\*[^*]*\*+([^/*][^*]*\*+)*\/</span><br><span class="line">num   [0-9]+|[0-9]*&quot;.&quot;[0-9]+</span><br><span class="line">nonascii  [\200-\377]</span><br><span class="line">nmstart   [_a-z]|&#123;nonascii&#125;|&#123;escape&#125;</span><br><span class="line">nmchar    [_a-z0-9-]|&#123;nonascii&#125;|&#123;escape&#125;</span><br><span class="line">name    &#123;nmchar&#125;+</span><br><span class="line">ident   &#123;nmstart&#125;&#123;nmchar&#125;*</span><br></pre></td></tr></table></figure><p>â€œidentâ€æ˜¯æ ‡è¯†ç¬¦ (identifier) çš„ç¼©å†™ï¼Œæ¯”å¦‚ç±»åã€‚â€œnameâ€æ˜¯å…ƒç´ çš„ IDï¼ˆé€šè¿‡ â€œ#â€ æ¥å¼•ç”¨ï¼‰ã€‚</p><p>è¯­æ³•æ˜¯é‡‡ç”¨ BNF æ ¼å¼æè¿°çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ruleset</span><br><span class="line">  : selector [ &apos;,&apos; S* selector ]*</span><br><span class="line">    &apos;&#123;&apos; S* declaration [ &apos;;&apos; S* declaration ]* &apos;&#125;&apos; S*</span><br><span class="line">  ;</span><br><span class="line">selector</span><br><span class="line">  : simple_selector [ combinator selector | S+ [ combinator? selector ]? ]?</span><br><span class="line">  ;</span><br><span class="line">simple_selector</span><br><span class="line">  : element_name [ HASH | class | attrib | pseudo ]*</span><br><span class="line">  | [ HASH | class | attrib | pseudo ]+</span><br><span class="line">  ;</span><br><span class="line">class</span><br><span class="line">  : &apos;.&apos; IDENT</span><br><span class="line">  ;</span><br><span class="line">element_name</span><br><span class="line">  : IDENT | &apos;*&apos;</span><br><span class="line">  ;</span><br><span class="line">attrib</span><br><span class="line">  : &apos;[&apos; S* IDENT S* [ [ &apos;=&apos; | INCLUDES | DASHMATCH ] S*</span><br><span class="line">    [ IDENT | STRING ] S* ] &apos;]&apos;</span><br><span class="line">  ;</span><br><span class="line">pseudo</span><br><span class="line">  : &apos;:&apos; [ IDENT | FUNCTION S* [IDENT S*] &apos;)&apos; ]</span><br><span class="line">  ;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šè¿™æ˜¯ä¸€ä¸ªè§„åˆ™é›†çš„ç»“æ„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">div.error , a.error &#123;</span><br><span class="line">  color:red;</span><br><span class="line">  font-weight:bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>div.error å’Œ a.error æ˜¯é€‰æ‹©å™¨ã€‚å¤§æ‹¬å·å†…çš„éƒ¨åˆ†åŒ…å«äº†ç”±æ­¤è§„åˆ™é›†åº”ç”¨çš„è§„åˆ™ã€‚æ­¤ç»“æ„çš„æ­£å¼å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ruleset</span><br><span class="line">  : selector [ &apos;,&apos; S* selector ]*</span><br><span class="line">    &apos;&#123;&apos; S* declaration [ &apos;;&apos; S* declaration ]* &apos;&#125;&apos; S*</span><br><span class="line">  ;</span><br></pre></td></tr></table></figure><p>è¿™è¡¨ç¤ºä¸€ä¸ªè§„åˆ™é›†å°±æ˜¯ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œæˆ–è€…ç”±é€—å·å’Œç©ºæ ¼ï¼ˆS è¡¨ç¤ºç©ºæ ¼ï¼‰åˆ†éš”çš„å¤šä¸ªï¼ˆæ•°é‡å¯é€‰ï¼‰é€‰æ‹©å™¨ã€‚è§„åˆ™é›†åŒ…å«äº†å¤§æ‹¬å·ï¼Œä»¥åŠå…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆæ•°é‡å¯é€‰ï¼‰ç”±åˆ†å·åˆ†éš”çš„å£°æ˜ã€‚â€œå£°æ˜â€å’Œ â€œé€‰æ‹©å™¨â€ å°†ç”±ä¸‹é¢çš„ BNF æ ¼å¼å®šä¹‰ã€‚</p><h4 id="WebKit-CSS-è§£æå™¨"><a href="#WebKit-CSS-è§£æå™¨" class="headerlink" title="WebKit CSS è§£æå™¨"></a>WebKit CSS è§£æå™¨</h4><p>WebKit ä½¿ç”¨ <a href="#parser_generators">Flex å’Œ Bison</a> è§£æå™¨ç”Ÿæˆå™¨ï¼Œé€šè¿‡ CSS è¯­æ³•æ–‡ä»¶è‡ªåŠ¨åˆ›å»ºè§£æå™¨ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨è§£æå™¨ç®€ä»‹ä¸­æ‰€è¯´ï¼ŒBison ä¼šåˆ›å»ºè‡ªä¸‹è€Œä¸Šçš„ç§»ä½å½’çº¦è§£æå™¨ã€‚Firefox ä½¿ç”¨çš„æ˜¯äººå·¥ç¼–å†™çš„è‡ªä¸Šè€Œä¸‹çš„è§£æå™¨ã€‚è¿™ä¸¤ç§è§£æå™¨éƒ½ä¼šå°† CSS æ–‡ä»¶è§£ææˆ StyleSheet å¯¹è±¡ï¼Œä¸”æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å« CSS è§„åˆ™ã€‚CSS è§„åˆ™å¯¹è±¡åˆ™åŒ…å«é€‰æ‹©å™¨å’Œå£°æ˜å¯¹è±¡ï¼Œä»¥åŠå…¶ä»–ä¸ CSS è¯­æ³•å¯¹åº”çš„å¯¹è±¡ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image023.png" alt=""> å›¾ï¼šè§£æ CSS</p><h3 id="å¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåº"><a href="#å¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåº" class="headerlink" title="å¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåº"></a>å¤„ç†è„šæœ¬å’Œæ ·å¼è¡¨çš„é¡ºåº</h3><h4 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h4><p>ç½‘ç»œçš„æ¨¡å‹æ˜¯åŒæ­¥çš„ã€‚ç½‘é¡µä½œè€…å¸Œæœ›è§£æå™¨é‡åˆ° <code>&lt;script&gt;</code> æ ‡è®°æ—¶ç«‹å³è§£æå¹¶æ‰§è¡Œè„šæœ¬ã€‚æ–‡æ¡£çš„è§£æå°†åœæ­¢ï¼Œç›´åˆ°è„šæœ¬æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœè„šæœ¬æ˜¯å¤–éƒ¨çš„ï¼Œé‚£ä¹ˆè§£æè¿‡ç¨‹ä¼šåœæ­¢ï¼Œç›´åˆ°ä»ç½‘ç»œåŒæ­¥æŠ“å–èµ„æºå®Œæˆåå†ç»§ç»­ã€‚æ­¤æ¨¡å‹å·²ç»ä½¿ç”¨äº†å¤šå¹´ï¼Œä¹Ÿåœ¨ HTML4 å’Œ HTML5 è§„èŒƒä¸­è¿›è¡Œäº†æŒ‡å®šã€‚ä½œè€…ä¹Ÿå¯ä»¥å°†è„šæœ¬æ ‡æ³¨ä¸º â€œdeferâ€ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šåœæ­¢æ–‡æ¡£è§£æï¼Œè€Œæ˜¯ç­‰åˆ°è§£æç»“æŸæ‰æ‰§è¡Œã€‚HTML5 å¢åŠ äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯å°†è„šæœ¬æ ‡è®°ä¸ºå¼‚æ­¥ï¼Œä»¥ä¾¿ç”±å…¶ä»–çº¿ç¨‹è§£æå’Œæ‰§è¡Œã€‚</p><h4 id="é¢„è§£æ"><a href="#é¢„è§£æ" class="headerlink" title="é¢„è§£æ"></a>é¢„è§£æ</h4><p>WebKit å’Œ Firefox éƒ½è¿›è¡Œäº†è¿™é¡¹ä¼˜åŒ–ã€‚åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šè§£ææ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ï¼Œæ‰¾å‡ºå¹¶åŠ è½½éœ€è¦é€šè¿‡ç½‘ç»œåŠ è½½çš„å…¶ä»–èµ„æºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œèµ„æºå¯ä»¥åœ¨å¹¶è¡Œè¿æ¥ä¸ŠåŠ è½½ï¼Œä»è€Œæé«˜æ€»ä½“é€Ÿåº¦ã€‚è¯·æ³¨æ„ï¼Œé¢„è§£æå™¨ä¸ä¼šä¿®æ”¹ DOM æ ‘ï¼Œè€Œæ˜¯å°†è¿™é¡¹å·¥ä½œäº¤ç”±ä¸»è§£æå™¨å¤„ç†ï¼›é¢„è§£æå™¨åªä¼šè§£æå¤–éƒ¨èµ„æºï¼ˆä¾‹å¦‚å¤–éƒ¨è„šæœ¬ã€æ ·å¼è¡¨å’Œå›¾ç‰‡ï¼‰çš„å¼•ç”¨ã€‚</p><h4 id="æ ·å¼è¡¨"><a href="#æ ·å¼è¡¨" class="headerlink" title="æ ·å¼è¡¨"></a>æ ·å¼è¡¨</h4><p>å¦ä¸€æ–¹é¢ï¼Œæ ·å¼è¡¨æœ‰ç€ä¸åŒçš„æ¨¡å‹ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œåº”ç”¨æ ·å¼è¡¨ä¸ä¼šæ›´æ”¹ DOM æ ‘ï¼Œå› æ­¤ä¼¼ä¹æ²¡æœ‰å¿…è¦ç­‰å¾…æ ·å¼è¡¨å¹¶åœæ­¢æ–‡æ¡£è§£æã€‚ä½†è¿™æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è„šæœ¬åœ¨æ–‡æ¡£è§£æé˜¶æ®µä¼šè¯·æ±‚æ ·å¼ä¿¡æ¯ã€‚å¦‚æœå½“æ—¶è¿˜æ²¡æœ‰åŠ è½½å’Œè§£ææ ·å¼ï¼Œè„šæœ¬å°±ä¼šè·å¾—é”™è¯¯çš„å›å¤ï¼Œè¿™æ ·æ˜¾ç„¶ä¼šäº§ç”Ÿå¾ˆå¤šé—®é¢˜ã€‚è¿™çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªéå…¸å‹æ¡ˆä¾‹ï¼Œä½†äº‹å®ä¸Šéå¸¸æ™®éã€‚Firefox åœ¨æ ·å¼è¡¨åŠ è½½å’Œè§£æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šç¦æ­¢æ‰€æœ‰è„šæœ¬ã€‚è€Œå¯¹äº WebKit è€Œè¨€ï¼Œä»…å½“è„šæœ¬å°è¯•è®¿é—®çš„æ ·å¼å±æ€§å¯èƒ½å—å°šæœªåŠ è½½çš„æ ·å¼è¡¨å½±å“æ—¶ï¼Œå®ƒæ‰ä¼šç¦æ­¢è¯¥è„šæœ¬ã€‚</p><h3 id="å‘ˆç°æ ‘æ„å»º"><a href="#å‘ˆç°æ ‘æ„å»º" class="headerlink" title="å‘ˆç°æ ‘æ„å»º"></a>å‘ˆç°æ ‘æ„å»º</h3><p>åœ¨ DOM æ ‘æ„å»ºçš„åŒæ—¶ï¼Œæµè§ˆå™¨è¿˜ä¼šæ„å»ºå¦ä¸€ä¸ªæ ‘ç»“æ„ï¼šå‘ˆç°æ ‘ã€‚è¿™æ˜¯ç”±å¯è§†åŒ–å…ƒç´ æŒ‰ç…§å…¶æ˜¾ç¤ºé¡ºåºè€Œç»„æˆçš„æ ‘ï¼Œä¹Ÿæ˜¯æ–‡æ¡£çš„å¯è§†åŒ–è¡¨ç¤ºã€‚å®ƒçš„ä½œç”¨æ˜¯è®©æ‚¨æŒ‰ç…§æ­£ç¡®çš„é¡ºåºç»˜åˆ¶å†…å®¹ã€‚</p><p>Firefox å°†å‘ˆç°æ ‘ä¸­çš„å…ƒç´ ç§°ä¸º â€œæ¡†æ¶â€ã€‚WebKit ä½¿ç”¨çš„æœ¯è¯­æ˜¯å‘ˆç°å™¨æˆ–å‘ˆç°å¯¹è±¡ã€‚<br>å‘ˆç°å™¨çŸ¥é“å¦‚ä½•å¸ƒå±€å¹¶å°†è‡ªèº«åŠå…¶å­å…ƒç´ ç»˜åˆ¶å‡ºæ¥ã€‚<br>WebKits RenderObject ç±»æ˜¯æ‰€æœ‰å‘ˆç°å™¨çš„åŸºç±»ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class RenderObject&#123;</span><br><span class="line">  virtual void layout();</span><br><span class="line">  virtual void paint(PaintInfo);</span><br><span class="line">  virtual void rect repaintRect();</span><br><span class="line">  Node* node;  //the DOM node</span><br><span class="line">  RenderStyle* style;  // the computed style</span><br><span class="line">  RenderLayer* containgLayer; //the containing z-index layer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªå‘ˆç°å™¨éƒ½ä»£è¡¨äº†ä¸€ä¸ªçŸ©å½¢çš„åŒºåŸŸï¼Œé€šå¸¸å¯¹åº”äºç›¸å…³èŠ‚ç‚¹çš„ CSS æ¡†ï¼Œè¿™ä¸€ç‚¹åœ¨ CSS2 è§„èŒƒä¸­æœ‰æ‰€æè¿°ã€‚å®ƒåŒ…å«è¯¸å¦‚å®½åº¦ã€é«˜åº¦å’Œä½ç½®ç­‰å‡ ä½•ä¿¡æ¯ã€‚<br>æ¡†çš„ç±»å‹ä¼šå—åˆ°ä¸èŠ‚ç‚¹ç›¸å…³çš„ â€œdisplayâ€ æ ·å¼å±æ€§çš„å½±å“ï¼ˆè¯·å‚é˜…<a href="#style_computation">æ ·å¼è®¡ç®—</a>ç« èŠ‚ï¼‰ã€‚ä¸‹é¢è¿™æ®µ WebKit ä»£ç æè¿°äº†æ ¹æ® display å±æ€§çš„ä¸åŒï¼Œé’ˆå¯¹åŒä¸€ä¸ª DOM èŠ‚ç‚¹åº”åˆ›å»ºä»€ä¹ˆç±»å‹çš„å‘ˆç°å™¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">RenderObject* RenderObject::createObject(Node* node, RenderStyle* style)</span><br><span class="line">&#123;</span><br><span class="line">    Document* doc = node-&gt;document();</span><br><span class="line">    RenderArena* arena = doc-&gt;renderArena();</span><br><span class="line">    ...</span><br><span class="line">    RenderObject* o = 0;</span><br><span class="line"></span><br><span class="line">    switch (style-&gt;display()) &#123;</span><br><span class="line">        case NONE:</span><br><span class="line">            break;</span><br><span class="line">        case INLINE:</span><br><span class="line">            o = new (arena) RenderInline(node);</span><br><span class="line">            break;</span><br><span class="line">        case BLOCK:</span><br><span class="line">            o = new (arena) RenderBlock(node);</span><br><span class="line">            break;</span><br><span class="line">        case INLINE_BLOCK:</span><br><span class="line">            o = new (arena) RenderBlock(node);</span><br><span class="line">            break;</span><br><span class="line">        case LIST_ITEM:</span><br><span class="line">            o = new (arena) RenderListItem(node);</span><br><span class="line">            break;</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ƒç´ ç±»å‹ä¹Ÿæ˜¯è€ƒè™‘å› ç´ ä¹‹ä¸€ï¼Œä¾‹å¦‚è¡¨å•æ§ä»¶å’Œè¡¨æ ¼éƒ½å¯¹åº”ç‰¹æ®Šçš„æ¡†æ¶ã€‚<br>åœ¨ WebKit ä¸­ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ éœ€è¦åˆ›å»ºç‰¹æ®Šçš„å‘ˆç°å™¨ï¼Œå°±ä¼šæ›¿æ¢ <code>createRenderer</code> æ–¹æ³•ã€‚å‘ˆç°å™¨æ‰€æŒ‡å‘çš„æ ·å¼å¯¹è±¡ä¸­åŒ…å«äº†ä¸€äº›å’Œå‡ ä½•æ— å…³çš„ä¿¡æ¯ã€‚</p><h5 id="å‘ˆç°æ ‘å’Œ-DOM-æ ‘çš„å…³ç³»"><a href="#å‘ˆç°æ ‘å’Œ-DOM-æ ‘çš„å…³ç³»" class="headerlink" title="å‘ˆç°æ ‘å’Œ DOM æ ‘çš„å…³ç³»"></a>å‘ˆç°æ ‘å’Œ DOM æ ‘çš„å…³ç³»</h5><p>å‘ˆç°å™¨æ˜¯å’Œ DOM å…ƒç´ ç›¸å¯¹åº”çš„ï¼Œä½†å¹¶éä¸€ä¸€å¯¹åº”ã€‚éå¯è§†åŒ–çš„ DOM å…ƒç´ ä¸ä¼šæ’å…¥å‘ˆç°æ ‘ä¸­ï¼Œä¾‹å¦‚ â€œheadâ€ å…ƒç´ ã€‚å¦‚æœå…ƒç´ çš„ display å±æ€§å€¼ä¸º â€œnoneâ€ï¼Œé‚£ä¹ˆä¹Ÿä¸ä¼šæ˜¾ç¤ºåœ¨å‘ˆç°æ ‘ä¸­ï¼ˆä½†æ˜¯ visibility å±æ€§å€¼ä¸ºâ€œhiddenâ€ çš„å…ƒç´ ä»ä¼šæ˜¾ç¤ºï¼‰ã€‚</p><p>æœ‰ä¸€äº› DOM å…ƒç´ å¯¹åº”å¤šä¸ªå¯è§†åŒ–å¯¹è±¡ã€‚å®ƒä»¬å¾€å¾€æ˜¯å…·æœ‰å¤æ‚ç»“æ„çš„å…ƒç´ ï¼Œæ— æ³•ç”¨å•ä¸€çš„çŸ©å½¢æ¥æè¿°ã€‚ä¾‹å¦‚ï¼Œâ€œselectâ€ å…ƒç´ æœ‰ 3 ä¸ªå‘ˆç°å™¨ï¼šä¸€ä¸ªç”¨äºæ˜¾ç¤ºåŒºåŸŸï¼Œä¸€ä¸ªç”¨äºä¸‹æ‹‰åˆ—è¡¨æ¡†ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºæŒ‰é’®ã€‚å¦‚æœç”±äºå®½åº¦ä¸å¤Ÿï¼Œæ–‡æœ¬æ— æ³•åœ¨ä¸€è¡Œä¸­æ˜¾ç¤ºè€Œåˆ†ä¸ºå¤šè¡Œï¼Œé‚£ä¹ˆæ–°çš„è¡Œä¹Ÿä¼šä½œä¸ºæ–°çš„å‘ˆç°å™¨è€Œæ·»åŠ ã€‚<br>å¦ä¸€ä¸ªå…³äºå¤šå‘ˆç°å™¨çš„ä¾‹å­æ˜¯æ ¼å¼æ— æ•ˆçš„ HTMLã€‚æ ¹æ® CSS è§„èŒƒï¼Œinline å…ƒç´ åªèƒ½åŒ…å« block å…ƒç´ æˆ– inline å…ƒç´ ä¸­çš„ä¸€ç§ã€‚å¦‚æœå‡ºç°äº†æ··åˆå†…å®¹ï¼Œåˆ™åº”åˆ›å»ºåŒ¿åçš„ block å‘ˆç°å™¨ï¼Œä»¥åŒ…è£¹ inline å…ƒç´ ã€‚</p><p>æœ‰ä¸€äº›å‘ˆç°å¯¹è±¡å¯¹åº”äº DOM èŠ‚ç‚¹ï¼Œä½†åœ¨æ ‘ä¸­æ‰€åœ¨çš„ä½ç½®ä¸ DOM èŠ‚ç‚¹ä¸åŒã€‚æµ®åŠ¨å®šä½å’Œç»å¯¹å®šä½çš„å…ƒç´ å°±æ˜¯è¿™æ ·ï¼Œå®ƒä»¬å¤„äºæ­£å¸¸çš„æµç¨‹ä¹‹å¤–ï¼Œæ”¾ç½®åœ¨æ ‘ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œå¹¶æ˜ å°„åˆ°çœŸæ­£çš„æ¡†æ¶ï¼Œè€Œæ”¾åœ¨åŸä½çš„æ˜¯å ä½æ¡†æ¶ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image025.png" alt=""> å›¾ï¼šå‘ˆç°æ ‘åŠå…¶å¯¹åº”çš„ DOM æ ‘ (<a href="#3_1">3.1</a>)ã€‚åˆå§‹å®¹å™¨ block ä¸º â€œviewportâ€ï¼Œè€Œåœ¨ WebKit ä¸­åˆ™ä¸ºâ€œRenderViewâ€ å¯¹è±¡ã€‚</p><h5 id="æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹"><a href="#æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹" class="headerlink" title="æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹"></a>æ„å»ºå‘ˆç°æ ‘çš„æµç¨‹</h5><p>åœ¨ Firefox ä¸­ï¼Œç³»ç»Ÿä¼šé’ˆå¯¹ DOM æ›´æ–°æ³¨å†Œå±•ç¤ºå±‚ï¼Œä½œä¸ºä¾¦å¬å™¨ã€‚å±•ç¤ºå±‚å°†æ¡†æ¶åˆ›å»ºå·¥ä½œå§”æ‰˜ç»™ <code>FrameConstructor</code>ï¼Œç”±è¯¥æ„é€ å™¨è§£ææ ·å¼ï¼ˆè¯·å‚é˜…<a href="#style">æ ·å¼è®¡ç®—</a>ï¼‰å¹¶åˆ›å»ºæ¡†æ¶ã€‚</p><p>åœ¨ WebKit ä¸­ï¼Œè§£ææ ·å¼å’Œåˆ›å»ºå‘ˆç°å™¨çš„è¿‡ç¨‹ç§°ä¸º â€œé™„åŠ â€ã€‚æ¯ä¸ª DOM èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªâ€œattachâ€ æ–¹æ³•ã€‚é™„åŠ æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œå°†èŠ‚ç‚¹æ’å…¥ DOM æ ‘éœ€è¦è°ƒç”¨æ–°çš„èŠ‚ç‚¹ â€œattachâ€ æ–¹æ³•ã€‚</p><p>å¤„ç† html å’Œ body æ ‡è®°å°±ä¼šæ„å»ºå‘ˆç°æ ‘æ ¹èŠ‚ç‚¹ã€‚è¿™ä¸ªæ ¹èŠ‚ç‚¹å‘ˆç°å¯¹è±¡å¯¹åº”äº CSS è§„èŒƒä¸­æ‰€è¯´çš„å®¹å™¨ blockï¼Œè¿™æ˜¯æœ€ä¸Šå±‚çš„ blockï¼ŒåŒ…å«äº†å…¶ä»–æ‰€æœ‰ blockã€‚å®ƒçš„å°ºå¯¸å°±æ˜¯è§†å£ï¼Œå³æµè§ˆå™¨çª—å£æ˜¾ç¤ºåŒºåŸŸçš„å°ºå¯¸ã€‚Firefox ç§°ä¹‹ä¸º <code>ViewPortFrame</code>ï¼Œè€Œ WebKit ç§°ä¹‹ä¸º <code>RenderView</code>ã€‚è¿™å°±æ˜¯æ–‡æ¡£æ‰€æŒ‡å‘çš„å‘ˆç°å¯¹è±¡ã€‚å‘ˆç°æ ‘çš„å…¶ä½™éƒ¨åˆ†ä»¥ DOM æ ‘èŠ‚ç‚¹æ’å…¥çš„å½¢å¼æ¥æ„å»ºã€‚</p><p>è¯·å‚é˜…<a href="http://www.w3.org/TR/CSS21/intro.html#processing-model" target="_blank" rel="noopener">å…³äºå¤„ç†æ¨¡å‹çš„ CSS2 è§„èŒƒ</a>ã€‚</p><h4 id="æ ·å¼è®¡ç®—"><a href="#æ ·å¼è®¡ç®—" class="headerlink" title="æ ·å¼è®¡ç®—"></a>æ ·å¼è®¡ç®—</h4><p>æ„å»ºå‘ˆç°æ ‘æ—¶ï¼Œéœ€è¦è®¡ç®—æ¯ä¸€ä¸ªå‘ˆç°å¯¹è±¡çš„å¯è§†åŒ–å±æ€§ã€‚è¿™æ˜¯é€šè¿‡è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æ ·å¼å±æ€§æ¥å®Œæˆçš„ã€‚</p><p>æ ·å¼åŒ…æ‹¬æ¥è‡ªå„ç§æ¥æºçš„æ ·å¼è¡¨ã€inline æ ·å¼å…ƒç´ å’Œ HTML ä¸­çš„å¯è§†åŒ–å±æ€§ï¼ˆä¾‹å¦‚ â€œbgcolorâ€ å±æ€§ï¼‰ã€‚å…¶ä¸­åè€…å°†ç»è¿‡è½¬åŒ–ä»¥åŒ¹é… CSS æ ·å¼å±æ€§ã€‚</p><p>æ ·å¼è¡¨çš„æ¥æºåŒ…æ‹¬æµè§ˆå™¨çš„é»˜è®¤æ ·å¼è¡¨ã€ç”±ç½‘é¡µä½œè€…æä¾›çš„æ ·å¼è¡¨ä»¥åŠç”±æµè§ˆå™¨ç”¨æˆ·æä¾›çš„ç”¨æˆ·æ ·å¼è¡¨ï¼ˆæµè§ˆå™¨å…è®¸æ‚¨å®šä¹‰è‡ªå·±å–œæ¬¢çš„æ ·å¼ã€‚ä»¥ Firefox ä¸ºä¾‹ï¼Œç”¨æˆ·å¯ä»¥å°†è‡ªå·±å–œæ¬¢çš„æ ·å¼è¡¨æ”¾åœ¨ â€œFirefox Profileâ€ æ–‡ä»¶å¤¹ä¸‹ï¼‰ã€‚</p><p>æ ·å¼è®¡ç®—å­˜åœ¨ä»¥ä¸‹éš¾ç‚¹ï¼š</p><ol><li>æ ·å¼æ•°æ®æ˜¯ä¸€ä¸ªè¶…å¤§çš„ç»“æ„ï¼Œå­˜å‚¨äº†æ— æ•°çš„æ ·å¼å±æ€§ï¼Œè¿™å¯èƒ½é€ æˆå†…å­˜é—®é¢˜ã€‚</li><li><p>å¦‚æœä¸è¿›è¡Œä¼˜åŒ–ï¼Œä¸ºæ¯ä¸€ä¸ªå…ƒç´ æŸ¥æ‰¾åŒ¹é…çš„è§„åˆ™ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚è¦ä¸ºæ¯ä¸€ä¸ªå…ƒç´ éå†æ•´ä¸ªè§„åˆ™åˆ—è¡¨æ¥å¯»æ‰¾åŒ¹é…è§„åˆ™ï¼Œè¿™æ˜¯ä¸€é¡¹æµ©å¤§çš„å·¥ç¨‹ã€‚é€‰æ‹©å™¨ä¼šå…·æœ‰å¾ˆå¤æ‚çš„ç»“æ„ï¼Œè¿™å°±ä¼šå¯¼è‡´æŸä¸ªåŒ¹é…è¿‡ç¨‹ä¸€å¼€å§‹çœ‹èµ·æ¥å¾ˆå¯èƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æœ€ç»ˆå‘ç°å…¶å®æ˜¯å¾’åŠ³çš„ï¼Œå¿…é¡»å°è¯•å…¶ä»–åŒ¹é…è·¯å¾„ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç»„åˆé€‰æ‹©å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div div div div&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><pre><code>è¿™æ„å‘³ç€è§„åˆ™é€‚ç”¨äºä½œä¸º 3 ä¸ª div å…ƒç´ çš„å­ä»£çš„ `&lt;div&gt;`ã€‚å¦‚æœæ‚¨è¦æ£€æŸ¥è§„åˆ™æ˜¯å¦é€‚ç”¨äºæŸä¸ªæŒ‡å®šçš„ `&lt;div&gt;` å…ƒç´ ï¼Œåº”é€‰æ‹©æ ‘ä¸Šçš„ä¸€æ¡å‘ä¸Šè·¯å¾„è¿›è¡Œæ£€æŸ¥ã€‚æ‚¨å¯èƒ½éœ€è¦å‘ä¸Šéå†èŠ‚ç‚¹æ ‘ï¼Œç»“æœå‘ç°åªæœ‰ä¸¤ä¸ª divï¼Œè€Œä¸”è§„åˆ™å¹¶ä¸é€‚ç”¨ã€‚ç„¶åï¼Œæ‚¨å¿…é¡»å°è¯•æ ‘ä¸­çš„å…¶ä»–è·¯å¾„ã€‚</code></pre><ol start="3"><li>åº”ç”¨è§„åˆ™æ¶‰åŠåˆ°ç›¸å½“å¤æ‚çš„å±‚å è§„åˆ™ï¼ˆç”¨äºå®šä¹‰è¿™äº›è§„åˆ™çš„å±‚æ¬¡ï¼‰ã€‚</li></ol><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹æµè§ˆå™¨æ˜¯å¦‚ä½•å¤„ç†è¿™äº›é—®é¢˜çš„ï¼š</p><h5 id="å…±äº«æ ·å¼æ•°æ®"><a href="#å…±äº«æ ·å¼æ•°æ®" class="headerlink" title="å…±äº«æ ·å¼æ•°æ®"></a>å…±äº«æ ·å¼æ•°æ®</h5><p>WebKit èŠ‚ç‚¹ä¼šå¼•ç”¨æ ·å¼å¯¹è±¡ (RenderStyle)ã€‚è¿™äº›å¯¹è±¡åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ç”±ä¸åŒèŠ‚ç‚¹å…±äº«ã€‚è¿™äº›èŠ‚ç‚¹æ˜¯åŒçº§å…³ç³»ï¼Œå¹¶ä¸”ï¼š</p><ol><li>è¿™äº›å…ƒç´ å¿…é¡»å¤„äºç›¸åŒçš„é¼ æ ‡çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œä¸å…è®¸å…¶ä¸­ä¸€ä¸ªæ˜¯ â€œ:hoverâ€ çŠ¶æ€ï¼Œè€Œå¦ä¸€ä¸ªä¸æ˜¯ï¼‰</li><li>ä»»ä½•å…ƒç´ éƒ½æ²¡æœ‰ ID</li><li>æ ‡è®°åç§°åº”åŒ¹é…</li><li>ç±»å±æ€§åº”åŒ¹é…</li><li>æ˜ å°„å±æ€§çš„é›†åˆå¿…é¡»æ˜¯å®Œå…¨ç›¸åŒçš„</li><li>é“¾æ¥çŠ¶æ€å¿…é¡»åŒ¹é…</li><li>ç„¦ç‚¹çŠ¶æ€å¿…é¡»åŒ¹é…</li><li>ä»»ä½•å…ƒç´ éƒ½ä¸åº”å—å±æ€§é€‰æ‹©å™¨çš„å½±å“ï¼Œè¿™é‡Œæ‰€è¯´çš„ â€œå½±å“â€ æ˜¯æŒ‡åœ¨é€‰æ‹©å™¨ä¸­çš„ä»»ä½•ä½ç½®æœ‰ä»»ä½•ä½¿ç”¨äº†å±æ€§é€‰æ‹©å™¨çš„é€‰æ‹©å™¨åŒ¹é…</li><li>å…ƒç´ ä¸­ä¸èƒ½æœ‰ä»»ä½• inline æ ·å¼å±æ€§</li><li>ä¸èƒ½ä½¿ç”¨ä»»ä½•åŒçº§é€‰æ‹©å™¨ã€‚WebCore åœ¨é‡åˆ°ä»»ä½•åŒçº§é€‰æ‹©å™¨æ—¶ï¼Œåªä¼šå¼•å‘ä¸€ä¸ªå…¨å±€å¼€å…³ï¼Œå¹¶åœç”¨æ•´ä¸ªæ–‡æ¡£çš„æ ·å¼å…±äº«ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚è¿™åŒ…æ‹¬ + é€‰æ‹©å™¨ä»¥åŠ :first-child å’Œ :last-child ç­‰é€‰æ‹©å™¨ã€‚</li></ol><h5 id="Firefox-è§„åˆ™æ ‘"><a href="#Firefox-è§„åˆ™æ ‘" class="headerlink" title="Firefox è§„åˆ™æ ‘"></a>Firefox è§„åˆ™æ ‘</h5><p>ä¸ºäº†ç®€åŒ–æ ·å¼è®¡ç®—ï¼ŒFirefox è¿˜é‡‡ç”¨äº†å¦å¤–ä¸¤ç§æ ‘ï¼šè§„åˆ™æ ‘å’Œæ ·å¼ä¸Šä¸‹æ–‡æ ‘ã€‚WebKit ä¹Ÿæœ‰æ ·å¼å¯¹è±¡ï¼Œä½†å®ƒä»¬ä¸æ˜¯ä¿å­˜åœ¨ç±»ä¼¼æ ·å¼ä¸Šä¸‹æ–‡æ ‘è¿™æ ·çš„æ ‘ç»“æ„ä¸­ï¼Œåªæ˜¯ç”± DOM èŠ‚ç‚¹æŒ‡å‘æ­¤ç±»å¯¹è±¡çš„ç›¸å…³æ ·å¼ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image035.png" alt=""> å›¾ï¼šFirefox æ ·å¼ä¸Šä¸‹æ–‡æ ‘ (<a href="#2_2">2.2</a>)</p><p>æ ·å¼ä¸Šä¸‹æ–‡åŒ…å«ç«¯å€¼ã€‚è¦è®¡ç®—å‡ºè¿™äº›å€¼ï¼Œåº”æŒ‰ç…§æ­£ç¡®é¡ºåºåº”ç”¨æ‰€æœ‰çš„åŒ¹é…è§„åˆ™ï¼Œå¹¶å°†å…¶ä»é€»è¾‘å€¼è½¬åŒ–ä¸ºå…·ä½“çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé€»è¾‘å€¼æ˜¯å±å¹•å¤§å°çš„ç™¾åˆ†æ¯”ï¼Œåˆ™éœ€è¦æ¢ç®—æˆç»å¯¹çš„å•ä½ã€‚è§„åˆ™æ ‘çš„ç‚¹å­çœŸçš„å¾ˆå·§å¦™ï¼Œå®ƒä½¿å¾—èŠ‚ç‚¹ä¹‹é—´å¯ä»¥å…±äº«è¿™äº›å€¼ï¼Œä»¥é¿å…é‡å¤è®¡ç®—ï¼Œè¿˜å¯ä»¥èŠ‚çº¦ç©ºé—´ã€‚</p><p>æ‰€æœ‰åŒ¹é…çš„è§„åˆ™éƒ½å­˜å‚¨åœ¨æ ‘ä¸­ã€‚è·¯å¾„ä¸­çš„åº•å±‚èŠ‚ç‚¹æ‹¥æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚è§„åˆ™æ ‘åŒ…å«äº†æ‰€æœ‰å·²çŸ¥è§„åˆ™åŒ¹é…çš„è·¯å¾„ã€‚è§„åˆ™çš„å­˜å‚¨æ˜¯å»¶è¿Ÿè¿›è¡Œçš„ã€‚è§„åˆ™æ ‘ä¸ä¼šåœ¨å¼€å§‹çš„æ—¶å€™å°±ä¸ºæ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œè®¡ç®—ï¼Œè€Œæ˜¯åªæœ‰å½“æŸä¸ªèŠ‚ç‚¹æ ·å¼éœ€è¦è¿›è¡Œè®¡ç®—æ—¶ï¼Œæ‰ä¼šå‘è§„åˆ™æ ‘æ·»åŠ è®¡ç®—çš„è·¯å¾„ã€‚</p><p>è¿™ä¸ªæƒ³æ³•ç›¸å½“äºå°†è§„åˆ™æ ‘è·¯å¾„è§†ä¸ºè¯å…¸ä¸­çš„å•è¯ã€‚å¦‚æœæˆ‘ä»¬å·²ç»è®¡ç®—å‡ºå¦‚ä¸‹çš„è§„åˆ™æ ‘ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/tree.png" alt=""></p><p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸ºå†…å®¹æ ‘ä¸­çš„å¦ä¸€ä¸ªå…ƒç´ åŒ¹é…è§„åˆ™ï¼Œå¹¶ä¸”æ‰¾åˆ°åŒ¹é…è·¯å¾„æ˜¯ B - E - Iï¼ˆæŒ‰ç…§æ­¤é¡ºåºï¼‰ã€‚ç”±äºæˆ‘ä»¬åœ¨æ ‘ä¸­å·²ç»è®¡ç®—å‡ºäº†è·¯å¾„ A - B - E - I - Lï¼Œå› æ­¤å°±å·²ç»æœ‰äº†æ­¤è·¯å¾„ï¼Œè¿™å°±å‡å°‘äº†ç°åœ¨æ‰€éœ€çš„å·¥ä½œé‡ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹è§„åˆ™æ ‘å¦‚ä½•å¸®åŠ©æˆ‘ä»¬å‡å°‘å·¥ä½œã€‚</p><h5 id="ç»“æ„åˆ’åˆ†"><a href="#ç»“æ„åˆ’åˆ†" class="headerlink" title="ç»“æ„åˆ’åˆ†"></a>ç»“æ„åˆ’åˆ†</h5><p>æ ·å¼ä¸Šä¸‹æ–‡å¯åˆ†å‰²æˆå¤šä¸ªç»“æ„ã€‚è¿™äº›ç»“æ„ä½“åŒ…å«äº†ç‰¹å®šç±»åˆ«ï¼ˆå¦‚ border æˆ– colorï¼‰çš„æ ·å¼ä¿¡æ¯ã€‚ç»“æ„ä¸­çš„å±æ€§éƒ½æ˜¯ç»§æ‰¿çš„æˆ–éç»§æ‰¿çš„ã€‚ç»§æ‰¿å±æ€§å¦‚æœæœªç”±å…ƒç´ å®šä¹‰ï¼Œåˆ™ç»§æ‰¿è‡ªå…¶çˆ¶ä»£ã€‚éç»§æ‰¿å±æ€§ï¼ˆä¹Ÿç§°ä¸º â€œé‡ç½®â€ å±æ€§ï¼‰å¦‚æœæœªè¿›è¡Œå®šä¹‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚</p><p>è§„åˆ™æ ‘é€šè¿‡ç¼“å­˜æ•´ä¸ªç»“æ„ï¼ˆåŒ…å«è®¡ç®—å‡ºçš„ç«¯å€¼ï¼‰ä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚è¿™ä¸€æƒ³æ³•å‡å®šåº•å±‚èŠ‚ç‚¹æ²¡æœ‰æä¾›ç»“æ„çš„å®šä¹‰ï¼Œåˆ™å¯ä½¿ç”¨ä¸Šå±‚èŠ‚ç‚¹ä¸­çš„ç¼“å­˜ç»“æ„ã€‚</p><h5 id="ä½¿ç”¨è§„åˆ™æ ‘è®¡ç®—æ ·å¼ä¸Šä¸‹æ–‡"><a href="#ä½¿ç”¨è§„åˆ™æ ‘è®¡ç®—æ ·å¼ä¸Šä¸‹æ–‡" class="headerlink" title="ä½¿ç”¨è§„åˆ™æ ‘è®¡ç®—æ ·å¼ä¸Šä¸‹æ–‡"></a>ä½¿ç”¨è§„åˆ™æ ‘è®¡ç®—æ ·å¼ä¸Šä¸‹æ–‡</h5><p>åœ¨è®¡ç®—æŸä¸ªç‰¹å®šå…ƒç´ çš„æ ·å¼ä¸Šä¸‹æ–‡æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—è§„åˆ™æ ‘ä¸­çš„å¯¹åº”è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨ç°æœ‰çš„è·¯å¾„ã€‚ç„¶åæˆ‘ä»¬æ²¿æ­¤è·¯å¾„åº”ç”¨è§„åˆ™ï¼Œåœ¨æ–°çš„æ ·å¼ä¸Šä¸‹æ–‡ä¸­å¡«å……ç»“æ„ã€‚æˆ‘ä»¬ä»è·¯å¾„ä¸­æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„åº•å±‚èŠ‚ç‚¹ï¼ˆé€šå¸¸ä¹Ÿæ˜¯æœ€ç‰¹æ®Šçš„é€‰æ‹©å™¨ï¼‰å¼€å§‹ï¼Œå¹¶å‘ä¸Šéå†è§„åˆ™æ ‘ï¼Œç›´åˆ°ç»“æ„å¡«å……å®Œæ¯•ã€‚å¦‚æœè¯¥è§„åˆ™èŠ‚ç‚¹å¯¹äºæ­¤ç»“æ„æ²¡æœ‰ä»»ä½•è§„èŒƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®ç°æ›´å¥½çš„ä¼˜åŒ–ï¼šå¯»æ‰¾è·¯å¾„æ›´ä¸Šå±‚çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°åæŒ‡å®šå®Œæ•´çš„è§„èŒƒå¹¶æŒ‡å‘ç›¸å…³èŠ‚ç‚¹å³å¯ã€‚è¿™æ˜¯æœ€å¥½çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå› ä¸ºæ•´ä¸ªç»“æ„éƒ½èƒ½å…±äº«ã€‚è¿™å¯ä»¥å‡å°‘ç«¯å€¼çš„è®¡ç®—é‡å¹¶èŠ‚çº¦å†…å­˜ã€‚<br>å¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†éƒ¨åˆ†å®šä¹‰ï¼Œå°±ä¼šå‘ä¸Šéå†è§„åˆ™æ ‘ï¼Œç›´åˆ°ç»“æ„å¡«å……å®Œæ¯•ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ‰¾ä¸åˆ°ç»“æ„çš„ä»»ä½•å®šä¹‰ï¼Œé‚£ä¹ˆå‡å¦‚è¯¥ç»“æ„æ˜¯ â€œç»§æ‰¿â€ ç±»å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨<strong>ä¸Šä¸‹æ–‡æ ‘</strong>ä¸­æŒ‡å‘çˆ¶ä»£çš„ç»“æ„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å…±äº«ç»“æ„ã€‚å¦‚æœæ˜¯ reset ç±»å‹çš„ç»“æ„ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚</p><p>å¦‚æœæœ€ç‰¹æ®Šçš„èŠ‚ç‚¹ç¡®å®æ·»åŠ äº†å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¦å¤–è¿›è¡Œä¸€äº›è®¡ç®—ï¼Œä»¥ä¾¿å°†è¿™äº›å€¼è½¬åŒ–æˆå®é™…å€¼ã€‚ç„¶åæˆ‘ä»¬å°†ç»“æœç¼“å­˜åœ¨æ ‘èŠ‚ç‚¹ä¸­ï¼Œä¾›å­ä»£ä½¿ç”¨ã€‚</p><p>å¦‚æœæŸä¸ªå…ƒç´ ä¸å…¶åŒçº§å…ƒç´ éƒ½æŒ‡å‘åŒä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬å°±å¯ä»¥å…±äº«<strong>æ•´ä¸ªæ ·å¼ä¸Šä¸‹æ–‡</strong>ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹ HTML ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        this is a &lt;span&gt; big error &lt;/span&gt;</span><br><span class="line">        this is also a</span><br><span class="line">        &lt;span&gt; very  big  error&lt;/span&gt; error</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;another error&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">div &#123;margin:5px;color:black&#125;</span><br><span class="line">.err &#123;color:red&#125;</span><br><span class="line">.big &#123;margin-top:3px&#125;</span><br><span class="line">div span &#123;margin-bottom:4px&#125;</span><br><span class="line">#div1 &#123;color:blue&#125;</span><br><span class="line">#div2 &#123;color:green&#125;</span><br><span class="line">div &#123;margin:5px;color:black&#125;</span><br><span class="line">.err &#123;color:red&#125;</span><br><span class="line">.big &#123;margin-top:3px&#125;</span><br><span class="line">div span &#123;margin-bottom:4px&#125;</span><br><span class="line">#div1 &#123;color:blue&#125;</span><br><span class="line">#div2 &#123;color:green&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬åªéœ€è¦å¡«å……ä¸¤ä¸ªç»“æ„ï¼šcolor ç»“æ„å’Œ margin ç»“æ„ã€‚color ç»“æ„åªåŒ…å«ä¸€ä¸ªæˆå‘˜ï¼ˆå³ â€œcolorâ€ï¼‰ï¼Œè€Œ margin ç»“æ„åŒ…å«å››æ¡è¾¹ã€‚<br>å½¢æˆçš„è§„åˆ™æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆèŠ‚ç‚¹çš„æ ‡è®°æ–¹å¼ä¸º â€œèŠ‚ç‚¹å : æŒ‡å‘çš„è§„åˆ™åºå·â€ï¼‰ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image027.png" alt=""> å›¾ï¼šè§„åˆ™æ ‘</p><p>ä¸Šä¸‹æ–‡æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆèŠ‚ç‚¹å : æŒ‡å‘çš„è§„åˆ™èŠ‚ç‚¹ï¼‰ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image029.png" alt=""> å›¾ï¼šä¸Šä¸‹æ–‡æ ‘</p><p>å‡è®¾æˆ‘ä»¬è§£æ HTML æ—¶é‡åˆ°äº†ç¬¬äºŒä¸ª</p><div>æ ‡è®°ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ­¤èŠ‚ç‚¹åˆ›å»ºæ ·å¼ä¸Šä¸‹æ–‡ï¼Œå¹¶å¡«å……å…¶æ ·å¼ç»“æ„ã€‚<br>ç»è¿‡è§„åˆ™åŒ¹é…ï¼Œæˆ‘ä»¬å‘ç°è¯¥<div>çš„åŒ¹é…è§„åˆ™æ˜¯ç¬¬ 1ã€2 å’Œ 6 æ¡ã€‚è¿™æ„å‘³ç€è§„åˆ™æ ‘ä¸­å·²æœ‰ä¸€æ¡è·¯å¾„å¯ä¾›æˆ‘ä»¬çš„å…ƒç´ ä½¿ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦å†ä¸ºå…¶æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ä»¥åŒ¹é…ç¬¬ 6 æ¡è§„åˆ™ï¼ˆè§„åˆ™æ ‘ä¸­çš„ F èŠ‚ç‚¹ï¼‰ã€‚<br>æˆ‘ä»¬å°†åˆ›å»ºæ ·å¼ä¸Šä¸‹æ–‡å¹¶å°†å…¶æ”¾å…¥ä¸Šä¸‹æ–‡æ ‘ä¸­ã€‚æ–°çš„æ ·å¼ä¸Šä¸‹æ–‡å°†æŒ‡å‘è§„åˆ™æ ‘ä¸­çš„ F èŠ‚ç‚¹ã€‚<p></p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦å¡«å……æ ·å¼ç»“æ„ã€‚é¦–å…ˆè¦å¡«å……çš„æ˜¯ margin ç»“æ„ã€‚ç”±äºæœ€åçš„è§„åˆ™èŠ‚ç‚¹ (F) å¹¶æ²¡æœ‰æ·»åŠ åˆ° margin ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šæº¯è§„åˆ™æ ‘ï¼Œç›´è‡³æ‰¾åˆ°åœ¨å…ˆå‰èŠ‚ç‚¹æ’å…¥ä¸­è®¡ç®—è¿‡çš„ç¼“å­˜ç»“æ„ï¼Œç„¶åä½¿ç”¨è¯¥ç»“æ„ã€‚æˆ‘ä»¬ä¼šåœ¨æŒ‡å®š margin è§„åˆ™çš„æœ€ä¸Šå±‚èŠ‚ç‚¹ï¼ˆå³ B èŠ‚ç‚¹ï¼‰ä¸Šæ‰¾åˆ°è¯¥ç»“æ„ã€‚</p><p>æˆ‘ä»¬å·²ç»æœ‰äº† color ç»“æ„çš„å®šä¹‰ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ç¼“å­˜çš„ç»“æ„ã€‚ç”±äº color æœ‰ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬æ— éœ€ä¸Šæº¯è§„åˆ™æ ‘ä»¥å¡«å……å…¶ä»–å±æ€§ã€‚æˆ‘ä»¬å°†è®¡ç®—ç«¯å€¼ï¼ˆå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸º RGB ç­‰ï¼‰å¹¶åœ¨æ­¤èŠ‚ç‚¹ä¸Šç¼“å­˜ç»è¿‡è®¡ç®—çš„ç»“æ„ã€‚</p><p>ç¬¬äºŒä¸ª <span>å…ƒç´ å¤„ç†èµ·æ¥æ›´åŠ ç®€å•ã€‚æˆ‘ä»¬å°†åŒ¹é…è§„åˆ™ï¼Œæœ€ç»ˆå‘ç°å®ƒå’Œä¹‹å‰çš„ span ä¸€æ ·æŒ‡å‘è§„åˆ™ Gã€‚ç”±äºæˆ‘ä»¬æ‰¾åˆ°äº†æŒ‡å‘åŒä¸€èŠ‚ç‚¹çš„åŒçº§ï¼Œå°±å¯ä»¥å…±äº«æ•´ä¸ªæ ·å¼ä¸Šä¸‹æ–‡äº†ï¼Œåªéœ€æŒ‡å‘ä¹‹å‰ span çš„ä¸Šä¸‹æ–‡å³å¯ã€‚</span></p><p>å¯¹äºåŒ…å«äº†ç»§æ‰¿è‡ªçˆ¶ä»£çš„è§„åˆ™çš„ç»“æ„ï¼Œç¼“å­˜æ˜¯åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­è¿›è¡Œçš„ï¼ˆäº‹å®ä¸Š color å±æ€§æ˜¯ç»§æ‰¿çš„ï¼Œä½†æ˜¯ Firefox å°†å…¶è§†ä¸º reset å±æ€§ï¼Œå¹¶ç¼“å­˜åˆ°è§„åˆ™æ ‘ä¸Šï¼‰ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŸä¸ªæ®µè½ä¸­æ·»åŠ  font è§„åˆ™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p &#123;font-family:Verdana;font size:10px;font-weight:bold&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œè¯¥æ®µè½å…ƒç´ ä½œä¸ºä¸Šä¸‹æ–‡æ ‘ä¸­çš„ div çš„å­ä»£ï¼Œå°±ä¼šå…±äº«ä¸å…¶çˆ¶ä»£ç›¸åŒçš„ font ç»“æ„ï¼ˆå‰ææ˜¯è¯¥æ®µè½æ²¡æœ‰æŒ‡å®š font è§„åˆ™ï¼‰ã€‚</p><p>åœ¨ WebKit ä¸­æ²¡æœ‰è§„åˆ™æ ‘ï¼Œå› æ­¤ä¼šå¯¹åŒ¹é…çš„å£°æ˜éå† 4 æ¬¡ã€‚é¦–å…ˆåº”ç”¨éé‡è¦é«˜ä¼˜å…ˆçº§çš„å±æ€§ï¼ˆç”±äºä½œä¸ºå…¶ä»–å±æ€§çš„ä¾æ®è€Œåº”é¦–å…ˆåº”ç”¨çš„å±æ€§ï¼Œä¾‹å¦‚ displayï¼‰ï¼Œæ¥ç€æ˜¯é«˜ä¼˜å…ˆçº§é‡è¦è§„åˆ™ï¼Œç„¶åæ˜¯æ™®é€šä¼˜å…ˆçº§éé‡è¦è§„åˆ™ï¼Œæœ€åæ˜¯æ™®é€šä¼˜å…ˆçº§é‡è¦è§„åˆ™ã€‚è¿™æ„å‘³ç€å¤šæ¬¡å‡ºç°çš„å±æ€§ä¼šæ ¹æ®æ­£ç¡®çš„å±‚å é¡ºåºè¿›è¡Œè§£æã€‚æœ€åå‡ºç°çš„æœ€ç»ˆç”Ÿæ•ˆã€‚</p><p>å› æ­¤æ¦‚æ‹¬æ¥è¯´ï¼Œå…±äº«æ ·å¼å¯¹è±¡ï¼ˆæ•´ä¸ªå¯¹è±¡æˆ–è€…å¯¹è±¡ä¸­çš„éƒ¨åˆ†ç»“æ„ï¼‰å¯ä»¥è§£å†³é—®é¢˜ <a href="#issue1">1</a> å’Œé—®é¢˜ <a href="#issue3">3</a>ã€‚Firefox è§„åˆ™æ ‘è¿˜æœ‰åŠ©äºæŒ‰ç…§æ­£ç¡®çš„é¡ºåºåº”ç”¨å±æ€§ã€‚</p><h5 id="å¯¹è§„åˆ™è¿›è¡Œå¤„ç†ä»¥ç®€åŒ–åŒ¹é…"><a href="#å¯¹è§„åˆ™è¿›è¡Œå¤„ç†ä»¥ç®€åŒ–åŒ¹é…" class="headerlink" title="å¯¹è§„åˆ™è¿›è¡Œå¤„ç†ä»¥ç®€åŒ–åŒ¹é…"></a>å¯¹è§„åˆ™è¿›è¡Œå¤„ç†ä»¥ç®€åŒ–åŒ¹é…</h5><p>æ ·å¼è§„åˆ™æœ‰ä¸€äº›æ¥æºï¼š</p><ul><li><p>å¤–éƒ¨æ ·å¼è¡¨æˆ–æ ·å¼å…ƒç´ ä¸­çš„ CSS è§„åˆ™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p &#123;color:blue&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>inline æ ·å¼å±æ€§åŠç±»ä¼¼å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p /&gt;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>HTML å¯è§†åŒ–å±æ€§ï¼ˆæ˜ å°„åˆ°ç›¸å…³çš„æ ·å¼è§„åˆ™ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p bgcolor=&quot;blue&quot; /&gt;</span><br></pre></td></tr></table></figure></li></ul><p>åä¸¤ç§å¾ˆå®¹æ˜“å’Œå…ƒç´ è¿›è¡ŒåŒ¹é…ï¼Œå› ä¸ºå…ƒç´ æ‹¥æœ‰æ ·å¼å±æ€§ï¼Œè€Œä¸” HTML å±æ€§å¯ä»¥ä½¿ç”¨å…ƒç´ ä½œä¸ºé”®å€¼è¿›è¡Œæ˜ å°„ã€‚</p><p>æˆ‘ä»¬ä¹‹å‰åœ¨<a href="#issue2">ç¬¬ 2 ä¸ªé—®é¢˜</a>ä¸­æåˆ°è¿‡ï¼ŒCSS è§„åˆ™åŒ¹é…å¯èƒ½æ¯”è¾ƒæ£˜æ‰‹ã€‚ä¸ºäº†è§£å†³è¿™ä¸€éš¾é¢˜ï¼Œå¯ä»¥å¯¹ CSS è§„åˆ™è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä»¥ä¾¿è®¿é—®ã€‚</p><p>æ ·å¼è¡¨è§£æå®Œæ¯•åï¼Œç³»ç»Ÿä¼šæ ¹æ®é€‰æ‹©å™¨å°† CSS è§„åˆ™æ·»åŠ åˆ°æŸä¸ªå“ˆå¸Œè¡¨ä¸­ã€‚è¿™äº›å“ˆå¸Œè¡¨çš„é€‰æ‹©å™¨å„ä¸ç›¸åŒï¼ŒåŒ…æ‹¬ IDã€ç±»åç§°ã€æ ‡è®°åç§°ç­‰ï¼Œè¿˜æœ‰ä¸€ç§é€šç”¨å“ˆå¸Œè¡¨ï¼Œé€‚åˆä¸å±äºä¸Šè¿°ç±»åˆ«çš„è§„åˆ™ã€‚å¦‚æœé€‰æ‹©å™¨æ˜¯ IDï¼Œè§„åˆ™å°±ä¼šæ·»åŠ åˆ° ID è¡¨ä¸­ï¼›å¦‚æœé€‰æ‹©å™¨æ˜¯ç±»ï¼Œè§„åˆ™å°±ä¼šæ·»åŠ åˆ°ç±»è¡¨ä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚<br>è¿™ç§å¤„ç†å¯ä»¥å¤§å¤§ç®€åŒ–è§„åˆ™åŒ¹é…ã€‚æˆ‘ä»¬æ— éœ€æŸ¥çœ‹æ¯ä¸€æ¡å£°æ˜ï¼Œåªè¦ä»å“ˆå¸Œè¡¨ä¸­æå–å…ƒç´ çš„ç›¸å…³è§„åˆ™å³å¯ã€‚è¿™ç§ä¼˜åŒ–æ–¹æ³•å¯æ’é™¤æ‰ 95% ä»¥ä¸Šè§„åˆ™ï¼Œå› æ­¤åœ¨åŒ¹é…è¿‡ç¨‹ä¸­æ ¹æœ¬å°±ä¸ç”¨è€ƒè™‘è¿™äº›è§„åˆ™äº† (<a href="#4_1">4.1</a>)ã€‚</p><p>æˆ‘ä»¬ä»¥å¦‚ä¸‹çš„æ ·å¼è§„åˆ™ä¸ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p.error &#123;color:red&#125;</span><br><span class="line">#messageDiv &#123;height:50px&#125;</span><br><span class="line">div &#123;margin:5px&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡è§„åˆ™å°†æ’å…¥ç±»è¡¨ï¼Œç¬¬äºŒæ¡å°†æ’å…¥ ID è¡¨ï¼Œè€Œç¬¬ä¸‰æ¡å°†æ’å…¥æ ‡è®°è¡¨ã€‚<br>å¯¹äºä¸‹é¢çš„ HTML ä»£ç æ®µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;an error occurred &lt;/p&gt;</span><br><span class="line">&lt;div&gt;this is a message&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆä¼šä¸º p å…ƒç´ å¯»æ‰¾åŒ¹é…çš„è§„åˆ™ã€‚ç±»è¡¨ä¸­æœ‰ä¸€ä¸ª â€œerrorâ€ é”®ï¼Œåœ¨ä¸‹é¢å¯ä»¥æ‰¾åˆ° â€œp.errorâ€ çš„è§„åˆ™ã€‚div å…ƒç´ åœ¨ ID è¡¨ï¼ˆé”®ä¸º IDï¼‰å’Œæ ‡è®°è¡¨ä¸­æœ‰ç›¸å…³çš„è§„åˆ™ã€‚å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ‰¾å‡ºå“ªäº›æ ¹æ®é”®æå–çš„è§„åˆ™æ˜¯çœŸæ­£åŒ¹é…çš„äº†ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœ div çš„å¯¹åº”è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table div &#123;margin:5px&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¡è§„åˆ™ä»ç„¶ä¼šä»æ ‡è®°è¡¨ä¸­æå–å‡ºæ¥ï¼Œå› ä¸ºé”®æ˜¯æœ€å³è¾¹çš„é€‰æ‹©å™¨ï¼Œä½†è¿™æ¡è§„åˆ™å¹¶ä¸åŒ¹é…æˆ‘ä»¬çš„ div å…ƒç´ ï¼Œå› ä¸º div æ²¡æœ‰ table ç¥–å…ˆã€‚</p><p>WebKit å’Œ Firefox éƒ½è¿›è¡Œäº†è¿™ä¸€å¤„ç†ã€‚</p><h5 id="ä»¥æ­£ç¡®çš„å±‚å é¡ºåºåº”ç”¨è§„åˆ™"><a href="#ä»¥æ­£ç¡®çš„å±‚å é¡ºåºåº”ç”¨è§„åˆ™" class="headerlink" title="ä»¥æ­£ç¡®çš„å±‚å é¡ºåºåº”ç”¨è§„åˆ™"></a>ä»¥æ­£ç¡®çš„å±‚å é¡ºåºåº”ç”¨è§„åˆ™</h5><p>æ ·å¼å¯¹è±¡å…·æœ‰ä¸æ¯ä¸ªå¯è§†åŒ–å±æ€§ä¸€ä¸€å¯¹åº”çš„å±æ€§ï¼ˆå‡ä¸º CSS å±æ€§ä½†æ›´ä¸ºé€šç”¨ï¼‰ã€‚å¦‚æœæŸä¸ªå±æ€§æœªç”±ä»»ä½•åŒ¹é…è§„åˆ™æ‰€å®šä¹‰ï¼Œé‚£ä¹ˆéƒ¨åˆ†å±æ€§å°±å¯ç”±çˆ¶ä»£å…ƒç´ æ ·å¼å¯¹è±¡ç»§æ‰¿ã€‚å…¶ä»–å±æ€§å…·æœ‰é»˜è®¤å€¼ã€‚</p><p>å¦‚æœå®šä¹‰ä¸æ­¢ä¸€ä¸ªï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œéœ€è¦é€šè¿‡å±‚å é¡ºåºæ¥è§£å†³ã€‚</p><h5 id="æ ·å¼è¡¨å±‚å é¡ºåº"><a href="#æ ·å¼è¡¨å±‚å é¡ºåº" class="headerlink" title="æ ·å¼è¡¨å±‚å é¡ºåº"></a>æ ·å¼è¡¨å±‚å é¡ºåº</h5><p>æŸä¸ªæ ·å¼å±æ€§çš„å£°æ˜å¯èƒ½ä¼šå‡ºç°åœ¨å¤šä¸ªæ ·å¼è¡¨ä¸­ï¼Œä¹Ÿå¯èƒ½åœ¨åŒä¸€ä¸ªæ ·å¼è¡¨ä¸­å‡ºç°å¤šæ¬¡ã€‚è¿™æ„å‘³ç€åº”ç”¨è§„åˆ™çš„é¡ºåºæä¸ºé‡è¦ã€‚è¿™ç§°ä¸º â€œå±‚å â€ é¡ºåºã€‚æ ¹æ® CSS2 è§„èŒƒï¼Œå±‚å çš„é¡ºåºä¸ºï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š</p><ol><li>æµè§ˆå™¨å£°æ˜</li><li>ç”¨æˆ·æ™®é€šå£°æ˜</li><li>ä½œè€…æ™®é€šå£°æ˜</li><li>ä½œè€…é‡è¦å£°æ˜</li><li>ç”¨æˆ·é‡è¦å£°æ˜</li></ol><p>æµè§ˆå™¨å£°æ˜æ˜¯é‡è¦ç¨‹åº¦æœ€ä½çš„ï¼Œè€Œç”¨æˆ·åªæœ‰å°†è¯¥å£°æ˜æ ‡è®°ä¸º â€œé‡è¦â€ æ‰å¯ä»¥æ›¿æ¢ç½‘é¡µä½œè€…çš„å£°æ˜ã€‚åŒæ ·é¡ºåºçš„å£°æ˜ä¼šæ ¹æ®<a href="#Specificity">ç‰¹å¼‚æ€§</a>è¿›è¡Œæ’åºï¼Œç„¶åå†æ˜¯å…¶æŒ‡å®šé¡ºåºã€‚HTML å¯è§†åŒ–å±æ€§ä¼šè½¬æ¢æˆåŒ¹é…çš„ CSS å£°æ˜ã€‚å®ƒä»¬è¢«è§†ä¸ºä½ä¼˜å…ˆçº§çš„ç½‘é¡µä½œè€…è§„åˆ™ã€‚</p><h5 id="ç‰¹å¼‚æ€§"><a href="#ç‰¹å¼‚æ€§" class="headerlink" title="ç‰¹å¼‚æ€§"></a>ç‰¹å¼‚æ€§</h5><p>é€‰æ‹©å™¨çš„ç‰¹å¼‚æ€§ç”± <a href="http://www.w3.org/TR/CSS2/cascade.html#specificity" target="_blank" rel="noopener">CSS2 è§„èŒƒ</a>å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœå£°æ˜æ¥è‡ªäº â€œstyleâ€ å±æ€§ï¼Œè€Œä¸æ˜¯å¸¦æœ‰é€‰æ‹©å™¨çš„è§„åˆ™ï¼Œåˆ™è®°ä¸º 1ï¼Œå¦åˆ™è®°ä¸º 0 (= a)</li><li>è®°ä¸ºé€‰æ‹©å™¨ä¸­ ID å±æ€§çš„ä¸ªæ•° (= b)</li><li>è®°ä¸ºé€‰æ‹©å™¨ä¸­å…¶ä»–å±æ€§å’Œä¼ªç±»çš„ä¸ªæ•° (= c)</li><li>è®°ä¸ºé€‰æ‹©å™¨ä¸­å…ƒç´ åç§°å’Œä¼ªå…ƒç´ çš„ä¸ªæ•° (= d)</li></ul><p>å°†å››ä¸ªæ•°å­—æŒ‰ a-b-c-d è¿™æ ·è¿æ¥èµ·æ¥ï¼ˆä½äºå¤§æ•°è¿›åˆ¶çš„æ•°å­—ç³»ç»Ÿä¸­ï¼‰ï¼Œæ„æˆç‰¹å¼‚æ€§ã€‚</p><p>æ‚¨ä½¿ç”¨çš„è¿›åˆ¶å–å†³äºä¸Šè¿°ç±»åˆ«ä¸­çš„æœ€é«˜è®¡æ•°ã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœ a=14ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶ã€‚å¦‚æœ a=17ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨åä¸ƒè¿›åˆ¶ï¼›å½“ç„¶ä¸å¤ªå¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼Œé™¤éæ˜¯å­˜åœ¨å¦‚ä¸‹çš„é€‰æ‹©å™¨ï¼šhtml body div div p â€¦ï¼ˆåœ¨é€‰æ‹©å™¨ä¸­å‡ºç°äº† 17 ä¸ªæ ‡è®°ï¼Œè¿™æ ·çš„å¯èƒ½æ€§æä½ï¼‰ã€‚</p><p>ä¸€äº›ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*             &#123;&#125;  /* a=0 b=0 c=0 d=0 -&gt; specificity = 0,0,0,0 */</span><br><span class="line">li            &#123;&#125;  /* a=0 b=0 c=0 d=1 -&gt; specificity = 0,0,0,1 */</span><br><span class="line">li:first-line &#123;&#125;  /* a=0 b=0 c=0 d=2 -&gt; specificity = 0,0,0,2 */</span><br><span class="line">ul li         &#123;&#125;  /* a=0 b=0 c=0 d=2 -&gt; specificity = 0,0,0,2 */</span><br><span class="line">ul ol+li      &#123;&#125;  /* a=0 b=0 c=0 d=3 -&gt; specificity = 0,0,0,3 */</span><br><span class="line">h1 + *[rel=up]&#123;&#125;  /* a=0 b=0 c=1 d=1 -&gt; specificity = 0,0,1,1 */</span><br><span class="line">ul ol li.red  &#123;&#125;  /* a=0 b=0 c=1 d=3 -&gt; specificity = 0,0,1,3 */</span><br><span class="line">li.red.level  &#123;&#125;  /* a=0 b=0 c=2 d=1 -&gt; specificity = 0,0,2,1 */</span><br><span class="line">#x34y         &#123;&#125;  /* a=0 b=1 c=0 d=0 -&gt; specificity = 0,1,0,0 */</span><br><span class="line">         /* a=1 b=0 c=0 d=0 -&gt; specificity = 1,0,0,0 */</span><br></pre></td></tr></table></figure><h5 id="è§„åˆ™æ’åº"><a href="#è§„åˆ™æ’åº" class="headerlink" title="è§„åˆ™æ’åº"></a>è§„åˆ™æ’åº</h5><p>æ‰¾åˆ°åŒ¹é…çš„è§„åˆ™ä¹‹åï¼Œåº”æ ¹æ®çº§è”é¡ºåºå°†å…¶æ’åºã€‚WebKit å¯¹äºè¾ƒå°çš„åˆ—è¡¨ä¼šä½¿ç”¨å†’æ³¡æ’åºï¼Œè€Œå¯¹è¾ƒå¤§çš„åˆ—è¡¨åˆ™ä½¿ç”¨å½’å¹¶æ’åºã€‚å¯¹äºä»¥ä¸‹è§„åˆ™ï¼ŒWebKit é€šè¿‡æ›¿æ¢ â€œ&gt;â€ è¿ç®—ç¬¦æ¥å®ç°æ’åºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static bool operator &gt;(CSSRuleData&amp; r1, CSSRuleData&amp; r2)</span><br><span class="line">&#123;</span><br><span class="line">    int spec1 = r1.selector()-&gt;specificity();</span><br><span class="line">    int spec2 = r2.selector()-&gt;specificity();</span><br><span class="line">    return (spec1 == spec2) : r1.position() &gt; r2.position() : spec1 &gt; spec2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¸è¿›å¼å¤„ç†"><a href="#æ¸è¿›å¼å¤„ç†" class="headerlink" title="æ¸è¿›å¼å¤„ç†"></a>æ¸è¿›å¼å¤„ç†</h4><p>WebKit ä½¿ç”¨ä¸€ä¸ªæ ‡è®°æ¥è¡¨ç¤ºæ˜¯å¦æ‰€æœ‰çš„é¡¶çº§æ ·å¼è¡¨ï¼ˆåŒ…æ‹¬ @importsï¼‰å‡å·²åŠ è½½å®Œæ¯•ã€‚å¦‚æœåœ¨é™„åŠ è¿‡ç¨‹ä¸­å°šæœªå®Œå…¨åŠ è½½æ ·å¼ï¼Œåˆ™ä½¿ç”¨å ä½ç¬¦ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸­è¿›è¡Œæ ‡æ³¨ï¼Œç­‰æ ·å¼è¡¨åŠ è½½å®Œæ¯•åå†é‡æ–°è®¡ç®—ã€‚</p><h3 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h3><p>å‘ˆç°å™¨åœ¨åˆ›å»ºå®Œæˆå¹¶æ·»åŠ åˆ°å‘ˆç°æ ‘æ—¶ï¼Œå¹¶ä¸åŒ…å«ä½ç½®å’Œå¤§å°ä¿¡æ¯ã€‚è®¡ç®—è¿™äº›å€¼çš„è¿‡ç¨‹ç§°ä¸ºå¸ƒå±€æˆ–é‡æ’ã€‚</p><p>HTML é‡‡ç”¨åŸºäºæµçš„å¸ƒå±€æ¨¡å‹ï¼Œè¿™æ„å‘³ç€å¤§å¤šæ•°æƒ…å†µä¸‹åªè¦ä¸€æ¬¡éå†å°±èƒ½è®¡ç®—å‡ºå‡ ä½•ä¿¡æ¯ã€‚å¤„äºæµä¸­é åä½ç½®å…ƒç´ é€šå¸¸ä¸ä¼šå½±å“é å‰ä½ç½®å…ƒç´ çš„å‡ ä½•ç‰¹å¾ï¼Œå› æ­¤å¸ƒå±€å¯ä»¥æŒ‰ä»å·¦è‡³å³ã€ä»ä¸Šè‡³ä¸‹çš„é¡ºåºéå†æ–‡æ¡£ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–æƒ…å†µï¼Œæ¯”å¦‚ HTML è¡¨æ ¼çš„è®¡ç®—å°±éœ€è¦ä¸æ­¢ä¸€æ¬¡çš„éå† (<a href="#3_5">3.5</a>)ã€‚</p><p>åæ ‡ç³»æ˜¯ç›¸å¯¹äºæ ¹æ¡†æ¶è€Œå»ºç«‹çš„ï¼Œä½¿ç”¨çš„æ˜¯ä¸Šåæ ‡å’Œå·¦åæ ‡ã€‚</p><p>å¸ƒå±€æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ã€‚å®ƒä»æ ¹å‘ˆç°å™¨ï¼ˆå¯¹åº”äº HTML æ–‡æ¡£çš„ <code>&lt;html&gt;</code> å…ƒç´ ï¼‰å¼€å§‹ï¼Œç„¶åé€’å½’éå†éƒ¨åˆ†æˆ–æ‰€æœ‰çš„æ¡†æ¶å±‚æ¬¡ç»“æ„ï¼Œä¸ºæ¯ä¸€ä¸ªéœ€è¦è®¡ç®—çš„å‘ˆç°å™¨è®¡ç®—å‡ ä½•ä¿¡æ¯ã€‚</p><p>æ ¹å‘ˆç°å™¨çš„ä½ç½®å·¦è¾¹æ˜¯ 0,0ï¼Œå…¶å°ºå¯¸ä¸ºè§†å£ï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨çª—å£çš„å¯è§åŒºåŸŸï¼‰ã€‚</p><p>æ‰€æœ‰çš„å‘ˆç°å™¨éƒ½æœ‰ä¸€ä¸ª â€œlayoutâ€ æˆ–è€… â€œreflowâ€ æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªå‘ˆç°å™¨éƒ½ä¼šè°ƒç”¨å…¶éœ€è¦è¿›è¡Œå¸ƒå±€çš„å­ä»£çš„ layout æ–¹æ³•ã€‚</p><h4 id="Dirty-ä½ç³»ç»Ÿ"><a href="#Dirty-ä½ç³»ç»Ÿ" class="headerlink" title="Dirty ä½ç³»ç»Ÿ"></a>Dirty ä½ç³»ç»Ÿ</h4><p>ä¸ºé¿å…å¯¹æ‰€æœ‰ç»†å°æ›´æ”¹éƒ½è¿›è¡Œæ•´ä½“å¸ƒå±€ï¼Œæµè§ˆå™¨é‡‡ç”¨äº†ä¸€ç§ â€œdirty ä½â€ ç³»ç»Ÿã€‚å¦‚æœæŸä¸ªå‘ˆç°å™¨å‘ç”Ÿäº†æ›´æ”¹ï¼Œæˆ–è€…å°†è‡ªèº«åŠå…¶å­ä»£æ ‡æ³¨ä¸ºâ€œdirtyâ€ï¼Œåˆ™éœ€è¦è¿›è¡Œå¸ƒå±€ã€‚</p><p>æœ‰ä¸¤ç§æ ‡è®°ï¼šâ€œdirtyâ€å’Œ â€œchildren are dirtyâ€ã€‚â€œchildren are dirtyâ€ è¡¨ç¤ºå°½ç®¡å‘ˆç°å™¨è‡ªèº«æ²¡æœ‰å˜åŒ–ï¼Œä½†å®ƒè‡³å°‘æœ‰ä¸€ä¸ªå­ä»£éœ€è¦å¸ƒå±€ã€‚</p><h4 id="å…¨å±€å¸ƒå±€å’Œå¢é‡å¸ƒå±€"><a href="#å…¨å±€å¸ƒå±€å’Œå¢é‡å¸ƒå±€" class="headerlink" title="å…¨å±€å¸ƒå±€å’Œå¢é‡å¸ƒå±€"></a>å…¨å±€å¸ƒå±€å’Œå¢é‡å¸ƒå±€</h4><p>å…¨å±€å¸ƒå±€æ˜¯æŒ‡è§¦å‘äº†æ•´ä¸ªå‘ˆç°æ ‘èŒƒå›´çš„å¸ƒå±€ï¼Œè§¦å‘åŸå› å¯èƒ½åŒ…æ‹¬ï¼š</p><ol><li>å½±å“æ‰€æœ‰å‘ˆç°å™¨çš„å…¨å±€æ ·å¼æ›´æ”¹ï¼Œä¾‹å¦‚å­—ä½“å¤§å°æ›´æ”¹ã€‚</li><li>å±å¹•å¤§å°è°ƒæ•´ã€‚</li></ol><p>å¸ƒå±€å¯ä»¥é‡‡ç”¨å¢é‡æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åªå¯¹ dirty å‘ˆç°å™¨è¿›è¡Œå¸ƒå±€ï¼ˆè¿™æ ·å¯èƒ½å­˜åœ¨éœ€è¦è¿›è¡Œé¢å¤–å¸ƒå±€çš„å¼Šç«¯ï¼‰ã€‚<br>å½“å‘ˆç°å™¨ä¸º dirty æ—¶ï¼Œä¼šå¼‚æ­¥è§¦å‘å¢é‡å¸ƒå±€ã€‚ä¾‹å¦‚ï¼Œå½“æ¥è‡ªç½‘ç»œçš„é¢å¤–å†…å®¹æ·»åŠ åˆ° DOM æ ‘ä¹‹åï¼Œæ–°çš„å‘ˆç°å™¨é™„åŠ åˆ°äº†å‘ˆç°æ ‘ä¸­ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/reflow.png" alt=""> å›¾ï¼šå¢é‡å¸ƒå±€ - åªæœ‰ dirty å‘ˆç°å™¨åŠå…¶å­ä»£è¿›è¡Œå¸ƒå±€ (<a href="#3_6">3.6</a>)ã€‚</p><h4 id="å¼‚æ­¥å¸ƒå±€å’ŒåŒæ­¥å¸ƒå±€"><a href="#å¼‚æ­¥å¸ƒå±€å’ŒåŒæ­¥å¸ƒå±€" class="headerlink" title="å¼‚æ­¥å¸ƒå±€å’ŒåŒæ­¥å¸ƒå±€"></a>å¼‚æ­¥å¸ƒå±€å’ŒåŒæ­¥å¸ƒå±€</h4><p>å¢é‡å¸ƒå±€æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚Firefox å°†å¢é‡å¸ƒå±€çš„ â€œreflow å‘½ä»¤â€ åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œè°ƒåº¦ç¨‹åºä¼šè§¦å‘è¿™äº›å‘½ä»¤çš„æ‰¹é‡æ‰§è¡Œã€‚WebKit ä¹Ÿæœ‰ç”¨äºæ‰§è¡Œå¢é‡å¸ƒå±€çš„è®¡æ—¶å™¨ï¼šå¯¹å‘ˆç°æ ‘è¿›è¡Œéå†ï¼Œå¹¶å¯¹ dirty å‘ˆç°å™¨è¿›è¡Œå¸ƒå±€ã€‚<br>è¯·æ±‚æ ·å¼ä¿¡æ¯ï¼ˆä¾‹å¦‚ â€œoffsetHeightâ€ï¼‰çš„è„šæœ¬å¯åŒæ­¥è§¦å‘å¢é‡å¸ƒå±€ã€‚<br>å…¨å±€å¸ƒå±€å¾€å¾€æ˜¯åŒæ­¥è§¦å‘çš„ã€‚<br>æœ‰æ—¶ï¼Œå½“åˆå§‹å¸ƒå±€å®Œæˆä¹‹åï¼Œå¦‚æœä¸€äº›å±æ€§ï¼ˆå¦‚æ»šåŠ¨ä½ç½®ï¼‰å‘ç”Ÿå˜åŒ–ï¼Œå¸ƒå±€å°±ä¼šä½œä¸ºå›è°ƒè€Œè§¦å‘ã€‚</p><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>å¦‚æœå¸ƒå±€æ˜¯ç”± â€œå¤§å°è°ƒæ•´â€ æˆ–å‘ˆç°å™¨çš„ä½ç½®ï¼ˆè€Œéå¤§å°ï¼‰æ”¹å˜è€Œè§¦å‘çš„ï¼Œé‚£ä¹ˆå¯ä»¥ä»ç¼“å­˜ä¸­è·å–å‘ˆç°å™¨çš„å¤§å°ï¼Œè€Œæ— éœ€é‡æ–°è®¡ç®—ã€‚<br>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªå­æ ‘è¿›è¡Œäº†ä¿®æ”¹ï¼Œå› æ­¤æ— éœ€ä»æ ¹èŠ‚ç‚¹å¼€å§‹å¸ƒå±€ã€‚è¿™é€‚ç”¨äºåœ¨æœ¬åœ°è¿›è¡Œæ›´æ”¹è€Œä¸å½±å“å‘¨å›´å…ƒç´ çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨æ–‡æœ¬å­—æ®µä¸­æ’å…¥æ–‡æœ¬ï¼ˆå¦åˆ™æ¯æ¬¡é”®ç›˜è¾“å…¥éƒ½å°†è§¦å‘ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å¸ƒå±€ï¼‰ã€‚</p><h4 id="å¸ƒå±€å¤„ç†"><a href="#å¸ƒå±€å¤„ç†" class="headerlink" title="å¸ƒå±€å¤„ç†"></a>å¸ƒå±€å¤„ç†</h4><p>å¸ƒå±€é€šå¸¸å…·æœ‰ä»¥ä¸‹æ¨¡å¼ï¼š</p><ol><li>çˆ¶å‘ˆç°å™¨ç¡®å®šè‡ªå·±çš„å®½åº¦ã€‚</li><li>çˆ¶å‘ˆç°å™¨ä¾æ¬¡å¤„ç†å­å‘ˆç°å™¨ï¼Œå¹¶ä¸”ï¼š<ol><li>æ”¾ç½®å­å‘ˆç°å™¨ï¼ˆè®¾ç½® x,y åæ ‡ï¼‰ã€‚</li><li>å¦‚æœæœ‰å¿…è¦ï¼Œè°ƒç”¨å­å‘ˆç°å™¨çš„å¸ƒå±€ï¼ˆå¦‚æœå­å‘ˆç°å™¨æ˜¯ dirty çš„ï¼Œæˆ–è€…è¿™æ˜¯å…¨å±€å¸ƒå±€ï¼Œæˆ–å‡ºäºå…¶ä»–æŸäº›åŸå› ï¼‰ï¼Œè¿™ä¼šè®¡ç®—å­å‘ˆç°å™¨çš„é«˜åº¦ã€‚</li></ol></li><li>çˆ¶å‘ˆç°å™¨æ ¹æ®å­å‘ˆç°å™¨çš„ç´¯åŠ é«˜åº¦ä»¥åŠè¾¹è·å’Œè¡¥ç™½çš„é«˜åº¦æ¥è®¾ç½®è‡ªèº«é«˜åº¦ï¼Œæ­¤å€¼ä¹Ÿå¯ä¾›çˆ¶å‘ˆç°å™¨çš„çˆ¶å‘ˆç°å™¨ä½¿ç”¨ã€‚</li><li>å°†å…¶ dirty ä½è®¾ç½®ä¸º falseã€‚</li></ol><p>Firefox ä½¿ç”¨ â€œstateâ€ å¯¹è±¡ (nsHTMLReflowState) ä½œä¸ºå¸ƒå±€çš„å‚æ•°ï¼ˆç§°ä¸ºâ€œreflowâ€ï¼‰ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬äº†çˆ¶å‘ˆç°å™¨çš„å®½åº¦ã€‚<br>Firefox å¸ƒå±€çš„è¾“å‡ºä¸º â€œmetricsâ€ å¯¹è±¡ (nsHTMLReflowMetrics)ï¼Œå…¶åŒ…å«è®¡ç®—å¾—å‡ºçš„å‘ˆç°å™¨é«˜åº¦ã€‚</p><h4 id="å®½åº¦è®¡ç®—"><a href="#å®½åº¦è®¡ç®—" class="headerlink" title="å®½åº¦è®¡ç®—"></a>å®½åº¦è®¡ç®—</h4><p>å‘ˆç°å™¨å®½åº¦æ˜¯æ ¹æ®å®¹å™¨å—çš„å®½åº¦ã€å‘ˆç°å™¨æ ·å¼ä¸­çš„ â€œwidthâ€ å±æ€§ä»¥åŠè¾¹è·å’Œè¾¹æ¡†è®¡ç®—å¾—å‡ºçš„ã€‚<br>ä¾‹å¦‚ä»¥ä¸‹ div çš„å®½åº¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div/&gt;</span><br></pre></td></tr></table></figure><p>å°†ç”± WebKit è®¡ç®—å¦‚ä¸‹ï¼ˆBenderBox ç±»ï¼ŒcalcWidth æ–¹æ³•ï¼‰ï¼š</p><ul><li><p>å®¹å™¨çš„å®½åº¦å–å®¹å™¨çš„ availableWidth å’Œ 0 ä¸­çš„è¾ƒå¤§å€¼ã€‚availableWidth åœ¨æœ¬ä¾‹ä¸­ç›¸å½“äº contentWidthï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clientWidth() - paddingLeft() - paddingRight()</span><br></pre></td></tr></table></figure></li></ul><pre><code>clientWidth å’Œ clientHeight è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨ï¼ˆé™¤å»è¾¹æ¡†å’Œæ»šåŠ¨æ¡ï¼‰ã€‚</code></pre><ul><li>å…ƒç´ çš„å®½åº¦æ˜¯ â€œwidthâ€ æ ·å¼å±æ€§ã€‚å®ƒä¼šæ ¹æ®å®¹å™¨å®½åº¦çš„ç™¾åˆ†æ¯”è®¡ç®—å¾—å‡ºä¸€ä¸ªç»å¯¹å€¼ã€‚</li><li>ç„¶ååŠ ä¸Šæ°´å¹³æ–¹å‘çš„è¾¹æ¡†å’Œè¡¥ç™½ã€‚</li></ul><p>ç°åœ¨è®¡ç®—å¾—å‡ºçš„æ˜¯ â€œpreferred widthâ€ã€‚ç„¶åéœ€è¦è®¡ç®—æœ€å°å®½åº¦å’Œæœ€å¤§å®½åº¦ã€‚<br>å¦‚æœé¦–é€‰å®½åº¦å¤§äºæœ€å¤§å®½åº¦ï¼Œé‚£ä¹ˆåº”ä½¿ç”¨æœ€å¤§å®½åº¦ã€‚å¦‚æœé¦–é€‰å®½åº¦å°äºæœ€å°å®½åº¦ï¼ˆæœ€å°çš„ä¸å¯ç ´å¼€å•ä½ï¼‰ï¼Œé‚£ä¹ˆåº”ä½¿ç”¨æœ€å°å®½åº¦ã€‚</p><p>è¿™äº›å€¼ä¼šç¼“å­˜èµ·æ¥ï¼Œä»¥ç”¨äºéœ€è¦å¸ƒå±€è€Œå®½åº¦ä¸å˜çš„æƒ…å†µã€‚</p><h4 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h4><p>å¦‚æœå‘ˆç°å™¨åœ¨å¸ƒå±€è¿‡ç¨‹ä¸­éœ€è¦æ¢è¡Œï¼Œä¼šç«‹å³åœæ­¢å¸ƒå±€ï¼Œå¹¶å‘ŠçŸ¥å…¶çˆ¶ä»£éœ€è¦æ¢è¡Œã€‚çˆ¶ä»£ä¼šåˆ›å»ºé¢å¤–çš„å‘ˆç°å™¨ï¼Œå¹¶å¯¹å…¶è°ƒç”¨å¸ƒå±€ã€‚</p><h3 id="ç»˜åˆ¶"><a href="#ç»˜åˆ¶" class="headerlink" title="ç»˜åˆ¶"></a>ç»˜åˆ¶</h3><p>åœ¨ç»˜åˆ¶é˜¶æ®µï¼Œç³»ç»Ÿä¼šéå†å‘ˆç°æ ‘ï¼Œå¹¶è°ƒç”¨å‘ˆç°å™¨çš„ â€œpaintâ€ æ–¹æ³•ï¼Œå°†å‘ˆç°å™¨çš„å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ç»˜åˆ¶å·¥ä½œæ˜¯ä½¿ç”¨ç”¨æˆ·ç•Œé¢åŸºç¡€ç»„ä»¶å®Œæˆçš„ã€‚</p><h4 id="å…¨å±€ç»˜åˆ¶å’Œå¢é‡ç»˜åˆ¶"><a href="#å…¨å±€ç»˜åˆ¶å’Œå¢é‡ç»˜åˆ¶" class="headerlink" title="å…¨å±€ç»˜åˆ¶å’Œå¢é‡ç»˜åˆ¶"></a>å…¨å±€ç»˜åˆ¶å’Œå¢é‡ç»˜åˆ¶</h4><p>å’Œå¸ƒå±€ä¸€æ ·ï¼Œç»˜åˆ¶ä¹Ÿåˆ†ä¸ºå…¨å±€ï¼ˆç»˜åˆ¶æ•´ä¸ªå‘ˆç°æ ‘ï¼‰å’Œå¢é‡ä¸¤ç§ã€‚åœ¨å¢é‡ç»˜åˆ¶ä¸­ï¼Œéƒ¨åˆ†å‘ˆç°å™¨å‘ç”Ÿäº†æ›´æ”¹ï¼Œä½†æ˜¯ä¸ä¼šå½±å“æ•´ä¸ªæ ‘ã€‚æ›´æ”¹åçš„å‘ˆç°å™¨å°†å…¶åœ¨å±å¹•ä¸Šå¯¹åº”çš„çŸ©å½¢åŒºåŸŸè®¾ä¸ºæ— æ•ˆï¼Œè¿™å¯¼è‡´ OS å°†å…¶è§†ä¸ºä¸€å— â€œdirty åŒºåŸŸâ€ï¼Œå¹¶ç”Ÿæˆâ€œpaintâ€ äº‹ä»¶ã€‚OS ä¼šå¾ˆå·§å¦™åœ°å°†å¤šä¸ªåŒºåŸŸåˆå¹¶æˆä¸€ä¸ªã€‚åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œæƒ…å†µè¦æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸º Chrome æµè§ˆå™¨çš„å‘ˆç°å™¨ä¸åœ¨ä¸»è¿›ç¨‹ä¸Šã€‚Chrome æµè§ˆå™¨ä¼šåœ¨æŸç§ç¨‹åº¦ä¸Šæ¨¡æ‹Ÿ OS çš„è¡Œä¸ºã€‚å±•ç¤ºå±‚ä¼šä¾¦å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶å°†æ¶ˆæ¯å§”æ‰˜ç»™å‘ˆç°æ ¹èŠ‚ç‚¹ã€‚ç„¶åéå†å‘ˆç°æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸å…³çš„å‘ˆç°å™¨ï¼Œè¯¥å‘ˆç°å™¨ä¼šé‡æ–°ç»˜åˆ¶è‡ªå·±ï¼ˆé€šå¸¸ä¹ŸåŒ…æ‹¬å…¶å­ä»£ï¼‰ã€‚</p><h4 id="ç»˜åˆ¶é¡ºåº"><a href="#ç»˜åˆ¶é¡ºåº" class="headerlink" title="ç»˜åˆ¶é¡ºåº"></a>ç»˜åˆ¶é¡ºåº</h4><p><a href="http://www.w3.org/TR/CSS21/zindex.html" target="_blank" rel="noopener">CSS2 è§„èŒƒå®šä¹‰äº†ç»˜åˆ¶æµç¨‹çš„é¡ºåº</a>ã€‚ç»˜åˆ¶çš„é¡ºåºå…¶å®å°±æ˜¯å…ƒç´ è¿›å…¥<a href="#stackingcontext">å †æ ˆæ ·å¼ä¸Šä¸‹æ–‡</a>çš„é¡ºåºã€‚è¿™äº›å †æ ˆä¼šä»åå¾€å‰ç»˜åˆ¶ï¼Œå› æ­¤è¿™æ ·çš„é¡ºåºä¼šå½±å“ç»˜åˆ¶ã€‚å—å‘ˆç°å™¨çš„å †æ ˆé¡ºåºå¦‚ä¸‹ï¼š</p><ol><li>èƒŒæ™¯é¢œè‰²</li><li>èƒŒæ™¯å›¾ç‰‡</li><li>è¾¹æ¡†</li><li>å­ä»£</li><li>è½®å»“</li></ol><h4 id="Firefox-æ˜¾ç¤ºåˆ—è¡¨"><a href="#Firefox-æ˜¾ç¤ºåˆ—è¡¨" class="headerlink" title="Firefox æ˜¾ç¤ºåˆ—è¡¨"></a>Firefox æ˜¾ç¤ºåˆ—è¡¨</h4><p>Firefox éå†æ•´ä¸ªå‘ˆç°æ ‘ï¼Œä¸ºç»˜åˆ¶çš„çŸ©å½¢å»ºç«‹ä¸€ä¸ªæ˜¾ç¤ºåˆ—è¡¨ã€‚åˆ—è¡¨ä¸­æŒ‰ç…§æ­£ç¡®çš„ç»˜åˆ¶é¡ºåºï¼ˆå…ˆæ˜¯å‘ˆç°å™¨çš„èƒŒæ™¯ï¼Œç„¶åæ˜¯è¾¹æ¡†ç­‰ç­‰ï¼‰åŒ…å«äº†ä¸çŸ©å½¢ç›¸å…³çš„å‘ˆç°å™¨ã€‚è¿™æ ·ç­‰åˆ°é‡æ–°ç»˜åˆ¶çš„æ—¶å€™ï¼Œåªéœ€éå†ä¸€æ¬¡å‘ˆç°æ ‘ï¼Œè€Œä¸ç”¨å¤šæ¬¡éå†ï¼ˆç»˜åˆ¶æ‰€æœ‰èƒŒæ™¯ï¼Œç„¶åç»˜åˆ¶æ‰€æœ‰å›¾ç‰‡ï¼Œå†ç»˜åˆ¶æ‰€æœ‰è¾¹æ¡†ç­‰ç­‰ï¼‰ã€‚</p><p>Firefox å¯¹æ­¤è¿‡ç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¸æ·»åŠ éšè—çš„å…ƒç´ ï¼Œä¾‹å¦‚è¢«ä¸é€æ˜å…ƒç´ å®Œå…¨é®æŒ¡ä½çš„å…ƒç´ ã€‚</p><h4 id="WebKit-çŸ©å½¢å­˜å‚¨"><a href="#WebKit-çŸ©å½¢å­˜å‚¨" class="headerlink" title="WebKit çŸ©å½¢å­˜å‚¨"></a>WebKit çŸ©å½¢å­˜å‚¨</h4><p>åœ¨é‡æ–°ç»˜åˆ¶ä¹‹å‰ï¼ŒWebKit ä¼šå°†åŸæ¥çš„çŸ©å½¢å¦å­˜ä¸ºä¸€å¼ ä½å›¾ï¼Œç„¶ååªç»˜åˆ¶æ–°æ—§çŸ©å½¢ä¹‹é—´çš„å·®å¼‚éƒ¨åˆ†ã€‚</p><h3 id="åŠ¨æ€å˜åŒ–"><a href="#åŠ¨æ€å˜åŒ–" class="headerlink" title="åŠ¨æ€å˜åŒ–"></a>åŠ¨æ€å˜åŒ–</h3><p>åœ¨å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæµè§ˆå™¨ä¼šå°½å¯èƒ½åšå‡ºæœ€å°çš„å“åº”ã€‚å› æ­¤ï¼Œå…ƒç´ çš„é¢œè‰²æ”¹å˜åï¼Œåªä¼šå¯¹è¯¥å…ƒç´ è¿›è¡Œé‡ç»˜ã€‚å…ƒç´ çš„ä½ç½®æ”¹å˜åï¼Œåªä¼šå¯¹è¯¥å…ƒç´ åŠå…¶å­å…ƒç´ ï¼ˆå¯èƒ½è¿˜æœ‰åŒçº§å…ƒç´ ï¼‰è¿›è¡Œå¸ƒå±€å’Œé‡ç»˜ã€‚æ·»åŠ  DOM èŠ‚ç‚¹åï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œå¸ƒå±€å’Œé‡ç»˜ã€‚ä¸€äº›é‡å¤§å˜åŒ–ï¼ˆä¾‹å¦‚å¢å¤§ â€œhtmlâ€ å…ƒç´ çš„å­—ä½“ï¼‰ä¼šå¯¼è‡´ç¼“å­˜æ— æ•ˆï¼Œä½¿å¾—æ•´ä¸ªå‘ˆç°æ ‘éƒ½ä¼šè¿›è¡Œé‡æ–°å¸ƒå±€å’Œç»˜åˆ¶ã€‚</p><h3 id="å‘ˆç°å¼•æ“çš„çº¿ç¨‹"><a href="#å‘ˆç°å¼•æ“çš„çº¿ç¨‹" class="headerlink" title="å‘ˆç°å¼•æ“çš„çº¿ç¨‹"></a>å‘ˆç°å¼•æ“çš„çº¿ç¨‹</h3><p>å‘ˆç°å¼•æ“é‡‡ç”¨äº†å•çº¿ç¨‹ã€‚å‡ ä¹æ‰€æœ‰æ“ä½œï¼ˆé™¤äº†ç½‘ç»œæ“ä½œï¼‰éƒ½æ˜¯åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œçš„ã€‚åœ¨ Firefox å’Œ Safari ä¸­ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯æµè§ˆå™¨çš„ä¸»çº¿ç¨‹ã€‚è€Œåœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œè¯¥çº¿ç¨‹æ˜¯æ ‡ç­¾è¿›ç¨‹çš„ä¸»çº¿ç¨‹ã€‚<br>ç½‘ç»œæ“ä½œå¯ç”±å¤šä¸ªå¹¶è¡Œçº¿ç¨‹æ‰§è¡Œã€‚å¹¶è¡Œè¿æ¥æ•°æ˜¯æœ‰é™çš„ï¼ˆé€šå¸¸ä¸º 2 è‡³ 6 ä¸ªï¼Œä»¥ Firefox 3 ä¸ºä¾‹æ˜¯ 6 ä¸ªï¼‰ã€‚</p><h4 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h4><p>æµè§ˆå™¨çš„ä¸»çº¿ç¨‹æ˜¯äº‹ä»¶å¾ªç¯ã€‚å®ƒæ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæ°¸è¿œå¤„äºæ¥å—å¤„ç†çŠ¶æ€ï¼Œå¹¶ç­‰å¾…äº‹ä»¶ï¼ˆå¦‚å¸ƒå±€å’Œç»˜åˆ¶äº‹ä»¶ï¼‰å‘ç”Ÿï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚è¿™æ˜¯ Firefox ä¸­å…³äºä¸»äº‹ä»¶å¾ªç¯çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">while (!mExiting)</span><br><span class="line">    NS_ProcessNextEvent(thread);</span><br></pre></td></tr></table></figure><h3 id="CSS2-å¯è§†åŒ–æ¨¡å‹"><a href="#CSS2-å¯è§†åŒ–æ¨¡å‹" class="headerlink" title="CSS2 å¯è§†åŒ–æ¨¡å‹"></a>CSS2 å¯è§†åŒ–æ¨¡å‹</h3><h4 id="ç”»å¸ƒ"><a href="#ç”»å¸ƒ" class="headerlink" title="ç”»å¸ƒ"></a>ç”»å¸ƒ</h4><p>æ ¹æ® <a href="http://www.w3.org/TR/CSS21/intro.html#processing-model" target="_blank" rel="noopener">CSS2 è§„èŒƒ</a>ï¼Œâ€œç”»å¸ƒâ€ è¿™ä¸€æœ¯è¯­æ˜¯æŒ‡ â€œç”¨æ¥å‘ˆç°æ ¼å¼åŒ–ç»“æ„çš„ç©ºé—´â€ï¼Œä¹Ÿå°±æ˜¯ä¾›æµè§ˆå™¨ç»˜åˆ¶å†…å®¹çš„åŒºåŸŸã€‚ç”»å¸ƒçš„ç©ºé—´å°ºå¯¸å¤§å°æ˜¯æ— é™çš„ï¼Œä½†æ˜¯æµè§ˆå™¨ä¼šæ ¹æ®è§†å£çš„å°ºå¯¸é€‰æ‹©ä¸€ä¸ªåˆå§‹å®½åº¦ã€‚</p><p>æ ¹æ® <a href="http://www.w3.org/TR/CSS2/zindex.html" target="_blank" rel="noopener">www.w3.org/TR/CSS2/zindex.html</a>ï¼Œç”»å¸ƒå¦‚æœåŒ…å«åœ¨å…¶ä»–ç”»å¸ƒå†…ï¼Œå°±æ˜¯é€æ˜çš„ï¼›å¦åˆ™ä¼šç”±æµè§ˆå™¨æŒ‡å®šä¸€ç§é¢œè‰²ã€‚</p><h4 id="CSS-æ¡†æ¨¡å‹"><a href="#CSS-æ¡†æ¨¡å‹" class="headerlink" title="CSS æ¡†æ¨¡å‹"></a>CSS æ¡†æ¨¡å‹</h4><p><a href="http://www.w3.org/TR/CSS2/box.html" target="_blank" rel="noopener">CSS æ¡†æ¨¡å‹</a>æè¿°çš„æ˜¯é’ˆå¯¹æ–‡æ¡£æ ‘ä¸­çš„å…ƒç´ è€Œç”Ÿæˆï¼Œå¹¶æ ¹æ®å¯è§†åŒ–æ ¼å¼æ¨¡å‹è¿›è¡Œå¸ƒå±€çš„çŸ©å½¢æ¡†ã€‚<br>æ¯ä¸ªæ¡†éƒ½æœ‰ä¸€ä¸ªå†…å®¹åŒºåŸŸï¼ˆä¾‹å¦‚æ–‡æœ¬ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œè¿˜æœ‰å¯é€‰çš„å‘¨å›´è¡¥ç™½ã€è¾¹æ¡†å’Œè¾¹è·åŒºåŸŸã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image046.jpg" alt=""> å›¾ï¼šCSS2 æ¡†æ¨¡å‹</p><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”Ÿæˆ 0..n ä¸ªè¿™æ ·çš„æ¡†ã€‚<br>æ‰€æœ‰å…ƒç´ éƒ½æœ‰ä¸€ä¸ª â€œdisplayâ€ å±æ€§ï¼Œå†³å®šäº†å®ƒä»¬æ‰€å¯¹åº”ç”Ÿæˆçš„æ¡†ç±»å‹ã€‚ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">block  - generates a block box.</span><br><span class="line">inline - generates one or more inline boxes.</span><br><span class="line">none - no box is generated.</span><br></pre></td></tr></table></figure><p>é»˜è®¤å€¼æ˜¯ inlineï¼Œä½†æ˜¯æµè§ˆå™¨æ ·å¼è¡¨è®¾ç½®äº†å…¶ä»–é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œâ€œdivâ€ å…ƒç´ çš„ display å±æ€§é»˜è®¤å€¼æ˜¯ blockã€‚<br>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°é»˜è®¤æ ·å¼è¡¨ç¤ºä¾‹ï¼š<a href="http://www.w3.org/TR/CSS2/sample.html" target="_blank" rel="noopener">www.w3.org/TR/CSS2/sample.html</a></p><h4 id="å®šä½æ–¹æ¡ˆ"><a href="#å®šä½æ–¹æ¡ˆ" class="headerlink" title="å®šä½æ–¹æ¡ˆ"></a>å®šä½æ–¹æ¡ˆ</h4><p>æœ‰ä¸‰ç§å®šä½æ–¹æ¡ˆï¼š</p><ol><li>æ™®é€šï¼šæ ¹æ®å¯¹è±¡åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®è¿›è¡Œå®šä½ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è±¡åœ¨å‘ˆç°æ ‘ä¸­çš„ä½ç½®å’Œå®ƒåœ¨ DOM æ ‘ä¸­çš„ä½ç½®ç›¸ä¼¼ï¼Œå¹¶æ ¹æ®å…¶æ¡†ç±»å‹å’Œå°ºå¯¸è¿›è¡Œå¸ƒå±€ã€‚</li><li>æµ®åŠ¨ï¼šå¯¹è±¡å…ˆæŒ‰ç…§æ™®é€šæµè¿›è¡Œå¸ƒå±€ï¼Œç„¶åå°½å¯èƒ½åœ°å‘å·¦æˆ–å‘å³ç§»åŠ¨ã€‚</li><li>ç»å¯¹ï¼šå¯¹è±¡åœ¨å‘ˆç°æ ‘ä¸­çš„ä½ç½®å’Œå®ƒåœ¨ DOM æ ‘ä¸­çš„ä½ç½®ä¸åŒã€‚</li></ol><p>å®šä½æ–¹æ¡ˆæ˜¯ç”± â€œpositionâ€ å±æ€§å’Œ â€œfloatâ€ å±æ€§è®¾ç½®çš„ã€‚</p><ul><li>å¦‚æœå€¼æ˜¯ static å’Œ relativeï¼Œå°±æ˜¯æ™®é€šæµ</li><li>å¦‚æœå€¼æ˜¯ absolute å’Œ fixedï¼Œå°±æ˜¯ç»å¯¹å®šä½</li></ul><p>static å®šä½æ— éœ€å®šä¹‰ä½ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤å®šä½ã€‚å¯¹äºå…¶ä»–æ–¹æ¡ˆï¼Œç½‘é¡µä½œè€…éœ€è¦æŒ‡å®šä½ç½®ï¼štopã€bottomã€leftã€rightã€‚</p><p>æ¡†çš„å¸ƒå±€æ–¹å¼æ˜¯ç”±ä»¥ä¸‹å› ç´ å†³å®šçš„ï¼š</p><ul><li>æ¡†ç±»å‹</li><li>æ¡†å°ºå¯¸</li><li>å®šä½æ–¹æ¡ˆ</li><li>å¤–éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚å›¾ç‰‡å¤§å°å’Œå±å¹•å¤§å°</li></ul><h4 id="æ¡†ç±»å‹"><a href="#æ¡†ç±»å‹" class="headerlink" title="æ¡†ç±»å‹"></a>æ¡†ç±»å‹</h4><p>block æ¡†ï¼šå½¢æˆä¸€ä¸ª blockï¼Œåœ¨æµè§ˆå™¨çª—å£ä¸­æ‹¥æœ‰å…¶è‡ªå·±çš„çŸ©å½¢åŒºåŸŸã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image057.png" alt=""> å›¾ï¼šblock æ¡†</p><p>inline æ¡†ï¼šæ²¡æœ‰è‡ªå·±çš„ blockï¼Œä½†æ˜¯ä½äºå®¹å™¨ block å†…ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image059.png" alt=""> å›¾ï¼šinline æ¡†</p><p>block é‡‡ç”¨çš„æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‚ç›´æ ¼å¼ï¼Œè€Œ inline é‡‡ç”¨çš„æ˜¯æ°´å¹³æ ¼å¼ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image061.png" alt=""> å›¾ï¼šblock å’Œ inline æ ¼å¼</p><p>inline æ¡†æ”¾ç½®åœ¨è¡Œä¸­æˆ– â€œè¡Œæ¡†â€ ä¸­ã€‚è¿™äº›è¡Œè‡³å°‘å’Œæœ€é«˜çš„æ¡†ä¸€æ ·é«˜ï¼Œè¿˜å¯ä»¥æ›´é«˜ï¼Œå½“æ¡†æ ¹æ® â€œåº•çº¿â€ å¯¹é½æ—¶ï¼Œè¿™æ„å‘³ç€å…ƒç´ çš„åº•éƒ¨éœ€è¦æ ¹æ®å…¶ä»–æ¡†ä¸­éåº•éƒ¨çš„ä½ç½®å¯¹é½ã€‚å¦‚æœå®¹å™¨çš„å®½åº¦ä¸å¤Ÿï¼Œinline å…ƒç´ å°±ä¼šåˆ†ä¸ºå¤šè¡Œæ”¾ç½®ã€‚åœ¨æ®µè½ä¸­ç»å¸¸å‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image063.png" alt=""> å›¾ï¼šè¡Œ</p><h3 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h3><h4 id="ç›¸å¯¹"><a href="#ç›¸å¯¹" class="headerlink" title="ç›¸å¯¹"></a>ç›¸å¯¹</h4><p>ç›¸å¯¹å®šä½ï¼šå…ˆæŒ‰ç…§æ™®é€šæ–¹å¼å®šä½ï¼Œç„¶åæ ¹æ®æ‰€éœ€åç§»é‡è¿›è¡Œç§»åŠ¨ã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image065.png" alt=""> å›¾ï¼šç›¸å¯¹å®šä½</p><h4 id="æµ®åŠ¨"><a href="#æµ®åŠ¨" class="headerlink" title="æµ®åŠ¨"></a>æµ®åŠ¨</h4><p>æµ®åŠ¨æ¡†ä¼šç§»åŠ¨åˆ°è¡Œçš„å·¦è¾¹æˆ–å³è¾¹ã€‚æœ‰è¶£çš„ç‰¹å¾åœ¨äºï¼Œå…¶ä»–æ¡†ä¼šæµ®åŠ¨åœ¨å®ƒçš„å‘¨å›´ã€‚ä¸‹é¢è¿™æ®µ HTML ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">  &lt;img src=&quot;images/image.gif&quot; width=&quot;100&quot; height=&quot;100&quot;&gt;</span><br><span class="line">  Lorem ipsum dolor sit amet, consectetuer...</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image067.png" alt=""> å›¾ï¼šæµ®åŠ¨</p><h4 id="ç»å¯¹å®šä½å’Œå›ºå®šå®šä½"><a href="#ç»å¯¹å®šä½å’Œå›ºå®šå®šä½" class="headerlink" title="ç»å¯¹å®šä½å’Œå›ºå®šå®šä½"></a>ç»å¯¹å®šä½å’Œå›ºå®šå®šä½</h4><p>è¿™ç§å¸ƒå±€æ˜¯å‡†ç¡®å®šä¹‰çš„ï¼Œä¸æ™®é€šæµæ— å…³ã€‚å…ƒç´ ä¸å‚ä¸æ™®é€šæµã€‚å°ºå¯¸æ˜¯ç›¸å¯¹äºå®¹å™¨è€Œè¨€çš„ã€‚åœ¨å›ºå®šå®šä½ä¸­ï¼Œå®¹å™¨å°±æ˜¯å¯è§†åŒºåŸŸã€‚</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image069.png" alt=""> å›¾ï¼šå›ºå®šå®šä½</p><p>è¯·æ³¨æ„ï¼Œå³ä½¿åœ¨æ–‡æ¡£æ»šåŠ¨æ—¶ï¼Œå›ºå®šæ¡†ä¹Ÿä¸ä¼šç§»åŠ¨ã€‚</p><h3 id="åˆ†å±‚å±•ç¤º"><a href="#åˆ†å±‚å±•ç¤º" class="headerlink" title="åˆ†å±‚å±•ç¤º"></a>åˆ†å±‚å±•ç¤º</h3><p>è¿™æ˜¯ç”± z-index CSS å±æ€§æŒ‡å®šçš„ã€‚å®ƒä»£è¡¨äº†æ¡†çš„ç¬¬ä¸‰ä¸ªç»´åº¦ï¼Œä¹Ÿå°±æ˜¯æ²¿ â€œz è½´â€ æ–¹å‘çš„ä½ç½®ã€‚</p><p>è¿™äº›æ¡†åˆ†æ•£åˆ°å¤šä¸ªå †æ ˆï¼ˆç§°ä¸ºå †æ ˆä¸Šä¸‹æ–‡ï¼‰ä¸­ã€‚åœ¨æ¯ä¸€ä¸ªå †æ ˆä¸­ï¼Œä¼šé¦–å…ˆç»˜åˆ¶åé¢çš„å…ƒç´ ï¼Œç„¶ååœ¨é¡¶éƒ¨ç»˜åˆ¶å‰é¢çš„å…ƒç´ ï¼Œä»¥ä¾¿æ›´é è¿‘ç”¨æˆ·ã€‚å¦‚æœå‡ºç°é‡å ï¼Œæ–°ç»˜åˆ¶çš„å…ƒç´ å°±ä¼šè¦†ç›–ä¹‹å‰çš„å…ƒç´ ã€‚<br>å †æ ˆæ˜¯æŒ‰ç…§ z-index å±æ€§è¿›è¡Œæ’åºçš„ã€‚å…·æœ‰ â€œz-indexâ€ å±æ€§çš„æ¡†å½¢æˆäº†æœ¬åœ°å †æ ˆã€‚è§†å£å…·æœ‰å¤–éƒ¨å †æ ˆã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">      div &#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        left: 2in;</span><br><span class="line">        top: 2in;</span><br><span class="line">      &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">        &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">        &gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"> &lt;/p&gt;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/image071.png" alt=""> å›¾ï¼šå›ºå®šå®šä½</p><p>è™½ç„¶çº¢è‰² div åœ¨æ ‡è®°ä¸­çš„ä½ç½®æ¯”ç»¿è‰² div é å‰ï¼ˆæŒ‰ç†åº”è¯¥åœ¨å¸¸è§„æµç¨‹ä¸­ä¼˜å…ˆç»˜åˆ¶ï¼‰ï¼Œä½†æ˜¯ z-index å±æ€§çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› æ­¤å®ƒç§»åŠ¨åˆ°äº†æ ¹æ¡†æ‰€ä¿æŒçš„å †æ ˆä¸­æ›´é å‰çš„ä½ç½®ã€‚</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li>æµè§ˆå™¨æ¶æ„<ol><li>Grosskurth, Alan. <a href="http://grosskurth.ca/papers/browser-refarch.pdf" target="_blank" rel="noopener">A Reference Architecture for Web Browsers (pdf)</a></li><li>Gupta, Vineet. <a href="http://www.vineetgupta.com/2010/11/how-browsers-work-part-1-architecture/" target="_blank" rel="noopener">How Browsers Work - Part 1 - Architecture</a></li></ol></li><li>è§£æ<ol><li>Aho, Sethi, Ullman, Compilers: Principles, Techniques, and Toolsï¼ˆå³ â€œDragon bookâ€ï¼‰, Addison-Wesley, 1986</li><li>Rick Jelliffe. <a href="http://broadcast.oreilly.com/2009/05/the-bold-and-the-beautiful-two.html" target="_blank" rel="noopener">The Bold and the Beautiful: two new drafts for HTML 5.</a></li></ol></li><li>Firefox<ol><li>L. David Baron, <a href="http://dbaron.org/talks/2008-11-12-faster-html-and-css/slide-6.xhtml" target="_blank" rel="noopener">Faster HTML and CSS: Layout Engine Internals for Web Developers.</a></li><li>L. David Baron, <a href="https://www.youtube.com/watch?v=a2_6bGNZ7bA" target="_blank" rel="noopener">Faster HTML and CSS: Layout Engine Internals for Web Developersï¼ˆGoogle æŠ€æœ¯è®¿è°ˆè§†é¢‘ï¼‰</a></li><li>L. David Baron, <a href="http://www.mozilla.org/newlayout/doc/layout-2006-07-12/slide-6.xhtml" target="_blank" rel="noopener">Mozillaâ€™s Layout Engine</a></li><li>L. David Baron, <a href="http://www.mozilla.org/newlayout/doc/style-system.html" target="_blank" rel="noopener">Mozilla Style System Documentation</a></li><li>Chris Waterson, <a href="http://www.mozilla.org/newlayout/doc/reflow.html" target="_blank" rel="noopener">Notes on HTML Reflow</a></li><li>Chris Waterson, <a href="http://www.mozilla.org/newlayout/doc/gecko-overview.htm" target="_blank" rel="noopener">Gecko Overview</a></li><li>Alexander Larsson, <a href="https://developer.mozilla.org/en/The_life_of_an_HTML_HTTP_request" target="_blank" rel="noopener">The life of an HTML HTTP request</a></li></ol></li><li>WebKit<ol><li>David Hyatt, <a href="http://weblogs.mozillazine.org/hyatt/archives/cat_safari.html" target="_blank" rel="noopener">Implementing CSSï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰</a></li><li>David Hyatt, <a href="http://weblogs.mozillazine.org/hyatt/WebCore/chapter2.html" target="_blank" rel="noopener">An Overview of WebCore</a></li><li>David Hyatt, <a href="http://webkit.org/blog/114/" target="_blank" rel="noopener">WebCore Rendering</a></li><li>David Hyatt, <a href="http://webkit.org/blog/66/the-fouc-problem/" target="_blank" rel="noopener">The FOUC Problem</a></li></ol></li><li>W3C è§„èŒƒ<ol><li><a href="http://www.w3.org/TR/html4/" target="_blank" rel="noopener">HTML 4.01 è§„èŒƒ</a></li><li><a href="http://dev.w3.org/html5/spec/Overview.html" target="_blank" rel="noopener">W3C HTML5 è§„èŒƒ</a></li><li><a href="http://www.w3.org/TR/CSS2/" target="_blank" rel="noopener">å±‚å æ ·å¼è¡¨ç¬¬ 2 çº§ç¬¬ 1 æ¬¡ä¿®æ”¹ (CSS 2.1) è§„èŒƒ</a></li></ol></li><li>æµè§ˆå™¨æ„å»ºè¯´æ˜<ol><li>Firefox. <a href="https://developer.mozilla.org/en/Build_Documentation" target="_blank" rel="noopener">https://developer.mozilla.org/en/Build_Documentation</a></li><li>WebKit. <a href="http://webkit.org/building/build.html" target="_blank" rel="noopener">http://webkit.org/building/build.html</a></li></ol></li></ol></div></div><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      ç½‘ç»œæµè§ˆå™¨å¾ˆå¯èƒ½æ˜¯ä½¿ç”¨æœ€å¹¿çš„è½¯ä»¶ã€‚åœ¨è¿™ç¯‡å…¥é—¨æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šä»‹ç»å®ƒä»¬çš„å¹•åå·¥ä½œåŸç†ã€‚æˆ‘ä»¬ä¼šäº†è§£åˆ°ï¼Œä»æ‚¨åœ¨åœ°å€æ è¾“å…¥ `google.com` ç›´åˆ°æ‚¨åœ¨æµè§ˆå™¨å±å¹•ä¸Šçœ‹åˆ° Google é¦–é¡µçš„æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½å‘ç”Ÿäº†äº›ä»€ä¹ˆã€‚
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="æµè§ˆå™¨" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
    
      <category term="æµè§ˆå™¨" scheme="https://andyxw.com/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>åä¸ªæ¡ˆä¾‹å­¦ä¼š React Hooks</title>
    <link href="https://andyxw.com/archives/cca6.html"/>
    <id>https://andyxw.com/archives/cca6.html</id>
    <published>2019-09-04T03:06:33.000Z</published>
    <updated>2019-09-04T13:24:35.157Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p><a href="https://github.com/happylindz/blog/issues/19" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p><h1 id="åä¸ªæ¡ˆä¾‹å­¦ä¼š-React-Hooks"><a href="#åä¸ªæ¡ˆä¾‹å­¦ä¼š-React-Hooks" class="headerlink" title="åä¸ªæ¡ˆä¾‹å­¦ä¼š React Hooks"></a>åä¸ªæ¡ˆä¾‹å­¦ä¼š React Hooks</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ React çš„ä¸–ç•Œä¸­ï¼Œæœ‰å®¹å™¨ç»„ä»¶å’Œ UI ç»„ä»¶ä¹‹åˆ†ï¼Œåœ¨ React Hooks å‡ºç°ä¹‹å‰ï¼ŒUI ç»„ä»¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°ï¼Œæ— çŠ¶æ€ç»„ä»¶æ¥å±•ç¤º UIï¼Œè€Œå¯¹äºå®¹å™¨ç»„ä»¶ï¼Œå‡½æ•°ç»„ä»¶å°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ï¼Œæˆ‘ä»¬ä¾èµ–äºç±»ç»„ä»¶æ¥è·å–æ•°æ®ï¼Œå¤„ç†æ•°æ®ï¼Œå¹¶å‘ä¸‹ä¼ é€’å‚æ•°ç»™ UI ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä½¿ç”¨ React Hooks ç›¸æ¯”äºä»å‰çš„ç±»ç»„ä»¶æœ‰ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼š</p><ol><li>ä»£ç å¯è¯»æ€§æ›´å¼ºï¼ŒåŸæœ¬åŒä¸€å—åŠŸèƒ½çš„ä»£ç é€»è¾‘è¢«æ‹†åˆ†åœ¨äº†ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ï¼Œå®¹æ˜“ä½¿å¼€å‘è€…ä¸åˆ©äºç»´æŠ¤å’Œè¿­ä»£ï¼Œé€šè¿‡ React Hooks å¯ä»¥å°†åŠŸèƒ½ä»£ç èšåˆï¼Œæ–¹ä¾¿é˜…è¯»ç»´æŠ¤</li><li>ç»„ä»¶æ ‘å±‚çº§å˜æµ…ï¼Œåœ¨åŸæœ¬çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ HOC/render props ç­‰æ–¹å¼æ¥å¤ç”¨ç»„ä»¶çš„çŠ¶æ€ï¼Œå¢å¼ºåŠŸèƒ½ç­‰ï¼Œæ— ç–‘å¢åŠ äº†ç»„ä»¶æ ‘å±‚æ•°åŠæ¸²æŸ“ï¼Œè€Œåœ¨ React Hooks ä¸­ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡å¼ºå¤§çš„è‡ªå®šä¹‰çš„ Hooks æ¥å®ç°</li></ol><p>React åœ¨ v16.8 çš„ç‰ˆæœ¬ä¸­æ¨å‡ºäº† React Hooks æ–°ç‰¹æ€§ï¼Œè™½ç„¶ç¤¾åŒºè¿˜æ²¡æœ‰æœ€ä½³å®è·µå¦‚ä½•åŸºäº React Hooks æ¥æ‰“é€ å¤æ‚åº”ç”¨(è‡³å°‘æˆ‘è¿˜æ²¡æœ‰)ï¼Œå‡­å€Ÿç€é˜…è¯»ç¤¾åŒºä¸­å¤§é‡çš„å…³äºè¿™æ–¹é¢çš„æ–‡ç« ï¼Œä¸‹é¢æˆ‘å°†é€šè¿‡åä¸ªæ¡ˆä¾‹æ¥å¸®åŠ©ä½ è®¤è¯†ç†è§£å¹¶å¯ä»¥ç†Ÿç»ƒè¿ç”¨ React Hooks å¤§éƒ¨åˆ†ç‰¹æ€§ã€‚</p><h2 id="useState-ä¿å­˜ç»„ä»¶çŠ¶æ€"><a href="#useState-ä¿å­˜ç»„ä»¶çŠ¶æ€" class="headerlink" title="useState ä¿å­˜ç»„ä»¶çŠ¶æ€"></a>useState ä¿å­˜ç»„ä»¶çŠ¶æ€</h2><p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>this.state</code> æ¥ä¿å­˜ç»„ä»¶çŠ¶æ€ï¼Œå¹¶å¯¹å…¶ä¿®æ”¹è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªç®€å•çš„è®¡æ•°å™¨ç»„ä»¶ï¼Œå¾ˆå¥½è¯ é‡Šäº†ç±»ç»„ä»¶å¦‚ä½•è¿è¡Œï¼š<a href="https://codesandbox.io/s/ojk1oloq9z" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      count: <span class="number">0</span>,</span><br><span class="line">      name: <span class="string">"alife"</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Count: &#123;count&#125;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: count + <span class="number">1</span> &#125;)&#125;&gt;+<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: count - <span class="number">1</span> &#125;)&#125;&gt;-<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ç»„ä»¶å°±å®Œæˆäº†ï¼Œè€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œç”±äºæ²¡æœ‰ this è¿™ä¸ªé»‘é­”æ³•ï¼ŒReact é€šè¿‡ useState æ¥å¸®æˆ‘ä»¬ä¿å­˜ç»„ä»¶çš„çŠ¶æ€ã€‚<a href="https://codesandbox.io/s/mj3j955m6x" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [obj, setObject] = useState(&#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    name: <span class="string">"alife"</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      Count: &#123;obj.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setObject(&#123; ...obj, <span class="attr">count</span>: obj.count + <span class="number">1</span> &#125;)&#125;&gt;+<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setObject(&#123; ...obj, <span class="attr">count</span>: obj.count - <span class="number">1</span> &#125;)&#125;&gt;-<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¼ å…¥ useState å‚æ•°åè¿”å›ä¸€ä¸ªå¸¦æœ‰é»˜è®¤çŠ¶æ€å’Œæ”¹å˜çŠ¶æ€å‡½æ•°çš„æ•°ç»„ã€‚é€šè¿‡ä¼ å…¥æ–°çŠ¶æ€ç»™å‡½æ•°æ¥æ”¹å˜åŸæœ¬çš„çŠ¶æ€å€¼ã€‚<strong>å€¼å¾—æ³¨æ„çš„æ˜¯ useState ä¸å¸®åŠ©ä½ å¤„ç†çŠ¶æ€ï¼Œç›¸è¾ƒäº setState éè¦†ç›–å¼æ›´æ–°çŠ¶æ€ï¼ŒuseState è¦†ç›–å¼æ›´æ–°çŠ¶æ€ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±å¤„ç†é€»è¾‘ã€‚(ä»£ç å¦‚ä¸Š)</strong></p><p>ä¼¼ä¹æœ‰ä¸ª useState åï¼Œå‡½æ•°ç»„ä»¶ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€äº†ï¼Œä½†ä»…ä»…æ˜¯è¿™æ ·å®Œå…¨ä¸å¤Ÿã€‚</p><h2 id="useEffect-å¤„ç†å‰¯ä½œç”¨"><a href="#useEffect-å¤„ç†å‰¯ä½œç”¨" class="headerlink" title="useEffect å¤„ç†å‰¯ä½œç”¨"></a>useEffect å¤„ç†å‰¯ä½œç”¨</h2><p>å‡½æ•°ç»„ä»¶èƒ½ä¿å­˜çŠ¶æ€ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥è¯·æ±‚ï¼Œå‰¯ä½œç”¨çš„æ“ä½œè¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥ React æä¾›äº† useEffect æ¥å¸®åŠ©å¼€å‘è€…å¤„ç†å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œåœ¨ä»‹ç»æ–° API ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç±»ç»„ä»¶æ˜¯æ€ä¹ˆåšçš„ï¼š<a href="https://codesandbox.io/s/y29rwpk3z1" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">1</span></span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">"componentDidMount"</span> + count;</span><br><span class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(<span class="function">(<span class="params">&#123; count &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">        count: count + <span class="number">1</span></span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">"componentDidMount"</span> + count;</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">"componentWillUnmount"</span>;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.timer);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        Count:&#123;count&#125;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; clearInterval(<span class="keyword">this</span>.timer)&#125;&gt;clear&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¾‹å­ä¸­ï¼Œç»„ä»¶æ¯éš”ä¸€ç§’æ›´æ–°ç»„ä»¶çŠ¶æ€ï¼Œå¹¶ä¸”æ¯æ¬¡è§¦å‘æ›´æ–°éƒ½ä¼šè§¦å‘ document.title çš„æ›´æ–°(å‰¯ä½œç”¨)ï¼Œè€Œåœ¨ç»„ä»¶å¸è½½æ—¶ä¿®æ”¹ document.titleï¼ˆç±»ä¼¼äºæ¸…é™¤ï¼‰</p><p>ä»ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€äº›é‡å¤çš„åŠŸèƒ½å¼€å‘è€…éœ€è¦åœ¨ componentDidMount å’Œ componentDidUpdate é‡å¤ç¼–å†™ï¼Œè€Œå¦‚æœä½¿ç”¨ useEffect åˆ™å®Œå…¨ä¸ä¸€æ ·ã€‚<a href="https://codesandbox.io/s/0x1l4kk6lv" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">"componentDidMount"</span> + count;</span><br><span class="line">  &#125;,[count]);</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="function"><span class="params">prevCount</span> =&gt;</span> prevCount + <span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">document</span>.title = <span class="string">"componentWillUnmount"</span>;</span><br><span class="line">      clearInterval(timer);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      Count: &#123;count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; clearInterval(timer)&#125;&gt;clear&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ useEffect é‡å†™äº†ä¸Šé¢çš„ä¾‹å­ï¼ŒuseEffect ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥åšä¸€äº›å‰¯ä½œç”¨æ¯”å¦‚å¼‚æ­¥è¯·æ±‚ï¼Œä¿®æ”¹å¤–éƒ¨å‚æ•°ç­‰è¡Œä¸ºï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªæ•°ç»„ï¼Œå¦‚æœæ•°ç»„ä¸­çš„å€¼æ‰ä¼šè§¦å‘ useEffect ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„å‡½æ•°ã€‚è¿”å›å€¼(å¦‚æœæœ‰)åˆ™åœ¨ç»„ä»¶é”€æ¯æˆ–è€…è°ƒç”¨å‡½æ•°å‰è°ƒç”¨ã€‚</p><ol><li>æ¯”å¦‚ç¬¬ä¸€ä¸ª useEffect ä¸­ï¼Œç†è§£èµ·æ¥å°±æ˜¯ä¸€æ—¦ count å€¼å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä¿®æ”¹ documen.title å€¼</li><li>è€Œç¬¬äºŒä¸ª useEffect ä¸­æ•°ç»„æ²¡æœ‰ä¼ å€¼ï¼Œä»£è¡¨ä¸ç›‘å¬ä»»ä½•å‚æ•°å˜åŒ–ï¼Œå³åªæœ‰åœ¨ç»„ä»¶åˆå§‹åŒ–æˆ–é”€æ¯çš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼Œç”¨æ¥ä»£æ›¿ componentDidMount å’Œ componentWillUnmount</li></ol><p>åŸºäºè¿™ä¸ªå¼ºå¤§ Hooksï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå°è£…å‡ºå…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ¯”å¦‚ componentDidUpdate ä»£ç ååˆ†ç®€å•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useUpdate</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// useRef åˆ›å»ºä¸€ä¸ªå¼•ç”¨</span></span><br><span class="line">    <span class="keyword">const</span> mounting = useRef(<span class="literal">true</span>);</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (mounting.current) &#123;</span><br><span class="line">        mounting.current = <span class="literal">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fn();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æœ‰äº† useState ç®¡ç†çŠ¶æ€ï¼ŒuseEffect å¤„ç†å‰¯ä½œç”¨ï¼Œå¼‚æ­¥é€»è¾‘ï¼Œå­¦ä¼šè¿™ä¸¤æ‹›è¶³ä»¥åº”å¯¹å¤§éƒ¨åˆ†ç±»ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ã€‚</p><h2 id="useContext-å‡å°‘ç»„ä»¶å±‚çº§"><a href="#useContext-å‡å°‘ç»„ä»¶å±‚çº§" class="headerlink" title="useContext å‡å°‘ç»„ä»¶å±‚çº§"></a>useContext å‡å°‘ç»„ä»¶å±‚çº§</h2><p>ä¸Šé¢ä»‹ç»äº† useStateã€useEffect è¿™ä¸¤ä¸ªæœ€åŸºæœ¬çš„ APIï¼Œæ¥ä¸‹æ¥ä»‹ç»çš„ useContext æ˜¯ React å¸®ä½ å°è£…å¥½çš„ï¼Œç”¨æ¥å¤„ç†å¤šå±‚çº§ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œåœ¨ä»¥å‰ç»„ä»¶æ ‘ç§ï¼Œè·¨å±‚çº§ç¥–å…ˆç»„ä»¶æƒ³è¦ç»™å­™å­ç»„ä»¶ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œé™¤äº†ä¸€å±‚å±‚ props å¾€ä¸‹é€ä¼ ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ React Context API æ¥å¸®æˆ‘ä»¬åšè¿™ä»¶äº‹ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š<a href="https://codesandbox.io/s/94p24or414" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; Provider, Consumer &#125; = React.createContext(<span class="literal">null</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Consumer</span>&gt;</span>&#123;color =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;color&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Consumer</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">function App() &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;Provider value=&#123;"grey"&#125;&gt;</span><br><span class="line">      &lt;Foo /&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ React createContext çš„è¯­æ³•ï¼Œåœ¨ APP ç»„ä»¶ä¸­å¯ä»¥è·¨è¿‡ Foo ç»„ä»¶ç»™ Bar ä¼ é€’æ•°æ®ã€‚è€Œåœ¨ React Hooks ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ useContext è¿›è¡Œæ”¹é€ ã€‚<a href="">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> colorContext = React.createContext(<span class="string">"gray"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> color = useContext(colorContext);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;color&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Bar</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">function App() &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;colorContext.Provider value=&#123;"red"&#125;&gt;</span><br><span class="line">      &lt;Foo /&gt;</span><br><span class="line">    &lt;/colorContext.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’ç»™ useContext çš„æ˜¯ context è€Œä¸æ˜¯ consumerï¼Œè¿”å›å€¼å³æ˜¯æƒ³è¦é€ä¼ çš„æ•°æ®äº†ã€‚ç”¨æ³•å¾ˆç®€å•ï¼Œä½¿ç”¨ useContext å¯ä»¥è§£å†³ Consumer å¤šçŠ¶æ€åµŒå¥—çš„é—®é¢˜ã€‚<a href="https://daveceddia.com/usecontext-hook/" target="_blank" rel="noopener">å‚è€ƒä¾‹å­</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HeaderBar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;CurrentUser.Consumer&gt;</span><br><span class="line">      &#123;user =&gt;</span><br><span class="line">        &lt;Notifications.Consumer&gt;</span><br><span class="line">          &#123;notifications =&gt;</span><br><span class="line">            &lt;header&gt;</span><br><span class="line">              Welcome back, &#123;user.name&#125;!</span><br><span class="line">              You have &#123;notifications.length&#125; notifications.</span><br><span class="line">            &lt;<span class="regexp">/header&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>CurrentUser.Consumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä½¿ç”¨ useContext åˆ™å˜å¾—ååˆ†ç®€æ´ï¼Œå¯è¯»æ€§æ›´å¼ºä¸”ä¸ä¼šå¢åŠ ç»„ä»¶æ ‘æ·±åº¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HeaderBar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = useContext(CurrentUser);</span><br><span class="line">  <span class="keyword">const</span> notifications = useContext(Notifications);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;header&gt;</span><br><span class="line">      Welcome back, &#123;user.name&#125;!</span><br><span class="line">      You have &#123;notifications.length&#125; notifications.</span><br><span class="line">    &lt;<span class="regexp">/header&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h2><p>useReducer è¿™ä¸ª Hooks åœ¨ä½¿ç”¨ä¸Šå‡ ä¹è·Ÿ Redux/React-Redux ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€ç¼ºå°‘çš„å°±æ˜¯æ— æ³•ä½¿ç”¨ redux æä¾›çš„ä¸­é—´ä»¶ã€‚æˆ‘ä»¬å°†ä¸Šè¿°çš„è®¡æ—¶å™¨ç»„ä»¶æ”¹å†™ä¸º useReducerï¼Œ<a href="https://codesandbox.io/s/727o0kr4yx" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = &#123;</span><br><span class="line">  count: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"increment"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count + action.payload &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"decrement"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - action.payload &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      Count: &#123;state.count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; dispatch(&#123; <span class="attr">type</span>: <span class="string">"increment"</span>, <span class="attr">payload</span>: <span class="number">5</span> &#125;)&#125;&gt;</span><br><span class="line">        +</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; dispatch(&#123; type: "decrement", payload: 5 &#125;)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        -</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ³•è·Ÿ Redux åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œç®—æ˜¯æä¾›ä¸€ä¸ª mini çš„ Redux ç‰ˆæœ¬ã€‚</p><h2 id="useCallback-è®°å¿†å‡½æ•°"><a href="#useCallback-è®°å¿†å‡½æ•°" class="headerlink" title="useCallback è®°å¿†å‡½æ•°"></a>useCallback è®°å¿†å‡½æ•°</h2><p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çŠ¯ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &lt;SomeComponent style=&#123;&#123; fontSize: 14 &#125;&#125; doSomething=&#123; () =&gt; &#123; console.log('do something'); &#125;&#125;  /&gt;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å†™æœ‰ä»€ä¹ˆåå¤„å‘¢ï¼Ÿä¸€æ—¦ App ç»„ä»¶çš„ props æˆ–è€…çŠ¶æ€æ”¹å˜äº†å°±ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå³ä½¿è·Ÿ SomeComponent ç»„ä»¶ä¸ç›¸å…³ï¼Œç”±äºæ¯æ¬¡ render éƒ½ä¼šäº§ç”Ÿæ–°çš„ style å’Œ doSomethingï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ SomeComponent é‡æ–°æ¸²æŸ“ï¼Œå€˜è‹¥ SomeComponent æ˜¯ä¸€ä¸ªå¤§å‹çš„ç»„ä»¶æ ‘ï¼Œè¿™æ ·çš„ Virtual Dom çš„æ¯”è¾ƒæ˜¾ç„¶æ˜¯å¾ˆæµªè´¹çš„ï¼Œè§£å†³çš„åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†å‚æ•°æŠ½ç¦»æˆå˜é‡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fontSizeStyle = &#123; <span class="attr">fontSize</span>: <span class="number">14</span> &#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    doSomething = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'do something'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &lt;SomeComponent style=&#123;fontSizeStyle&#125; doSomething=&#123; this.doSomething &#125;  /&gt;</span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ this è¿™ä¸ªå¯¹è±¡æ¥å­˜å‚¨å‡½æ•°ï¼Œè€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­æ²¡åŠæ³•è¿›è¡ŒæŒ‚è½½äº†ã€‚æ‰€ä»¥å‡½æ•°ç»„ä»¶åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™å¦‚æœæœ‰ä¼ é€’å‡½æ•°çš„è¯éƒ½ä¼šé‡æ¸²æŸ“å­ç»„ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Click happened'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œæœ‰äº† useCallback å°±ä¸ä¸€æ ·äº†ï¼Œä½ å¯ä»¥é€šè¿‡ useCallback è·å¾—ä¸€ä¸ªè®°å¿†åçš„å‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> memoizedHandleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Click happened'</span>)</span><br><span class="line">  &#125;, []); <span class="comment">// ç©ºæ•°ç»„ä»£è¡¨æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹è¯¥å‡½æ•°éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;memoizedHandleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€è§„çŸ©ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ä¸€æ—¦å€¼æˆ–è€…å¼•ç”¨å‘ç”Ÿæ”¹å˜ï¼ŒuseCallback å°±ä¼šé‡æ–°è¿”å›ä¸€ä¸ªæ–°çš„è®°å¿†å‡½æ•°æä¾›ç»™åé¢è¿›è¡Œæ¸²æŸ“ã€‚</p><p>è¿™æ ·åªè¦å­ç»„ä»¶ç»§æ‰¿äº† PureComponent æˆ–è€…ä½¿ç”¨ React.memo å°±å¯ä»¥æœ‰æ•ˆé¿å…ä¸å¿…è¦çš„ VDOM æ¸²æŸ“ã€‚</p><h2 id="useMemo-è®°å¿†ç»„ä»¶"><a href="#useMemo-è®°å¿†ç»„ä»¶" class="headerlink" title="useMemo è®°å¿†ç»„ä»¶"></a>useMemo è®°å¿†ç»„ä»¶</h2><p>useCallback çš„åŠŸèƒ½å®Œå…¨å¯ä»¥ç”± useMemo æ‰€å–ä»£ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ä½¿ç”¨ useMemo è¿”å›ä¸€ä¸ªè®°å¿†å‡½æ•°ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useCallback(fn, inputs) is equivalent to useMemo(() =&gt; fn, inputs).</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å‰é¢ä½¿ç”¨ useCallback çš„ä¾‹å­å¯ä»¥ä½¿ç”¨ useMemo è¿›è¡Œæ”¹å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> memoizedHandleClick = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Click happened'</span>)</span><br><span class="line">  &#125;, []); <span class="comment">// ç©ºæ•°ç»„ä»£è¡¨æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹è¯¥å‡½æ•°éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SomeComponent</span> <span class="attr">onClick</span>=<span class="string">&#123;memoizedHandleClick&#125;</span>&gt;</span>Click Me<span class="tag">&lt;/<span class="name">SomeComponent</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼š<strong>useCallback ä¸ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‚æ•°å‡½æ•°ï¼Œè€Œæ˜¯å°†å®ƒè¿”å›ç»™ä½ ï¼Œè€Œ useMemo ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå‡½æ•°å¹¶ä¸”å°†å‡½æ•°æ‰§è¡Œç»“æœè¿”å›ç»™ä½ ã€‚</strong>æ‰€ä»¥åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥è¿”å› handleClick æ¥è¾¾åˆ°å­˜å‚¨å‡½æ•°çš„ç›®çš„ã€‚</p><p>æ‰€ä»¥ useCallback å¸¸ç”¨è®°å¿†äº‹ä»¶å‡½æ•°ï¼Œç”Ÿæˆè®°å¿†åçš„äº‹ä»¶å‡½æ•°å¹¶ä¼ é€’ç»™å­ç»„ä»¶ä½¿ç”¨ã€‚è€Œ useMemo æ›´é€‚åˆç»è¿‡å‡½æ•°è®¡ç®—å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚è®°å¿†ç»„ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">&#123; a, b &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Only re-rendered if `a` changes:</span></span><br><span class="line">  <span class="keyword">const</span> child1 = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &lt;Child1 a=&#123;a&#125; /&gt;, [a]);</span><br><span class="line">  <span class="comment">// Only re-rendered if `b` changes:</span></span><br><span class="line">  <span class="keyword">const</span> child2 = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &lt;Child2 b=&#123;b&#125; /&gt;, [b]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;child1&#125;</span><br><span class="line">      &#123;child2&#125;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å½“ a/b æ”¹å˜æ—¶ï¼Œchild1/child2 æ‰ä¼šé‡æ–°æ¸²æŸ“ã€‚ä»ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåªæœ‰åœ¨ç¬¬äºŒä¸ªå‚æ•°æ•°ç»„çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘å­ç»„ä»¶çš„æ›´æ–°ã€‚</p><h2 id="useRef-ä¿å­˜å¼•ç”¨å€¼"><a href="#useRef-ä¿å­˜å¼•ç”¨å€¼" class="headerlink" title="useRef ä¿å­˜å¼•ç”¨å€¼"></a>useRef ä¿å­˜å¼•ç”¨å€¼</h2><p>useRef è·Ÿ createRef ç±»ä¼¼ï¼Œéƒ½å¯ä»¥ç”¨æ¥ç”Ÿæˆå¯¹ DOM å¯¹è±¡çš„å¼•ç”¨ï¼Œçœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š<a href="https://codesandbox.io/s/v6948pww5y?from-embed" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [name, setName] = useState(<span class="string">"Nate"</span>);</span><br><span class="line">  <span class="keyword">let</span> nameRef = useRef();</span><br><span class="line">  <span class="keyword">const</span> submitButton = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setName(nameRef.current.value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;name&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input ref=&#123;nameRef&#125; type="text" /</span>&gt;</span><br><span class="line">        &lt;button type=<span class="string">"button"</span> onClick=&#123;submitButton&#125;&gt;</span><br><span class="line">          Submit</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>useRef è¿”å›çš„å€¼ä¼ é€’ç»™ç»„ä»¶æˆ–è€… DOM çš„ ref å±æ€§ï¼Œå°±å¯ä»¥é€šè¿‡ ref.current å€¼è®¿é—®ç»„ä»¶æˆ–çœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥å¯¹ DOM è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç›‘å¬äº‹ä»¶ç­‰ç­‰ã€‚</p><p>å½“ç„¶ useRef è¿œæ¯”ä½ æƒ³è±¡ä¸­çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼ŒuseRef çš„åŠŸèƒ½æœ‰ç‚¹åƒç±»å±æ€§ï¼Œæˆ–è€…è¯´æ‚¨æƒ³è¦åœ¨ç»„ä»¶ä¸­è®°å½•ä¸€äº›å€¼ï¼Œå¹¶ä¸”è¿™äº›å€¼åœ¨ç¨åå¯ä»¥æ›´æ”¹ã€‚</p><p>åˆ©ç”¨ useRef å°±å¯ä»¥ç»•è¿‡ Capture Value çš„ç‰¹æ€§ã€‚å¯ä»¥è®¤ä¸º ref åœ¨æ‰€æœ‰ Render è¿‡ç¨‹ä¸­ä¿æŒç€å”¯ä¸€å¼•ç”¨ï¼Œå› æ­¤æ‰€æœ‰å¯¹ ref çš„èµ‹å€¼æˆ–å–å€¼ï¼Œæ‹¿åˆ°çš„éƒ½åªæœ‰ä¸€ä¸ªæœ€ç»ˆçŠ¶æ€ï¼Œè€Œä¸ä¼šåœ¨æ¯ä¸ª Render é—´å­˜åœ¨éš”ç¦»ã€‚å‚è€ƒä¾‹å­ï¼š<a href="https://juejin.im/post/5c8eec1bf265da67cb619e79" target="_blank" rel="noopener">ç²¾è¯»ã€ŠFunction VS Class ç»„ä»¶ã€‹</a></p><p>React Hooks ä¸­å­˜åœ¨ Capture Value çš„ç‰¹æ€§ï¼š<a href="https://codesandbox.io/s/93m5mz9w24" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MessageThread</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [message, setMessage] = useState(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showMessage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    alert(<span class="string">"You said: "</span> + message);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSendClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(showMessage, <span class="number">3000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleMessageChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    setMessage(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;input value=&#123;message&#125; onChange=&#123;handleMessageChange&#125; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleSendClick&#125;&gt;Send&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç‚¹å‡» Send æŒ‰é’®åï¼Œå†æ¬¡ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼ï¼Œ3 ç§’åçš„è¾“å‡ºä¾ç„¶æ˜¯ç‚¹å‡»å‰è¾“å…¥æ¡†çš„å€¼ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ capture value çš„ç‰¹æ€§ã€‚è€Œåœ¨ç±»ç»„ä»¶ä¸­ 3 ç§’åè¾“å‡ºçš„å°±æ˜¯ä¿®æ”¹åçš„å€¼ï¼Œå› ä¸ºè¿™æ—¶å€™ message æ˜¯æŒ‚è½½åœ¨ this å˜é‡ä¸Šï¼Œå®ƒä¿ç•™çš„æ˜¯ä¸€ä¸ªå¼•ç”¨å€¼ï¼Œå¯¹ this å±æ€§çš„è®¿é—®éƒ½ä¼šè·å–åˆ°æœ€æ–°çš„å€¼ã€‚è®²åˆ°è¿™é‡Œä½ åº”è¯¥å°±æ˜ç™½äº†ï¼ŒuseRef åˆ›å»ºä¸€ä¸ªå¼•ç”¨ï¼Œå°±å¯ä»¥æœ‰æ•ˆè§„é¿ React Hooks ä¸­ Capture Value ç‰¹æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MessageThread</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> latestMessage = useRef(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> showMessage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    alert(<span class="string">"You said: "</span> + latestMessage.current);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSendClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(showMessage, <span class="number">3000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleMessageChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    latestMessage.current = e.target.value;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦å°†èµ‹å€¼ä¸å–å€¼çš„å¯¹è±¡å˜æˆ useRefï¼Œè€Œä¸æ˜¯ useStateï¼Œå°±å¯ä»¥èº²è¿‡ capture value ç‰¹æ€§ï¼Œåœ¨ 3 ç§’åå¾—åˆ°æœ€æ–°çš„å€¼ã€‚</p><h2 id="useImperativeHandle-é€ä¼ -Ref"><a href="#useImperativeHandle-é€ä¼ -Ref" class="headerlink" title="useImperativeHandle é€ä¼  Ref"></a>useImperativeHandle é€ä¼  Ref</h2><p>é€šè¿‡ useImperativeHandle ç”¨äºè®©çˆ¶ç»„ä»¶è·å–å­ç»„ä»¶å†…çš„ç´¢å¼• <a href="https://codesandbox.io/s/m7wxjz5j3j" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef, useEffect, useImperativeHandle, forwardRef &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChildInputComponent</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef(<span class="literal">null</span>);</span><br><span class="line">  useImperativeHandle(ref, () =&gt; inputRef.current);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"child input"</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">const ChildInput = forwardRef(ChildInputComponent);</span></span><br><span class="line"><span class="xml">function App() &#123;</span></span><br><span class="line"><span class="xml">  const inputRef = useRef(null);</span></span><br><span class="line"><span class="xml">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">    inputRef.current.focus();</span></span><br><span class="line"><span class="xml">  &#125;, []);</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ChildInput ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒApp ç»„ä»¶å¯ä»¥è·å¾—å­ç»„ä»¶çš„ input çš„ DOM èŠ‚ç‚¹ã€‚</p><h2 id="useLayoutEffect-åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨"><a href="#useLayoutEffect-åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨" class="headerlink" title="useLayoutEffect åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨"></a>useLayoutEffect åŒæ­¥æ‰§è¡Œå‰¯ä½œç”¨</h2><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½¿ç”¨ useEffect å°±å¯ä»¥å¸®æˆ‘ä»¬å¤„ç†ç»„ä»¶çš„å‰¯ä½œç”¨ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦åŒæ­¥è°ƒç”¨ä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¯¹ DOM çš„æ“ä½œï¼Œå°±éœ€è¦ä½¿ç”¨ useLayoutEffectï¼ŒuseLayoutEffect ä¸­çš„å‰¯ä½œç”¨ä¼šåœ¨ DOM æ›´æ–°ä¹‹ååŒæ­¥æ‰§è¡Œã€‚<a href="https://codesandbox.io/s/74myo7w94q" target="_blank" rel="noopener">åœ¨çº¿ Demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [width, setWidth] = useState(<span class="number">0</span>);</span><br><span class="line">  useLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="built_in">document</span>.querySelector(<span class="string">"#title"</span>);</span><br><span class="line">    <span class="keyword">const</span> titleWidth = title.getBoundingClientRect().width;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"useLayoutEffect"</span>);</span><br><span class="line">    <span class="keyword">if</span> (width !== titleWidth) &#123;</span><br><span class="line">      setWidth(titleWidth);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"useEffect"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 id=<span class="string">"title"</span>&gt;hello&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;&#123;width&#125;&lt;/</span>h2&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒuseLayoutEffect ä¼šåœ¨ renderï¼ŒDOM æ›´æ–°ä¹‹ååŒæ­¥è§¦å‘å‡½æ•°ï¼Œä¼šä¼˜äº useEffect å¼‚æ­¥è§¦å‘å‡½æ•°ã€‚</p><h2 id="React-Hooks-ä¸è¶³"><a href="#React-Hooks-ä¸è¶³" class="headerlink" title="React Hooks ä¸è¶³"></a>React Hooks ä¸è¶³</h2><p>å°½ç®¡æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä¾‹å­çœ‹åˆ° React Hooks çš„å¼ºå¤§ä¹‹å¤„ï¼Œä¼¼ä¹ç±»ç»„ä»¶å®Œå…¨éƒ½å¯ä»¥ä½¿ç”¨ React Hooks é‡å†™ã€‚ä½†æ˜¯å½“ä¸‹ v16.8 çš„ç‰ˆæœ¬ä¸­ï¼Œè¿˜æ— æ³•å®ç° getSnapshotBeforeUpdate å’Œ componentDidCatch è¿™ä¸¤ä¸ªåœ¨ç±»ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å®˜æ–¹ä¹Ÿè®¡åˆ’åœ¨ä¸ä¹…çš„å°†æ¥åœ¨ React Hooks è¿›è¡Œå®ç°ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      é€šè¿‡åä¸ªæ¡ˆä¾‹æ¥è®¤è¯†ç†è§£å¹¶å¯ä»¥ç†Ÿç»ƒè¿ç”¨ React Hooks å¤§éƒ¨åˆ†ç‰¹æ€§
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/React-Hooks/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
  </entry>
  
  <entry>
    <title>JS Iframeä¸çˆ¶çº§é¡µé¢é€šä¿¡åŠIE9å…¼å®¹æ€§</title>
    <link href="https://andyxw.com/archives/d4bd.html"/>
    <id>https://andyxw.com/archives/d4bd.html</id>
    <published>2019-09-04T03:04:24.000Z</published>
    <updated>2019-09-04T13:25:42.469Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://www.cnblogs.com/haosit/p/11301350.html" target="_blank" rel="noopener">https://www.cnblogs.com/haosit/p/11301350.html</a></p></blockquote><p><strong>ä¸€ã€ postMessage</strong></p><p>window.postMessage() æ–¹æ³•å®‰å…¨åœ°å¯ç”¨ Window å¯¹è±¡ä¹‹é—´çš„è·¨æºé€šä¿¡ï¼›ä¾‹å¦‚ï¼Œåœ¨é¡µé¢å’Œå®ƒäº§ç”Ÿçš„å¼¹å‡ºçª—å£ä¹‹é—´ï¼Œæˆ–è€…åœ¨é¡µé¢å’ŒåµŒå…¥å…¶ä¸­çš„ iframe ä¹‹é—´ã€‚</p><p><strong>äºŒã€è¯­æ³•</strong></p><p>otherWindow.postMessage(message, targetOrigin, [transfer]);</p><p><strong>otherWindowï¼š</strong>æ˜¯æ¥æ”¶å¯¹è±¡çš„çª—ä½“å¼•ç”¨ï¼Œä¾‹å¦‚ï¼šå­çª—ä½“ (iframe) å¯¹çˆ¶çº§çª—ä½“çš„å¼•ç”¨ â€œwindow.parentâ€ æˆ–è€…å…¶ä»– Iframe çš„å¼•ç”¨ â€œWindow.frames + ç´¢å¼•å€¼(å‘½åæˆ–æ•°å­—)â€</p><p><strong>messageï¼š</strong>å°†è¦å‘é€åˆ°å…¶ä»– window çš„æ•°æ®ã€‚åœ¨ IE9 ä»¥ä¸‹çš„æµè§ˆå™¨, message ä¸æ”¯æŒ JSON å¯¹è±¡ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹</p><p><strong>targetOriginï¼š</strong>é€šè¿‡çª—å£çš„ origin å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸² â€œ*â€ï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ª URIã€‚åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡çª—å£çš„åè®®ã€ä¸»æœºåœ°å€æˆ–ç«¯å£è¿™ä¸‰è€…çš„ä»»æ„ä¸€é¡¹ä¸åŒ¹é… targetOrigin æä¾›çš„å€¼ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸ä¼šè¢«å‘é€ï¼›åªæœ‰ä¸‰è€…å®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«å‘é€ã€‚</p><p><strong>transferï¼š</strong>æ˜¯ä¸€ä¸²å’Œ message åŒæ—¶ä¼ é€’çš„ <code>Transferable</code> å¯¹è±¡. è¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒã€‚</p><p><strong>ä¸‰ã€åº”ç”¨å­çª—ä½“å’Œçˆ¶çª—ä½“ä¹‹é—´çš„é€šä¿¡</strong></p><p><strong>1. parent.htmlï¼š</strong>æ·»åŠ æœ‰ Iframe(childIframe.html) é¡µé¢ï¼Œå¹¶ç›‘å¬ message äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta  /&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        iframe&#123;</span><br><span class="line">            border:none;</span><br><span class="line">            width:100%;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;parent&lt;/h1&gt;</span><br><span class="line">    &lt;iframe src=&quot;childiframe.html&quot;&gt;&lt;/iframe&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        window.addEventListener(&quot;message&quot;, function (message) &#123;</span><br><span class="line">            alert(JSON.stringify(message.data));</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>2. childIframe.htmlï¼š</strong>ç›´æ¥å‘ parent å‘é€ä¸€æ¡æ¶ˆæ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta  /&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;childIframe&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        window.parent.postMessage(&#123;type:&quot;open&quot;,url:&quot;iframe.html&quot;&#125;,&quot;*&quot;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><strong>3. IE9 - å…¼å®¹é—®é¢˜ï¼š</strong></p><p>IE9 åŠä»¥ä¸‹çš„æµè§ˆå™¨, message ä¸æ”¯æŒ JSON å¯¹è±¡ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚å‘é€æ—¶å°† JSON è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.parent.postMessage(JSON.stringify(&#123; type: &quot;open&quot;, url: &quot;iframe.html&quot; &#125;), &quot;*&quot;);</span><br></pre></td></tr></table></figure><p>IE9 è¿˜æ˜¯ IE8 ä¸å…¼å®¹ addEventListener å’Œ â€œmessageâ€ ç›‘å¬æ–¹æ³•å’Œäº‹ä»¶ï¼Œå…¼å®¹åŠæ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//IE8,IE9å…¼å®¹æ–¹æ³•</span><br><span class="line">if (window.attachEvent) &#123;</span><br><span class="line">    window.attachEvent(&apos;onmessage&apos;, function (message) &#123;</span><br><span class="line">        console.log(JSON.parse(message.data));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    window.addEventListener(&apos;message&apos;, function (message) &#123;</span><br><span class="line">        console.log(JSON.parse(message.data));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      JS Iframeä¸çˆ¶çº§é¡µé¢é€šä¿¡åŠIE9å…¼å®¹æ€§
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Iframe" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/Iframe/"/>
    
    
      <category term="JS" scheme="https://andyxw.com/tags/JS/"/>
    
      <category term="Iframe" scheme="https://andyxw.com/tags/Iframe/"/>
    
  </entry>
  
  <entry>
    <title>A Complete Guide to useEffect</title>
    <link href="https://andyxw.com/archives/6387.html"/>
    <id>https://andyxw.com/archives/6387.html</id>
    <published>2019-08-23T11:02:17.805Z</published>
    <updated>2019-09-04T13:25:12.045Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/a-complete-guide-to-useeffect/</a></p></blockquote><p>You wrote a few components with <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hooks</a>. Maybe even a small app. Youâ€™re mostly satisfied. Youâ€™re comfortable with the API and picked up a few tricks along the way. You even made some <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom Hooks</a> to extract repetitive logic (300 lines gone!) and showed it off to your colleagues. â€œGreat jobâ€, they said.</p><p>But sometimes when you <code>useEffect</code>, the pieces donâ€™t quite fit together. You have a nagging feeling that youâ€™re missing something. It seems similar to class lifecyclesâ€¦ but is it really? You find yourself asking questions like:</p><ul><li>ğŸ¤” How do I replicate <code>componentDidMount</code> with <code>useEffect</code>?</li><li>ğŸ¤” How do I correctly fetch data inside <code>useEffect</code>? What is <code>[]</code>?</li><li>ğŸ¤” Do I need to specify functions as effect dependencies or not?</li><li>ğŸ¤” Why do I sometimes get an infinite refetching loop?</li><li>ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?</li></ul><p>When I just started using Hooks, I was confused by all of those questions too. Even when writing the initial docs, I didnâ€™t have a firm grasp on some of the subtleties. Iâ€™ve since had a few â€œahaâ€ moments that I want to share with you. <strong>This deep dive will make the answers to these questions look obvious to you.</strong></p><p>To <em>see</em> the answers, we need to take a step back. The goal of this article isnâ€™t to give you a list of bullet point recipes. Itâ€™s to help you truly â€œgrokâ€ <code>useEffect</code>. There wonâ€™t be much to learn. In fact, weâ€™ll spend most of our time _un_learning.</p><p><strong>Itâ€™s only after I stopped looking at the <code>useEffect</code> Hook through the prism of the familiar class lifecycle methods that everything came together for me.</strong></p><blockquote><p>â€œUnlearn what you have learned.â€ â€” Yoda</p></blockquote><p><a href="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" target="_blank" rel="noopener"><img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" alt=""></a></p><p><strong>This article assumes that youâ€™re somewhat familiar with <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener"><code>useEffect</code></a> API.</strong></p><p><strong>Itâ€™s also <em>really</em> long. Itâ€™s like a mini-book. Thatâ€™s just my preferred format. But I wrote a TLDR just below if youâ€™re in a rush or donâ€™t really care.</strong></p><p><strong>If youâ€™re not comfortable with deep dives, you might want to wait until these explanations appear elsewhere. Just like when React came out in 2013, it will take some time for people to recognize a different mental model and teach it.</strong></p><h2 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a><a href="#tldr"></a>TLDR</h2><p>Hereâ€™s a quick TLDR if you donâ€™t want to read the whole thing. If some parts donâ€™t make sense, you can scroll down until you find something related.</p><p>Feel free to skip it if you plan to read the whole post. Iâ€™ll link to it at the end.</p><p><strong>ğŸ¤” Question: How do I replicate <code>componentDidMount</code> with <code>useEffect</code>?</strong></p><p>While you can <code>useEffect(fn, [])</code>, itâ€™s not an exact equivalent. Unlike <code>componentDidMount</code>, it will <em>capture</em> props and state. So even inside the callbacks, youâ€™ll see the initial props and state. If you want to see â€œlatestâ€ something, you can write it to a ref. But thereâ€™s usually a simpler way to structure the code so that you donâ€™t have to. Keep in mind that the mental model for effects is different from <code>componentDidMount</code> and other lifecycles, and trying to find their exact equivalents may confuse you more than help. To get productive, you need to â€œthink in effectsâ€, and their mental model is closer to implementing synchronization than to responding to lifecycle events.</p><p><strong>ğŸ¤” Question: How do I correctly fetch data inside <code>useEffect</code>? What is <code>[]</code>?</strong></p><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">This article</a> is a good primer on data fetching with <code>useEffect</code>. Make sure to read it to the end! Itâ€™s not as long as this one. <code>[]</code> means the effect doesnâ€™t use any value that participates in React data flow, and is for that reason safe to apply once. It is also a common source of bugs when the value actually _is_ used. Youâ€™ll need to learn a few strategies (primarily <code>useReducer</code> and <code>useCallback</code>) that can <em>remove the need</em> for a dependency instead of incorrectly omitting it.</p><p><strong>ğŸ¤” Question: Do I need to specify functions as effect dependencies or not?</strong></p><p>The recommendation is to hoist functions that donâ€™t need props or state <em>outside</em> of your component, and pull the ones that are used only by an effect <em>inside</em> of that effect. If after that your effect still ends up using functions in the render scope (including function from props), wrap them into <code>useCallback</code> where theyâ€™re defined, and repeat the process. Why does it matter? Functions can â€œseeâ€ values from props and state â€” so they participate in the data flow. Thereâ€™s a <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">more detailed answer</a> in our FAQ.</p><p><strong>ğŸ¤” Question: Why do I sometimes get an infinite refetching loop?</strong></p><p>This can happen if youâ€™re doing data fetching in an effect without the second dependencies argument. Without it, effects run after every render â€” and setting the state will trigger the effects again. An infinite loop may also happen if you specify a value that <em>always</em> changes in the dependency array. You can tell which one by removing them one by one. However, removing a dependency you use (or blindly specifying <code>[]</code>) is usually the wrong fix. Instead, fix the problem at its source. For example, functions can cause this problem, and putting them inside effects, hoisting them out, or wrapping them with <code>useCallback</code> helps. To avoid recreating objects, <code>useMemo</code> can serve a similar purpose.</p><p><strong>ğŸ¤” Why do I sometimes get an old state or prop value inside my effect?</strong></p><p>Effects always â€œseeâ€ props and state from the render they were defined in. That <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">helps prevent bugs</a> but in some cases can be annoying. For those cases, you can explicitly maintain some value in a mutable ref (the linked article explains it at the end). If you think youâ€™re seeing some props or state from an old render but donâ€™t expect it, you probably missed some dependencies. Try using the <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint rule</a> to train yourself to see them. A few days, and itâ€™ll be like a second nature to you. See also <a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="noopener">this answer</a> in our FAQ.</p><p>I hope this TLDR was helpful! Otherwise, letâ€™s go.</p><h2 id="Each-Render-Has-Its-Own-Props-and-State"><a href="#Each-Render-Has-Its-Own-Props-and-State" class="headerlink" title="Each Render Has Its Own Props and State"></a><a href="#each-render-has-its-own-props-and-state"></a>Each Render Has Its Own Props and State</h2><p>Before we can talk about effects, we need to talk about rendering.</p><p>Hereâ€™s a counter. Look at the highlighted line closely:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>What does it mean? Does <code>count</code> somehow â€œwatchâ€ changes to our state and update automatically? That might be a useful first intuition when you learn React but itâ€™s <em>not</em> an <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">accurate mental model</a>.</p><p><strong>In this example, <code>count</code> is just a number.</strong> Itâ€™s not a magic â€œdata bindingâ€, a â€œwatcherâ€, a â€œproxyâ€, or anything else. Itâ€™s a good old number like this one:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const count = 42;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>The first time our component renders, the <code>count</code> variable we get from <code>useState()</code> is <code>0</code>. When we call <code>setCount(1)</code>, React calls our component again. This time, <code>count</code> will be <code>1</code>. And so on:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Whenever we update the state, React calls our component. Each render result â€œseesâ€ its own <code>counter</code> state value which is a <em>constant</em> inside our function.</strong></p><p>So this line doesnâ€™t do any special data binding:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p><strong>It only embeds a number value into the render output.</strong> That number is provided by React. When we <code>setCount</code>, React calls our component again with a different <code>count</code> value. Then React updates the DOM to match our latest render output.</p><p>The key takeaway is that the <code>count</code> constant inside any particular render doesnâ€™t change over time. Itâ€™s our component thatâ€™s called again â€” and each render â€œseesâ€ its own <code>count</code> value thatâ€™s isolated between renders.</p><p><em>(For an in-depth overview of this process, check out my post <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">React as a UI Runtime</a>.)</em></p><h2 id="Each-Render-Has-Its-Own-Event-Handlers"><a href="#Each-Render-Has-Its-Own-Event-Handlers" class="headerlink" title="Each Render Has Its Own Event Handlers"></a><a href="#each-render-has-its-own-event-handlers"></a>Each Render Has Its Own Event Handlers</h2><p>So far so good. What about event handlers?</p><p>Look at this example. It shows an alert with the <code>count</code> after three seconds:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  function handleAlertClick() &#123;    setTimeout(() =&gt; &#123;      alert(&apos;You clicked on: &apos; + count);    &#125;, 3000);  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;        Show alert      &lt;/button&gt;    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Letâ€™s say I do this sequence of steps:</p><ul><li><strong>Increment</strong> the counter to 3</li><li><strong>Press</strong> â€œShow alertâ€</li><li><strong>Increment</strong> it to 5 before the timeout fires</li></ul><p><img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt=""></p><p>What do you expect the alert to show? Will it show 5 â€” which is the counter state at the time of the alert? Or will it show 3 â€” the state when I clicked?</p><p><em>spoilers ahead</em></p><p>Go ahead and <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">try it yourself!</a></p><p>If the behavior doesnâ€™t quite make sense to you, imagine a more practical example: a chat app with the current recipient ID in the state, and a Send button. <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">This article</a> explores the reasons in depth but the correct answer is 3.</p><p>The alert will â€œcaptureâ€ the state at the time I clicked the button.</p><p><em>(There are ways to implement the other behavior too but Iâ€™ll be focusing on the default case for now. When building a mental model, itâ€™s important that we distinguish the â€œpath of least resistanceâ€ from the opt-in escape hatches.)</em></p><p>But how does it work?</p><p>Weâ€™ve discussed that the <code>count</code> value is constant for every particular call to our function. Itâ€™s worth emphasizing this â€” <strong>our function gets called many times (once per each render), but every one of those times the <code>count</code> value inside of it is constant and set to a particular value (state for that render).</strong></p><p>This is not specific to React â€” regular functions work in a similar way:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function sayHi(person) &#123;</span><br><span class="line">  const name = person.name;  setTimeout(() =&gt; &#123;</span><br><span class="line">    alert(&apos;Hello, &apos; + name);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let someone = &#123;name: &apos;Dan&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Yuzhi&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Dominic&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br></pre></td></tr></table></figure><p>In <a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="noopener">this example</a>, the outer <code>someone</code> variable is reassigned several times. (Just like somewhere in React, the <em>current</em> component state can change.) <strong>However, inside <code>sayHi</code>, there is a local <code>name</code> constant that is associated with a <code>person</code> from a particular call.</strong> That constant is local, so itâ€™s isolated between the calls! As a result, when the timeouts fire, each alert â€œremembersâ€ its own <code>name</code>.</p><p>This explains how our event handler captures the <code>count</code> at the time of the click. If we apply the same substitution principle, each render â€œseesâ€ its own <code>count</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So effectively, each render returns its own â€œversionâ€ of <code>handleAlertClick</code>. Each of those versions â€œremembersâ€ its own <code>count</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 0);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 1);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 2);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is why <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">in this demo</a> event handlers â€œbelongâ€ to a particular render, and when you click, it keeps using the <code>counter</code> state <em>from</em> that render.</p><p><strong>Inside any particular render, props and state forever stay the same.</strong> But if props and state are isolated between renders, so are any values using them (including the event handlers). They also â€œbelongâ€ to a particular render. So even async functions inside an event handler will â€œseeâ€ the same <code>count</code> value.</p><p><em>Side note: I inlined concrete <code>count</code> values right into <code>handleAlertClick</code> functions above. This mental substitution is safe because <code>count</code> canâ€™t possibly change within a particular render. Itâ€™s declared as a <code>const</code> and is a number. It would be safe to think the same way about other values like objects too, but only if we agree to avoid mutating state. Calling <code>setSomething(newObj)</code> with a newly created object instead of mutating it is fine because state belonging to previous renders is intact.</em></p><h2 id="Each-Render-Has-Its-Own-Effects"><a href="#Each-Render-Has-Its-Own-Effects" class="headerlink" title="Each Render Has Its Own Effects"></a><a href="#each-render-has-its-own-effects"></a>Each Render Has Its Own Effects</h2><p>This was supposed to be a post about effects but we still havenâ€™t talked about effects yet! Weâ€™ll rectify this now. Turns out, effects arenâ€™t really any different.</p><p>Letâ€™s go back to an example from <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">the docs</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = `You clicked $&#123;count&#125; times`;  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Hereâ€™s a question for you: how does the effect read the latest <code>count</code> state?</strong></p><p>Maybe, thereâ€™s some kind of â€œdata bindingâ€ or â€œwatchingâ€ that makes <code>count</code> update live inside the effect function? Maybe <code>count</code> is a mutable variable that React sets inside our component so that our effect always sees the latest value?</p><p>Nope.</p><p>We already know that <code>count</code> is constant within a particular component render. Event handlers â€œseeâ€ the <code>count</code> state from the render that they â€œbelongâ€ to because <code>count</code> is a variable in their scope. The same is true for effects!</p><p><strong>Itâ€™s not the <code>count</code> variable that somehow changes inside an â€œunchangingâ€ effect. Itâ€™s the <em>effect function itself</em> thatâ€™s different on every render.</strong></p><p>Each version â€œseesâ€ the <code>count</code> value from the render that it â€œbelongsâ€ to:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;0&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;1&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;2&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React remembers the effect function you provided, and runs it after flushing changes to the DOM and letting the browser paint the screen.</p><p>So even if we speak of a single conceptual <em>effect</em> here (updating the document title), it is represented by a <em>different function</em> on every render â€” and each effect function â€œseesâ€ props and state from the particular render it â€œbelongsâ€ to.</p><p><strong>Conceptually, you can imagine effects are a <em>part of the render result</em>.</strong></p><p>Strictly saying, theyâ€™re not (in order to <a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener">allow Hook composition</a> without clumsy syntax or runtime overhead). But in the mental model weâ€™re building up, effect functions <em>belong</em> to a particular render in the same way that event handlers do.</p><p>To make sure we have a solid understanding, letâ€™s recap our first render:</p><ul><li><strong>React:</strong> Give me the UI when the state is <code>0</code>.</li><li><p><strong>Your component:</strong></p><ul><li>Hereâ€™s the render result: <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>.</li><li>Also remember to run this effect after youâ€™re done: <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li></ul></li><li><strong>React:</strong> Sure. Updating the UI. Hey browser, Iâ€™m adding some stuff to the DOM.</li><li><strong>Browser:</strong> Cool, I painted it to the screen.</li><li><p><strong>React:</strong> OK, now Iâ€™m going to run the effect you gave me.</p><ul><li>Running <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>.</li></ul></li></ul><p>Now letâ€™s recap what happens after we click:</p><ul><li><strong>Your component:</strong> Hey React, set my state to <code>1</code>.</li><li><strong>React:</strong> Give me the UI for when the state is <code>1</code>.</li><li><p><strong>Your component:</strong></p><ul><li>Hereâ€™s the render result: <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>.</li><li>Also remember to run this effect after youâ€™re done: <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li></ul></li><li><strong>React:</strong> Sure. Updating the UI. Hey browser, Iâ€™ve changed the DOM.</li><li><strong>Browser:</strong> Cool, I painted your changes to the screen.</li><li><p><strong>React:</strong> OK, now Iâ€™ll run the effect that belongs to the render I just did.</p><ul><li>Running <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>.</li></ul></li></ul><h2 id="Each-Render-Has-Its-Ownâ€¦-Everything"><a href="#Each-Render-Has-Its-Ownâ€¦-Everything" class="headerlink" title="Each Render Has Its Ownâ€¦ Everything"></a><a href="#each-render-has-its-own-everything"></a>Each Render Has Its Ownâ€¦ Everything</h2><p><strong>We know now that effects run after every render, are conceptually a part of the component output, and â€œseeâ€ the props and state from that particular render.</strong></p><p>Letâ€™s try a thought experiment. Consider this code:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    setTimeout(() =&gt; &#123;      console.log(`You clicked $&#123;count&#125; times`);    &#125;, 3000);  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If I click several times with a small delay, what is the log going to look like?</p><p><em>spoilers ahead</em></p><p>You might think this is a gotcha and the end result is unintuitive. Itâ€™s not! Weâ€™re going to see a sequence of logs â€” each one belonging to a particular render and thus with its own <code>count</code> value. You can <a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="noopener">try it yourself</a>:</p><p><img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif" alt=""></p><p>You may think: â€œOf course thatâ€™s how it works! How else could it work?â€</p><p>Well, thatâ€™s not how <code>this.state</code> works in classes. Itâ€™s easy to make the mistake of thinking that this <a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="noopener">class implementation</a> is equivalent:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(`You clicked $&#123;this.state.count&#125; times`);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, <code>this.state.count</code> always points at the <em>latest</em> count rather than the one belonging to a particular render. So youâ€™ll see <code>5</code> logged each time instead:</p><p><img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt=""></p><p>I think itâ€™s ironic that Hooks rely so much on JavaScript closures, and yet itâ€™s the class implementation that suffers from <a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="noopener">the canonical wrong-value-in-a-timeout confusion</a> thatâ€™s often associated with closures. This is because the actual source of the confusion in this example is the mutation (React mutates <code>this.state</code> in classes to point to the latest state) and not closures themselves.</p><p><strong>Closures are great when the values you close over never change. That makes them easy to think about because youâ€™re essentially referring to constants.</strong> And as we discussed, props and state never change within a particular render. By the way, we can fix the class versionâ€¦ by <a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="noopener">using a closure</a>.</p><h2 id="Swimming-Against-the-Tide"><a href="#Swimming-Against-the-Tide" class="headerlink" title="Swimming Against the Tide"></a><a href="#swimming-against-the-tide"></a>Swimming Against the Tide</h2><p>At this point itâ€™s important that we call it out explicitly: <strong>every</strong> function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.</p><p>So these two examples are equivalent:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(props.counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  const counter = props.counter;  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>It doesnâ€™t matter whether you read from props or state â€œearlyâ€ inside of your component.</strong> Theyâ€™re not going to change! Inside the scope of a single render, props and state stay the same. (Destructuring props makes this more obvious.)</p><p>Of course, sometimes you <em>want</em> to read the latest rather than captured value inside some callback defined in an effect. The easiest way to do it is by using refs, as described in the last section of <a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">this article</a>.</p><p>Be aware that when you want to read the <em>future</em> props or state from a function in a <em>past</em> render, youâ€™re swimming against the tide. Itâ€™s not <em>wrong</em> (and in some cases necessary) but it might look less â€œcleanâ€ to break out of the paradigm. This is an intentional consequence because it helps highlight which code is fragile and depends on timing. In classes, itâ€™s less obvious when this happens.</p><p>Hereâ€™s a <a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="noopener">version of our counter example</a> that replicates the class behavior:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const latestCount = useRef(count);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        latestCount.current = count;    setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(`You clicked $&#123;latestCount.current&#125; times`);    &#125;, 3000);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt=""></p><p>It might seem quirky to mutate something in React. However, this is exactly how React itself reassigns <code>this.state</code> in classes. Unlike with captured props and state, you donâ€™t have any guarantees that reading <code>latestCount.current</code> would give you the same value in any particular callback. By definition, you can mutate it any time. This is why itâ€™s not a default, and you have to opt into that.</p><h2 id="So-What-About-Cleanup"><a href="#So-What-About-Cleanup" class="headerlink" title="So What About Cleanup?"></a><a href="#so-what-about-cleanup"></a>So What About Cleanup?</h2><p>As <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="noopener">the docs explain</a>, some effects might have a cleanup phase. Essentially, its purpose is to â€œundoâ€ an effect for cases like subscriptions.</p><p>Consider this code:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Say <code>props</code> is <code>{id: 10}</code> on the first render, and <code>{id: 20}</code> on the second render. You <em>might</em> think that something like this happens:</p><ul><li>React cleans up the effect for <code>{id: 10}</code>.</li><li>React renders UI for <code>{id: 20}</code>.</li><li>React runs the effect for <code>{id: 20}</code>.</li></ul><p>(This is not quite the case.)</p><p>With this mental model, you might think the cleanup â€œseesâ€ the old props because it runs before we re-render, and then the new effect â€œseesâ€ the new props because it runs after the re-render. Thatâ€™s the mental model lifted directly from the class lifecycles, and <strong>itâ€™s not accurate here</strong>. Letâ€™s see why.</p><p>React only runs the effects after <a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="noopener">letting the browser paint</a>. This makes your app faster as most effects donâ€™t need to block screen updates. Effect cleanup is also delayed. <strong>The previous effect is cleaned up <em>after</em> the re-render with new props:</strong></p><ul><li><strong>React renders UI for <code>{id: 20}</code>.</strong></li><li>The browser paints. We see the UI for <code>{id: 20}</code> on the screen.</li><li><strong>React cleans up the effect for <code>{id: 10}</code>.</strong></li><li>React runs the effect for <code>{id: 20}</code>.</li></ul><p>You might be wondering: but how can the cleanup of the previous effect still â€œseeâ€ the old <code>{id: 10}</code> props if it runs <em>after</em> the props change to <code>{id: 20}</code>?</p><p>Weâ€™ve been here beforeâ€¦ ğŸ¤”</p><p><img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt=""></p><p>Quoting the previous section:</p><blockquote><p>Every function inside the component render (including event handlers, effects, timeouts or API calls inside them) captures the props and state of the render call that defined it.</p></blockquote><p>Now the answer is clear! The effect cleanup doesnâ€™t read the â€œlatestâ€ props, whatever that means. It reads props that belong to the render itâ€™s defined in:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">            return () =&gt; &#123;        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);      &#125;;    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      </span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Kingdoms will rise and turn into ashes, the Sun will shed its outer layers to be a white dwarf, and the last civilization will end. But nothing will make the props â€œseenâ€ by the first render effectâ€™s cleanup anything other than <code>{id: 10}</code>.</p><p>Thatâ€™s what allows React to deal with effects right after painting â€” and make your apps faster by default. The old props are still there if our code needs them.</p><h2 id="Synchronization-Not-Lifecycle"><a href="#Synchronization-Not-Lifecycle" class="headerlink" title="Synchronization, Not Lifecycle"></a><a href="#synchronization-not-lifecycle"></a>Synchronization, Not Lifecycle</h2><p>One of my favorite things about React is that it unifies describing the initial render result and the updates. This <a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="noopener">reduces the entropy</a> of your program.</p><p>Say my component looks like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It doesnâ€™t matter if I render <code>&lt;Greeting /&gt;</code> and later <code>&lt;Greeting /&gt;</code>, or if I just render <code>&lt;Greeting /&gt;</code>. In the end, we will see â€œHello, Yuzhiâ€ in both cases.</p><p>People say: â€œItâ€™s all about the journey, not the destinationâ€. With React, itâ€™s the opposite. <strong>Itâ€™s all about the destination, not the journey.</strong> Thatâ€™s the difference between <code>$.addClass</code> and <code>$.removeClass</code> calls in jQuery code (our â€œjourneyâ€) and specifying what the CSS class <em>should be</em> in React code (our â€œdestinationâ€).</p><p><strong>React synchronizes the DOM according to our current props and state.</strong> There is no distinction between a â€œmountâ€ or an â€œupdateâ€ when rendering.</p><p>You should think of effects in a similar way. <strong><code>useEffect</code> lets you <em>synchronize</em> things outside of the React tree according to our props and state.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = &apos;Hello, &apos; + name;  &#125;);  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is subtly different from the familiar <em>mount/update/unmount</em> mental model. It is important really to internalize this. <strong>If youâ€™re trying to write an effect that behaves differently depending on whether the component renders for the first time or not, youâ€™re swimming against the tide!</strong> Weâ€™re failing at synchronizing if our result depends on the â€œjourneyâ€ rather than the â€œdestinationâ€.</p><p>It shouldnâ€™t matter whether we rendered with props A, B, and C, or if we rendered with C immediately. While there may be some temporary differences (e.g. while weâ€™re fetching data), eventually the end result should be the same.</p><p>Still, of course running all effects on <em>every</em> render might not be efficient. (And in some cases, it would lead to infinite loops.)</p><p>So how can we fix this?</p><h2 id="Teaching-React-to-Diff-Your-Effects"><a href="#Teaching-React-to-Diff-Your-Effects" class="headerlink" title="Teaching React to Diff Your Effects"></a><a href="#teaching-react-to-diff-your-effects"></a>Teaching React to Diff Your Effects</h2><p>Weâ€™ve already learned that lesson with the DOM itself. Instead of touching it on every re-render, React only updates the parts of the DOM that actually change.</p><p>When youâ€™re updating</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Dan</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>to</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Yuzhi</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>React sees two objects:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;</span><br><span class="line">const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;</span><br></pre></td></tr></table></figure><p>It goes over each of their props and determine that <code>children</code> have changed and need a DOM update, but <code>className</code> did not. So it can just do:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domNode.innerText = &apos;Hello, Yuzhi&apos;;</span><br></pre></td></tr></table></figure><p><strong>Could we do something like this with effects too? It would be nice to avoid re-running them when applying the effect is unnecessary.</strong></p><p>For example, maybe our component re-renders because of a state change:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  const [counter, setCounter] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = &apos;Hello, &apos; + name;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCounter(count + 1)&#125;&gt;        Increment      &lt;/button&gt;    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But our effect doesnâ€™t use the <code>counter</code> state. <strong>Our effect synchronizes the <code>document.title</code> with the <code>name</code> prop, but the <code>name</code> prop is the same.</strong> Re-assigning <code>document.title</code> on every counter change seems non-ideal.</p><p>OK, so can React justâ€¦ diff effects?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br></pre></td></tr></table></figure><p>Not really. React canâ€™t guess what the function does without calling it. (The source doesnâ€™t really contain specific values, it just closes over the <code>name</code> prop.)</p><p>This is why if you want to avoid re-running effects unnecessarily, you can provide a dependency array (also known as â€œdepsâ€) argument to <code>useEffect</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><strong>Itâ€™s like if we told React: â€œHey, I know you canâ€™t see <em>inside</em> this function, but I promise it only uses <code>name</code> and nothing else from the render scope.â€</strong></p><p>If each of these values is the same between the current and the previous time this effect ran, thereâ€™s nothing to synchronize so React can skip the effect:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const oldDeps = [&apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const newDeps = [&apos;Dan&apos;];</span><br></pre></td></tr></table></figure><p>If even one of the values in the dependency array is different between renders, we know running the effect canâ€™t be skipped. Synchronize all the things!</p><h2 id="Donâ€™t-Lie-to-React-About-Dependencies"><a href="#Donâ€™t-Lie-to-React-About-Dependencies" class="headerlink" title="Donâ€™t Lie to React About Dependencies"></a><a href="#dont-lie-to-react-about-dependencies"></a>Donâ€™t Lie to React About Dependencies</h2><p>Lying to React about dependencies has bad consequences. Intuitively, this makes sense, but Iâ€™ve seen pretty much everyone who tries <code>useEffect</code> with a mental model from classes try to cheat the rules. (And I did that too at first!)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(The <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">Hooks FAQ</a> explains what to do instead. Weâ€™ll come back to this example <a href="#moving-functions-inside-effects">below</a>.)</em></p><p>â€œBut I only want to run it on mount!â€, youâ€™ll say. For now, remember: if you specify deps, <strong><em>all</em> values from inside your component that are used by the effect <em>must</em> be there</strong>. Including props, state, functions â€” anything in your component.</p><p>Sometimes when you do that, it causes a problem. For example, maybe you see an infinite refetching loop, or a socket is recreated too often. <strong>The solution to that problem is <em>not</em> to remove a dependency.</strong> Weâ€™ll look at the solutions soon.</p><p>But before we jump to solutions, letâ€™s understand the problem better.</p><h2 id="What-Happens-When-Dependencies-Lie"><a href="#What-Happens-When-Dependencies-Lie" class="headerlink" title="What Happens When Dependencies Lie"></a><a href="#what-happens-when-dependencies-lie"></a>What Happens When Dependencies Lie</h2><p>If deps contain every value used by the effect, React knows when to re-run it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt=""></p><p><em>(Dependencies are different, so we re-run the effect.)</em></p><p>But if we specified <code>[]</code> for this effect, the new effect function wouldnâ€™t run:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>In this case the problem might seem obvious. But the intuition can fool you in other cases where a class solution â€œjumps outâ€ from your memory.</p><p>For example, letâ€™s say weâ€™re writing a counter that increments every second. With a class, our intuition is: â€œSet up the interval once and destroy it onceâ€. Hereâ€™s an <a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="noopener">example</a> of how we can do it. When we mentally translate this code to <code>useEffect</code>, we instinctively add <code>[]</code> to the deps. â€œI want it to run onceâ€, right?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(count + 1);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>However, this example <a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="noopener">only <em>increments</em> once</a>. <em>Oops.</em></p><p>If your mental model is â€œdependencies let me specify when I want to re-trigger the effectâ€, this example might give you an existential crisis. You <em>want</em> to trigger it once because itâ€™s an interval â€” so why is it causing issues?</p><p>However, this makes sense if you know that dependencies are our hint to React about <em>everything</em> that the effect uses from the render scope. It uses <code>count</code> but we lied that it doesnâ€™t with <code>[]</code>. Itâ€™s only a matter of time before this bites us!</p><p>In the first render, <code>count</code> is <code>0</code>. Therefore, <code>setCount(count + 1)</code> in the first renderâ€™s effect means <code>setCount(0 + 1)</code>. <strong>Since we never re-run the effect because of <code>[]</code> deps, it will keep calling <code>setCount(0 + 1)</code> every second:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We lied to React by saying our effect doesnâ€™t depend on a value from inside our component, when in fact it does!</p><p>Our effect uses <code>count</code> â€” a value inside the component (but outside the effect):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const count = </span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>Therefore, specifying <code>[]</code> as a dependency will create a bug. React will compare the dependencies, and skip updating this effect:</p><p><img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>Issues like this are difficult to think about. Therefore, I encourage you to adopt it as a hard rule to always be honest about the effect dependencies, and specify them all. (We provide a <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint rule</a> if you want to enforce this on your team.)</p><h2 id="Two-Ways-to-Be-Honest-About-Dependencies"><a href="#Two-Ways-to-Be-Honest-About-Dependencies" class="headerlink" title="Two Ways to Be Honest About Dependencies"></a><a href="#two-ways-to-be-honest-about-dependencies"></a>Two Ways to Be Honest About Dependencies</h2><p>There are two strategies to be honest about dependencies. You should generally start with the first one, and then apply the second one if needed.</p><p><strong>The first strategy is to fix the dependency array to include <em>all</em> the values inside the component that are used inside the effect.</strong> Letâ€™s include <code>count</code> as a dep:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);  &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>This makes the dependency array correct. It may not be <em>ideal</em> but thatâ€™s the first issue we needed to fix. Now a change to <code>count</code> will re-run the effect, with each next interval referencing <code>count</code> from its render in <code>setCount(count + 1)</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [0]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [1]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That would <a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="noopener">fix the problem</a> but our interval would be cleared and set again whenever the <code>count</code> changes. That may be undesirable:</p><p><img src="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt=""></p><p><em>(Dependencies are different, so we re-run the effect.)</em></p><p><strong>The second strategy is to change our effect code so that it wouldnâ€™t <em>need</em> a value that changes more often than we want.</strong> We donâ€™t want to lie about the dependencies â€” we just want to change our effect to have <em>fewer</em> of them.</p><p>Letâ€™s look at a few common techniques for removing dependencies.</p><h2 id="Making-Effects-Self-Sufficient"><a href="#Making-Effects-Self-Sufficient" class="headerlink" title="Making Effects Self-Sufficient"></a><a href="#making-effects-self-sufficient"></a>Making Effects Self-Sufficient</h2><p>We want to get rid of the <code>count</code> dependency in our effect.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>To do this, we need to ask ourselves: <strong>what are we using <code>count</code> for?</strong> It seems like we only use it for the <code>setCount</code> call. In that case, we donâ€™t actually need <code>count</code> in the scope at all. When we want to update state based on the previous state, we can use the <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="noopener">functional updater form</a> of <code>setState</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(c =&gt; c + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>I like to think of these cases as â€œfalse dependenciesâ€. Yes, <code>count</code> was a necessary dependency because we wrote <code>setCount(count + 1)</code> inside the effect. However, we only truly needed <code>count</code> to transform it into <code>count + 1</code> and â€œsend it backâ€ to React. But React <em>already knows</em> the current <code>count</code>. <strong>All we needed to tell React is to increment the state â€” whatever it is right now.</strong></p><p>Thatâ€™s exactly what <code>setCount(c =&gt; c + 1)</code> does. You can think of it as â€œsending an instructionâ€ to React about how the state should change. This â€œupdater formâ€ also helps in other cases, like when you <a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="noopener">batch multiple updates</a>.</p><p><strong>Note that we actually <em>did the work</em> to remove the dependency. We didnâ€™t cheat. Our effect doesnâ€™t read the <code>counter</code> value from the render scope anymore:</strong></p><p><img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt=""></p><p><em>(Dependencies are equal, so we skip the effect.)</em></p><p>You can try it <a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="noopener">here</a>.</p><p>Even though this effect only runs once, the interval callback that belongs to the first render is perfectly capable of sending the <code>c =&gt; c + 1</code> update instruction every time the interval fires. It doesnâ€™t need to know the current <code>counter</code> state anymore. React already knows it.</p><h2 id="Functional-Updates-and-Google-Docs"><a href="#Functional-Updates-and-Google-Docs" class="headerlink" title="Functional Updates and Google Docs"></a><a href="#functional-updates-and-google-docs"></a>Functional Updates and Google Docs</h2><p>Remember how we talked about synchronization being the mental model for effects? An interesting aspect of synchronization is that you often want to keep the â€œmessagesâ€ between the systems untangled from their state. For example, editing a document in Google Docs doesnâ€™t actually send the <em>whole</em> page to the server. That would be very inefficient. Instead, it sends a representation of what the user tried to do.</p><p>While our use case is different, a similar philosophy applies to effects. <strong>It helps to send only the minimal necessary information from inside the effects into a component.</strong> The updater form like <code>setCount(c =&gt; c + 1)</code> conveys strictly less information than <code>setCount(count + 1)</code> because it isnâ€™t â€œtaintedâ€ by the current count. It only expresses the action (â€œincrementingâ€). Thinking in React involves <a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="noopener">finding the minimal state</a>. This is the same principle, but for updates.</p><p>Encoding the <em>intent</em> (rather than the result) is similar to how Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="noopener">solves</a> collaborative editing. While this is stretching the analogy, functional updates serve a similar role in React. They ensure updates from multiple sources (event handlers, effect subscriptions, etc) can be correctly applied in a batch and in a predictable way.</p><p><strong>However, even <code>setCount(c =&gt; c + 1)</code> isnâ€™t that great.</strong> It looks a bit weird and itâ€™s very limited in what it can do. For example, if we had two state variables whose values depend on each other, or if we needed to calculate the next state based on a prop, it wouldnâ€™t help us. Luckily, <code>setCount(c =&gt; c + 1)</code> has a more powerful sister pattern. Its name is <code>useReducer</code>.</p><h2 id="Decoupling-Updates-from-Actions"><a href="#Decoupling-Updates-from-Actions" class="headerlink" title="Decoupling Updates from Actions"></a><a href="#decoupling-updates-from-actions"></a>Decoupling Updates from Actions</h2><p>Letâ€™s modify the previous example to have two state variables: <code>count</code> and <code>step</code>. Our interval will increment the count by the value of the <code>step</code> input:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(c =&gt; c + step);    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="noopener">demo</a>.)</p><p>Note that <strong>weâ€™re not cheating</strong>. Since I started using <code>step</code> inside the effect, I added it to the dependencies. And thatâ€™s why the code runs correctly.</p><p>The current behavior in this example is that changing the <code>step</code> restarts the interval â€” because itâ€™s one of the dependencies. And in many cases, that is exactly what you want! Thereâ€™s nothing wrong with tearing down an effect and setting it up anew, and we shouldnâ€™t avoid that unless we have a good reason.</p><p>However, letâ€™s say we want the interval clock to not reset on changes to the <code>step</code>. How do we remove the <code>step</code> dependency from our effect?</p><p><strong>When setting a state variable depends on the current value of another state variable, you might want to try replacing them both with <code>useReducer</code>.</strong></p><p>When you find yourself writing <code>setSomething(something =&gt; ...)</code>, itâ€™s a good time to consider using a reducer instead. A reducer lets you <strong>decouple expressing the â€œactionsâ€ that happened in your component from how the state updates in response to them</strong>.</p><p>Letâ€™s trade the <code>step</code> dependency for a <code>dispatch</code> dependency in our effect:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &apos;tick&apos; &#125;);   &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [dispatch]);</span><br></pre></td></tr></table></figure><p>(See the <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>.)</p><p>You might ask me: â€œHow is this any better?â€ The answer is that <strong>React guarantees the <code>dispatch</code> function to be constant throughout the component lifetime. So the example above doesnâ€™t ever need to resubscribe the interval.</strong></p><p>We solved our problem!</p><p><em>(You may omit <code>dispatch</code>, <code>setState</code>, and <code>useRef</code> container values from the deps because React guarantees them to be static. But it also doesnâ€™t hurt to specify them.)</em></p><p>Instead of reading the state <em>inside</em> an effect, it dispatches an <em>action</em> that encodes the information about <em>what happened</em>. This allows our effect to stay decoupled from the <code>step</code> state. Our effect doesnâ€™t care <em>how</em> we update the state, it just tells us about <em>what happened</em>. And the reducer centralizes the update logic:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">  step: 1,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  const &#123; count, step &#125; = state;</span><br><span class="line">  if (action.type === &apos;tick&apos;) &#123;    return &#123; count: count + step, step &#125;;  &#125; else if (action.type === &apos;step&apos;) &#123;</span><br><span class="line">    return &#123; count, step: action.step &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a> if you missed it earlier).</p><h2 id="Why-useReducer-Is-the-Cheat-Mode-of-Hooks"><a href="#Why-useReducer-Is-the-Cheat-Mode-of-Hooks" class="headerlink" title="Why useReducer Is the Cheat Mode of Hooks"></a><a href="#why-usereducer-is-the-cheat-mode-of-hooks"></a>Why useReducer Is the Cheat Mode of Hooks</h2><p>Weâ€™ve seen how to remove dependencies when an effect needs to set state based on previous state, or on another state variable. <strong>But what if we need <em>props</em> to calculate the next state?</strong> For example, maybe our API is <code>&lt;Counter step={1} /&gt;</code>. Surely, in this case we canâ€™t avoid specifying <code>props.step</code> as a dependency?</p><p>In fact, we can! We can put <em>the reducer itself</em> inside our component to read props:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter(&#123; step &#125;) &#123;  const [count, dispatch] = useReducer(reducer, 0);</span><br><span class="line"></span><br><span class="line">  function reducer(state, action) &#123;</span><br><span class="line">    if (action.type === &apos;tick&apos;) &#123;</span><br><span class="line">      return state + step;    &#125; else &#123;</span><br><span class="line">      throw new Error();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &apos;tick&apos; &#125;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This pattern disables a few optimizations so try not to use it everywhere, but you can totally access props from a reducer if you need to. (Hereâ€™s a <a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="noopener">demo</a>.)</p><p><strong>Even in that case, <code>dispatch</code> identity is still guaranteed to be stable between re-renders.</strong> So you may omit it from the effect deps if you want. Itâ€™s not going to cause the effect to re-run.</p><p>You may be wondering: how can this possibly work? How can the reducer â€œknowâ€ props when called from inside an effect that belongs to another render? The answer is that when you <code>dispatch</code>, React just remembers the action â€” but it will <em>call</em> your reducer during the next render. At that point the fresh props will be in scope, and you wonâ€™t be inside an effect.</p><p><strong>This is why I like to think of <code>useReducer</code> as the â€œcheat modeâ€ of Hooks. It lets me decouple the update logic from describing what happened. This, in turn, helps me remove unnecessary dependencies from my effects and avoid re-running them more often than necessary.</strong></p><h2 id="Moving-Functions-Inside-Effects"><a href="#Moving-Functions-Inside-Effects" class="headerlink" title="Moving Functions Inside Effects"></a><a href="#moving-functions-inside-effects"></a>Moving Functions Inside Effects</h2><p>A common mistake is to think functions shouldnâ€™t be dependencies. For example, this seems like it could work:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [data, setData] = useState(&#123; hits: [] &#125;);</span><br><span class="line"></span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(</span><br><span class="line">      &apos;https://hn.algolia.com/api/v1/search?query=react&apos;,</span><br><span class="line">    );</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br></pre></td></tr></table></figure><p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="noopener">This example</a> is adapted from a great article by Robin Wieruch â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">check it out</a>!)</em></p><p>And to be clear, this code <em>does</em> work. <strong>But the problem with simply omitting local functions is that it gets pretty hard to tell whether weâ€™re handling all cases as the component grows!</strong></p><p>Imagine our code was split like this and each function was five times larger:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now letâ€™s say we later use some state or prop in one of these functions:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If we forget to update the deps of any effects that call these functions (possibly, through other functions!), our effects will fail to synchronize changes from our props and state. This doesnâ€™t sound great.</p><p>Luckily, there is an easy solution to this problem. <strong>If you only use some functions <em>inside</em> an effect, move them directly <em>into</em> that effect:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        function getFetchUrl() &#123;      return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;    &#125;    async function fetchData() &#123;      const result = await axios(getFetchUrl());      setData(result.data);    &#125;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="noopener">Hereâ€™s a demo</a>.)</p><p>So what is the benefit? We no longer have to think about the â€œtransitive dependenciesâ€. Our dependencies array isnâ€™t lying anymore: <strong>we truly <em>arenâ€™t</em> using anything from the outer scope of the component in our effect</strong>.</p><p>If we later edit <code>getFetchUrl</code> to use the <code>query</code> state, weâ€™re much more likely to notice that weâ€™re editing it <em>inside</em> an effect â€” and therefore, we need to add <code>query</code> to the effect dependencies:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    function getFetchUrl() &#123;</span><br><span class="line">      return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;    &#125;</span><br><span class="line"></span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, [query]); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(Hereâ€™s a <a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="noopener">demo</a>.)</p><p>By adding this dependency, weâ€™re not just â€œappeasing Reactâ€. It <em>makes sense</em> to refetch the data when the query changes. <strong>The design of <code>useEffect</code> forces you to notice the change in our data flow and choose how our effects should synchronize it â€” instead of ignoring it until our product users hit a bug.</strong></p><p>Thanks to the <code>exhaustive-deps</code> lint rule from the <code>eslint-plugin-react-hooks</code> plugin, you can <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">analyze the effects as you type in your editor</a> and receive suggestions about which dependencies are missing. In other words, a machine can tell you which data flow changes arenâ€™t handled correctly by a component.</p><p><img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt=""></p><p>Pretty sweet.</p><h2 id="But-I-Canâ€™t-Put-This-Function-Inside-an-Effect"><a href="#But-I-Canâ€™t-Put-This-Function-Inside-an-Effect" class="headerlink" title="But I Canâ€™t Put This Function Inside an Effect"></a><a href="#but-i-cant-put-this-function-inside-an-effect"></a>But I Canâ€™t Put This Function Inside an Effect</h2><p>Sometimes you might not want to move a function <em>inside</em> an effect. For example, several effects in the same component may call the same function, and you donâ€™t want to copy and paste its logic. Or maybe itâ€™s a prop.</p><p>Should you skip a function like this in the effect dependencies? I think not. Again, <strong>effects shouldnâ€™t lie about their dependencies.</strong> There are usually better solutions. A common misconception is that â€œa function would never changeâ€. But as we learned throughout this article, this couldnâ€™t be further from truth. Indeed, a function defined inside a component changes on every render!</p><p><strong>That by itself presents a problem.</strong> Say two effects call <code>getFetchUrl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  function getFetchUrl(query) &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In that case you might not want to move <code>getFetchUrl</code> inside either of the effects since you wouldnâ€™t be able to share the logic.</p><p>On the other hand, if youâ€™re â€œhonestâ€ about the effect dependencies, you may run into a problem. Since both our effects depend on <code>getFetchUrl</code> <strong>(which is different on every render)</strong>, our dependency arrays are useless:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    function getFetchUrl(query) &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A tempting solution to this is to just skip the <code>getFetchUrl</code> function in the deps list. However, I donâ€™t think itâ€™s a good solution. This makes it difficult to notice when we <em>are</em> adding a change to the data flow that <em>needs</em> to be handled by an effect. This leads to bugs like the â€œnever updating intervalâ€ we saw earlier.</p><p>Instead, there are two other solutions that are simpler.</p><p><strong>First of all, if a function doesnâ€™t use anything from the component scope, you can hoist it outside the component and then freely use it inside your effects:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function getFetchUrl(query) &#123;  return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;</span><br><span class="line">function SearchResults() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Thereâ€™s no need to specify it in deps because itâ€™s not in the render scope and canâ€™t be affected by the data flow. It canâ€™t accidentally depend on props or state.</p><p>Alternatively, you can wrap it into the <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="noopener"><code>useCallback</code> Hook</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    const getFetchUrl = useCallback((query) =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, []);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useCallback</code> is essentially like adding another layer of dependency checks. Itâ€™s solving the problem on the other end â€” <strong>rather than avoid a function dependency, we make the function itself only change when necessary</strong>.</p><p>Letâ€™s see why this approach is useful. Previously, our example showed two search results (for <code>&#39;react&#39;</code> and <code>&#39;redux&#39;</code> search queries). But letâ€™s say we want to add an input so that you can search for an arbitrary <code>query</code>. So instead of taking <code>query</code> as an argument, <code>getFetchUrl</code> will now read it from local state.</p><p>Weâ€™ll immediately see that itâ€™s missing a <code>query</code> dependency:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line">  const getFetchUrl = useCallback(() =&gt; &#123; </span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;, []);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>If I fix my <code>useCallback</code> deps to include <code>query</code>, any effect with <code>getFetchUrl</code> in deps will re-run whenever the <code>query</code> changes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const getFetchUrl = useCallback(() =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, [query]);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl();</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Thanks to <code>useCallback</code>, if <code>query</code> is the same, <code>getFetchUrl</code> also stays the same, and our effect doesnâ€™t re-run. But if <code>query</code> changes, <code>getFetchUrl</code> will also change, and we will re-fetch the data. Itâ€™s a lot like when you change some cell in an Excel spreadsheet, and the other cells using it recalculate automatically.</p><p>This is just a consequence of embracing the data flow and the synchronization mindset. <strong>The same solution works for function props passed from parents:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const fetchData = useCallback(() =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;      &#125;, [query]);  </span><br><span class="line">  return &lt;Child fetchData=&#123;fetchData&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; fetchData &#125;) &#123;</span><br><span class="line">  let [data, setData] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData().then(setData);</span><br><span class="line">  &#125;, [fetchData]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Since <code>fetchData</code> only changes inside <code>Parent</code> when its <code>query</code> state changes, our <code>Child</code> wonâ€™t refetch the data until itâ€™s actually necessary for the app.</p><h2 id="Are-Functions-Part-of-the-Data-Flow"><a href="#Are-Functions-Part-of-the-Data-Flow" class="headerlink" title="Are Functions Part of the Data Flow?"></a><a href="#are-functions-part-of-the-data-flow"></a>Are Functions Part of the Data Flow?</h2><p>Interestingly, this pattern is broken with classes in a way that really shows the difference between the effect and lifecycle paradigms. Consider this translation:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;      &#125;;  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;    this.props.fetchData();  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>You might be thinking: â€œCome on Dan, we all know that <code>useEffect</code> is like <code>componentDidMount</code> and <code>componentDidUpdate</code> combined, you canâ€™t keep beating that drum!â€ <strong>Yet this doesnâ€™t work even with <code>componentDidUpdate</code>:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;        if (this.props.fetchData !== prevProps.fetchData) &#123;      this.props.fetchData();    &#125;  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Of course, <code>fetchData</code> is a class method! (Or, rather, a class property â€” but that doesnâ€™t change anything.) Itâ€™s not going to be different because of a state change. So <code>this.props.fetchData</code> will stay equal to <code>prevProps.fetchData</code> and weâ€™ll never refetch. Letâ€™s just remove this condition then?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps) &#123;</span><br><span class="line">  this.props.fetchData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Oh wait, this fetches on <em>every</em> re-render. (Adding an animation above in the tree is a fun way to discover it.) Maybe letâ€™s bind it to a particular query?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>But then <code>this.props.fetchData !== prevProps.fetchData</code> is <em>always</em> <code>true</code>, even if the <code>query</code> didnâ€™t change! So weâ€™ll <em>always</em> refetch.</p><p>The only real solution to this conundrum with classes is to bite the bullet and pass the <code>query</code> itself into the <code>Child</code> component. The <code>Child</code> doesnâ€™t actually end up <em>using</em> the <code>query</code>, but it can trigger a refetch when it changes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;</span><br><span class="line">    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;;  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    if (this.props.query !== prevProps.query) &#123;      this.props.fetchData();    &#125;  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Over the years of working with classes with React, Iâ€™ve gotten so used to passing unnecessary props down and breaking encapsulation of parent components that I only realized a week ago why we had to do it.</p><p><strong>With classes, function props by themselves arenâ€™t truly a part of the data flow.</strong> Methods close over the mutable <code>this</code> variable so we canâ€™t rely on their identity to mean anything. Therefore, even when we only want a function, we have to pass a bunch of other data around in order to be able to â€œdiffâ€ it. We canâ€™t know whether <code>this.props.fetchData</code> passed from the parent depends on some state or not, and whether that state has just changed.</p><p><strong>With <code>useCallback</code>, functions can fully participate in the data flow.</strong> We can say that if the function inputs changed, the function itself has changed, but if not, it stayed the same. Thanks to the granularity provided by <code>useCallback</code>, changes to props like <code>props.fetchData</code> can propagate down automatically.</p><p>Similarly, <a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a> lets us do the same for complex objects:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ColorPicker() &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  const [color, setColor] = useState(&apos;pink&apos;);</span><br><span class="line">  const style = useMemo(() =&gt; (&#123; color &#125;), [color]);</span><br><span class="line">  return &lt;Child style=&#123;style&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>I want to emphasize that putting <code>useCallback</code> everywhere is pretty clunky.</strong> Itâ€™s a nice escape hatch and itâ€™s useful when a function is both passed down <em>and</em> called from inside an effect in some children. Or if youâ€™re trying to prevent breaking memoization of a child component. But Hooks lend themselves better to <a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="noopener">avoiding passing callbacks down</a> altogether.</p><p>In the above examples, Iâ€™d much prefer if <code>fetchData</code> was either inside my effect (which itself could be extracted to a custom Hook) or a top-level import. I want to keep the effects simple, and callbacks in them donâ€™t help that. (â€œWhat if some <code>props.onComplete</code> callback changes while the request was in flight?â€) You can <a href="#swimming-against-the-tide">simulate the class behavior</a> but that doesnâ€™t solve race conditions.</p><h2 id="Speaking-of-Race-Conditions"><a href="#Speaking-of-Race-Conditions" class="headerlink" title="Speaking of Race Conditions"></a><a href="#speaking-of-race-conditions"></a>Speaking of Race Conditions</h2><p>A classic data fetching example with classes might look like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As you probably know, this code is buggy. It doesnâ€™t handle updates. So the second classic example you could find online is something like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;    if (prevProps.id !== this.props.id) &#123;      this.fetchData(this.props.id);    &#125;  &#125;  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This is definitely better! But itâ€™s still buggy. The reason itâ€™s buggy is that the request may come out of order. So if Iâ€™m fetching <code>{id: 10}</code>, switch to <code>{id: 20}</code>, but the <code>{id: 20}</code> request comes first, the request that started earlier but finished later would incorrectly overwrite my state.</p><p>This is called a race condition, and itâ€™s typical in code that mixes <code>async</code> / <code>await</code> (which assumes something waits for the result) with top-down data flow (props or state can change while weâ€™re in the middle of an async function).</p><p>Effects donâ€™t magically solve this problem, although theyâ€™ll warn you if you try to pass an <code>async</code> function to the effect directly. (Weâ€™ll need to improve that warning to better explain the problems you might run into.)</p><p>If the async approach you use supports cancellation, thatâ€™s great! You can cancel the async request right in your cleanup function.</p><p>Alternatively, the easiest stopgap approach is to track it with a boolean:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Article(&#123; id &#125;) &#123;</span><br><span class="line">  const [article, setArticle] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let didCancel = false;</span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const article = await API.fetchArticle(id);</span><br><span class="line">      if (!didCancel) &#123;        setArticle(article);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;      didCancel = true;    &#125;;  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">This article</a> goes into more detail about how you can handle errors and loading states, as well as extract that logic into a custom Hook. I recommend you to check it out if youâ€™re interested to learn more about data fetching with Hooks.</p><h2 id="Raising-the-Bar"><a href="#Raising-the-Bar" class="headerlink" title="Raising the Bar"></a><a href="#raising-the-bar"></a>Raising the Bar</h2><p>With the class lifecycle mindset, side effects behave differently from the render output. Rendering the UI is driven by props and state, and is guaranteed to be consistent with them, but side effects are not. This is a common source of bugs.</p><p>With the mindset of <code>useEffect</code>, things are synchronized by default. Side effects become a part of the React data flow. For every <code>useEffect</code> call, once you get it right, your component handles edge cases much better.</p><p>However, the upfront cost of getting it right is higher. This can be annoying. Writing synchronization code that handles edge cases well is inherently more difficult than firing one-off side effects that arenâ€™t consistent with rendering.</p><p>This could be worrying if <code>useEffect</code> was meant to be <em>the</em> tool you use most of the time. However, itâ€™s a low-level building block. Itâ€™s an early time for Hooks so everybody uses low-level ones all the time, especially in tutorials. But in practice, itâ€™s likely the community will start moving to higher-level Hooks as good APIs gain momentum.</p><p>Iâ€™m seeing different apps create their own Hooks like <code>useFetch</code> that encapsulates some of their appâ€™s auth logic or <code>useTheme</code> which uses theme context. Once you have a toolbox of those, you donâ€™t reach for <code>useEffect</code> <em>that</em> often. But the resilience it brings benefits every Hook built on top of it.</p><p>So far, <code>useEffect</code> is most commonly used for data fetching. But data fetching isnâ€™t exactly a synchronization problem. This is especially obvious because our deps are often <code>[]</code>. What are we even synchronizing?</p><p>In the longer term, <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="noopener">Suspense for Data Fetching</a> will allow third-party libraries to have a first-class way to tell React to suspend rendering until something async (anything: code, data, images) is ready.</p><p>As Suspense gradually covers more data fetching use cases, I anticipate that <code>useEffect</code> will fade into background as a power user tool for cases when you actually want to synchronize props and state to some side effect. Unlike data fetching, it handles this case naturally because it was designed for it. But until then, custom Hooks like <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">shown here</a> are a good way to reuse data fetching logic.</p><h2 id="In-Closing"><a href="#In-Closing" class="headerlink" title="In Closing"></a><a href="#in-closing"></a>In Closing</h2><p>Now that you know pretty much everything I know about using effects, check out the <a href="#tldr">TLDR</a> in the beginning. Does it make sense? Did I miss something? (I havenâ€™t run out of paper yet!)</p><p>Iâ€™d love to hear from you on Twitter! Thanks for reading.</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      useEffect å®Œæ•´æŒ‡å— â€” Dan Abramov
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/React-Hooks/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
      <category term="useEffect" scheme="https://andyxw.com/tags/useEffect/"/>
    
  </entry>
  
  <entry>
    <title>A Complete Guide to useEffectï¼ˆä¸­æ–‡ç‰ˆï¼‰</title>
    <link href="https://andyxw.com/archives/4233.html"/>
    <id>https://andyxw.com/archives/4233.html</id>
    <published>2019-08-23T10:49:59.210Z</published>
    <updated>2019-09-04T13:25:07.766Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/</a></p></blockquote><p>ä½ ç”¨ <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hooks</a> å†™äº†ä¸€äº›ç»„ä»¶ï¼Œç”šæˆ–å†™äº†ä¸€ä¸ªå°å‹åº”ç”¨ã€‚ä½ å¯èƒ½å¾ˆæ»¡æ„ï¼Œä½¿ç”¨å®ƒçš„ API å¾ˆèˆ’æœå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›å°æŠ€å·§ã€‚ä½ ç”šè‡³å¯èƒ½å†™äº†ä¸€äº› <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom Hooks</a> å»æŠ½ç¦»é‡å¤çš„é€»è¾‘ï¼ˆç²¾ç®€æ‰äº† 300 è¡Œä»£ç ï¼‰ï¼Œå¹¶ä¸”å¾—æ„åœ°å±•ç¤ºç»™ä½ çš„åŒäº‹çœ‹ï¼Œâ€œå¹²å¾—æ¼‚äº®â€ï¼Œä»–ä»¬å¦‚æ˜¯è¯´ã€‚</p><p>ä½†æœ‰æ—¶å€™å½“ä½ ä½¿ç”¨<code>useEffect</code>ä½ æ€»è§‰å¾—å“ªå„¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ä½ ä¼šå˜€å’•ä½ å¯èƒ½é—æ¼äº†ä»€ä¹ˆã€‚å®ƒçœ‹èµ·æ¥åƒ class çš„ç”Ÿå‘½å‘¨æœŸâ€¦ ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä½ å‘è§‰è‡ªå·±åœ¨é—®ç±»ä¼¼ä¸‹é¢çš„è¿™äº›é—®é¢˜ï¼š</p><ul><li>ğŸ¤” å¦‚ä½•ç”¨<code>useEffect</code>æ¨¡æ‹Ÿ<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸï¼Ÿ</li><li>ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨<code>useEffect</code>é‡Œè¯·æ±‚æ•°æ®ï¼Ÿ<code>[]</code>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</li><li>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– propï¼Ÿ</li></ul><p>å½“æˆ‘åˆšå¼€å§‹ä½¿ç”¨ Hooks çš„æ—¶å€™ï¼Œæˆ‘ä¹ŸåŒæ ·è¢«ä¸Šé¢è¿™äº›é—®é¢˜æ‰€å›°æ‰°ã€‚ç”šè‡³å½“æˆ‘å†™æœ€åˆçš„æ–‡æ¡£æ—¶ï¼Œæˆ‘ä¹Ÿå¹¶æ²¡æœ‰æ‰å®åœ°æŒæ¡æŸäº›ç»†èŠ‚ã€‚æˆ‘ç»å†äº†ä¸€äº› â€œå•Šå“ˆâ€ çš„å¼€çªæ—¶åˆ»ï¼Œæˆ‘æƒ³æŠŠè¿™äº›åˆ†äº«ç»™ä½ ã€‚<strong>è¿™ç¯‡æ–‡ç« ä¼šæ·±å…¥è®²è§£å¸®ä½ æ˜ç™½ä¸Šé¢é—®é¢˜çš„ç­”æ¡ˆã€‚</strong></p><p>åœ¨çœ‹ç­”æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¾€åé€€ä¸€æ­¥ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¸æ˜¯ç»™ä½ ä¸€ä¸ªè¦ç‚¹æ¸…å•ï¼Œè€Œæ˜¯æƒ³å¸®ä½ çœŸæ­£åœ°é¢†ä¼š<code>useEffect</code>ã€‚å…¶å®æˆ‘ä»¬å¹¶æ²¡æœ‰å¤ªå¤šéœ€è¦å­¦ä¹ çš„ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¼šèŠ±å¾ˆå¤šæ—¶é—´è¯•å›¾å¿˜è®°æŸäº›å·²ç»ä¹ å¾—çš„æ¦‚å¿µï¼ˆunlearningï¼‰ã€‚</p><p><strong>å½“æˆ‘ä¸å†é€è¿‡ç†Ÿæ‚‰çš„ class ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»çª¥è§†<code>useEffect</code> è¿™ä¸ª Hook çš„æ—¶å€™ï¼Œæˆ‘æ‰å¾—ä»¥èä¼šè´¯é€šã€‚</strong></p><blockquote><p>â€œå¿˜è®°ä½ å·²ç»å­¦åˆ°çš„ã€‚â€ â€” Yoda</p></blockquote><p><a href="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" target="_blank" rel="noopener"><img src="https://overreacted.io/static/6203a1f1f2c771816a5ba0969baccd12/5ed8a/yoda.jpg" alt=""></a></p><p><strong>è¿™ç¯‡æ–‡ç« ä¼šå‡è®¾ä½ å¯¹ <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener"><code>useEffect</code></a> API æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ã€‚</strong></p><p><strong>è¿™ç¯‡æ–‡ç« çœŸçš„å¾ˆé•¿ã€‚å®ƒæ›´åƒä¸€æœ¬ mini ä¹¦ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æ›´å–œæ¬¢çš„å½¢å¼ã€‚å¦‚æœä½ å¾ˆåŒ†å¿™æˆ–è€…å¹¶ä¸æ˜¯å¤ªå…³å¿ƒæœ¬æ–‡ä¸»é¢˜çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„æ‘˜è¦ã€‚</strong></p><p><strong>å¦‚æœä½ å¯¹äºæ·±å…¥ç ”ç©¶æ„Ÿè§‰ä¸æ˜¯å¾ˆé€‚åº”çš„è¯ï¼Œä½ æˆ–è®¸å¯ä»¥ç­‰ä¸‹é¢è¿™äº›è§£é‡Šå‡ºç°åœ¨å…¶ä»–æ–‡ç« ä¸­å†å»äº†è§£ä¹Ÿè¡Œã€‚å°±åƒ 2013 å¹´ React åˆšå‡ºä¸–çš„æ—¶å€™ï¼Œå¤§å®¶éœ€è¦æ—¶é—´å»ç†è§£æ¶ˆåŒ–ä¸€ç§ä¸åŒçš„å¿ƒæ™ºæ¨¡å‹ã€‚çŸ¥è¯†ä¹Ÿéœ€è¦æ—¶é—´å»æ™®åŠã€‚</strong></p><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a><a href="#%E6%91%98%E8%A6%81"></a>æ‘˜è¦</h2><p>å¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œå¯ä»¥å¿«é€Ÿæµè§ˆè¿™ä»½æ‘˜è¦ã€‚è¦æ˜¯æŸäº›éƒ¨åˆ†ä¸å®¹æ˜“ç†è§£ï¼Œä½ å¯ä»¥å¾€ä¸‹æ»šåŠ¨å¯»æ‰¾ç›¸å…³çš„å†…å®¹å»é˜…è¯»ã€‚</p><p>å¦‚æœä½ æ‰“ç®—é˜…è¯»æ•´ç¯‡æ–‡ç« ï¼Œä½ å®Œå…¨å¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†ã€‚æˆ‘ä¼šåœ¨æ–‡ç« æœ«å°¾å¸¦ä¸Šæ‘˜è¦çš„é“¾æ¥ã€‚</p><p><strong>ğŸ¤” Question: å¦‚ä½•ç”¨<code>useEffect</code>æ¨¡æ‹Ÿ<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸï¼Ÿ</strong></p><p>è™½ç„¶å¯ä»¥ä½¿ç”¨<code>useEffect(fn, [])</code>ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸ç­‰ã€‚å’Œ<code>componentDidMount</code>ä¸ä¸€æ ·ï¼Œ<code>useEffect</code>ä¼š_æ•è·_ props å’Œ stateã€‚æ‰€ä»¥å³ä¾¿åœ¨å›è°ƒå‡½æ•°é‡Œï¼Œä½ æ‹¿åˆ°çš„è¿˜æ˜¯åˆå§‹çš„ props å’Œ stateã€‚å¦‚æœä½ æƒ³å¾—åˆ° â€œæœ€æ–°â€ çš„å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ refã€‚ä¸è¿‡ï¼Œé€šå¸¸ä¼šæœ‰æ›´ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ‰€ä»¥ä½ å¹¶ä¸ä¸€å®šè¦ç”¨ refã€‚è®°ä½ï¼Œeffects çš„å¿ƒæ™ºæ¨¡å‹å’Œ<code>componentDidMount</code>ä»¥åŠå…¶ä»–ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åŒçš„ï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬ä¹‹é—´å®Œå…¨ä¸€è‡´çš„è¡¨è¾¾åè€Œæ›´å®¹æ˜“ä½¿ä½ æ··æ·†ã€‚æƒ³è¦æ›´æœ‰æ•ˆï¼Œä½ éœ€è¦ â€œthink in effectsâ€ï¼Œå®ƒçš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°çŠ¶æ€åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p><p><strong>ğŸ¤” Question: å¦‚ä½•æ­£ç¡®åœ°åœ¨<code>useEffect</code>é‡Œè¯·æ±‚æ•°æ®ï¼Ÿ<code>[]</code>åˆæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> æ˜¯å¾ˆå¥½çš„å…¥é—¨ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨<code>useEffect</code>é‡Œåšæ•°æ®è¯·æ±‚ã€‚è¯·åŠ¡å¿…è¯»å®Œå®ƒï¼å®ƒæ²¡æœ‰æˆ‘çš„è¿™ç¯‡è¿™ä¹ˆé•¿ã€‚<code>[]</code>è¡¨ç¤º effect æ²¡æœ‰ä½¿ç”¨ä»»ä½• React æ•°æ®æµé‡Œçš„å€¼ï¼Œå› æ­¤è¯¥ effect ä»…è¢«è°ƒç”¨ä¸€æ¬¡æ˜¯å®‰å…¨çš„ã€‚<code>[]</code>åŒæ ·ä¹Ÿæ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºï¼Œä¹Ÿå³ä½ ä»¥ä¸ºæ²¡ä½¿ç”¨æ•°æ®æµé‡Œçš„å€¼ä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥ï¼ˆä¸»è¦æ˜¯<code>useReducer</code> å’Œ <code>useCallback</code>ï¼‰æ¥ç§»é™¤è¿™äº› effect ä¾èµ–ï¼Œè€Œä¸æ˜¯é”™è¯¯åœ°å¿½ç•¥å®ƒä»¬ã€‚</p><p><strong>ğŸ¤” Question: æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš effect çš„ä¾èµ–å—ï¼Ÿ</strong></p><p>ä¸€èˆ¬å»ºè®®æŠŠä¸ä¾èµ– props å’Œ state çš„å‡½æ•°æåˆ°ä½ çš„ç»„ä»¶å¤–é¢ï¼Œå¹¶ä¸”æŠŠé‚£äº›ä»…è¢« effect ä½¿ç”¨çš„å‡½æ•°æ”¾åˆ° effect é‡Œé¢ã€‚å¦‚æœè¿™æ ·åšäº†ä»¥åï¼Œä½ çš„ effect è¿˜æ˜¯éœ€è¦ç”¨åˆ°ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬é€šè¿‡ props ä¼ è¿›æ¥çš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒä»¬çš„åœ°æ–¹ç”¨<code>useCallback</code>åŒ…ä¸€å±‚ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿå› ä¸ºè¿™äº›å‡½æ•°å¯ä»¥è®¿é—®åˆ° props å’Œ stateï¼Œå› æ­¤å®ƒä»¬ä¼šå‚ä¸åˆ°æ•°æ®æµä¸­ã€‚æˆ‘ä»¬å®˜ç½‘çš„ FAQ æœ‰<a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">æ›´è¯¦ç»†çš„ç­”æ¡ˆ</a>ã€‚</p><p><strong>ğŸ¤” Question: ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ</strong></p><p>è¿™ä¸ªé€šå¸¸å‘ç”Ÿäºä½ åœ¨ effect é‡Œåšæ•°æ®è¯·æ±‚å¹¶ä¸”æ²¡æœ‰è®¾ç½® effect ä¾èµ–å‚æ•°çš„æƒ…å†µã€‚æ²¡æœ‰è®¾ç½®ä¾èµ–ï¼Œeffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨ effect ä¸­æ›´æ–°äº†çŠ¶æ€å¼•èµ·æ¸²æŸ“å¹¶å†æ¬¡è§¦å‘ effectã€‚æ— é™å¾ªç¯çš„å‘ç”Ÿä¹Ÿå¯èƒ½æ˜¯å› ä¸ºä½ è®¾ç½®çš„ä¾èµ–æ€»æ˜¯ä¼šæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªç§»é™¤çš„æ–¹å¼æ’æŸ¥å‡ºå“ªä¸ªä¾èµ–å¯¼è‡´äº†é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç§»é™¤ä½ ä½¿ç”¨çš„ä¾èµ–ï¼ˆæˆ–è€…ç›²ç›®åœ°ä½¿ç”¨<code>[]</code>ï¼‰é€šå¸¸æ˜¯ä¸€ç§é”™è¯¯çš„è§£å†³æ–¹å¼ã€‚ä½ åº”è¯¥åšçš„æ˜¯è§£å†³é—®é¢˜çš„æ ¹æºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ° effect é‡Œï¼Œæˆ–è€…æåˆ°ç»„ä»¶å¤–é¢ï¼Œæˆ–è€…ç”¨<code>useCallback</code>åŒ…ä¸€å±‚ã€‚<code>useMemo</code> å¯ä»¥åšç±»ä¼¼çš„äº‹æƒ…ä»¥é¿å…é‡å¤ç”Ÿæˆå¯¹è±¡ã€‚</p><p><strong>ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨ effect é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„ state æˆ– prop å‘¢ï¼Ÿ</strong></p><p>Effect æ‹¿åˆ°çš„æ€»æ˜¯å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚è¿™èƒ½å¤Ÿ<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">é¿å…ä¸€äº› bugs</a>ï¼Œä½†åœ¨ä¸€äº›åœºæ™¯ä¸­åˆä¼šæœ‰äº›è®¨äººå«Œã€‚å¯¹äºè¿™äº›åœºæ™¯ï¼Œä½ å¯ä»¥æ˜ç¡®åœ°ä½¿ç”¨å¯å˜çš„ ref ä¿å­˜ä¸€äº›å€¼ï¼ˆä¸Šé¢æ–‡ç« çš„æœ«å°¾è§£é‡Šäº†è¿™ä¸€ç‚¹ï¼‰ã€‚å¦‚æœä½ è§‰å¾—åœ¨æ¸²æŸ“ä¸­æ‹¿åˆ°äº†ä¸€äº›æ—§çš„ props å’Œ stateï¼Œä¸”ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œä½ å¾ˆå¯èƒ½é—æ¼äº†ä¸€äº›ä¾èµ–ã€‚å¯ä»¥å°è¯•ä½¿ç”¨è¿™ä¸ª <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint è§„åˆ™</a>æ¥è®­ç»ƒä½ å‘ç°è¿™äº›ä¾èµ–ã€‚å¯èƒ½æ²¡è¿‡å‡ å¤©ï¼Œè¿™ç§èƒ½åŠ›ä¼šå˜å¾—åƒæ˜¯ä½ çš„ç¬¬äºŒå¤©æ€§ã€‚åŒæ ·å¯ä»¥çœ‹æˆ‘ä»¬å®˜ç½‘ FAQ ä¸­çš„<a href="https://reactjs.org/docs/hooks-faq.html#why-am-i-seeing-stale-props-or-state-inside-my-function" target="_blank" rel="noopener">è¿™ä¸ªå›ç­”ã€‚</a></p><p>æˆ‘å¸Œæœ›è¿™ä¸ªæ‘˜è¦å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼è¦ä¸ï¼Œæˆ‘ä»¬å¼€å§‹æ­£æ–‡ã€‚</p><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Props-and-State"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Props-and-State" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and State"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84-props-and-state"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Props and State</h2><p>åœ¨æˆ‘ä»¬è®¨è®º effects ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹æ¸²æŸ“ï¼ˆrenderingï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ Counterï¼Œæ³¨æ„é«˜äº®çš„é‚£ä¸€è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é«˜äº®çš„ä»£ç ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ<code>count</code> ä¼š â€œç›‘å¬â€ çŠ¶æ€çš„å˜åŒ–å¹¶è‡ªåŠ¨æ›´æ–°å—ï¼Ÿè¿™ä¹ˆæƒ³å¯èƒ½æ˜¯å­¦ä¹  React çš„æ—¶å€™æœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒå¹¶ä¸æ˜¯<a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">ç²¾ç¡®çš„å¿ƒæ™ºæ¨¡å‹</a>ã€‚</p><p><strong>ä¸Šé¢ä¾‹å­ä¸­ï¼Œ<code>count</code>ä»…æ˜¯ä¸€ä¸ªæ•°å­—è€Œå·²ã€‚</strong>å®ƒä¸æ˜¯ç¥å¥‡çš„ â€œdata bindingâ€, â€œwatcherâ€, â€œproxyâ€ï¼Œæˆ–è€…å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—åƒä¸‹é¢è¿™ä¸ªä¸€æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const count = 42;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä»<code>useState()</code>æ‹¿åˆ°<code>count</code>çš„åˆå§‹å€¼<code>0</code>ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>setCount(1)</code>ï¼ŒReact ä¼šå†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œè¿™ä¸€æ¬¡<code>count</code>æ˜¯<code>1</code>ã€‚å¦‚æ­¤ç­‰ç­‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½èƒ½æ‹¿åˆ°ç‹¬ç«‹çš„<code>count</code> çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å€¼æ˜¯å‡½æ•°ä¸­çš„ä¸€ä¸ªå¸¸é‡ã€‚</strong></p><p>æ‰€ä»¥ä¸‹é¢çš„è¿™è¡Œä»£ç æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br></pre></td></tr></table></figure><p><strong>å®ƒä»…ä»…åªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­æ’å…¥äº† count è¿™ä¸ªæ•°å­—ã€‚</strong>è¿™ä¸ªæ•°å­—ç”± React æä¾›ã€‚å½“<code>setCount</code>çš„æ—¶å€™ï¼ŒReact ä¼šå¸¦ç€ä¸€ä¸ªä¸åŒçš„<code>count</code>å€¼å†æ¬¡è°ƒç”¨ç»„ä»¶ã€‚ç„¶åï¼ŒReact ä¼šæ›´æ–° DOM ä»¥ä¿æŒå’Œæ¸²æŸ“è¾“å‡ºä¸€è‡´ã€‚</p><p>è¿™é‡Œå…³é”®çš„ç‚¹åœ¨äºä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å¸¸é‡éƒ½ä¸ä¼šéšç€æ—¶é—´æ”¹å˜ã€‚æ¸²æŸ“è¾“å‡ºä¼šå˜æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶è¢«ä¸€æ¬¡æ¬¡è°ƒç”¨ï¼Œè€Œæ¯ä¸€æ¬¡è°ƒç”¨å¼•èµ·çš„æ¸²æŸ“ä¸­ï¼Œå®ƒåŒ…å«çš„<code>count</code>å€¼ç‹¬ç«‹äºå…¶ä»–æ¸²æŸ“ã€‚</p><p><em>ï¼ˆå…³äºè¿™ä¸ªè¿‡ç¨‹æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="https://overreacted.io/react-as-a-ui-runtime/" target="_blank" rel="noopener">React as a UI Runtime</a>ã€‚ï¼‰</em></p><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡éƒ½è¿˜å¥½ã€‚é‚£ä¹ˆäº‹ä»¶å¤„ç†å‡½æ•°å‘¢ï¼Ÿ</p><p>çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒåœ¨ä¸‰ç§’åä¼š alert ç‚¹å‡»æ¬¡æ•°<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  function handleAlertClick() &#123;    setTimeout(() =&gt; &#123;      alert(&apos;You clicked on: &apos; + count);    &#125;, 3000);  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;        Show alert      &lt;/button&gt;    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å»æ“ä½œï¼š</p><ul><li><strong>ç‚¹å‡»å¢åŠ </strong> counter åˆ° 3</li><li><strong>ç‚¹å‡»ä¸€ä¸‹</strong> â€œShow alertâ€</li><li><strong>ç‚¹å‡»å¢åŠ </strong> counter åˆ° 5 å¹¶ä¸”åœ¨å®šæ—¶å™¨å›è°ƒè§¦å‘å‰å®Œæˆ</li></ul><p><img src="https://overreacted.io/counter-46c55d5f1f749462b7a173f1e748e41e.gif" alt=""></p><p>ä½ çŒœ alert ä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯ 5 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯ alert çš„æ—¶å€™ counter çš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯ 3 å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚</p><p><em>å‰§é€é¢„è­¦</em></p><p>æ¥è‡ªå·± <a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">è¯•è¯•å§ï¼</a></p><p>å¦‚æœç»“æœå’Œä½ é¢„æ–™ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨åœ¨ state ä¸­ä¿å­˜äº†å½“å‰æ¥æ”¶è€…çš„ IDï¼Œä»¥åŠä¸€ä¸ªå‘é€æŒ‰é’®ã€‚ <a href="https://overreacted.io/how-are-function-components-different-from-classes" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æ·±å…¥æ¢ç´¢äº†ä¸ªä¸­ç¼˜ç”±ã€‚æ­£ç¡®çš„ç­”æ¡ˆå°±æ˜¯ 3ã€‚</p><p>alert ä¼š â€œæ•è·â€ æˆ‘ç‚¹å‡»æŒ‰é’®æ—¶å€™çš„çŠ¶æ€ã€‚</p><p><em>ï¼ˆè™½ç„¶æœ‰å…¶ä»–åŠæ³•å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œä½†ç°åœ¨æˆ‘ä¼šä¸“æ³¨äºè¿™ä¸ªé»˜è®¤çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬åœ¨æ„å»ºä¸€ç§å¿ƒæ™ºæ¨¡å‹çš„æ—¶å€™ï¼Œåœ¨å¯é€‰çš„ç­–ç•¥ä¸­åˆ†è¾¨å‡º â€œæœ€å°é˜»åŠ›è·¯å¾„â€ æ˜¯éå¸¸é‡è¦çš„ã€‚ï¼‰</em></p><p>ä½†å®ƒç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‘ç°<code>count</code>åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” <strong>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­<code>count</code>å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚</strong></p><p>è¿™å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function sayHi(person) &#123;</span><br><span class="line">  const name = person.name;  setTimeout(() =&gt; &#123;</span><br><span class="line">    alert(&apos;Hello, &apos; + name);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let someone = &#123;name: &apos;Dan&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Yuzhi&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br><span class="line"></span><br><span class="line">someone = &#123;name: &apos;Dominic&apos;&#125;;</span><br><span class="line">sayHi(someone);</span><br></pre></td></tr></table></figure><p>åœ¨ <a href="https://codesandbox.io/s/mm6ww11lk8" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a>ä¸­, å¤–å±‚çš„<code>someone</code>ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨ React ä¸­ï¼Œ_å½“å‰_çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚<strong>ç„¶åï¼Œåœ¨<code>sayHi</code>å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡<code>name</code>ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„<code>person</code>å…³è”ã€‚</strong>å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ª alert éƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„<code>name</code>ã€‚</p><p>è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„<code>count</code>å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ â€œçœ‹åˆ°â€ çš„æ˜¯å®ƒè‡ªå·±çš„<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 0;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 1;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const count = 2;   </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + count);</span><br><span class="line">    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ª â€œæ–°ç‰ˆæœ¬â€ çš„<code>handleAlertClick</code>ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„<code>handleAlertClick</code>â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ <code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 0);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 1);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  function handleAlertClick() &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      alert(&apos;You clicked on: &apos; + 2);    &#125;, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<a href="https://codesandbox.io/s/w2wxl3yo0l" target="_blank" rel="noopener">åœ¨è¿™ä¸ª demo ä¸­</a>ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° â€œå±äºâ€ æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­<code>counter</code>çš„çŠ¶æ€å€¼ã€‚</p><p><strong>åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œprops å’Œ state æ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚</strong>å¦‚æœ props å’Œ state åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½ â€œå±äºâ€ ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨ â€œçœ‹åˆ°â€ çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</p><p><em>å¤‡æ³¨ï¼šä¸Šé¢æˆ‘å°†å…·ä½“çš„<code>count</code>å€¼ç›´æ¥å†…è”åˆ°äº†<code>handleAlertClick</code>å‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒæ™ºä¸Šçš„æ›¿æ¢æ˜¯å®‰å…¨çš„å› ä¸º<code>count</code> å€¼åœ¨æŸæ¬¡ç‰¹å®šæ¸²æŸ“ä¸­ä¸å¯èƒ½è¢«æ”¹å˜ã€‚å®ƒè¢«å£°æ˜æˆäº†ä¸€ä¸ªå¸¸é‡å¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚è¿™æ ·å»æ€è€ƒå…¶ä»–ç±»å‹çš„å€¼æ¯”å¦‚å¯¹è±¡ä¹ŸåŒæ ·æ˜¯å®‰å…¨çš„ï¼Œå½“ç„¶éœ€è¦åœ¨æˆ‘ä»¬éƒ½åŒæ„åº”è¯¥é¿å…ç›´æ¥ä¿®æ”¹ state è¿™ä¸ªå‰æä¸‹ã€‚é€šè¿‡è°ƒç”¨<code>setSomething(newObj)</code>çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¿è¯ä¹‹å‰æ¸²æŸ“ä¸­çš„ state ä¸ä¼šè¢«æ±¡æŸ“ã€‚</em></p><h2 id="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Effects"><a href="#æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„-Effects" class="headerlink" title="æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effects"></a><a href="#%E6%AF%8F%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84effects"></a>æ¯æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„ Effects</h2><p>è¿™ç¯‡æ–‡ç« æ˜¯å…³äº effects çš„ï¼Œä½†ç›®å‰æˆ‘ä»¬å±…ç„¶è¿˜æ²¡æœ‰è®¨è®º effectsï¼ è¨€å½’æ­£ä¼ ï¼Œç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºä¸€ä¸ªç»“æœï¼Œeffects å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>è®©æˆ‘ä»¬å›åˆ°<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a>ä¸­çš„è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = `You clicked $&#123;count&#125; times`;  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŠ›ä¸€ä¸ªé—®é¢˜ç»™ä½ ï¼šeffect æ˜¯å¦‚ä½•è¯»å–åˆ°æœ€æ–°çš„<code>count</code> çŠ¶æ€å€¼çš„å‘¢ï¼Ÿ</strong></p><p>ä¹Ÿè®¸ï¼Œæ˜¯æŸç§ â€œdata bindingâ€ æˆ–â€œwatchingâ€æœºåˆ¶ä½¿å¾—<code>count</code>èƒ½å¤Ÿåœ¨ effect å‡½æ•°å†…æ›´æ–°ï¼Ÿä¹Ÿæˆ–è®¸<code>count</code>æ˜¯ä¸€ä¸ªå¯å˜çš„å€¼ï¼ŒReact ä¼šåœ¨æˆ‘ä»¬ç»„ä»¶å†…éƒ¨ä¿®æ”¹å®ƒä»¥ä½¿æˆ‘ä»¬çš„ effect å‡½æ•°æ€»èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Ÿ</p><p>éƒ½ä¸æ˜¯ã€‚</p><p>æˆ‘ä»¬å·²ç»çŸ¥é“<code>count</code>æ˜¯æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­çš„å¸¸é‡ã€‚äº‹ä»¶å¤„ç†å‡½æ•° â€œçœ‹åˆ°â€ çš„æ˜¯å±äºå®ƒé‚£æ¬¡ç‰¹å®šæ¸²æŸ“ä¸­çš„<code>count</code>çŠ¶æ€å€¼ã€‚å¯¹äº effects ä¹ŸåŒæ ·å¦‚æ­¤ï¼š</p><p><strong>å¹¶ä¸æ˜¯<code>count</code>çš„å€¼åœ¨ â€œä¸å˜â€ çš„ effect ä¸­å‘ç”Ÿäº†æ”¹å˜ï¼Œè€Œæ˜¯ <em>effect å‡½æ•°æœ¬èº«</em>åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¸ç›¸åŒã€‚</strong></p><p>æ¯ä¸€ä¸ª effect ç‰ˆæœ¬ â€œçœ‹åˆ°â€ çš„<code>count</code>å€¼éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;0&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;1&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">        () =&gt; &#123;      document.title = `You clicked $&#123;2&#125; times`;    &#125;  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React ä¼šè®°ä½ä½ æä¾›çš„ effect å‡½æ•°ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ›´æ”¹ä½œç”¨äº DOM å¹¶è®©æµè§ˆå™¨ç»˜åˆ¶å±å¹•åå»è°ƒç”¨å®ƒã€‚</p><p>æ‰€ä»¥è™½ç„¶æˆ‘ä»¬è¯´çš„æ˜¯ä¸€ä¸ª <em>effect</em>ï¼ˆè¿™é‡ŒæŒ‡æ›´æ–° document çš„ titleï¼‰ï¼Œä½†å…¶å®æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ä¸€ä¸ª<em>ä¸åŒçš„å‡½æ•°</em> â€” å¹¶ä¸”æ¯ä¸ª effect å‡½æ•° â€œçœ‹åˆ°â€ çš„ props å’Œ state éƒ½æ¥è‡ªäºå®ƒå±äºçš„é‚£æ¬¡ç‰¹å®šæ¸²æŸ“ã€‚</p><p><strong>æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥æƒ³è±¡ effects æ˜¯æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ†ã€‚</strong></p><p>ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ï¼ˆä¸ºäº†<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/" target="_blank" rel="noopener">å…è®¸ Hook çš„ç»„åˆ</a>å¹¶ä¸”ä¸å¼•å…¥ç¬¨æ‹™çš„è¯­æ³•æˆ–è€…è¿è¡Œæ—¶ï¼‰ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒæ™ºæ¨¡å‹ä¸Šï¼Œeffect å‡½æ•°_å±äº_æŸä¸ªç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†å‡½æ•°ä¸€æ ·ã€‚</p><p>ä¸ºäº†ç¡®ä¿æˆ‘ä»¬å·²ç»æœ‰äº†æ‰å®çš„ç†è§£ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ç¬¬ä¸€æ¬¡çš„æ¸²æŸ“è¿‡ç¨‹ï¼š</p><ul><li><strong>React:</strong> ç»™æˆ‘çŠ¶æ€ä¸º <code>0</code>æ—¶å€™çš„ UIã€‚</li><li><p><strong>ä½ çš„ç»„ä»¶:</strong></p><ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effect: <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li></ul></li><li><strong>React:</strong> æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘è¦ç»™ DOM æ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚</li><li><strong>æµè§ˆå™¨:</strong> é…·ï¼Œæˆ‘å·²ç»æŠŠå®ƒç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li><p><strong>React:</strong> å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œç»™æˆ‘çš„ effect</p><ul><li>è¿è¡Œ <code>() =&gt; { document.title = &#39;You clicked 0 times&#39; }</code>ã€‚</li></ul></li></ul><p>ç°åœ¨æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬ç‚¹å‡»ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><ul><li><strong>ä½ çš„ç»„ä»¶:</strong> å–‚ React, æŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º<code>1</code>ã€‚</li><li><strong>React:</strong> ç»™æˆ‘çŠ¶æ€ä¸º <code>1</code>æ—¶å€™çš„ UIã€‚</li><li><p><strong>ä½ çš„ç»„ä»¶:</strong></p><ul><li>ç»™ä½ éœ€è¦æ¸²æŸ“çš„å†…å®¹: <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code>ã€‚</li><li>è®°å¾—åœ¨æ¸²æŸ“å®Œäº†ä¹‹åè°ƒç”¨è¿™ä¸ª effectï¼š <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li></ul></li><li><strong>React:</strong> æ²¡é—®é¢˜ã€‚å¼€å§‹æ›´æ–° UIï¼Œå–‚æµè§ˆå™¨ï¼Œæˆ‘ä¿®æ”¹äº† DOMã€‚</li><li><strong>Browser:</strong> é…·ï¼Œæˆ‘å·²ç»å°†æ›´æ”¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šäº†ã€‚</li><li><p><strong>React:</strong> å¥½çš„ï¼Œ æˆ‘ç°åœ¨å¼€å§‹è¿è¡Œå±äºè¿™æ¬¡æ¸²æŸ“çš„ effect</p><ul><li>è¿è¡Œ <code>() =&gt; { document.title = &#39;You clicked 1 times&#39; }</code>ã€‚</li></ul></li></ul><h2 id="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦-æ‰€æœ‰"><a href="#æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦-æ‰€æœ‰" class="headerlink" title="æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦ æ‰€æœ‰"></a><a href="#%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%B8%B2%E6%9F%93%E9%83%BD%E6%9C%89%E5%AE%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%89%80%E6%9C%89"></a>æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±çš„â€¦ æ‰€æœ‰</h2><p><strong>æˆ‘ä»¬ç°åœ¨çŸ¥é“ effects ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œï¼Œå¹¶ä¸”æ¦‚å¿µä¸Šå®ƒæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ â€œçœ‹åˆ°â€ å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„ props å’Œ stateã€‚</strong></p><p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæ€æƒ³å®éªŒï¼Œæ€è€ƒä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;    setTimeout(() =&gt; &#123;      console.log(`You clicked $&#123;count&#125; times`);    &#125;, 3000);  &#125;);</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ç‚¹å‡»äº†å¾ˆå¤šæ¬¡å¹¶ä¸”åœ¨ effect é‡Œè®¾ç½®äº†å»¶æ—¶ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><em>å‰§é€é¢„è­¦</em></p><p>ä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆç»•çš„é¢˜å¹¶ä¸”ç»“æœæ˜¯åç›´è§‰çš„ã€‚å®Œå…¨é”™äº†ï¼æˆ‘ä»¬çœ‹åˆ°çš„å°±æ˜¯é¡ºåºçš„æ‰“å°è¾“å‡º â€” æ¯ä¸€ä¸ªéƒ½å±äºæŸæ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤æœ‰å®ƒè¯¥æœ‰çš„<code>count</code>å€¼ã€‚ä½ å¯ä»¥<a href="https://codesandbox.io/s/lyx20m1ol" target="_blank" rel="noopener">è‡ªå·±è¯•ä¸€è¯•</a>ï¼š</p><p><img src="https://overreacted.io/timeout_counter-a5727d333c270e05942f508707265378.gif" alt=""></p><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå®ƒå½“ç„¶åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚å¦åˆ™è¿˜ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿâ€</p><p>ä¸è¿‡ï¼Œclass ä¸­çš„<code>this.state</code>å¹¶ä¸æ˜¯è¿™æ ·è¿ä½œçš„ã€‚ä½ å¯èƒ½ä¼šæƒ³å½“ç„¶ä»¥ä¸ºä¸‹é¢çš„ <a href="https://codesandbox.io/s/kkymzwjqz3" target="_blank" rel="noopener">class å®ç°</a>å’Œä¸Šé¢æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate() &#123;</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(`You clicked $&#123;this.state.count&#125; times`);</span><br><span class="line">  &#125;, 3000);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œ<code>this.state.count</code>æ€»æ˜¯æŒ‡å‘_æœ€æ–°_çš„ count å€¼ï¼Œè€Œä¸æ˜¯å±äºæŸæ¬¡ç‰¹å®šæ¸²æŸ“çš„å€¼ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ‰“å°è¾“å‡ºéƒ½æ˜¯<code>5</code>ï¼š</p><p><img src="https://overreacted.io/timeout_counter_class-264b329edc111a1973003bdf2bcacd65.gif" alt=""></p><p>æˆ‘è§‰å¾— Hooks è¿™ä¹ˆä¾èµ– Javascript é—­åŒ…æ˜¯æŒºè®½åˆºçš„ä¸€ä»¶äº‹ã€‚æœ‰æ—¶å€™ç»„ä»¶çš„ class å®ç°æ–¹å¼ä¼šå—é—­åŒ…ç›¸å…³çš„è‹¦ï¼ˆ<a href="https://wsvincent.com/javascript-closure-settimeout-for-loop/" target="_blank" rel="noopener">the canonical wrong-value-in-a-timeout confusion</a>ï¼‰ï¼Œä½†å…¶å®è¿™ä¸ªä¾‹å­ä¸­çœŸæ­£çš„æ··ä¹±æ¥æºæ˜¯å¯å˜æ•°æ®ï¼ˆReact ä¿®æ”¹äº† class ä¸­çš„<code>this.state</code>ä½¿å…¶æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰ï¼Œå¹¶ä¸æ˜¯é—­åŒ…æœ¬èº«çš„é”™ã€‚</p><p><strong>å½“å°é—­çš„å€¼å§‹ç»ˆä¸ä¼šå˜çš„æƒ…å†µä¸‹é—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å®ƒä»¬éå¸¸å®¹æ˜“æ€è€ƒå› ä¸ºä½ æœ¬è´¨ä¸Šåœ¨å¼•ç”¨å¸¸é‡ã€‚</strong>æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œprops å’Œ state åœ¨æŸä¸ªç‰¹å®šæ¸²æŸ“ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://codesandbox.io/s/w7vjo07055" target="_blank" rel="noopener">ä½¿ç”¨é—­åŒ…</a>ä¿®å¤ä¸Šé¢çš„ class ç‰ˆæœ¬â€¦</p><h2 id="é€†æ½®è€ŒåŠ¨"><a href="#é€†æ½®è€ŒåŠ¨" class="headerlink" title="é€†æ½®è€ŒåŠ¨"></a><a href="#%E9%80%86%E6%BD%AE%E8%80%8C%E5%8A%A8"></a>é€†æ½®è€ŒåŠ¨</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°å–Šå‡ºä¸‹é¢é‡è¦çš„äº‹å®ï¼š<strong>æ¯ä¸€ä¸ª</strong>ç»„ä»¶å†…çš„å‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·æŸæ¬¡æ¸²æŸ“ä¸­å®šä¹‰çš„ props å’Œ stateã€‚</p><p>æ‰€ä»¥ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­æ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(props.counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example(props) &#123;</span><br><span class="line">  const counter = props.counter;  useEffect(() =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      console.log(counter);    &#125;, 1000);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ç»„ä»¶å†…ä»€ä¹ˆæ—¶å€™å»è¯»å– props æˆ–è€… state æ˜¯æ— å…³ç´§è¦çš„ã€‚</strong>å› ä¸ºå®ƒä»¬ä¸ä¼šæ”¹å˜ã€‚åœ¨å•æ¬¡æ¸²æŸ“çš„èŒƒå›´å†…ï¼Œprops å’Œ state å§‹ç»ˆä¿æŒä¸å˜ã€‚ï¼ˆè§£æ„èµ‹å€¼çš„ props ä½¿å¾—è¿™ä¸€ç‚¹æ›´æ˜æ˜¾ã€‚ï¼‰</p><p>å½“ç„¶ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½_æƒ³_åœ¨ effect çš„å›è°ƒå‡½æ•°é‡Œè¯»å–æœ€æ–°çš„å€¼è€Œä¸æ˜¯æ•è·çš„å€¼ã€‚æœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨ refsï¼Œ<a href="https://overreacted.io/how-are-function-components-different-from-classes/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>çš„æœ€åä¸€éƒ¨åˆ†ä»‹ç»äº†ç›¸å…³å†…å®¹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ æƒ³è¦ä»_è¿‡å»<em>æ¸²æŸ“ä¸­çš„å‡½æ•°é‡Œè¯»å–</em>æœªæ¥<em>çš„ props å’Œ stateï¼Œä½ æ˜¯åœ¨é€†æ½®è€ŒåŠ¨ã€‚è™½ç„¶å®ƒå¹¶æ²¡æœ‰</em>é”™_ï¼ˆæœ‰æ—¶å€™å¯èƒ½ä¹Ÿéœ€è¦è¿™æ ·åšï¼‰ï¼Œä½†å®ƒå› ä¸ºæ‰“ç ´äº†é»˜è®¤èŒƒå¼ä¼šä½¿ä»£ç æ˜¾å¾—ä¸å¤Ÿ â€œå¹²å‡€â€ã€‚è¿™æ˜¯æˆ‘ä»¬æœ‰æ„ä¸ºä¹‹çš„ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©çªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œæ˜¯éœ€è¦ä¾èµ–æ—¶é—´æ¬¡åºçš„ã€‚åœ¨ class ä¸­ï¼Œå¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µå°±æ²¡é‚£ä¹ˆæ˜¾è€Œæ˜“è§äº†ã€‚</p><p>ä¸‹é¢è¿™ä¸ª<a href="https://codesandbox.io/s/rm7z22qnlp" target="_blank" rel="noopener">è®¡æ•°å™¨ç‰ˆæœ¬</a> æ¨¡æ‹Ÿäº† class ä¸­çš„è¡Œä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const latestCount = useRef(count);</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        latestCount.current = count;    setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(`You clicked $&#123;latestCount.current&#125; times`);    &#125;, 3000);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/timeout_counter_refs-78f7948263dd13b023498b23cb99f4fc.gif" alt=""></p><p>åœ¨ React ä¸­å»ç›´æ¥ä¿®æ”¹å€¼çœ‹ä¸Šå»æœ‰ç‚¹æ€ªå¼‚ã€‚ç„¶è€Œï¼Œåœ¨ class ç»„ä»¶ä¸­ React æ­£æ˜¯è¿™æ ·å»ä¿®æ”¹<code>this.state</code>çš„ã€‚ä¸åƒæ•è·çš„ props å’Œ stateï¼Œä½ æ²¡æ³•ä¿è¯åœ¨ä»»æ„ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­è¯»å–çš„<code>latestCount.current</code>æ˜¯ä¸å˜çš„ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶ä¿®æ”¹å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤è¡Œä¸ºï¼Œè€Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨é€‰æ‹©è¿™æ ·åšã€‚</p><h2 id="é‚£-Effect-ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ"><a href="#é‚£-Effect-ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ Effect ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ"></a><a href="#%E9%82%A3effect%E4%B8%AD%E7%9A%84%E6%B8%85%E7%90%86%E5%8F%88%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%E5%91%A2%EF%BC%9F"></a>é‚£ Effect ä¸­çš„æ¸…ç†åˆæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</h2><p>åƒ <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank" rel="noopener">æ–‡æ¡£ä¸­è§£é‡Šçš„</a>, æœ‰äº› effects å¯èƒ½éœ€è¦æœ‰ä¸€ä¸ªæ¸…ç†æ­¥éª¤ã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯æ¶ˆé™¤å‰¯ä½œç”¨ï¼ˆeffect)ï¼Œæ¯”å¦‚å–æ¶ˆè®¢é˜…ã€‚</p><p>æ€è€ƒä¸‹é¢çš„ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å‡è®¾ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™<code>props</code>æ˜¯<code>{id: 10}</code>ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯<code>{id: 20}</code>ã€‚ä½ _å¯èƒ½_ä¼šè®¤ä¸ºå‘ç”Ÿäº†ä¸‹é¢çš„è¿™äº›äº‹ï¼š</p><ul><li>React æ¸…é™¤äº† <code>{id: 10}</code>çš„ effectã€‚</li><li>React æ¸²æŸ“<code>{id: 20}</code>çš„ UIã€‚</li><li>React è¿è¡Œ<code>{id: 20}</code>çš„ effectã€‚</li></ul><p>(äº‹å®å¹¶ä¸æ˜¯è¿™æ ·ã€‚)</p><p>å¦‚æœä¾èµ–è¿™ç§å¿ƒæ™ºæ¨¡å‹ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºæ¸…é™¤è¿‡ç¨‹ â€œçœ‹åˆ°â€ çš„æ˜¯æ—§çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œçš„ï¼Œæ–°çš„ effectâ€œçœ‹åˆ°â€çš„æ˜¯æ–°çš„ props å› ä¸ºå®ƒæ˜¯åœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œçš„ã€‚è¿™ç§å¿ƒæ™ºæ¨¡å‹ç›´æ¥æ¥æºäº class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡<strong>å®ƒå¹¶ä¸ç²¾ç¡®</strong>ã€‚è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><p>React åªä¼šåœ¨<a href="https://medium.com/@dan_abramov/this-benchmark-is-indeed-flawed-c3d6b5b6f97f" target="_blank" rel="noopener">æµè§ˆå™¨ç»˜åˆ¶</a>åè¿è¡Œ effectsã€‚è¿™ä½¿å¾—ä½ çš„åº”ç”¨æ›´æµç•…å› ä¸ºå¤§å¤šæ•° effects å¹¶ä¸ä¼šé˜»å¡å±å¹•çš„æ›´æ–°ã€‚Effect çš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚<strong>ä¸Šä¸€æ¬¡çš„ effect ä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ï¼š</strong></p><ul><li><strong>React æ¸²æŸ“<code>{id: 20}</code>çš„ UIã€‚</strong></li><li>æµè§ˆå™¨ç»˜åˆ¶ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°<code>{id: 20}</code>çš„ UIã€‚</li><li><strong>React æ¸…é™¤<code>{id: 10}</code>çš„ effectã€‚</strong></li><li>React è¿è¡Œ<code>{id: 20}</code>çš„ effectã€‚</li></ul><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼šå¦‚æœæ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect å‘ç”Ÿåœ¨ props å˜æˆ<code>{id: 20}</code>ä¹‹åï¼Œé‚£å®ƒä¸ºä»€ä¹ˆè¿˜èƒ½ â€œçœ‹åˆ°â€ æ—§çš„<code>{id: 10}</code>ï¼Ÿ</p><p>ä½ æ›¾ç»æ¥è¿‡è¿™é‡Œâ€¦ ğŸ¤”</p><p><img src="https://overreacted.io/deja_vu-5fe238cf03a21dfa32af624124fcdcff.gif" alt=""></p><p>å¼•ç”¨ä¸ŠåŠéƒ¨åˆ†å¾—åˆ°çš„ç»“è®º:</p><blockquote><p>ç»„ä»¶å†…çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffectsï¼Œå®šæ—¶å™¨æˆ–è€… API è°ƒç”¨ç­‰ç­‰ï¼‰ä¼šæ•è·å®šä¹‰å®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å’Œ stateã€‚</p></blockquote><p>ç°åœ¨ç­”æ¡ˆæ˜¾è€Œæ˜“è§ã€‚effect çš„æ¸…é™¤å¹¶ä¸ä¼šè¯»å– â€œæœ€æ–°â€ çš„ propsã€‚å®ƒåªèƒ½è¯»å–åˆ°å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ props å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(10, handleStatusChange);</span><br><span class="line">            return () =&gt; &#123;        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);      &#125;;    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      ChatAPI.subscribeToFriendStatus(20, handleStatusChange);</span><br><span class="line">      </span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‹å›½ä¼šå´›èµ·è½¬è€Œå¤å½’å°˜åœŸï¼Œå¤ªé˜³ä¼šè„±è½å¤–å±‚å˜ä¸ºç™½çŸ®æ˜Ÿï¼Œæœ€åçš„æ–‡æ˜ä¹Ÿè¿Ÿæ—©ä¼šç»“æŸã€‚ä½†æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ effect çš„æ¸…é™¤å‡½æ•°åªèƒ½çœ‹åˆ°<code>{id: 10}</code>è¿™ä¸ª propsã€‚</p><p>è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆ React èƒ½åšåˆ°åœ¨ç»˜åˆ¶åç«‹å³å¤„ç† effects â€” å¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä½¿ä½ çš„åº”ç”¨è¿è¡Œæ›´æµç•…ã€‚å¦‚æœä½ çš„ä»£ç éœ€è¦ä¾ç„¶å¯ä»¥è®¿é—®åˆ°è€çš„ propsã€‚</p><h2 id="åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ"><a href="#åŒæ­¥ï¼Œ-è€Œéç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ"></a><a href="#%E5%90%8C%E6%AD%A5%EF%BC%8C-%E8%80%8C%E9%9D%9E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"></a>åŒæ­¥ï¼Œ è€Œéç”Ÿå‘½å‘¨æœŸ</h2><p>æˆ‘æœ€å–œæ¬¢ React çš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€æè¿°äº†åˆå§‹æ¸²æŸ“å’Œä¹‹åçš„æ›´æ–°ã€‚è¿™é™ä½äº†ä½ ç¨‹åºçš„<a href="https://overreacted.io/the-bug-o-notation/" target="_blank" rel="noopener">ç†µ</a>ã€‚</p><p>æ¯”å¦‚æˆ‘æœ‰ä¸ªç»„ä»¶åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘å…ˆæ¸²æŸ“<code>&lt;Greeting /&gt;</code>ç„¶åæ¸²æŸ“<code>&lt;Greeting /&gt;</code>ï¼Œå’Œæˆ‘ç›´æ¥æ¸²æŸ“<code>&lt;Greeting /&gt;</code>å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸­ï¼Œæˆ‘æœ€åçœ‹åˆ°çš„éƒ½æ˜¯ â€œHello, Yuzhiâ€ã€‚</p><p>äººä»¬æ€»æ˜¯è¯´ï¼šâ€œé‡è¦çš„æ˜¯æ—…è¡Œè¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°â€ã€‚åœ¨ React ä¸–ç•Œä¸­ï¼Œæ°å¥½ç›¸åã€‚<strong>é‡è¦çš„æ˜¯ç›®çš„ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹ã€‚</strong>è¿™å°±æ˜¯ JQuery ä»£ç ä¸­ <code>$.addClass</code> æˆ– <code>$.removeClass</code>è¿™æ ·çš„è°ƒç”¨ï¼ˆè¿‡ç¨‹ï¼‰å’Œ React ä»£ç ä¸­å£°æ˜ CSS ç±»å<em>åº”è¯¥æ˜¯ä»€ä¹ˆ</em>ï¼ˆç›®çš„ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p><strong>React ä¼šæ ¹æ®æˆ‘ä»¬å½“å‰çš„ props å’Œ state åŒæ­¥åˆ° DOMã€‚</strong>â€œmountâ€å’Œ â€œupdateâ€ ä¹‹äºæ¸²æŸ“å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>ä½ åº”è¯¥ä»¥ç›¸åŒçš„æ–¹å¼å»æ€è€ƒ effectsã€‚<strong><code>useEffect</code>ä½¿ä½ èƒ½å¤Ÿæ ¹æ® props å’Œ state _åŒæ­¥_ React tree ä¹‹å¤–çš„ä¸œè¥¿ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;    document.title = &apos;Hello, &apos; + name;  &#125;);  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å’Œå¤§å®¶ç†ŸçŸ¥çš„ <em>mount/update/unmount</em> å¿ƒæ™ºæ¨¡å‹ä¹‹é—´ç»†å¾®çš„åŒºåˆ«ã€‚ç†è§£å’Œå†…åŒ–è¿™ç§åŒºåˆ«æ˜¯éå¸¸é‡è¦çš„ã€‚<strong>å¦‚æœä½ è¯•å›¾å†™ä¸€ä¸ª effect ä¼šæ ¹æ®æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸ä¸€è‡´ï¼Œä½ æ­£åœ¨é€†æ½®è€ŒåŠ¨ã€‚</strong>å¦‚æœæˆ‘ä»¬çš„ç»“æœä¾èµ–äºè¿‡ç¨‹è€Œä¸æ˜¯ç›®çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨åŒæ­¥ä¸­çŠ¯é”™ã€‚</p><p>å…ˆæ¸²æŸ“å±æ€§ Aï¼ŒB å†æ¸²æŸ“ Cï¼Œå’Œç«‹å³æ¸²æŸ“ C å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è™½ç„¶ä»–ä»¬å¯èƒ½çŸ­æš‚åœ°ä¼šæœ‰ç‚¹ä¸åŒï¼ˆæ¯”å¦‚è¯·æ±‚æ•°æ®æ—¶ï¼‰ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p>ä¸è¿‡è¯è¯´å›æ¥ï¼Œåœ¨<em>æ¯ä¸€æ¬¡</em>æ¸²æŸ“åéƒ½å»è¿è¡Œæ‰€æœ‰çš„ effects å¯èƒ½å¹¶ä¸é«˜æ•ˆã€‚ï¼ˆå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚ï¼‰</p><p>æ‰€ä»¥æˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p><h2 id="å‘Šè¯‰-React-å»æ¯”å¯¹ä½ çš„-Effects"><a href="#å‘Šè¯‰-React-å»æ¯”å¯¹ä½ çš„-Effects" class="headerlink" title="å‘Šè¯‰ React å»æ¯”å¯¹ä½ çš„ Effects"></a><a href="#%E5%91%8A%E8%AF%89react%E5%8E%BB%E6%AF%94%E5%AF%B9%E4%BD%A0%E7%9A%84effects"></a>å‘Šè¯‰ React å»æ¯”å¯¹ä½ çš„ Effects</h2><p>å…¶å®æˆ‘ä»¬å·²ç»ä» React å¤„ç† DOM çš„æ–¹å¼ä¸­å­¦ä¹ åˆ°äº†è§£å†³åŠæ³•ã€‚React åªä¼šæ›´æ–° DOM çœŸæ­£å‘ç”Ÿæ”¹å˜çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½å¤§åŠ¨å¹²æˆˆã€‚</p><p>å½“ä½ æŠŠ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Dan</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>æ›´æ–°åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 class&gt;</span><br><span class="line">  Hello, Yuzhi</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>React èƒ½å¤Ÿçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const oldProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Dan&apos;&#125;;</span><br><span class="line">const newProps = &#123;className: &apos;Greeting&apos;, children: &apos;Hello, Yuzhi&apos;&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒä¼šæ£€æµ‹æ¯ä¸€ä¸ª propsï¼Œå¹¶ä¸”å‘ç°<code>children</code>å‘ç”Ÿæ”¹å˜éœ€è¦æ›´æ–° DOMï¼Œä½†<code>className</code>å¹¶æ²¡æœ‰ã€‚æ‰€ä»¥å®ƒåªéœ€è¦è¿™æ ·åšï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domNode.innerText = &apos;Hello, Yuzhi&apos;;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¤„ç† effects å—ï¼Ÿå¦‚æœèƒ½å¤Ÿåœ¨ä¸éœ€è¦çš„æ—¶å€™é¿å…è°ƒç”¨ effect å°±å¤ªå¥½äº†ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½å› ä¸ºçŠ¶æ€å˜æ›´è€Œé‡æ–°æ¸²æŸ“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Greeting(&#123; name &#125;) &#123;</span><br><span class="line">  const [counter, setCounter] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    document.title = &apos;Hello, &apos; + name;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;h1 class&gt;</span><br><span class="line">      Hello, &#123;name&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCounter(counter + 1)&#125;&gt;        Increment      &lt;/button&gt;    &lt;/h1&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬çš„ effect å¹¶æ²¡æœ‰ä½¿ç”¨<code>counter</code>è¿™ä¸ªçŠ¶æ€ã€‚<strong>æˆ‘ä»¬çš„ effect åªä¼šåŒæ­¥<code>name</code>å±æ€§ç»™<code>document.title</code>ï¼Œä½†<code>name</code>å¹¶æ²¡æœ‰å˜ã€‚</strong>åœ¨æ¯ä¸€æ¬¡ counter æ”¹å˜åé‡æ–°ç»™<code>document.title</code>èµ‹å€¼å¹¶ä¸æ˜¯ç†æƒ³çš„åšæ³•ã€‚</p><p>å¥½äº†ï¼Œé‚£ React å¯ä»¥â€¦ åŒºåˆ† effects çš„ä¸åŒå—ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">let newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸èƒ½ã€‚React å¹¶ä¸èƒ½çŒœæµ‹åˆ°å‡½æ•°åšäº†ä»€ä¹ˆå¦‚æœä¸å…ˆè°ƒç”¨çš„è¯ã€‚ï¼ˆæºç ä¸­å¹¶æ²¡æœ‰åŒ…å«ç‰¹æ®Šçš„å€¼ï¼Œå®ƒä»…ä»…æ˜¯å¼•ç”¨äº†<code>name</code>å±æ€§ã€‚ï¼‰</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆä½ å¦‚æœæƒ³è¦é¿å… effects ä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œä½ å¯ä»¥æä¾›ç»™<code>useEffect</code>ä¸€ä¸ªä¾èµ–æ•°ç»„å‚æ•° (deps)ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><strong>è¿™å¥½æ¯”ä½ å‘Šè¯‰ Reactï¼šâ€œHeyï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°é‡Œçš„ä¸œè¥¿ï¼Œä½†æˆ‘å¯ä»¥ä¿è¯åªä½¿ç”¨äº†æ¸²æŸ“ä¸­çš„<code>name</code>ï¼Œåˆ«æ— å…¶ä»–ã€‚â€</strong></p><p>å¦‚æœå½“å‰æ¸²æŸ“ä¸­çš„è¿™äº›ä¾èµ–é¡¹å’Œä¸Šä¸€æ¬¡è¿è¡Œè¿™ä¸ª effect çš„æ—¶å€™å€¼ä¸€æ ·ï¼Œå› ä¸ºæ²¡æœ‰ä»€ä¹ˆéœ€è¦åŒæ­¥ React ä¼šè‡ªåŠ¨è·³è¿‡è¿™æ¬¡ effectï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const oldEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const oldDeps = [&apos;Dan&apos;];</span><br><span class="line"></span><br><span class="line">const newEffect = () =&gt; &#123; document.title = &apos;Hello, Dan&apos;; &#125;;</span><br><span class="line">const newDeps = [&apos;Dan&apos;];</span><br></pre></td></tr></table></figure><p>å³ä½¿ä¾èµ–æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå€¼åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¸­ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è·³è¿‡ effect çš„è¿è¡Œã€‚è¦åŒæ­¥æ‰€æœ‰ï¼</p><h2 id="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹-React-æ’’è°"><a href="#å…³äºä¾èµ–é¡¹ä¸è¦å¯¹-React-æ’’è°" class="headerlink" title="å…³äºä¾èµ–é¡¹ä¸è¦å¯¹ React æ’’è°"></a><a href="#%E5%85%B3%E4%BA%8E%E4%BE%9D%E8%B5%96%E9%A1%B9%E4%B8%8D%E8%A6%81%E5%AF%B9react%E6%92%92%E8%B0%8E"></a>å…³äºä¾èµ–é¡¹ä¸è¦å¯¹ React æ’’è°</h2><p>å…³äºä¾èµ–é¡¹å¯¹ React æ’’è°ä¼šæœ‰ä¸å¥½çš„ç»“æœã€‚ç›´è§‰ä¸Šï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œä½†æˆ‘æ›¾çœ‹åˆ°å‡ ä¹æ‰€æœ‰ä¾èµ– class å¿ƒæ™ºæ¨¡å‹ä½¿ç”¨<code>useEffect</code>çš„äººéƒ½è¯•å›¾è¿åè¿™ä¸ªè§„åˆ™ã€‚ï¼ˆæˆ‘åˆšå¼€å§‹ä¹Ÿè¿™ä¹ˆå¹²äº†ï¼ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>(å®˜ç½‘çš„ <a href="https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies" target="_blank" rel="noopener">Hooks FAQ</a> è§£é‡Šäº†åº”è¯¥æ€ä¹ˆåšã€‚ æˆ‘ä»¬åœ¨<a href="#moving-functions-inside-effects">ä¸‹é¢</a>ä¼šé‡æ–°å›é¡¾è¿™ä¸ªä¾‹å­ã€‚)</em></p><p>â€œä½†æˆ‘åªæ˜¯æƒ³åœ¨æŒ‚è½½çš„æ—¶å€™è¿è¡Œå®ƒï¼â€ï¼Œä½ å¯èƒ½ä¼šè¯´ã€‚ç°åœ¨åªéœ€è¦è®°ä½ï¼šå¦‚æœä½ è®¾ç½®äº†ä¾èµ–é¡¹ï¼Œ<strong>effect ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½è¦åŒ…å«åœ¨ä¾èµ–ä¸­ã€‚</strong>è¿™åŒ…æ‹¬ propsï¼Œstateï¼Œå‡½æ•° â€” ç»„ä»¶å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</p><p>æœ‰æ—¶å€™ä½ æ˜¯è¿™æ ·åšäº†ï¼Œä½†å¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°æ— é™è¯·æ±‚çš„é—®é¢˜ï¼Œæˆ–è€… socket è¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚<strong>è§£å†³é—®é¢˜çš„æ–¹æ³•ä¸æ˜¯ç§»é™¤ä¾èµ–é¡¹ã€‚</strong>æˆ‘ä»¬ä¼šå¾ˆå¿«äº†è§£å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä¸è¿‡åœ¨æˆ‘ä»¬æ·±å…¥è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è¯•æ›´å¥½åœ°ç†è§£é—®é¢˜ã€‚</p><h2 id="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"><a href="#å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ"></a><a href="#%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86%E9%94%99%E8%AF%AF%E7%9A%84%E4%BE%9D%E8%B5%96%E4%BC%9A%E6%80%8E%E4%B9%88%E6%A0%B7%E5%91%A2%EF%BC%9F"></a>å¦‚æœè®¾ç½®äº†é”™è¯¯çš„ä¾èµ–ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</h2><p>å¦‚æœä¾èµ–é¡¹åŒ…å«äº†æ‰€æœ‰ effect ä¸­ä½¿ç”¨åˆ°çš„å€¼ï¼ŒReact å°±èƒ½çŸ¥é“ä½•æ—¶éœ€è¦è¿è¡Œå®ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, [name]);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-correct-fae247cd068eedbd4b62ba50592d2b3d.gif" alt=""></p><p><em>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)</em></p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†<code>[]</code>è®¾ä¸º effect çš„ä¾èµ–ï¼Œæ–°çš„ effect å‡½æ•°ä¸ä¼šè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  document.title = &apos;Hello, &apos; + name;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p><img src="https://overreacted.io/deps-compare-wrong-25f75db3f9f57ffe1426912093577445.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé—®é¢˜çœ‹èµ·æ¥æ˜¾è€Œæ˜“è§ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœä½ è„‘å­é‡Œ â€œè·³å‡ºâ€class ç»„ä»¶çš„è§£å†³åŠæ³•ï¼Œä½ çš„ç›´è§‰å¾ˆå¯èƒ½ä¼šæ¬ºéª—ä½ ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ¯ç§’é€’å¢çš„è®¡æ•°å™¨ã€‚åœ¨ Class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬çš„ç›´è§‰æ˜¯ï¼šâ€œå¼€å¯ä¸€æ¬¡å®šæ—¶å™¨ï¼Œæ¸…é™¤ä¹Ÿæ˜¯ä¸€æ¬¡â€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://codesandbox.io/s/n5mjzjy9kl" target="_blank" rel="noopener">ä¾‹å­</a>è¯´æ˜æ€ä¹ˆå®ç°å®ƒã€‚å½“æˆ‘ä»¬ç†æ‰€å½“ç„¶åœ°æŠŠå®ƒç”¨<code>useEffect</code>çš„æ–¹å¼ç¿»è¯‘ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬ä¼šè®¾ç½®ä¾èµ–ä¸º<code>[]</code>ã€‚â€œæˆ‘åªæƒ³è¿è¡Œä¸€æ¬¡ effectâ€ï¼Œå¯¹å—ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(count + 1);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­<a href="https://codesandbox.io/s/91n5z8jo7r" target="_blank" rel="noopener">åªä¼šé€’å¢ä¸€æ¬¡</a>ã€‚<em>å¤©äº†å™œã€‚</em></p><p>å¦‚æœä½ çš„å¿ƒæ™ºæ¨¡å‹æ˜¯ â€œåªæœ‰å½“æˆ‘æƒ³é‡æ–°è§¦å‘ effect çš„æ—¶å€™æ‰éœ€è¦å»è®¾ç½®ä¾èµ–â€ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½ä¼šè®©ä½ äº§ç”Ÿå­˜åœ¨å±æœºã€‚ä½ æƒ³è¦è§¦å‘ä¸€æ¬¡å› ä¸ºå®ƒæ˜¯å®šæ—¶å™¨ â€” ä½†ä¸ºä»€ä¹ˆä¼šæœ‰é—®é¢˜ï¼Ÿ</p><p>å¦‚æœä½ çŸ¥é“ä¾èµ–æ˜¯æˆ‘ä»¬ç»™ React çš„æš—ç¤ºï¼Œå‘Šè¯‰å®ƒ effect æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„æ¸²æŸ“ä¸­çš„å€¼ï¼Œä½ å°±ä¸ä¼šåƒæƒŠäº†ã€‚effect ä¸­ä½¿ç”¨äº†<code>count</code>ä½†æˆ‘ä»¬æ’’è°è¯´å®ƒæ²¡æœ‰ä¾èµ–ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšè¿Ÿæ—©ä¼šå‡ºå¹ºè›¾å­ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œ<code>count</code>æ˜¯<code>0</code>ã€‚å› æ­¤ï¼Œ<code>setCount(count + 1)</code>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­ç­‰ä»·äº<code>setCount(0 + 1)</code>ã€‚<strong>æ—¢ç„¶æˆ‘ä»¬è®¾ç½®äº†<code>[]</code>ä¾èµ–ï¼Œeffect ä¸ä¼šå†é‡æ–°è¿è¡Œï¼Œå®ƒåé¢æ¯ä¸€ç§’éƒ½ä¼šè°ƒç”¨<code>setCount(0 + 1)</code> ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯¹ React æ’’è°è¯´æˆ‘ä»¬çš„ effect ä¸ä¾èµ–ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œå¯å®é™…ä¸Šæˆ‘ä»¬çš„ effect æœ‰ä¾èµ–ï¼</p><p>æˆ‘ä»¬çš„ effect ä¾èµ–<code>count</code> - å®ƒæ˜¯ç»„ä»¶å†…çš„å€¼ï¼ˆä¸è¿‡åœ¨ effect å¤–é¢å®šä¹‰ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const count = </span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œè®¾ç½®<code>[]</code>ä¸ºä¾èµ–ä¼šå¼•å…¥ä¸€ä¸ª bugã€‚React ä¼šå¯¹æ¯”ä¾èµ–ï¼Œå¹¶ä¸”è·³è¿‡åé¢çš„ effectï¼š</p><p><img src="https://overreacted.io/interval-wrong-29e53bd0c9b7d2ac70d3cd924886b030.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>ç±»ä¼¼äºè¿™æ ·çš„é—®é¢˜æ˜¯å¾ˆéš¾è¢«æƒ³åˆ°çš„ã€‚å› æ­¤ï¼Œæˆ‘é¼“åŠ±ä½ å°†è¯šå®åœ°å‘ŠçŸ¥ effect ä¾èµ–ä½œä¸ºä¸€æ¡ç¡¬æ€§è§„åˆ™ï¼Œå¹¶ä¸”è¦åˆ—å‡ºæ‰€ä»¥ä¾èµ–ã€‚ï¼ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">lint è§„åˆ™</a>å¦‚æœä½ æƒ³åœ¨ä½ çš„å›¢é˜Ÿå†…åšç¡¬æ€§è§„å®šã€‚ï¼‰</p><h2 id="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"><a href="#ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•" class="headerlink" title="ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•"></a><a href="#%E4%B8%A4%E7%A7%8D%E8%AF%9A%E5%AE%9E%E5%91%8A%E7%9F%A5%E4%BE%9D%E8%B5%96%E7%9A%84%E6%96%B9%E6%B3%95"></a>ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„æ–¹æ³•</h2><p>æœ‰ä¸¤ç§è¯šå®å‘ŠçŸ¥ä¾èµ–çš„ç­–ç•¥ã€‚ä½ åº”è¯¥ä»ç¬¬ä¸€ç§å¼€å§‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™åº”ç”¨ç¬¬äºŒç§ã€‚</p><p><strong>ç¬¬ä¸€ç§ç­–ç•¥æ˜¯åœ¨ä¾èµ–ä¸­åŒ…å«æ‰€æœ‰ effect ä¸­ç”¨åˆ°çš„ç»„ä»¶å†…çš„å€¼ã€‚</strong>è®©æˆ‘ä»¬åœ¨ä¾èµ–ä¸­åŒ…å«<code>count</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);  &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>ç°åœ¨ä¾èµ–æ•°ç»„æ­£ç¡®äº†ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯<em>å¤ªç†æƒ³</em>ä½†ç¡®å®è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ç°åœ¨ï¼Œæ¯æ¬¡<code>count</code>ä¿®æ”¹éƒ½ä¼šé‡æ–°è¿è¡Œ effectï¼Œå¹¶ä¸”å®šæ—¶å™¨ä¸­çš„<code>setCount(count + 1)</code>ä¼šæ­£ç¡®å¼•ç”¨æŸæ¬¡æ¸²æŸ“ä¸­çš„ <code>count</code>å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(0 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [0]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function Counter() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(</span><br><span class="line">    </span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      const id = setInterval(() =&gt; &#123;</span><br><span class="line">        setCount(1 + 1);       &#125;, 1000);</span><br><span class="line">      return () =&gt; clearInterval(id);</span><br><span class="line">    &#125;,</span><br><span class="line">    [1]   );</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™èƒ½<a href="https://codesandbox.io/s/0x0mnlyq8l" target="_blank" rel="noopener">è§£å†³é—®é¢˜</a>ä½†æ˜¯æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šåœ¨æ¯ä¸€æ¬¡<code>count</code>æ”¹å˜åæ¸…é™¤å’Œé‡æ–°è®¾å®šã€‚è¿™åº”è¯¥ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š</p><p><img src="https://overreacted.io/interval-rightish-5734271ddfa94d2d65ac6160515e0069.gif" alt=""></p><p><em>(ä¾èµ–å‘ç”Ÿäº†å˜æ›´ï¼Œæ‰€ä»¥ä¼šé‡æ–°è¿è¡Œ effectã€‚)</em></p><p><strong>ç¬¬äºŒç§ç­–ç•¥æ˜¯ä¿®æ”¹ effect å†…éƒ¨çš„ä»£ç ä»¥ç¡®ä¿å®ƒåŒ…å«çš„å€¼åªä¼šåœ¨éœ€è¦çš„æ—¶å€™å‘ç”Ÿå˜æ›´ã€‚</strong>æˆ‘ä»¬ä¸æƒ³å‘ŠçŸ¥é”™è¯¯çš„ä¾èµ– - æˆ‘ä»¬åªæ˜¯ä¿®æ”¹ effect ä½¿å¾—ä¾èµ–æ›´å°‘ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç§»é™¤ä¾èµ–çš„å¸¸ç”¨æŠ€å·§ã€‚</p><h2 id="è®©-Effects-è‡ªç»™è‡ªè¶³"><a href="#è®©-Effects-è‡ªç»™è‡ªè¶³" class="headerlink" title="è®© Effects è‡ªç»™è‡ªè¶³"></a><a href="#%E8%AE%A9effects%E8%87%AA%E7%BB%99%E8%87%AA%E8%B6%B3"></a>è®© Effects è‡ªç»™è‡ªè¶³</h2><p>æˆ‘ä»¬æƒ³å»æ‰ effect çš„<code>count</code>ä¾èµ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(count + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [count]);</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼š<strong>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨<code>count</code>ï¼Ÿ</strong>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªåœ¨<code>setCount</code>è°ƒç”¨ä¸­ç”¨åˆ°äº†<code>count</code>ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦åœ¨ effect ä¸­ä½¿ç”¨<code>count</code>ã€‚å½“æˆ‘ä»¬æƒ³è¦æ ¹æ®å‰ä¸€ä¸ªçŠ¶æ€æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setState</code>çš„<a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" target="_blank" rel="noopener">å‡½æ•°å½¢å¼</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    setCount(c =&gt; c + 1);    &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure><p>æˆ‘å–œæ¬¢æŠŠç±»ä¼¼è¿™ç§æƒ…å†µç§°ä¸º â€œé”™è¯¯çš„ä¾èµ–â€ã€‚æ˜¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ effect ä¸­å†™äº†<code>setCount(count + 1)</code>æ‰€ä»¥<code>count</code>æ˜¯ä¸€ä¸ªå¿…éœ€çš„ä¾èµ–ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯æŠŠ<code>count</code>è½¬æ¢ä¸º<code>count+1</code>ï¼Œç„¶åè¿”å›ç»™ Reactã€‚å¯æ˜¯ React å…¶å®å·²ç»çŸ¥é“å½“å‰çš„<code>count</code>ã€‚<strong>æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥ React çš„ä»…ä»…æ˜¯å»é€’å¢çŠ¶æ€ - ä¸ç®¡å®ƒç°åœ¨å…·ä½“æ˜¯ä»€ä¹ˆå€¼ã€‚</strong></p><p>è¿™æ­£æ˜¯<code>setCount(c =&gt; c + 1)</code>åšçš„äº‹æƒ…ã€‚ä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨ç»™ Reactâ€œå‘é€æŒ‡ä»¤â€å‘ŠçŸ¥å¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚è¿™ç§ â€œæ›´æ–°å½¢å¼â€ åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä½ éœ€è¦<a href="https://overreacted.io/react-as-a-ui-runtime/#batching" target="_blank" rel="noopener">æ‰¹é‡æ›´æ–°</a>ã€‚</p><p><strong>æ³¨æ„æˆ‘ä»¬åšåˆ°äº†ç§»é™¤ä¾èµ–ï¼Œå¹¶ä¸”æ²¡æœ‰æ’’è°ã€‚æˆ‘ä»¬çš„ effect ä¸å†è¯»å–æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</strong></p><p><img src="https://overreacted.io/interval-right-f128ad20c28317ed27a3cb68197fc906.gif" alt=""></p><p><em>(ä¾èµ–æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ä¸ä¼šå†æ¬¡è¿è¡Œ effectã€‚)</em></p><p>ä½ å¯ä»¥è‡ªå·± <a href="https://codesandbox.io/s/q3181xz1pj" target="_blank" rel="noopener">è¯•è¯•</a>ã€‚</p><p>å°½ç®¡ effect åªè¿è¡Œäº†ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸­çš„å®šæ—¶å™¨å›è°ƒå‡½æ•°å¯ä»¥å®Œç¾åœ°åœ¨æ¯æ¬¡è§¦å‘çš„æ—¶å€™ç»™ React å‘é€<code>c =&gt; c + 1</code>æ›´æ–°æŒ‡ä»¤ã€‚å®ƒä¸å†éœ€è¦çŸ¥é“å½“å‰çš„<code>count</code>å€¼ã€‚å› ä¸º React å·²ç»çŸ¥é“äº†ã€‚</p><h2 id="å‡½æ•°å¼æ›´æ–°-å’Œ-Google-Docs"><a href="#å‡½æ•°å¼æ›´æ–°-å’Œ-Google-Docs" class="headerlink" title="å‡½æ•°å¼æ›´æ–° å’Œ Google Docs"></a><a href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%9B%B4%E6%96%B0-%E5%92%8C-google-docs"></a>å‡½æ•°å¼æ›´æ–° å’Œ Google Docs</h2><p>è¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡åŒæ­¥æ‰æ˜¯ç†è§£ effects çš„å¿ƒæ™ºæ¨¡å‹å—ï¼ŸåŒæ­¥çš„ä¸€ä¸ªæœ‰è¶£åœ°æ–¹åœ¨äºä½ é€šå¸¸æƒ³è¦æŠŠåŒæ­¥çš„ â€œä¿¡æ¯â€ å’ŒçŠ¶æ€è§£è€¦ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ åœ¨ Google Docs ç¼–è¾‘æ–‡æ¡£çš„æ—¶å€™ï¼ŒGoogle å¹¶ä¸ä¼šæŠŠæ•´ç¯‡æ–‡ç« å‘é€ç»™æœåŠ¡å™¨ã€‚é‚£æ ·åšä¼šéå¸¸ä½æ•ˆã€‚ç›¸åçš„ï¼Œå®ƒåªæ˜¯æŠŠä½ çš„ä¿®æ”¹ä»¥ä¸€ç§å½¢å¼å‘é€ç»™æœåŠ¡ç«¯ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ effect çš„æƒ…å†µä¸å°½ç›¸åŒï¼Œä½†å¯ä»¥åº”ç”¨ç±»ä¼¼çš„æ€æƒ³ã€‚<strong>åªåœ¨ effects ä¸­ä¼ é€’æœ€å°çš„ä¿¡æ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</strong>ç±»ä¼¼äº<code>setCount(c =&gt; c + 1)</code>è¿™æ ·çš„æ›´æ–°å½¢å¼æ¯”<code>setCount(count + 1)</code>ä¼ é€’äº†æ›´å°‘çš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒä¸å†è¢«å½“å‰çš„ count å€¼ â€œæ±¡æŸ“â€ã€‚å®ƒåªæ˜¯è¡¨è¾¾äº†ä¸€ç§è¡Œä¸ºï¼ˆâ€œé€’å¢â€ï¼‰ã€‚â€œThinking in Reactâ€ ä¹Ÿè®¨è®ºäº†<a href="https://reactjs.org/docs/thinking-in-react.html#step-3-identify-the-minimal-but-complete-representation-of-ui-state" target="_blank" rel="noopener">å¦‚ä½•æ‰¾åˆ°æœ€å°çŠ¶æ€</a>ã€‚åŸåˆ™æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ç°åœ¨å…³æ³¨çš„æ˜¯å¦‚ä½•æ›´æ–°ã€‚</p><p>è¡¨è¾¾_æ„å›¾_ï¼ˆè€Œä¸æ˜¯ç»“æœï¼‰å’Œ Google Docs <a href="https://medium.com/@srijancse/how-real-time-collaborative-editing-work-operational-transformation-ac4902d75682" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†</a>å…±åŒç¼–è¾‘å¼‚æ›²åŒå·¥ã€‚è™½ç„¶è¿™ä¸ªç±»æ¯”ç•¥å¾®å»¶ä¼¸äº†ä¸€ç‚¹ï¼Œå‡½æ•°å¼æ›´æ–°åœ¨ React ä¸­æ‰®æ¼”äº†ç±»ä¼¼çš„è§’è‰²ã€‚å®ƒä»¬ç¡®ä¿èƒ½ä»¥æ‰¹é‡åœ°å’Œå¯é¢„æµ‹çš„æ–¹å¼æ¥å¤„ç†å„ç§æºå¤´ï¼ˆäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œeffect ä¸­çš„è®¢é˜…ï¼Œç­‰ç­‰ï¼‰çš„çŠ¶æ€æ›´æ–°ã€‚</p><p><strong>ç„¶è€Œï¼Œå³ä½¿æ˜¯<code>setCount(c =&gt; c + 1)</code>ä¹Ÿå¹¶ä¸å®Œç¾ã€‚</strong>å®ƒçœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œå¹¶ä¸”éå¸¸å—é™äºå®ƒèƒ½åšçš„äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œæˆ–è€…æˆ‘ä»¬æƒ³åŸºäºä¸€ä¸ª prop æ¥è®¡ç®—ä¸‹ä¸€æ¬¡çš„ stateï¼Œå®ƒå¹¶ä¸èƒ½åšåˆ°ã€‚å¹¸è¿çš„æ˜¯ï¼Œ <code>setCount(c =&gt; c + 1)</code>æœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„å§å¦¹æ¨¡å¼ï¼Œå®ƒçš„åå­—å«<code>useReducer</code>ã€‚</p><h2 id="è§£è€¦æ¥è‡ª-Actions-çš„æ›´æ–°"><a href="#è§£è€¦æ¥è‡ª-Actions-çš„æ›´æ–°" class="headerlink" title="è§£è€¦æ¥è‡ª Actions çš„æ›´æ–°"></a><a href="#%E8%A7%A3%E8%80%A6%E6%9D%A5%E8%87%AAactions%E7%9A%84%E6%9B%B4%E6%96%B0"></a>è§£è€¦æ¥è‡ª Actions çš„æ›´æ–°</h2><p>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­è®©å®ƒåŒ…å«ä¸¤ä¸ªçŠ¶æ€ï¼š<code>count</code> å’Œ <code>step</code>ã€‚æˆ‘ä»¬çš„å®šæ—¶å™¨ä¼šæ¯æ¬¡åœ¨ count ä¸Šå¢åŠ ä¸€ä¸ª<code>step</code>å€¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  const [step, setStep] = useState(1);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      setCount(c =&gt; c + step);    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [step]);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;</span><br><span class="line">      &lt;input value=&#123;step&#125; onChange=&#123;e =&gt; setStep(Number(e.target.value))&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/zxn70rnkx" target="_blank" rel="noopener">demo</a>.)</p><p>æ³¨æ„<strong>æˆ‘ä»¬æ²¡æœ‰æ’’è°</strong>ã€‚æ—¢ç„¶æˆ‘ä»¬åœ¨ effect é‡Œä½¿ç”¨äº†<code>step</code>ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒåŠ åˆ°ä¾èµ–é‡Œã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»£ç èƒ½è¿è¡Œæ­£ç¡®ã€‚</p><p>è¿™ä¸ªä¾‹å­ç›®å‰çš„è¡Œä¸ºæ˜¯ä¿®æ”¹<code>step</code>ä¼šé‡å¯å®šæ—¶å™¨ - å› ä¸ºå®ƒæ˜¯ä¾èµ–é¡¹ä¹‹ä¸€ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œè¿™æ­£æ˜¯ä½ æ‰€éœ€è¦çš„ã€‚æ¸…é™¤ä¸Šä¸€æ¬¡çš„ effect ç„¶åé‡æ–°è¿è¡Œæ–°çš„ effect å¹¶æ²¡æœ‰ä»»ä½•é”™ã€‚é™¤éæˆ‘ä»¬æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ”¹å˜è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚</p><p>ä¸è¿‡ï¼Œå‡å¦‚æˆ‘ä»¬ä¸æƒ³åœ¨<code>step</code>æ”¹å˜åé‡å¯å®šæ—¶å™¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä» effect ä¸­ç§»é™¤å¯¹<code>step</code>çš„ä¾èµ–å‘¢ï¼Ÿ</p><p><strong>å½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªçŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç”¨<code>useReducer</code>å»æ›¿æ¢å®ƒä»¬ã€‚</strong></p><p>å½“ä½ å†™ç±»ä¼¼<code>setSomething(something =&gt; ...)</code>è¿™ç§ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿè®¸å°±æ˜¯è€ƒè™‘ä½¿ç”¨ reducer çš„å¥‘æœºã€‚reducer å¯ä»¥è®©ä½ <strong>æŠŠç»„ä»¶å†…å‘ç”Ÿäº†ä»€ä¹ˆ (actions) å’ŒçŠ¶æ€å¦‚ä½•å“åº”å¹¶æ›´æ–°åˆ†å¼€è¡¨è¿°ã€‚</strong></p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ª<code>dispatch</code>ä¾èµ–å»æ›¿æ¢ effect çš„<code>step</code>ä¾èµ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const [state, dispatch] = useReducer(reducer, initialState);const &#123; count, step &#125; = state;</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    dispatch(&#123; type: &apos;tick&apos; &#125;);   &#125;, 1000);</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [dispatch]);</span><br></pre></td></tr></table></figure><p>(æŸ¥çœ‹ <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a>ã€‚)</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œè¿™æ€ä¹ˆå°±æ›´å¥½äº†ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ <strong>React ä¼šä¿è¯<code>dispatch</code>åœ¨ç»„ä»¶çš„å£°æ˜å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚æ‰€ä»¥ä¸Šé¢ä¾‹å­ä¸­ä¸å†éœ€è¦é‡æ–°è®¢é˜…å®šæ—¶å™¨ã€‚</strong></p><p>æˆ‘ä»¬è§£å†³äº†é—®é¢˜!</p><p><em>ï¼ˆä½ å¯ä»¥ä»ä¾èµ–ä¸­å»é™¤<code>dispatch</code>, <code>setState</code>, å’Œ<code>useRef</code>åŒ…è£¹çš„å€¼å› ä¸º React ä¼šç¡®ä¿å®ƒä»¬æ˜¯é™æ€çš„ã€‚ä¸è¿‡ä½ è®¾ç½®äº†å®ƒä»¬ä½œä¸ºä¾èµ–ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ï¼‰</em></p><p>ç›¸æ¯”äºç›´æ¥åœ¨ effect é‡Œé¢è¯»å–çŠ¶æ€ï¼Œå®ƒ dispatch äº†ä¸€ä¸ª <em>action</em> æ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ effect å’Œ<code>step</code>çŠ¶æ€è§£è€¦ã€‚æˆ‘ä»¬çš„ effect ä¸å†å…³å¿ƒæ€ä¹ˆæ›´æ–°çŠ¶æ€ï¼Œå®ƒåªè´Ÿè´£å‘Šè¯‰æˆ‘ä»¬å‘ç”Ÿäº†ä»€ä¹ˆã€‚æ›´æ–°çš„é€»è¾‘å…¨éƒ½äº¤ç”± reducer å»ç»Ÿä¸€å¤„ç†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">  step: 1,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function reducer(state, action) &#123;</span><br><span class="line">  const &#123; count, step &#125; = state;</span><br><span class="line">  if (action.type === &apos;tick&apos;) &#123;    return &#123; count: count + step, step &#125;;  &#125; else if (action.type === &apos;step&apos;) &#123;</span><br><span class="line">    return &#123; count, step: action.step &#125;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    throw new Error();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/xzr480k0np" target="_blank" rel="noopener">demo</a> å¦‚æœä½ ä¹‹å‰é”™è¿‡äº†ã€‚)</p><h2 id="ä¸ºä»€ä¹ˆ-useReducer-æ˜¯-Hooks-çš„ä½œå¼Šæ¨¡å¼"><a href="#ä¸ºä»€ä¹ˆ-useReducer-æ˜¯-Hooks-çš„ä½œå¼Šæ¨¡å¼" class="headerlink" title="ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼"></a><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88usereducer%E6%98%AFhooks%E7%9A%84%E4%BD%9C%E5%BC%8A%E6%A8%A1%E5%BC%8F"></a>ä¸ºä»€ä¹ˆ useReducer æ˜¯ Hooks çš„ä½œå¼Šæ¨¡å¼</h2><p>æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°å¦‚ä½•ç§»é™¤ effect çš„ä¾èµ–ï¼Œä¸ç®¡çŠ¶æ€æ›´æ–°æ˜¯ä¾èµ–ä¸Šä¸€ä¸ªçŠ¶æ€è¿˜æ˜¯ä¾èµ–å¦ä¸€ä¸ªçŠ¶æ€ã€‚<strong>ä½†å‡å¦‚æˆ‘ä»¬éœ€è¦ä¾èµ– <em>props</em> å»è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€å‘¢ï¼Ÿ</strong>ä¸¾ä¸ªä¾‹å­ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„ API æ˜¯<code>&lt;Counter step={1} /&gt;</code>ã€‚ç¡®å®šçš„æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æ³•é¿å…ä¾èµ–<code>props.step</code> ã€‚æ˜¯å—ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ æˆ‘ä»¬å¯ä»¥é¿å…ï¼æˆ‘ä»¬å¯ä»¥æŠŠ <em>reducer</em> å‡½æ•°æ”¾åˆ°ç»„ä»¶å†…å»è¯»å– propsï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function Counter(&#123; step &#125;) &#123;  const [count, dispatch] = useReducer(reducer, 0);</span><br><span class="line"></span><br><span class="line">  function reducer(state, action) &#123;</span><br><span class="line">    if (action.type === &apos;tick&apos;) &#123;</span><br><span class="line">      return state + step;    &#125; else &#123;</span><br><span class="line">      throw new Error();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const id = setInterval(() =&gt; &#123;</span><br><span class="line">      dispatch(&#123; type: &apos;tick&apos; &#125;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">    return () =&gt; clearInterval(id);</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  return &lt;h1&gt;&#123;count&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ¨¡å¼ä¼šä½¿ä¸€äº›ä¼˜åŒ–å¤±æ•ˆï¼Œæ‰€ä»¥ä½ åº”è¯¥é¿å…æ»¥ç”¨å®ƒï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦ä½ å®Œå…¨å¯ä»¥åœ¨ reducer é‡Œé¢è®¿é—® propsã€‚ï¼ˆè¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/7ypm405o8q" target="_blank" rel="noopener">demo</a>ã€‚ï¼‰</p><p><strong>å³ä½¿æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒReact ä¹Ÿä¿è¯<code>dispatch</code>åœ¨æ¯æ¬¡æ¸²æŸ“ä¸­éƒ½æ˜¯ä¸€æ ·çš„ã€‚</strong> æ‰€ä»¥ä½ å¯ä»¥åœ¨ä¾èµ–ä¸­å»æ‰å®ƒã€‚å®ƒä¸ä¼šå¼•èµ· effect ä¸å¿…è¦çš„é‡å¤æ‰§è¡Œã€‚</p><p>ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿåœ¨ä¹‹å‰æ¸²æŸ“ä¸­è°ƒç”¨çš„ reducer æ€ä¹ˆ â€œçŸ¥é“â€ æ–°çš„ propsï¼Ÿç­”æ¡ˆæ˜¯å½“ä½ <code>dispatch</code>çš„æ—¶å€™ï¼ŒReact åªæ˜¯è®°ä½äº† action - å®ƒä¼šåœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­å†æ¬¡è°ƒç”¨ reducerã€‚åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæ–°çš„ props å°±å¯ä»¥è¢«è®¿é—®åˆ°ï¼Œè€Œä¸” reducer è°ƒç”¨ä¹Ÿä¸æ˜¯åœ¨ effect é‡Œã€‚</p><p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘å€¾å‘è®¤ä¸º<code>useReducer</code>æ˜¯ Hooks çš„ â€œä½œå¼Šæ¨¡å¼â€ã€‚å®ƒå¯ä»¥æŠŠæ›´æ–°é€»è¾‘å’Œæè¿°å‘ç”Ÿäº†ä»€ä¹ˆåˆ†å¼€ã€‚ç»“æœæ˜¯ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ç§»é™¤ä¸å¿…éœ€çš„ä¾èµ–ï¼Œé¿å…ä¸å¿…è¦çš„ effect è°ƒç”¨ã€‚</strong></p><h2 id="æŠŠå‡½æ•°ç§»åˆ°-Effects-é‡Œ"><a href="#æŠŠå‡½æ•°ç§»åˆ°-Effects-é‡Œ" class="headerlink" title="æŠŠå‡½æ•°ç§»åˆ° Effects é‡Œ"></a><a href="#%E6%8A%8A%E5%87%BD%E6%95%B0%E7%A7%BB%E5%88%B0effects%E9%87%8C"></a>æŠŠå‡½æ•°ç§»åˆ° Effects é‡Œ</h2><p>ä¸€ä¸ªå…¸å‹çš„è¯¯è§£æ˜¯è®¤ä¸ºå‡½æ•°ä¸åº”è¯¥æˆä¸ºä¾èµ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç çœ‹ä¸Šå»å¯ä»¥è¿è¡Œæ­£å¸¸ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [data, setData] = useState(&#123; hits: [] &#125;);</span><br><span class="line"></span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(</span><br><span class="line">      &apos;https://hn.algolia.com/api/v1/search?query=react&apos;,</span><br><span class="line">    );</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br></pre></td></tr></table></figure><p><em>(<a href="https://codesandbox.io/s/8j4ykjyv0" target="_blank" rel="noopener">è¿™ä¸ªä¾‹å­</a> æ”¹ç¼–è‡ª Robin Wieruch è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç«  â€” <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹</a>ï¼)</em></p><p>éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ­£å¸¸å·¥ä½œã€‚<strong>ä½†è¿™æ ·åšåœ¨ç»„ä»¶æ—¥æ¸å¤æ‚çš„è¿­ä»£è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆéš¾ç¡®ä¿å®ƒåœ¨å„ç§æƒ…å†µä¸‹è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚</strong></p><p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç åšä¸‹é¢è¿™æ ·çš„åˆ†ç¦»ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‡½æ•°çš„ä½“é‡æ˜¯ç°åœ¨çš„äº”å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨æŸäº›å‡½æ•°å†…ä½¿ç”¨äº†æŸäº› state æˆ–è€… propï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  function getFetchUrl() &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  async function fetchData() &#123;</span><br><span class="line">    const result = await axios(getFetchUrl());</span><br><span class="line">    setData(result.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¿˜è®°å»æ›´æ–°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼ˆå¾ˆå¯èƒ½é€šè¿‡å…¶ä»–å‡½æ•°è°ƒç”¨ï¼‰çš„ effects çš„ä¾èµ–ï¼Œæˆ‘ä»¬çš„ effects å°±ä¸ä¼šåŒæ­¥ props å’Œ state å¸¦æ¥çš„å˜æ›´ã€‚è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚<strong>å¦‚æœæŸäº›å‡½æ•°ä»…åœ¨ effect ä¸­è°ƒç”¨ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬çš„å®šä¹‰ç§»åˆ° effect ä¸­ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">        function getFetchUrl() &#123;      return &apos;https://hn.algolia.com/api/v1/search?query=react&apos;;    &#125;    async function fetchData() &#123;      const result = await axios(getFetchUrl());      setData(result.data);    &#125;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, []); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(<a href="https://codesandbox.io/s/04kp3jwwql" target="_blank" rel="noopener">è¿™é‡Œæ˜¯ demo</a>.)</p><p>è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæˆ‘ä»¬ä¸å†éœ€è¦å»è€ƒè™‘è¿™äº› â€œé—´æ¥ä¾èµ–â€ã€‚æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¹Ÿä¸å†æ’’è°ï¼š<strong>åœ¨æˆ‘ä»¬çš„ effect ä¸­ç¡®å®æ²¡æœ‰å†ä½¿ç”¨ç»„ä»¶èŒƒå›´å†…çš„ä»»ä½•ä¸œè¥¿ã€‚</strong></p><p>å¦‚æœæˆ‘ä»¬åé¢ä¿®æ”¹ <code>getFetchUrl</code>å»ä½¿ç”¨<code>query</code>çŠ¶æ€ï¼Œæˆ‘ä»¬æ›´å¯èƒ½ä¼šæ„è¯†åˆ°æˆ‘ä»¬æ­£åœ¨ effect é‡Œé¢ç¼–è¾‘å®ƒ - å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>query</code>æ·»åŠ åˆ° effect çš„ä¾èµ–é‡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    function getFetchUrl() &#123;</span><br><span class="line">      return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;    &#125;</span><br><span class="line"></span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const result = await axios(getFetchUrl());</span><br><span class="line">      setData(result.data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line">  &#125;, [query]); </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(è¿™é‡Œæ˜¯ <a href="https://codesandbox.io/s/pwm32zx7z7" target="_blank" rel="noopener">demo</a>.)</p><p>æ·»åŠ è¿™ä¸ªä¾èµ–ï¼Œæˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨ â€œå–æ‚¦ Reactâ€ã€‚åœ¨ query æ”¹å˜åå»é‡æ–°è¯·æ±‚æ•°æ®æ˜¯åˆç†çš„ã€‚<code>useEffect</code>çš„è®¾è®¡æ„å›¾å°±æ˜¯è¦å¼ºè¿«ä½ å…³æ³¨æ•°æ®æµçš„æ”¹å˜ï¼Œç„¶åå†³å®šæˆ‘ä»¬çš„ effects è¯¥å¦‚ä½•å’Œå®ƒåŒæ­¥ - è€Œä¸æ˜¯å¿½è§†å®ƒç›´åˆ°æˆ‘ä»¬çš„ç”¨æˆ·é‡åˆ°äº† bugã€‚</p><p>æ„Ÿè°¢<code>eslint-plugin-react-hooks</code> æ’ä»¶çš„<code>exhaustive-deps</code>lint è§„åˆ™ï¼Œå®ƒä¼šåœ¨ä½ <a href="https://github.com/facebook/react/issues/14920" target="_blank" rel="noopener">ç¼–ç çš„æ—¶å€™å°±åˆ†æ effects</a> å¹¶ä¸”æä¾›å¯èƒ½é—æ¼ä¾èµ–çš„å»ºè®®ã€‚æ¢å¥è¯è¯´ï¼Œæœºå™¨ä¼šå‘Šè¯‰ä½ ç»„ä»¶ä¸­å“ªäº›æ•°æ®æµå˜æ›´æ²¡æœ‰è¢«æ­£ç¡®åœ°å¤„ç†ã€‚</p><p><img src="https://overreacted.io/exhaustive-deps-04a90dcbacb01105d634964880ebed19.gif" alt=""></p><p>éå¸¸æ£’ã€‚</p><h2 id="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°-Effect-é‡Œ"><a href="#ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ°-Effect-é‡Œ" class="headerlink" title="ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ° Effect é‡Œ"></a><a href="#%E4%BD%86%E6%88%91%E4%B8%8D%E8%83%BD%E6%8A%8A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%94%BE%E5%88%B0effect%E9%87%8C"></a>ä½†æˆ‘ä¸èƒ½æŠŠè¿™ä¸ªå‡½æ•°æ”¾åˆ° Effect é‡Œ</h2><p>æœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³æŠŠå‡½æ•°ç§»å…¥ effect é‡Œã€‚æ¯”å¦‚ï¼Œç»„ä»¶å†…æœ‰å‡ ä¸ª effect ä½¿ç”¨äº†ç›¸åŒçš„å‡½æ•°ï¼Œä½ ä¸æƒ³åœ¨æ¯ä¸ª effect é‡Œå¤åˆ¶é»è´´ä¸€éè¿™ä¸ªé€»è¾‘ã€‚ä¹Ÿæˆ–è®¸è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª propã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ä½ åº”è¯¥å¿½ç•¥å¯¹å‡½æ•°çš„ä¾èµ–å—ï¼Ÿæˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚å†æ¬¡å¼ºè°ƒï¼Œ<strong>efffects ä¸åº”è¯¥å¯¹å®ƒçš„ä¾èµ–æ’’è°ã€‚</strong>é€šå¸¸æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•ã€‚ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯ï¼Œâ€œå‡½æ•°ä»æ¥ä¸ä¼šæ”¹å˜â€ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä½ è¯»åˆ°ç°åœ¨ï¼Œä½ çŸ¥é“è¿™æ˜¾ç„¶ä¸æ˜¯äº‹å®ã€‚å®é™…ä¸Šï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½åœ¨å˜ã€‚</p><p><strong>å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¹å˜è¿™ä¸ªäº‹å®æœ¬èº«å°±æ˜¯ä¸ªé—®é¢˜ã€‚</strong> æ¯”å¦‚æœ‰ä¸¤ä¸ª effects ä¼šè°ƒç”¨ <code>getFetchUrl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  function getFetchUrl(query) &#123;</span><br><span class="line">    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯èƒ½ä¸æƒ³æŠŠ<code>getFetchUrl</code> ç§»åˆ° effects ä¸­ï¼Œå› ä¸ºä½ æƒ³å¤ç”¨é€»è¾‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹ä¾èµ–å¾ˆ â€œè¯šå®â€ï¼Œä½ å¯èƒ½ä¼šæ‰åˆ°é™·é˜±é‡Œã€‚æˆ‘ä»¬çš„ä¸¤ä¸ª effects éƒ½ä¾èµ–<code>getFetchUrl</code>ï¼Œ<strong>è€Œå®ƒæ¯æ¬¡æ¸²æŸ“éƒ½ä¸åŒ</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾èµ–æ•°ç»„ä¼šå˜å¾—æ— ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    function getFetchUrl(query) &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå¯èƒ½çš„è§£å†³åŠæ³•æ˜¯æŠŠ<code>getFetchUrl</code>ä»ä¾èµ–ä¸­å»æ‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä¸è®¤ä¸ºè¿™æ˜¯å¥½çš„è§£å†³æ–¹å¼ã€‚è¿™ä¼šä½¿æˆ‘ä»¬åé¢å¯¹æ•°æ®æµçš„æ”¹å˜å¾ˆéš¾è¢«å‘ç°ä»è€Œå¿˜è®°å»å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç±»ä¼¼äºä¸Šé¢ â€œå®šæ—¶å™¨ä¸æ›´æ–°å€¼â€ çš„é—®é¢˜ã€‚</p><p>ç›¸åçš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ›´ç®€å•çš„è§£å†³åŠæ³•ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªï¼Œ å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰ä½¿ç”¨ç»„ä»¶å†…çš„ä»»ä½•å€¼ï¼Œä½ åº”è¯¥æŠŠå®ƒæåˆ°ç»„ä»¶å¤–é¢å»å®šä¹‰ï¼Œç„¶åå°±å¯ä»¥è‡ªç”±åœ°åœ¨ effects ä¸­ä½¿ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function getFetchUrl(query) &#123;  return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;&#125;</span><br><span class="line">function SearchResults() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, []); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¸å†éœ€è¦æŠŠå®ƒè®¾ä¸ºä¾èµ–ï¼Œå› ä¸ºå®ƒä»¬ä¸åœ¨æ¸²æŸ“èŒƒå›´å†…ï¼Œå› æ­¤ä¸ä¼šè¢«æ•°æ®æµå½±å“ã€‚å®ƒä¸å¯èƒ½çªç„¶æ„å¤–åœ°ä¾èµ–äº props æˆ– stateã€‚</p><p>æˆ–è€…ï¼Œ ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒåŒ…è£…æˆ <a href="https://reactjs.org/docs/hooks-reference.html#usecallback" target="_blank" rel="noopener"><code>useCallback</code> Hook</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">    const getFetchUrl = useCallback((query) =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, []);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;react&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl(&apos;redux&apos;);</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>useCallback</code>æœ¬è´¨ä¸Šæ˜¯æ·»åŠ äº†ä¸€å±‚ä¾èµ–æ£€æŸ¥ã€‚å®ƒä»¥å¦ä¸€ç§æ–¹å¼è§£å†³äº†é—®é¢˜ - <strong>æˆ‘ä»¬ä½¿å‡½æ•°æœ¬èº«åªåœ¨éœ€è¦çš„æ—¶å€™æ‰æ”¹å˜ï¼Œè€Œä¸æ˜¯å»æ‰å¯¹å‡½æ•°çš„ä¾èµ–ã€‚</strong></p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™ç§æ–¹å¼æ˜¯æœ‰ç”¨çš„ã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å±•ç¤ºäº†ä¸¤ç§æœç´¢ç»“æœï¼ˆæŸ¥è¯¢æ¡ä»¶åˆ†åˆ«ä¸º<code>&#39;react&#39;</code>å’Œ<code>&#39;redux&#39;</code>ï¼‰ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªè¾“å…¥æ¡†å…è®¸ä½ è¾“å…¥ä»»æ„çš„æŸ¥è¯¢æ¡ä»¶ (<code>query</code>)ã€‚ä¸åŒäºä¼ é€’<code>query</code>å‚æ•°çš„æ–¹å¼ï¼Œç°åœ¨<code>getFetchUrl</code>ä¼šä»çŠ¶æ€ä¸­è¯»å–ã€‚</p><p>æˆ‘ä»¬å¾ˆå¿«å‘ç°å®ƒé—æ¼äº†<code>query</code>ä¾èµ–ï¼š</p><p>å¦‚æœæˆ‘æŠŠ<code>query</code>æ·»åŠ åˆ°<code>useCallback</code> çš„ä¾èµ–ä¸­ï¼Œä»»ä½•è°ƒç”¨äº†<code>getFetchUrl</code>çš„ effect åœ¨<code>query</code>æ”¹å˜åéƒ½ä¼šé‡æ–°è¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function SearchResults() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const getFetchUrl = useCallback(() =&gt; &#123;    return &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;  &#125;, [query]);  </span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const url = getFetchUrl();</span><br><span class="line">    </span><br><span class="line">  &#125;, [getFetchUrl]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦æ„Ÿè°¢<code>useCallback</code>ï¼Œå› ä¸ºå¦‚æœ<code>query</code> ä¿æŒä¸å˜ï¼Œ<code>getFetchUrl</code>ä¹Ÿä¼šä¿æŒä¸å˜ï¼Œæˆ‘ä»¬çš„ effect ä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œã€‚ä½†æ˜¯å¦‚æœ<code>query</code>ä¿®æ”¹äº†ï¼Œ<code>getFetchUrl</code>ä¹Ÿä¼šéšä¹‹æ”¹å˜ï¼Œå› æ­¤ä¼šé‡æ–°è¯·æ±‚æ•°æ®ã€‚è¿™å°±åƒä½ åœ¨ Excel é‡Œä¿®æ”¹äº†ä¸€ä¸ªå•å…ƒæ ¼çš„å€¼ï¼Œå¦ä¸€ä¸ªä½¿ç”¨å®ƒçš„å•å…ƒæ ¼ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ ·ã€‚</p><p>è¿™æ­£æ˜¯æ‹¥æŠ±æ•°æ®æµå’ŒåŒæ­¥æ€ç»´çš„ç»“æœã€‚<strong>å¯¹äºé€šè¿‡å±æ€§ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„å‡½æ•°è¿™ä¸ªæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const [query, setQuery] = useState(&apos;react&apos;);</span><br><span class="line"></span><br><span class="line">    const fetchData = useCallback(() =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + query;      &#125;, [query]);  </span><br><span class="line">  return &lt;Child fetchData=&#123;fetchData&#125; /&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; fetchData &#125;) &#123;</span><br><span class="line">  let [data, setData] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    fetchData().then(setData);</span><br><span class="line">  &#125;, [fetchData]); </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>fetchData</code>åªæœ‰åœ¨<code>Parent</code>çš„<code>query</code>çŠ¶æ€å˜æ›´æ—¶æ‰ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„<code>Child</code>åªä¼šåœ¨éœ€è¦çš„æ—¶å€™æ‰å»é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><h2 id="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"><a href="#å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ" class="headerlink" title="å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ"></a><a href="#%E5%87%BD%E6%95%B0%E6%98%AF%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%E5%90%97%EF%BC%9F"></a>å‡½æ•°æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†å—ï¼Ÿ</h2><p>æœ‰è¶£çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼åœ¨ class ç»„ä»¶ä¸­è¡Œä¸é€šï¼Œå¹¶ä¸”è¿™ç§è¡Œä¸é€šæ°åˆ°å¥½å¤„åœ°æ­ç¤ºäº† effect å’Œç”Ÿå‘½å‘¨æœŸèŒƒå¼ä¹‹é—´çš„åŒºåˆ«ã€‚è€ƒè™‘ä¸‹é¢çš„è½¬æ¢ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;      &#125;;  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; /&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;    this.props.fetchData();  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå°‘æ¥äº† Danï¼Œæˆ‘ä»¬éƒ½çŸ¥é“<code>useEffect</code> å°±åƒ<code>componentDidMount</code> å’Œ <code>componentDidUpdate</code>çš„ç»“åˆï¼Œä½ ä¸èƒ½è€æ˜¯ç ´åè¿™ä¸€æ¡ï¼â€ <strong>å¥½å§ï¼Œå°±ç®—åŠ äº†<code>componentDidUpdate</code>ç…§æ ·æ— ç”¨ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;        if (this.props.fetchData !== prevProps.fetchData) &#123;      this.props.fetchData();    &#125;  &#125;  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æ­¤ï¼Œ<code>fetchData</code>æ˜¯ä¸€ä¸ª class æ–¹æ³•ï¼ï¼ˆæˆ–è€…ä½ ä¹Ÿå¯ä»¥è¯´æ˜¯ class å±æ€§ - ä½†è¿™ä¸èƒ½æ”¹å˜ä»€ä¹ˆã€‚ï¼‰å®ƒä¸ä¼šå› ä¸ºçŠ¶æ€çš„æ”¹å˜è€Œä¸åŒï¼Œæ‰€ä»¥<code>this.props.fetchData</code>å’Œ <code>prevProps.fetchData</code>å§‹ç»ˆç›¸ç­‰ï¼Œå› æ­¤ä¸ä¼šé‡æ–°è¯·æ±‚ã€‚é‚£æˆ‘ä»¬åˆ æ‰æ¡ä»¶åˆ¤æ–­æ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps) &#123;</span><br><span class="line">  this.props.fetchData();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­‰ç­‰ï¼Œè¿™æ ·ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½å»è¯·æ±‚ã€‚(æ·»åŠ ä¸€ä¸ªåŠ è½½åŠ¨ç”»å¯èƒ½æ˜¯ä¸€ç§æœ‰è¶£çš„å‘ç°è¿™ç§æƒ…å†µçš„æ–¹å¼ã€‚) ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªç‰¹å®šçš„ query?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  return &lt;Child fetchData=&#123;this.fetchData.bind(this, this.state.query)&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†è¿™æ ·ä¸€æ¥ï¼Œ<code>this.props.fetchData !== prevProps.fetchData</code> è¡¨è¾¾å¼æ°¸è¿œæ˜¯<code>true</code>ï¼Œå³ä½¿<code>query</code>å¹¶æœªæ”¹å˜ã€‚è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ€»æ˜¯å»è¯·æ±‚ã€‚</p><p>æƒ³è¦è§£å†³è¿™ä¸ª class ç»„ä»¶ä¸­çš„éš¾é¢˜ï¼Œå”¯ä¸€ç°å®å¯è¡Œçš„åŠæ³•æ˜¯ç¡¬ç€å¤´çš®æŠŠ<code>query</code>æœ¬èº«ä¼ å…¥ <code>Child</code> ç»„ä»¶ã€‚ <code>Child</code> è™½ç„¶å®é™…å¹¶æ²¡æœ‰ç›´æ¥_ä½¿ç”¨_è¿™ä¸ª<code>query</code>çš„å€¼ï¼Œä½†èƒ½åœ¨å®ƒæ”¹å˜çš„æ—¶å€™è§¦å‘ä¸€æ¬¡é‡æ–°è¯·æ±‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">class Parent extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    query: &apos;react&apos;</span><br><span class="line">  &#125;;</span><br><span class="line">  fetchData = () =&gt; &#123;</span><br><span class="line">    const url = &apos;https://hn.algolia.com/api/v1/search?query=&apos; + this.state.query;</span><br><span class="line">    </span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return &lt;Child fetchData=&#123;this.fetchData&#125; query=&#123;this.state.query&#125; /&gt;;  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Child extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.props.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    if (this.props.query !== prevProps.query) &#123;      this.props.fetchData();    &#125;  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ React çš„ class ç»„ä»¶è¿™ä¹ˆå¤šå¹´åï¼Œæˆ‘å·²ç»å¦‚æ­¤ä¹ æƒ¯äºæŠŠä¸å¿…è¦çš„ props ä¼ é€’ä¸‹å»å¹¶ä¸”ç ´åçˆ¶ç»„ä»¶çš„å°è£…ä»¥è‡³äºæˆ‘åœ¨ä¸€å‘¨ä¹‹å‰æ‰æ„è¯†åˆ°æˆ‘ä¸ºä»€ä¹ˆä¸€å®šè¦è¿™æ ·åšã€‚</p><p><strong>åœ¨ class ç»„ä»¶ä¸­ï¼Œå‡½æ•°å±æ€§æœ¬èº«å¹¶ä¸æ˜¯æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚</strong>ç»„ä»¶çš„æ–¹æ³•ä¸­åŒ…å«äº†å¯å˜çš„<code>this</code>å˜é‡å¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç¡®å®šæ— ç–‘åœ°è®¤ä¸ºå®ƒæ˜¯ä¸å˜çš„ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æŠŠä¸€å †æ•°æ®ä¼ é€’ä¸‹å»ä»…ä»…æ˜¯ä¸ºäº†åš â€œdiffâ€ã€‚æˆ‘ä»¬æ— æ³•çŸ¥é“ä¼ å…¥çš„<code>this.props.fetchData</code> æ˜¯å¦ä¾èµ–çŠ¶æ€ï¼Œå¹¶ä¸”ä¸çŸ¥é“å®ƒä¾èµ–çš„çŠ¶æ€æ˜¯å¦æ”¹å˜äº†ã€‚</p><p><strong>ä½¿ç”¨<code>useCallback</code>ï¼Œå‡½æ•°å®Œå…¨å¯ä»¥å‚ä¸åˆ°æ•°æ®æµä¸­ã€‚</strong>æˆ‘ä»¬å¯ä»¥è¯´å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¾“å…¥æ”¹å˜äº†ï¼Œè¿™ä¸ªå‡½æ•°å°±æ”¹å˜äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œå‡½æ•°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚æ„Ÿè°¢å‘¨åˆ°çš„<code>useCallback</code>ï¼Œå±æ€§æ¯”å¦‚<code>props.fetchData</code>çš„æ”¹å˜ä¹Ÿä¼šè‡ªåŠ¨ä¼ é€’ä¸‹å»ã€‚</p><p>ç±»ä¼¼çš„ï¼Œ<a href="https://reactjs.org/docs/hooks-reference.html#usememo" target="_blank" rel="noopener"><code>useMemo</code></a>å¯ä»¥è®©æˆ‘ä»¬å¯¹å¤æ‚å¯¹è±¡åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function ColorPicker() &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  const [color, setColor] = useState(&apos;pink&apos;);</span><br><span class="line">  const style = useMemo(() =&gt; (&#123; color &#125;), [color]);</span><br><span class="line">  return &lt;Child style=&#123;style&#125; /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œåˆ°å¤„ä½¿ç”¨<code>useCallback</code>æ˜¯ä»¶æŒºç¬¨æ‹™çš„äº‹ã€‚</strong>å½“æˆ‘ä»¬éœ€è¦å°†å‡½æ•°ä¼ é€’ä¸‹å»å¹¶ä¸”å‡½æ•°ä¼šåœ¨å­ç»„ä»¶çš„ effect ä¸­è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œ<code>useCallback</code> æ˜¯å¾ˆå¥½çš„æŠ€å·§ä¸”éå¸¸æœ‰ç”¨ã€‚æˆ–è€…ä½ æƒ³è¯•å›¾å‡å°‘å¯¹å­ç»„ä»¶çš„è®°å¿†è´Ÿæ‹…ï¼Œä¹Ÿä¸å¦¨ä¸€è¯•ã€‚ä½†æ€»çš„æ¥è¯´ Hooks æœ¬èº«èƒ½æ›´å¥½åœ°<a href="https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down" target="_blank" rel="noopener">é¿å…ä¼ é€’å›è°ƒå‡½æ•°</a>ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘æ›´å€¾å‘äºæŠŠ<code>fetchData</code>æ”¾åœ¨æˆ‘çš„ effect é‡Œï¼ˆå®ƒå¯ä»¥æŠ½ç¦»æˆä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼‰æˆ–è€…æ˜¯ä»é¡¶å±‚å¼•å…¥ã€‚æˆ‘æƒ³è®© effects ä¿æŒç®€å•ï¼Œè€Œåœ¨é‡Œé¢è°ƒç”¨å›è°ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚ï¼ˆâ€œå¦‚æœæŸä¸ª<code>props.onComplete</code>å›è°ƒæ”¹å˜äº†è€Œè¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ï¼‰ä½ å¯ä»¥<a href="#swimming-against-the-tide">æ¨¡æ‹Ÿ class çš„è¡Œä¸º</a>ä½†é‚£æ ·å¹¶ä¸èƒ½è§£å†³ç«æ€çš„é—®é¢˜ã€‚</p><h2 id="è¯´è¯´ç«æ€"><a href="#è¯´è¯´ç«æ€" class="headerlink" title="è¯´è¯´ç«æ€"></a><a href="#%E8%AF%B4%E8%AF%B4%E7%AB%9E%E6%80%81"></a>è¯´è¯´ç«æ€</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„åœ¨ class ç»„ä»¶é‡Œå‘è¯·æ±‚çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¾ˆå¯èƒ½å·²ç»çŸ¥é“ï¼Œä¸Šé¢çš„ä»£ç åŸ‹ä¼äº†ä¸€äº›é—®é¢˜ã€‚å®ƒå¹¶æ²¡æœ‰å¤„ç†æ›´æ–°çš„æƒ…å†µã€‚æ‰€ä»¥ç¬¬äºŒä¸ªä½ èƒ½å¤Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç»å…¸ä¾‹å­æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Article extends Component &#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    article: null</span><br><span class="line">  &#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.fetchData(this.props.id);</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;    if (prevProps.id !== this.props.id) &#123;      this.fetchData(this.props.id);    &#125;  &#125;  async fetchData(id) &#123;</span><br><span class="line">    const article = await API.fetchArticle(id);</span><br><span class="line">    this.setState(&#123; article &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶å¥½å¤šäº†ï¼ä½†ä¾æ—§æœ‰é—®é¢˜ã€‚æœ‰é—®é¢˜çš„åŸå› æ˜¯è¯·æ±‚ç»“æœè¿”å›çš„é¡ºåºä¸èƒ½ä¿è¯ä¸€è‡´ã€‚æ¯”å¦‚æˆ‘å…ˆè¯·æ±‚ <code>{id: 10}</code>ï¼Œç„¶åæ›´æ–°åˆ°<code>{id: 20}</code>ï¼Œä½†<code>{id: 20}</code>çš„è¯·æ±‚æ›´å…ˆè¿”å›ã€‚è¯·æ±‚æ›´æ—©ä½†è¿”å›æ›´æ™šçš„æƒ…å†µä¼šé”™è¯¯åœ°è¦†ç›–çŠ¶æ€å€¼ã€‚</p><p>è¿™è¢«å«åšç«æ€ï¼Œè¿™åœ¨æ··åˆäº†<code>async</code> / <code>await</code>ï¼ˆå‡è®¾åœ¨ç­‰å¾…ç»“æœè¿”å›ï¼‰å’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„ä»£ç ä¸­éå¸¸å…¸å‹ï¼ˆprops å’Œ state å¯èƒ½ä¼šåœ¨ async å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç”Ÿæ”¹å˜ï¼‰ã€‚</p><p>Effects å¹¶æ²¡æœ‰ç¥å¥‡åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°½ç®¡å®ƒä¼šè­¦å‘Šä½ å¦‚æœä½ ç›´æ¥ä¼ äº†ä¸€ä¸ª<code>async</code> å‡½æ•°ç»™ effectã€‚ï¼ˆæˆ‘ä»¬ä¼šæ”¹å–„è¿™ä¸ªè­¦å‘Šæ¥æ›´å¥½åœ°è§£é‡Šä½ å¯èƒ½ä¼šé‡åˆ°çš„è¿™äº›é—®é¢˜ã€‚ï¼‰</p><p>å¦‚æœä½ ä½¿ç”¨çš„å¼‚æ­¥æ–¹å¼æ”¯æŒå–æ¶ˆï¼Œé‚£å¤ªæ£’äº†ã€‚ä½ å¯ä»¥ç›´æ¥åœ¨æ¸…é™¤å‡½æ•°ä¸­å–æ¶ˆå¼‚æ­¥è¯·æ±‚ã€‚</p><p>æˆ–è€…ï¼Œæœ€ç®€å•çš„æƒå®œä¹‹è®¡æ˜¯ç”¨ä¸€ä¸ªå¸ƒå°”å€¼æ¥è·Ÿè¸ªå®ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Article(&#123; id &#125;) &#123;</span><br><span class="line">  const [article, setArticle] = useState(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let didCancel = false;</span><br><span class="line">    async function fetchData() &#123;</span><br><span class="line">      const article = await API.fetchArticle(id);</span><br><span class="line">      if (!didCancel) &#123;        setArticle(article);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fetchData();</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;      didCancel = true;    &#125;;  &#125;, [id]);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>è®¨è®ºäº†æ›´å¤šå…³äºå¦‚ä½•å¤„ç†é”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œä»¥åŠæŠ½ç¦»é€»è¾‘åˆ°è‡ªå®šä¹‰çš„ Hookã€‚æˆ‘æ¨èä½ è®¤çœŸé˜…è¯»ä¸€ä¸‹å¦‚æœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºå¦‚ä½•åœ¨ Hooks é‡Œè¯·æ±‚æ•°æ®çš„å†…å®¹ã€‚</p><h2 id="æé«˜æ°´å‡†"><a href="#æé«˜æ°´å‡†" class="headerlink" title="æé«˜æ°´å‡†"></a><a href="#%E6%8F%90%E9%AB%98%E6%B0%B4%E5%87%86"></a>æé«˜æ°´å‡†</h2><p>åœ¨ class ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ€ç»´æ¨¡å‹ä¸­ï¼Œå‰¯ä½œç”¨çš„è¡Œä¸ºå’Œæ¸²æŸ“è¾“å‡ºæ˜¯ä¸åŒçš„ã€‚UI æ¸²æŸ“æ˜¯è¢« props å’Œ state é©±åŠ¨çš„ï¼Œå¹¶ä¸”èƒ½ç¡®ä¿æ­¥è°ƒä¸€è‡´ï¼Œä½†å‰¯ä½œç”¨å¹¶ä¸æ˜¯è¿™æ ·ã€‚è¿™æ˜¯ä¸€ç±»å¸¸è§é—®é¢˜çš„æ¥æºã€‚</p><p>è€Œåœ¨<code>useEffect</code>çš„æ€ç»´æ¨¡å‹ä¸­ï¼Œé»˜è®¤éƒ½æ˜¯åŒæ­¥çš„ã€‚å‰¯ä½œç”¨å˜æˆäº† React æ•°æ®æµçš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºæ¯ä¸€ä¸ª<code>useEffect</code>è°ƒç”¨ï¼Œä¸€æ—¦ä½ å¤„ç†æ­£ç¡®ï¼Œä½ çš„ç»„ä»¶èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¾¹ç¼˜æƒ…å†µã€‚</p><p>ç„¶è€Œï¼Œç”¨å¥½<code>useEffect</code>çš„å‰æœŸå­¦ä¹ æˆæœ¬æ›´é«˜ã€‚è¿™å¯èƒ½è®©äººæ°”æ¼ã€‚ç”¨åŒæ­¥çš„ä»£ç å»å¤„ç†è¾¹ç¼˜æƒ…å†µå¤©ç„¶å°±æ¯”è§¦å‘ä¸€æ¬¡ä¸ç”¨å’Œæ¸²æŸ“ç»“æœæ­¥è°ƒä¸€è‡´çš„å‰¯ä½œç”¨æ›´éš¾ã€‚</p><p>è¿™éš¾å…è®©äººæ‹…å¿§å¦‚æœ<code>useEffect</code>æ˜¯ä½ ç°åœ¨ä½¿ç”¨æœ€å¤šçš„å·¥å…·ã€‚ä¸è¿‡ï¼Œç›®å‰å¤§æŠµè¿˜å¤„ç†ä½æ°´å¹³ä½¿ç”¨é˜¶æ®µã€‚å› ä¸º Hooks å¤ªæ–°äº†æ‰€ä»¥å¤§å®¶éƒ½è¿˜åœ¨ä½æ°´å¹³åœ°ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›æ•™ç¨‹ç¤ºä¾‹ä¸­ã€‚ä½†åœ¨å®è·µä¸­ï¼Œç¤¾åŒºå¾ˆå¯èƒ½å³å°†å¼€å§‹é«˜æ°´å¹³åœ°ä½¿ç”¨ Hooksï¼Œå› ä¸ºå¥½çš„ API ä¼šæœ‰æ›´å¥½çš„åŠ¨é‡å’Œå†²åŠ²ã€‚</p><p>æˆ‘çœ‹åˆ°ä¸åŒçš„åº”ç”¨åœ¨åˆ›é€ ä»–ä»¬è‡ªå·±çš„ Hooksï¼Œæ¯”å¦‚å°è£…äº†åº”ç”¨é‰´æƒé€»è¾‘çš„<code>useFetch</code>æˆ–è€…ä½¿ç”¨ theme context çš„<code>useTheme</code> ã€‚ä½ ä¸€æ—¦æœ‰äº†åŒ…å«è¿™äº›çš„å·¥å…·ç®±ï¼Œä½ å°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°ç›´æ¥ä½¿ç”¨<code>useEffect</code>ã€‚ä½†æ¯ä¸€ä¸ªåŸºäºå®ƒçš„ Hook éƒ½èƒ½ä»å®ƒçš„é€‚åº”èƒ½åŠ›ä¸­å¾—åˆ°ç›Šå¤„ã€‚</p><p>ç›®å‰ä¸ºæ­¢ï¼Œ<code>useEffect</code>ä¸»è¦ç”¨äºæ•°æ®è¯·æ±‚ã€‚ä½†æ˜¯æ•°æ®è¯·æ±‚å‡†ç¡®è¯´å¹¶ä¸æ˜¯ä¸€ä¸ªåŒæ­¥é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¾èµ–ç»å¸¸æ˜¯<code>[]</code>æ‰€ä»¥è¿™ä¸€ç‚¹å°¤å…¶æ˜æ˜¾ã€‚é‚£æˆ‘ä»¬ç©¶ç«Ÿåœ¨åŒæ­¥ä»€ä¹ˆï¼Ÿ</p><p>é•¿è¿œæ¥çœ‹ï¼Œ <a href="https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#react-16x-mid-2019-the-one-with-suspense-for-data-fetching" target="_blank" rel="noopener">Suspense ç”¨äºæ•°æ®è¯·æ±‚</a> ä¼šå…è®¸ç¬¬ä¸‰æ–¹åº“é€šè¿‡ç¬¬ä¸€ç­‰çš„é€”å¾„å‘Šè¯‰ React æš‚åœæ¸²æŸ“ç›´åˆ°æŸäº›å¼‚æ­¥äº‹ç‰©ï¼ˆä»»ä½•ä¸œè¥¿ï¼šä»£ç ï¼Œæ•°æ®ï¼Œå›¾ç‰‡ï¼‰å·²ç»å‡†å¤‡å°±ç»ªã€‚</p><p>å½“ Suspense é€æ¸åœ°è¦†ç›–åˆ°æ›´å¤šçš„æ•°æ®è¯·æ±‚ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘é¢„æ–™<code>useEffect</code> ä¼šé€€å±…å¹•åä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåŒæ­¥ props å’Œ state åˆ°æŸäº›å‰¯ä½œç”¨ã€‚ä¸åƒæ•°æ®è¯·æ±‚ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™äº›åœºæ™¯å› ä¸ºå®ƒå°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚ä¸è¿‡åœ¨é‚£ä¹‹å‰ï¼Œè‡ªå®šä¹‰çš„ Hooks æ¯”å¦‚<a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener">è¿™å„¿æåˆ°çš„</a>æ˜¯å¤ç”¨æ•°æ®è¯·æ±‚é€»è¾‘å¾ˆå¥½çš„æ–¹å¼ã€‚</p><h2 id="åœ¨ç»“æŸå‰"><a href="#åœ¨ç»“æŸå‰" class="headerlink" title="åœ¨ç»“æŸå‰"></a><a href="#%E5%9C%A8%E7%BB%93%E6%9D%9F%E5%89%8D"></a>åœ¨ç»“æŸå‰</h2><p>ç°åœ¨ä½ å·®ä¸å¤šçŸ¥é“äº†æˆ‘å…³äºå¦‚ä½•ä½¿ç”¨ effects çš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹å¼€å¤´çš„ <a href="#tldr">TLDR</a>ã€‚ä½ ç°åœ¨è§‰å¾—å®ƒè¯´å¾—æœ‰é“ç†å—ï¼Ÿæˆ‘æœ‰é—æ¼ä»€ä¹ˆå—ï¼Ÿï¼ˆæˆ‘çš„çº¸è¿˜æ²¡æœ‰å†™å®Œï¼ï¼‰</p><p>æˆ‘å¾ˆæƒ³åœ¨ Twitter ä¸Šå¬å¬ä½ çš„æƒ³æ³•ã€‚è°¢è°¢é˜…è¯»ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      useEffect å®Œæ•´æŒ‡å— â€” Dan Abramov
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/React-Hooks/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
      <category term="useEffect" scheme="https://andyxw.com/tags/useEffect/"/>
    
  </entry>
  
  <entry>
    <title>What are React Hooks</title>
    <link href="https://andyxw.com/archives/ef81.html"/>
    <id>https://andyxw.com/archives/ef81.html</id>
    <published>2019-08-21T09:31:54.000Z</published>
    <updated>2019-09-04T13:28:44.565Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><blockquote><p>æœ¬æ–‡ç”± <a href="http://ksria.com/simpread/" target="_blank" rel="noopener">ç®€æ‚¦ SimpRead</a> è½¬ç ï¼Œ åŸæ–‡åœ°å€ <a href="https://www.robinwieruch.de/react-hooks/" target="_blank" rel="noopener">https://www.robinwieruch.de/react-hooks/</a></p></blockquote><p>October 29, 2018 - <a href="https://github.com/rwieruch/blog_robinwieruch_content/blob/master/react-hooks.md" target="_blank" rel="noopener">Edit this Post on GitHub</a></p><p><img src="https://www.robinwieruch.de/img/posts/react-hooks/banner_1024.jpg" alt=""></p><p>React Hooks were introduced at <a href="https://www.youtube.com/watch?v=dpw9EHDh2bM" target="_blank" rel="noopener">React Conf October 2018</a> as a way to use state and side-effects in React function components. Whereas function components have been called functional stateless components (FSC) before, they are finally able to use state with React Hooks. Therefore, many people refer to them as function components now.</p><p>In this walkthrough, I want to explain the motivation behind hooks, what will change in React and why we shouldnâ€™t panic, and how React hooks can be used in function components by showcasing common React Hooks such as the state and effect hooks by example.</p><p>React Hooks were invented by the React team to introduce state management and side-effects in function components. Itâ€™s their way of making it more effortless to use only React function components without the need to refactor a React function component to a React class component for using lifecycle methods, in order to use have side-effects, or local state. React Hooks enable us to write React applications with only function components.</p><p><strong>Unnecessary Component Refactorings:</strong> Previously, only React class components were used for local state management and lifecycle methods. The latter have been essential for introducing side-effects, such as listeners or data fetching, in React class components.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">class Counter extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line"></span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;() =&gt;</span><br><span class="line">            this.setState(&#123; count: this.state.count + 1 &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Counter;</span><br></pre></td></tr></table></figure><p>Only if you didnâ€™t need state or lifecycle methods, React functional <em>stateless</em> components could be used. And because React function components are more lightweight (and elegant), people already used plenty of function components. This came with the drawback of refactoring components from React function components to React class components every time state or lifecycle methods were needed (and vice versa).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">// how to use the state hook in a React function component</span><br><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Counter;</span><br></pre></td></tr></table></figure><p>With Hooks there is no need for this refactoring. Side-effects and state are finally available in React function components. Thatâ€™s why a rebranding from functional stateless components to function components would be reasonable.</p><p><strong>Side-effect Logic:</strong> In React class components, side-effects were mostly introduced in lifecycle methods (e.g. componentDidMount, componentDidUpdate, componentWillUnmount). A side-effect could be <a href="https://www.robinwieruch.de/react-fetching-data/" target="_blank" rel="noopener">fetching data in React</a> or <a href="https://www.robinwieruch.de/react-intersection-observer-api/" target="_blank" rel="noopener">interacting with the Browser API</a>. Usually these side-effects came with a setup and clean up phase. For instance, if you would miss to remove your listener, you could run into <a href="https://www.robinwieruch.de/react-warning-cant-call-setstate-on-an-unmounted-component/" target="_blank" rel="noopener">React performance issues</a>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// side-effects in a React class component</span><br><span class="line">class MyComponent extends Component &#123;</span><br><span class="line">  // setup phase</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    // add listener for feature 1</span><br><span class="line">    // add listener for feature 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // clean up phase</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    // remove listener for feature 1</span><br><span class="line">    // remove listener for feature 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// side-effects in React function component with React Hooks</span><br><span class="line">function MyComponent() &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // add listener for feature 1 (setup)</span><br><span class="line">    // return function to remove listener for feature 1 (clean up)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // add listener for feature 2 (setup)</span><br><span class="line">    // return function to remove listener for feature 2 (clean up)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now, if you would introduce more than one of these side-effects in a React class componentâ€™s lifecycle methods, all side-effects would be grouped by lifecycle method but not by side-effect. Thatâ€™s what React Hooks are going to change by encapsulating a side-effect in one hook whereas every hook has its own side-effect with a setup and clean up phase. You will see later in a tutorial how this works for real by adding and removing listeners in a React Hook.</p><p><strong>Reactâ€™s Abstraction Hell:</strong> Abstraction and thus reusability were introduced with <a href="https://www.robinwieruch.de/gentle-introduction-higher-order-components/" target="_blank" rel="noopener">Higher-Order Components</a> and <a href="https://www.robinwieruch.de/react-render-props-pattern/" target="_blank" rel="noopener">Render Prop Components</a> in React. There is also <a href="https://www.robinwieruch.de/react-context-api/" target="_blank" rel="noopener">Reactâ€™s Context with its Provider and Consumer Components</a> that introduce another level of abstraction. All of these advanced patterns in React are using so called wrapping components. The implementation of the following components shouldnâ€™t be foreign to developers who are creating larger React applications.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; compose &#125; from &apos;recompose&apos;;</span><br><span class="line">import &#123; withRouter &#125; from &apos;react-router-dom&apos;;</span><br><span class="line"></span><br><span class="line">function App(&#123; history, state, dispatch &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;ThemeContext.Consumer&gt;</span><br><span class="line">      &#123;theme =&gt;</span><br><span class="line">        &lt;Content theme=&#123;theme&#125;&gt;</span><br><span class="line">          ...</span><br><span class="line">        &lt;/Content&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/ThemeContext.Consumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default compose(</span><br><span class="line">  withRouter,</span><br><span class="line">  withReducer(reducer, initialState)</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure><p>Sophie Alpert coined it â€œthe wrapper hellâ€ in React. You are not only seeing it in the implementation, but also when inspecting your components in the browser. There are dozens of wrapped components due to Render Prop Components (including Consumer components from Reactâ€™s Context) and Higher-Order Components. It becomes an unreadable component tree, because all the abstracted logic is covered up in other React components. The actual visible components are hard to track down in the browserâ€™s DOM. So what if these additional components were not needed because the logic is only encapsulated in functions as side-effects instead? Then you would remove all these wrapping components and flatten your component treeâ€™s structure:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const theme = useTheme();</span><br><span class="line">  const history = useRouter();</span><br><span class="line">  const [state, dispatch] = useReducer(reducer, initialState);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Content theme=&#123;theme&#125;&gt;</span><br><span class="line">      ...</span><br><span class="line">    &lt;/Content&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s what React Hooks are bringing on the table. All side-effects are sitting directly in the component without introducing other components as container for business logic. The container disappears and the logic just sits in React Hooks that are only functions. <a href="https://github.com/acdlite/recompose/commit/7867de653abbb57a49934e52622a60b433bda918" target="_blank" rel="noopener">Andrew Clark already left a statement in favor of React Hooks in his popular Higher-Order Component library called recompose.</a></p><p><strong>JavaScript Class Confusion:</strong> JavaScript mixes two worlds pretty well: Object-oriented programming (OOP) and functional programming. React introduces many developers to both worlds. On the one side, React (and Redux) introduced people to functional programming (FP) with function compositions, general programming concepts with functions (e.g. higher-order functions, JavaScript built-in methods like map, reduce, filter) and other terms such as immutability and side-effects. React itself didnâ€™t really introduce these things, because they are features of the language or the programming paradigm itself, but they are heavily used in React whereas <a href="https://www.robinwieruch.de/javascript-fundamentals-react-requirements/" target="_blank" rel="noopener">every React developer becomes automatically a better JavaScript developer</a>.</p><p>On the other side, React uses JavaScript classes as one way to define React components. A class is only the declaration whereas the actual usage of the component is the instantiation of it. It creates a class instance whereas the <code>this</code> object of the class instance is used to interact with class methods (e.g. setState, forceUpdate, other custom class methods). However, classes come with a steeper learning curve for React beginners who are not coming from an OOP background. Thatâ€™s why class bindings, the <code>this</code> object and inheritance can be confusing. I have <a href="https://www.robinwieruch.de/the-road-to-learn-react/" target="_blank" rel="noopener">a few chapters in my React book</a> focusing only on this aspect of React which is always the most confusing thing about React for beginners.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// I THOUGHT WE ARE USING A CLASS. WHY IS IT EXTENDING FROM SOMETHING?</span><br><span class="line">class Counter extends Component &#123;</span><br><span class="line">  // WAIT ... THIS WORKS???</span><br><span class="line">  state = &#123; value: 0 &#125;;</span><br><span class="line"></span><br><span class="line">  // I THOUGH IT&apos;S THIS WAY, BUT WHY DO I NEED PROPS HERE?</span><br><span class="line">  // constructor(props) &#123;</span><br><span class="line">  //  SUPER???</span><br><span class="line">  //  super(props);</span><br><span class="line">  //</span><br><span class="line">  //  this.state = &#123;</span><br><span class="line">  //    value: 0,</span><br><span class="line">  //  &#125;;</span><br><span class="line">  // &#125;</span><br><span class="line"></span><br><span class="line">  // WHY DO I HAVE TO USE AN ARROW FUNCTION???</span><br><span class="line">  onIncrement = () =&gt; &#123;</span><br><span class="line">    this.setState(state =&gt; (&#123;</span><br><span class="line">      value: state.value + 1</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  // SHOULDN&apos;T IT BE this.onDecrement = this.onDecrement.bind(this); in the constructor???</span><br><span class="line">  // WHAT&apos;S this.onDecrement = this.onDecrement.bind(this); DOING ANYWAY?</span><br><span class="line">  onDecrement = () =&gt; &#123;</span><br><span class="line">    this.setState(state =&gt; (&#123;</span><br><span class="line">      value: state.value - 1</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;this.state.value&#125;</span><br><span class="line"></span><br><span class="line">        &#123;/* WHY IS EVERYTHING AVAILABLE ON &quot;THIS&quot;??? */&#125;</span><br><span class="line">        &lt;button onClick=&#123;this.onIncrement&#125;&gt;+&lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;this.onDecrement&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now, many people argue React shouldnâ€™t take JavaScript classes away because people donâ€™t understand them. After all, they belong to the language. However, one of the hypotheses of introducing the Hooks API is a smoother learning curve for React beginners when writing their React components without JavaScript classes in the first place.</p><p>Every time a new feature is introduced, people are concerned about it. There is one side of the group that is ecstatic about the change, and the other side that fears the change. I heard the most common concerns for React Hooks are:</p><ul><li>Everything changes! <em>Subtle panic mode â€¦</em></li><li>React is becoming bloated like Angular!</li><li>Itâ€™s useless, classes worked fine.</li><li>Itâ€™s magic!</li></ul><p><strong>Let me address these concerns here:</strong></p><p><strong>Everything changes:</strong> React Hooks will change how we write React applications in the future. However, at the moment, nothing changes. You can still write class components with local state and lifecycle methods and deploy advanced patterns such as Higher-Order Components or Render Prop Components. Nobody takes these learnings away from you. See how I upgraded all my open source projects from older versions to React 16.6. and none of of these projects had problems. They are using HOCs, Render Props and I believe even the old context API (correct me if am wrong). Everything I have learned all these years still works. The React team makes sure that React stays backward compatible. It will be the same with React 16.7.</p><p><img src="https://www.robinwieruch.de/img/posts/react-hooks/react-upgrades_1024.jpg" alt=""></p><p><strong>React is becoming bloated like Angular:</strong> React was always seen as a library with a slim API. Thatâ€™s true and shall be true in the future. However, in order to adjust things that were the status quo of building component-based applications a few years ago, and not to be overtaken by other libraries who adapt to the new status quo, React introduces changes in favor of older APIs. If React would start out fresh this year, maybe there would be only function components and hooks. But React was released a couple of years ago and needs to adapt to keep up with the status quo or to invent a status quo. Maybe there will follow deprecations of React class components and lifecycle methods in a few years in favor of React function components and hooks, but at the moment, the React team keeps React class components in their repertoire of tools. After all, the React team utilizes hooks as an invention to run a marathon with React an not to win a sprint. Obviously, React Hooks add yet another API to React, but it is in favor to simplify Reactâ€™s API in the future. I like this transition more than having a React 2 where everything is different.</p><p><strong>Itâ€™s useless, classes worked fine:</strong> Imagine you would start from zero to learn React and you would be introduced to React with Hooks. Maybe <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a> wouldnâ€™t start out with a React class component but with a React function component. Everything you need to learn for your components would be React Hooks. They manage state and side-effects, so you would only need to know about the state and the effect hook. Itâ€™s everything a React class component did for you before. It will be simpler for React beginners to learn React without all the other overhead that comes with JavaScript classes (inheritance, this, bindings, super, â€¦). Imagine React Hooks as a new way of how to write React components - Itâ€™s a new mindset. I am a skeptical person myself, but once I wrote a couple of simpler scenarios with React Hooks, I was convinced that this is the simplest way to write but also to learn React. As someone who is doing lots of React workshops, I argue that it takes away all the frustration classes bring on the table for React beginners.</p><p><strong>Itâ€™s magic:</strong> React is known to be down to earth with JavaScript. Writing React applications makes you a better JavaScript developer - thatâ€™s one of the best things about React when someone asks me: â€œWhy should I learn React?â€. Whether there comes another library in the future or not, everyone is prepared by honing their JavaScript skills and general programming skills when using React. Itâ€™s one of the things that made Redux, often used in React, popular: There is no magic, it is plain JavaScript. Now these React Hooks come along the way, introduce something stateful in a previously often pure function component, a couple of not easily to accept rules, and many donâ€™t understand whatâ€™s going on under the hood. But think about it this way: A function component in React is not a mere function. You still have to import React as library to your source code file. It does something with your function, because the function becomes a function component in React land. This function component comes with hidden implementations that were there all the time. How else would it have been possible to use functions as function components as we did it before React Hooks were introduced? And people accepted it too, even though itâ€™s kinda magic. Now, the only thing changed (and maybe it has already been this way before) is that these function components come with an extra hidden object that keeps track of hooks. To quote Dan Abramov from <a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889" target="_blank" rel="noopener">his article about hooks</a>: <em>â€œPerhaps youâ€™re wondering where React keeps the state for Hooks. The answer is itâ€™s kept in the exact same place where React keeps state for classes. React has an internal update queue which is the source of truth for any state, no matter how you define your components.â€</em>.</p><p><strong>Finally, think about it this way:</strong> Component-based solutions such as Angular, Vue, and React are pushing the boundaries of web development with every release. They build up on top of technologies that were invented more than two decades ago. They adapt them to make web development effortless in 2018 and not 1998. They optimize them like crazy to meet the needs in the here and now. We are building web applications with components and not with HTML templates anymore. We are not there yet, but I imagine a future where we sit together and invent a component-based standard for the browser. Angular, Vue and React are only the spearhead of this movement.</p><p>In the following, I want to dive into a few popular React Hooks by example to get you up to speed. All examples can be found in this <a href="https://github.com/the-road-to-learn-react/react-hooks-introduction" target="_blank" rel="noopener">GitHub repository</a>.</p><p>You have seen the useState Hook before in a code snippet for a typical counter example. It is used to manage local state in function components. Letâ€™s use the hook in a more elaborate example where we are going to manage an array of items. In another article of mine, you can learn more about <a href="https://www.robinwieruch.de/react-state-array-add-update-remove/" target="_blank" rel="noopener">managing arrays as state in React</a>, but this time we are doing it with React hooks. Letâ€™s get started:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const INITIAL_LIST = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: &apos;0&apos;,</span><br><span class="line">    title: &apos;React with RxJS for State Management Tutorial&apos;,</span><br><span class="line">    url:</span><br><span class="line">      &apos;https://www.robinwieruch.de/react-rxjs-state-management-tutorial/&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &apos;1&apos;,</span><br><span class="line">    title: &apos;A complete React with Apollo and GraphQL Tutorial&apos;,</span><br><span class="line">    url: &apos;https://www.robinwieruch.de/react-graphql-apollo-tutorial&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>The useState hook accepts an initial state as argument and returns, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring" target="_blank" rel="noopener">by using array destructuring</a>, two variables that can be named however you want to name them. Whereas the first variable is the actual state, the second variable is a function to update the state by providing a new state.</p><p>The goal of this scenario is to remove an item from the list. In order to accomplish it, every item in the rendered list has a button with a click handler. The click handler can be inlined in the function component, because it will make use of <code>list</code> and <code>setList</code> later. Hence you donâ€™t need to pass these variables to the handler, because they are already available from the outer scope of the component.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem() &#123;</span><br><span class="line">    // remove item from &quot;list&quot;</span><br><span class="line">    // set the new list in state with &quot;setList&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;onRemoveItem&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Somehow we need to know about the item that should be removed from the list. Using a higher-order function, we can pass the identifier of the item to the handler function. Otherwise we wouldnâ€™t be able to identify the item that should be removed from the list.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem(id) &#123;</span><br><span class="line">    // remove item from &quot;list&quot;</span><br><span class="line">    // set the new list in state with &quot;setList&quot;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Finally, use the identifier to filter the list with a built-in array method. It returns a new list which is used to set the new state of the list.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [list, setList] = useState(INITIAL_LIST);</span><br><span class="line"></span><br><span class="line">  function onRemoveItem(id) &#123;</span><br><span class="line">    const newList = list.filter(item =&gt; item.id !== id);</span><br><span class="line">    setList(newList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map(item =&gt; (</span><br><span class="line">        &lt;li key=&#123;item.id&#125;&gt;</span><br><span class="line">          &lt;a href=&#123;item.url&#125;&gt;&#123;item.title&#125;&lt;/a&gt;</span><br><span class="line">          &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; onRemoveItem(item.id)&#125;&gt;</span><br><span class="line">            Remove</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>That should do the job. You are able to remove an item from the list based on the identifier you pass to the handler. The handler then filters the list and sets the new state of the list with the <code>setList</code> function.</p><p>The useState hook gives you everything you need to manage state in a function component: initial state, the latest state, and a state update function. Everything else is JavaScript again. Furthermore, you donâ€™t need to bother about the state object with its shallow merge as before in a class component. Instead, you encapsulate one domain (e.g. list) with useState, but if you would need another state (e.g. counter), then just encapsulate this domain with another useState. You can read more about <a href="https://reactjs.org/docs/hooks-state.html" target="_blank" rel="noopener">the useState hook in Reactâ€™s documentation</a>.</p><p>Letâ€™s head over to the next hook called useEffect. As mentioned before, function components should be able to manage state and side-effects with hooks. Managing state was showcased with the useState hook. Now comes the useEffect hook into play for side-effects which are usually used for interactions with the Browser/DOM API or external API like data fetching. Letâ€™s see how the useEffect hook can be used for interaction with the Browser API by implementing a simple stopwatch. You can see how it is done in a React class component in this <a href="https://github.com/the-road-to-learn-react/react-interval-setstate-unmounted-component-performance" target="_blank" rel="noopener">GitHub repository</a>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>There is no stopwatch yet. But at least there are is a <a href="https://www.robinwieruch.de/conditional-rendering-react/" target="_blank" rel="noopener">conditional rendering</a> to show either a â€œStartâ€ or â€œStopâ€ button. The state for the boolean flag is managed by the useState hook.</p><p>Letâ€™s introduce our side-effect with useEffect that registers an interval. The function used for the interval emits a console logging every second to your developer tools of your browser.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>In order to remove the interval when the component unmounts (but also after every other render update), you can return a function in useEffect for anything to be called for the clean up. For instance, there shouldnâ€™t be any memory leak left behind when the component isnâ€™t there anymore.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Now, you want to setup the side-effect when mounting the component and the clean up the side-effect when unmounting the component. If you would log how many times the function within the effect is called, you would see that it sets a new interval every time the state of the component changes (e.g. click on â€œStartâ€/â€œStopâ€ button).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;effect runs&apos;);</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>In order to only run the effect on mount and unmount of the component, you can pass it an empty array as second argument.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>However, since the interval is cleaned up after every render too, we need to set the interval in our update cycle too. But we can tell the effect to run only when the <code>isOn</code> variable changes. Only when one of the variables in the array changes, the effect will run during the update cycle. If you keep the array empty, the effect will only run on mount and unmount, because there is no variable to be checked for running the side-effect again.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    const interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>The interval is running whether the <code>isOn</code> boolean is true or false. It would be great to only run it when the stopwatch is activated.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(() =&gt; console.log(&apos;tick&apos;), 1000);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Now introduce another state in your function component to keep track of the timer of the stopwatch. It is used to update the timer, but only when the stopwatch is activated.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;timer&#125;</span><br><span class="line"></span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>There is still one mistake in the code. When the interval is running, it updates the timer every second by increasing it by one. However, it always relies on a stale state for the timer. Only when the <code>inOn</code> boolean flag changes the state is fine. In order to receive always the latest state for the timer when the interval is running, you can use a function instead for the state update function which always has the latest state.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer =&gt; timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>An alternative would have been to run the effect also when the timer changes. Then the effect would receive the latest timer state.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn, timer]);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s the implementation for the stopwatch that uses the Browser API If you want to continue, you can extend the example by providing a â€œResetâ€ button too.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOn, setIsOn] = useState(false);</span><br><span class="line">  const [timer, setTimer] = useState(0);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    let interval;</span><br><span class="line"></span><br><span class="line">    if (isOn) &#123;</span><br><span class="line">      interval = setInterval(</span><br><span class="line">        () =&gt; setTimer(timer =&gt; timer + 1),</span><br><span class="line">        1000,</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; clearInterval(interval);</span><br><span class="line">  &#125;, [isOn]);</span><br><span class="line"></span><br><span class="line">  const onReset = () =&gt; &#123;</span><br><span class="line">    setIsOn(false);</span><br><span class="line">    setTimer(0);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;timer&#125;</span><br><span class="line"></span><br><span class="line">      &#123;!isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(true)&#125;&gt;</span><br><span class="line">          Start</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &#123;isOn &amp;&amp; (</span><br><span class="line">        &lt;button type=&quot;button&quot; onClick=&#123;() =&gt; setIsOn(false)&#125;&gt;</span><br><span class="line">          Stop</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line"></span><br><span class="line">      &lt;button type=&quot;button&quot; disabled=&#123;timer === 0&#125; onClick=&#123;onReset&#125;&gt;</span><br><span class="line">        Reset</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Thatâ€™s it. The useEffect hook is used for side-effects in React function components that are used for interacting with the Browser/DOM API or other third-party APIs (e.g. data fetching). You can read more about <a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener">the useEffect hook in Reactâ€™s documentation</a>.</p><p>Last but not least, after you have learned about the two most popular hooks that introduce state and side-effects in function components, there is one last thing I want to show you: custom hooks. Thatâ€™s right, you can implement your own custom React Hooks that can be reused in your application or by others. Letâ€™s see how they work with an example application which is able to detect whether your device is online or offline.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Again, introduce the useEffect hook for the side-effect. In this case, the effect adds and removes listeners that check if the device is online or offline. Both listeners are setup only once on mount and cleaned up once on unmount (empty array as second argument). Whenever one of the listeners is called, it sets the state for the <code>isOffline</code> boolean.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  function onOffline() &#123;</span><br><span class="line">    setIsOffline(true);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function onOnline() &#123;</span><br><span class="line">    setIsOffline(false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    window.addEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">    window.addEventListener(&apos;online&apos;, onOnline);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.removeEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">      window.removeEventListener(&apos;online&apos;, onOnline);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Everything is nicely encapsulated in one effect now. Itâ€™s a great functionality which should be reuse somewhere else too. Thatâ€™s why we can extract the functionality as its a custom hook which follows the same naming convention as the other hooks.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function useOffline() &#123;</span><br><span class="line">  const [isOffline, setIsOffline] = useState(false);</span><br><span class="line"></span><br><span class="line">  function onOffline() &#123;</span><br><span class="line">    setIsOffline(true);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function onOnline() &#123;</span><br><span class="line">    setIsOffline(false);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    window.addEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">    window.addEventListener(&apos;online&apos;, onOnline);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      window.removeEventListener(&apos;offline&apos;, onOffline);</span><br><span class="line">      window.removeEventListener(&apos;online&apos;, onOnline);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return isOffline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  const isOffline = useOffline();</span><br><span class="line"></span><br><span class="line">  if (isOffline) &#123;</span><br><span class="line">    return &lt;div&gt;Sorry, you are offline ...&lt;/div&gt;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;You are online!&lt;/div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure><p>Extracting the custom hook as function was not the only thing. You also have to return the <code>isOffline</code> state from the custom hook in order to use it in your application to show a message to users who are offline. Otherwise, it should render the normal application. Thatâ€™s it for the custom hook that detects whether you are online or offline. You can read more about <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener">custom hooks in Reactâ€™s documentation</a>.</p><p>React Hooks being reusable is the best thing about them, because there is the potential to grow an ecosystem of custom React Hooks that can be installed from npm for any React application. And not only for React applications. Evan You, creator of Vue, <a href="https://twitter.com/youyuxi/status/1056042395891105793" target="_blank" rel="noopener">is hooked (!) by them as well</a>. Maybe we will see a bridge between both ecosystems where it is possible to share hooks between Vue and React.</p><hr><p>If you want to dive deeper into the state and effect hooks, you can check out the following React hook tutorials:</p><ul><li><a href="https://www.robinwieruch.de/react-usereducer-hook/" target="_blank" rel="noopener">How to useReducer Hook?</a></li><li><a href="https://www.robinwieruch.de/react-hooks-migration" target="_blank" rel="noopener">Migration from Class Components to Hooks</a></li><li><a href="https://www.robinwieruch.de/react-usereducer-vs-usestate/" target="_blank" rel="noopener">Comparison useState vs useReducer</a></li><li><a href="https://www.robinwieruch.de/react-state-usereducer-usestate-usecontext" target="_blank" rel="noopener">Modern State Management with Hooks</a></li><li><a href="https://www.robinwieruch.de/react-hooks-fetch-data" target="_blank" rel="noopener">How to fetch data with React Hooks</a></li></ul><p>Checkout the official <a href="https://reactjs.org/docs/hooks-faq.html" target="_blank" rel="noopener">FAQ</a> and <a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener">Rules</a> for hooks in Reactâ€™s documentation to learn more about their fine-grained behaviour. In addition, you can checkout <a href="https://reactjs.org/docs/hooks-reference.html" target="_blank" rel="noopener">all officially available React Hooks</a> too.</p><p>For everyone who is still concerned about React Hooks: Give them a shot yourself. Implement a couple of React function components with state and side-effects. I had to do it myself to understand how they work and to feel comfortable with them. And I must say it feels pretty great to use them.</p><h2 id="The-Road-to-learn-React"><a href="#The-Road-to-learn-React" class="headerlink" title="The Road to learn React"></a>The Road to learn React</h2><p><img src="https://www.robinwieruch.de/img/page/cover.png" alt=""></p><p>Build a Hacker News App along the way. No setup configuration. No tooling. No Redux. Plain React in 200+ pages of learning material. Learn React like <strong>50.000+ readers</strong>.</p><p><a href="https://roadtoreact.com/" target="_blank" rel="noopener">Get the Book for free</a></p><h3 id="Never-miss-an-article-about-web-development-JavaScript-and-self-growth"><a href="#Never-miss-an-article-about-web-development-JavaScript-and-self-growth" class="headerlink" title="Never miss an article about web development, JavaScript and self-growth."></a>Never miss an article about web development, JavaScript and self-growth.</h3><h2 id="Take-Part"><a href="#Take-Part" class="headerlink" title="Take Part"></a>Take Part</h2><h3 id="Join-30-000-Developers"><a href="#Join-30-000-Developers" class="headerlink" title="Join 30.000+ Developers"></a>Join 30.000+ Developers</h3><h3 id="Learn-Web-Development-with-JavaScript"><a href="#Learn-Web-Development-with-JavaScript" class="headerlink" title="Learn Web Development with JavaScript"></a>Learn Web Development with JavaScript</h3><h3 id="Tips-and-Tricks"><a href="#Tips-and-Tricks" class="headerlink" title="Tips and Tricks"></a>Tips and Tricks</h3><h3 id="Access-Tutorials-eBooks-and-Courses"><a href="#Access-Tutorials-eBooks-and-Courses" class="headerlink" title="Access Tutorials, eBooks and Courses"></a>Access Tutorials, eBooks and Courses</h3><h3 id="Personal-Development-as-a-Software-Engineer"><a href="#Personal-Development-as-a-Software-Engineer" class="headerlink" title="Personal Development as a Software Engineer"></a>Personal Development as a Software Engineer</h3><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      RWieruch - What are React Hooks
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/React-Hooks/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
      <category term="React Hooks" scheme="https://andyxw.com/tags/React-Hooks/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯ç›¸å…³æ–‡ç« æ”¶è—</title>
    <link href="https://andyxw.com/archives/f37d.html"/>
    <id>https://andyxw.com/archives/f37d.html</id>
    <published>2018-10-24T02:15:36.000Z</published>
    <updated>2019-09-04T13:19:15.518Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><h6 id="å‰ç«¯æ¶æ„"><a href="#å‰ç«¯æ¶æ„" class="headerlink" title="å‰ç«¯æ¶æ„"></a>å‰ç«¯æ¶æ„</h6><blockquote><p><a href="https://github.com/sorrycc/blog/issues/6" target="_blank" rel="noopener">æ”¯ä»˜å®å‰ç«¯åº”ç”¨æ¶æ„çš„å‘å±•å’Œé€‰æ‹©</a></p></blockquote><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      å‰ç«¯ç›¸å…³æ–‡ç« æ”¶è—
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="æ–‡ç« æ”¶è—" scheme="https://andyxw.com/tags/%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡å™¨é‡ç½®å¯†ç </title>
    <link href="https://andyxw.com/archives/fe92.html"/>
    <id>https://andyxw.com/archives/fe92.html</id>
    <published>2018-10-15T09:33:12.000Z</published>
    <updated>2018-10-15T12:00:55.263Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p>æœ‰æ—¶å€™ä¼šå¿˜è®°æœåŠ¡å™¨å¯†ç ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®˜ç½‘é¢æ¿ç­‰æ–¹å¼è¿ä¸Šæ—¶ï¼Œå¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹rootå¯†ç ï¼š<br>æ•´æ®µèµ‹å€¼ä¸‹é¢çš„å‘½ä»¤ï¼ˆâ€æ–°å¯†ç â€å¤„ æ›¿æ¢ä¸ºè¦ä¿®æ”¹çš„å¯†ç ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo root:æ–°å¯†ç  |sudo chpasswd root</span><br><span class="line">sudo sed -i &apos;s/^.*PermitRootLogin.*/PermitRootLogin yes/g&apos; /etc/ssh/sshd_config;</span><br><span class="line">sudo sed -i &apos;s/^.*PasswordAuthentication.*/PasswordAuthentication yes/g&apos; /etc/ssh/sshd_config;</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>é‡å¯åç”¨rootè´¦æˆ·ç™»å½•å³å¯ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      LinuxæœåŠ¡å™¨é‡ç½®å¯†ç 
    
    </summary>
    
      <category term="æœåŠ¡å™¨" scheme="https://andyxw.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    
      <category term="æœåŠ¡å™¨" scheme="https://andyxw.com/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
      <category term="Linux" scheme="https://andyxw.com/tags/Linux/"/>
    
      <category term="é‡ç½®å¯†ç " scheme="https://andyxw.com/tags/%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>è§£å¯†ä¼ ç»Ÿç»„ä»¶é—´é€šä¿¡ä¸Reactç»„ä»¶é—´é€šä¿¡</title>
    <link href="https://andyxw.com/archives/ac71.html"/>
    <id>https://andyxw.com/archives/ac71.html</id>
    <published>2018-08-17T08:39:36.000Z</published>
    <updated>2019-09-04T13:22:44.156Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p>åœ¨Reactä¸­æœ€å°çš„é€»è¾‘å•å…ƒæ˜¯ç»„ä»¶ï¼Œç»„ä»¶ä¹‹é—´å¦‚æœæœ‰è€¦åˆå…³ç³»å°±ä¼šè¿›è¡Œé€šä¿¡ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç»Reactä¸­çš„ç»„ä»¶é€šä¿¡çš„ä¸åŒæ–¹å¼</p><p>é€šè¿‡å½’çº³èŒƒï¼Œå¯ä»¥å°†ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡å½’ç±»ä¸ºå››ç§ç±»å‹çš„ç»„ä»¶é—´é€šä¿¡ï¼Œåˆ†åˆ«æ˜¯çˆ¶å­ç»„ä»¶ï¼Œçˆ·å­™ç»„ä»¶ï¼Œå…„å¼Ÿç»„ä»¶å’Œä»»æ„ç»„ä»¶ï¼Œ<br>éœ€è¦æ³¨æ„çš„æ˜¯å‰ä¸‰ä¸ªä¹Ÿå¯ä»¥ç®—ä½œä»»æ„ç»„ä»¶çš„èŒƒç•´ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªæ˜¯ä¸‡èƒ½æ–¹æ³•</p><h3 id="çˆ¶å­ç»„ä»¶"><a href="#çˆ¶å­ç»„ä»¶" class="headerlink" title="çˆ¶å­ç»„ä»¶"></a>çˆ¶å­ç»„ä»¶</h3><p>çˆ¶å­ç»„ä»¶é—´çš„é€šä¿¡åˆ†ä¸ºçˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡å’Œå­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡ä¸¤ç§æƒ…å†µï¼Œä¸‹é¢å…ˆæ¥ä»‹ç»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šä¿¡ï¼Œ<br>ä¼ ç»Ÿåšæ³•åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«æ˜¯åˆå§‹åŒ–æ—¶çš„å‚æ•°ä¼ é€’å’Œå®ä¾‹é˜¶æ®µçš„æ–¹æ³•è°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="comment">// è·å–domå¼•ç”¨</span></span><br><span class="line">        <span class="keyword">this</span>.$div = <span class="built_in">document</span>.querySelector(<span class="string">'#wp'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–æ—¶ä¼ å…¥name</span></span><br><span class="line">        <span class="keyword">this</span>.updateName(name);</span><br><span class="line">    &#125;</span><br><span class="line">    updateName(name) &#123;</span><br><span class="line">        <span class="comment">// å¯¹å¤–æä¾›æ›´æ–°çš„api</span></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// æ›´æ–°dom</span></span><br><span class="line">        <span class="keyword">this</span>.$div.innerHTML = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µ</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child(<span class="string">'yan'</span>);</span><br><span class="line">        </span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–é˜¶æ®µ</span></span><br><span class="line">            <span class="keyword">this</span>.child.updateName(<span class="string">'hou'</span>);</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Reactä¸­å°†ä¸¤ä¸ªæƒ…å†µç»Ÿä¸€å¤„ç†ï¼Œå…¨éƒ¨é€šè¿‡å±æ€§æ¥å®Œæˆï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿™æ ·æ˜¯å› ä¸ºReactåœ¨å±æ€§æ›´æ–°æ—¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œ<br>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ2ç§’åå­ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œå¹¶è·å–æ–°çš„å±æ€§å€¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µ</span></span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">name</span>: <span class="string">'yan'</span>&#125;;</span><br><span class="line"></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–é˜¶æ®µ</span></span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;<span class="attr">name</span>: <span class="string">'hou'</span>&#125;)</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">name</span>=<span class="string">&#123;this.state.name&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å­ç»„ä»¶å¦‚ä½•å‘çˆ¶ç»„ä»¶é€šä¿¡ï¼Œä¼ ç»Ÿåšæ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å›è°ƒå‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ä¸ºå­ç»„ä»¶éƒ¨ç½²æ¶ˆæ¯æ¥å£</p><p>å…ˆæ¥çœ‹å›è°ƒå‡½æ•°çš„ä¾‹å­ï¼Œå›è°ƒå‡½æ•°çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç¼ºç‚¹å°±æ˜¯å¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥ï¼Œå¹¶ä¸”ä¸å¯æ’¤å›ï¼Œå¹¶ä¸”åªèƒ½ä¼ å…¥ä¸€ä¸ªå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(cb) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç»„ä»¶ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œå‘é€æ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; cb() &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'child update'</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹çœ‹æ¶ˆæ¯æ¥å£æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªå¯ä»¥å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯çš„åŸºç±»ï¼Œæ¯”å¦‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªç®€å•çš„<code>EventEimtter</code>ï¼Œå®é™…ç”Ÿäº§ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ«äººå†™å¥½çš„ç±»åº“ï¼Œæ¯”å¦‚<a href="https://github.com/jsmini/event" target="_blank" rel="noopener">@jsmini/event</a>ï¼Œå­ç»„ä»¶ç»§æ‰¿æ¶ˆæ¯åŸºç±»ï¼Œå°±æœ‰äº†å‘å¸ƒæ¶ˆæ¯çš„èƒ½åŠ›ï¼Œç„¶åçˆ¶ç»„ä»¶è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯ï¼Œå³å¯å®ç°å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡çš„åŠŸèƒ½</p><p>æ¶ˆæ¯æ¥å£çš„ä¼˜ç‚¹å°±æ˜¯å¯ä»¥éšå¤„è®¢é˜…ï¼Œå¹¶ä¸”å¯ä»¥å¤šæ¬¡è®¢é˜…ï¼Œè¿˜å¯ä»¥å–æ¶ˆè®¢é˜…ï¼Œç¼ºç‚¹æ˜¯ç•¥æ˜¾éº»çƒ¦ï¼Œéœ€è¦å¼•å…¥æ¶ˆæ¯åŸºç±»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯æ¥å£ï¼Œè®¢é˜…å‘å¸ƒæ¨¡å¼ï¼Œç±»ä¼¼ç»‘å®šäº‹ä»¶ï¼Œè§¦å‘äº‹ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventMap = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sub(name, cb) &#123;</span><br><span class="line">        <span class="keyword">const</span> eventList = <span class="keyword">this</span>.eventMap[name] = <span class="keyword">this</span>.eventMap[name] || &#123;&#125;;</span><br><span class="line">        eventList.push(cb);</span><br><span class="line">    &#125;</span><br><span class="line">    pub(name, ...data) &#123;</span><br><span class="line">        (<span class="keyword">this</span>.eventMap[name] || []).forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(...data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// é€šè¿‡æ¶ˆæ¯æ¥å£å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">this</span>.pub(<span class="string">'update'</span>) &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é˜¶æ®µï¼Œä¼ å…¥å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.child = <span class="keyword">new</span> Child();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¢é˜…å­ç»„ä»¶çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">this</span>.child.sub(<span class="string">'update'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'child update'</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Backbone.jså°±åŒæ—¶æ”¯æŒå›è°ƒå‡½æ•°å’Œæ¶ˆæ¯æ¥å£æ–¹å¼ï¼Œä½†Reactä¸­é€‰æ‹©äº†æ¯”è¾ƒç®€å•çš„å›è°ƒå‡½æ•°æ¨¡å¼ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹Reactçš„ä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="keyword">this</span>.props.cb() &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">cb</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;console.log('update')&#125;&#125; /&gt;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="çˆ·å­™ç»„ä»¶"><a href="#çˆ·å­™ç»„ä»¶" class="headerlink" title="çˆ·å­™ç»„ä»¶"></a>çˆ·å­™ç»„ä»¶</h3><p>çˆ¶å­ç»„ä»¶å…¶å®å¯ä»¥ç®—æ˜¯çˆ·å­™ç»„ä»¶çš„ä¸€ç§ç‰¹ä¾‹ï¼Œè¿™é‡Œçš„çˆ·å­™ç»„ä»¶ä¸å…‰æŒ‡çˆ·çˆ·å’Œå­™å­ï¼Œè€Œæ˜¯æ³›æŒ‡ç¥–å…ˆä¸åä»£ç»„ä»¶é€šä¿¡ï¼Œå¯èƒ½éš”ç€å¾ˆå¤šå±‚çº§ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº†çˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜ï¼Œæ ¹æ®åŒ–å½’æ³•ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºçˆ·å­™ç»„ä»¶çš„ç­”æ¡ˆï¼Œé‚£å°±æ˜¯å±‚å±‚ä¼ é€’å±æ€§ä¹ˆï¼ŒæŠŠçˆ·å­™ç»„ä»¶é€šä¿¡åˆ†è§£ä¸ºå¤šä¸ªçˆ¶å­ç»„ä»¶é€šä¿¡çš„é—®é¢˜</p><p>å±‚å±‚ä¼ é€’çš„ä¼˜ç‚¹æ˜¯éå¸¸ç®€å•ï¼Œç”¨å·²æœ‰çŸ¥è¯†å°±èƒ½è§£å†³ï¼Œé—®é¢˜æ˜¯ä¼šæµªè´¹å¾ˆå¤šä»£ç ï¼Œéå¸¸ç¹çï¼Œä¸­é—´ä½œä¸ºæ¡¥æ¢çš„ç»„ä»¶ä¼šå¼•å…¥å¾ˆå¤šä¸å±äºè‡ªå·±çš„å±æ€§</p><p>åœ¨Reactä¸­ï¼Œé€šè¿‡contextå¯ä»¥è®©ç¥–å…ˆç»„ä»¶ç›´æ¥æŠŠå±æ€§ä¼ é€’åˆ°åä»£ç»„ä»¶ï¼Œæœ‰ç‚¹ç±»ä¼¼æ˜Ÿé™…æ—…è¡Œä¸­çš„è™«æ´ä¸€æ ·ï¼Œé€šè¿‡contextè¿™ä¸ªç‰¹æ®Šçš„æ¡¥æ¢ï¼Œå¯ä»¥è·¨è¶Šä»»æ„å±‚æ¬¡å‘åä»£ç»„ä»¶ä¼ é€’æ¶ˆæ¯</p><p>æ€ä¹ˆåœ¨éœ€è¦é€šä¿¡çš„ç»„ä»¶ä¹‹é—´å¼€å¯è¿™ä¸ªè™«æ´å‘¢ï¼Ÿéœ€è¦åŒå‘å£°æ˜ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¥–å…ˆç»„ä»¶å£°æ˜å±æ€§ï¼Œå¹¶åœ¨åä»£ç»„ä»¶ä¸Šå†æ¬¡å£°æ˜å±æ€§ï¼Œç„¶ååœ¨ç¥–å…ˆç»„ä»¶ä¸Šæ”¾ä¸Šå±æ€§å°±å¯ä»¥äº†ï¼Œå°±å¯ä»¥åœ¨åä»£ç»„ä»¶è¯»å–å±æ€§äº†ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åä»£ç»„ä»¶å£°æ˜éœ€è¦è¯»å–contextä¸Šçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        text: PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡this.context è¯»å–contextä¸Šçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.context.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ancestor</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¥–å…ˆç»„ä»¶å£°æ˜éœ€è¦æ”¾å…¥contextä¸Šçš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        text: PropTypes.string</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¥–å…ˆç»„ä»¶å¾€contextæ”¾å…¥æ•°æ®</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">text</span>: <span class="string">'yanhaijing'</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>contextçš„ä¼˜ç‚¹æ˜¯å¯ä»¥çœå»å±‚å±‚ä¼ é€’çš„éº»çƒ¦ï¼Œå¹¶ä¸”é€šè¿‡åŒå‘å£°æ˜æ§åˆ¶äº†æ•°æ®çš„å¯è§æ€§ï¼Œå¯¹äºå±‚æ•°å¾ˆå¤šæ—¶ï¼Œä¸å¤±ä¸ºä¸€ç§æ–¹æ¡ˆï¼›ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±åƒå…¨å±€å˜é‡ä¸€æ ·ï¼Œå¦‚æœä¸åŠ èŠ‚åˆ¶å¾ˆå®¹æ˜“é€ æˆæ··ä¹±ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å‡ºç°é‡åè¦†ç›–çš„é—®é¢˜</p><p>ä¸ªäººçš„å»ºè®®æ˜¯å¯¹ä¸€äº›æ‰€æœ‰ç»„ä»¶å…±äº«çš„åªè¯»ä¿¡æ¯å¯ä»¥é‡‡ç”¨contextæ¥ä¼ é€’ï¼Œæ¯”å¦‚ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ç­‰</p><p><em>å°è´´å£«ï¼šReact Routerè·¯ç”±å°±æ˜¯é€šè¿‡contextæ¥ä¼ é€’è·¯ç”±å±æ€§çš„</em></p><h3 id="å…„å¼Ÿç»„ä»¶"><a href="#å…„å¼Ÿç»„ä»¶" class="headerlink" title="å…„å¼Ÿç»„ä»¶"></a>å…„å¼Ÿç»„ä»¶</h3><p>å¦‚æœä¸¤ä¸ªç»„ä»¶æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå¯ä»¥é€šè¿‡çˆ¶ç»„ä»¶ä½œä¸ºæ¡¥æ¢ï¼Œæ¥è®©ä¸¤ä¸ªç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œè¿™å…¶å®å°±æ˜¯ä¸»æ¨¡å—æ¨¡å¼</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªå­ç»„ä»¶é€šè¿‡çˆ¶ç»„ä»¶æ¥å®ç°æ˜¾ç¤ºæ•°å­—åŒæ­¥çš„åŠŸèƒ½</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.onChange = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;num&#125;)</span><br><span class="line">        &#125;.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Child1 num=&#123;<span class="keyword">this</span>.state.num&#125; onChange=&#123;<span class="keyword">this</span>.onChange&#125;&gt;</span><br><span class="line">                &lt;Child2 num=&#123;<span class="keyword">this</span>.state.num&#125; onChange=&#123;<span class="keyword">this</span>.onChange&#125;&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸»æ¨¡å—æ¨¡å¼çš„ä¼˜ç‚¹å°±æ˜¯è§£è€¦ï¼ŒæŠŠä¸¤ä¸ªå­ç»„ä»¶ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œè§£è€¦æˆå­ç»„ä»¶å’Œçˆ¶ç»„ä»¶ä¹‹é—´çš„è€¦åˆï¼ŒæŠŠåˆ†æ•£çš„ä¸œè¥¿æ”¶é›†åœ¨ä¸€èµ·å¥½å¤„éå¸¸æ˜æ˜¾ï¼Œèƒ½å¸¦æ¥æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</p><h3 id="ä»»æ„ç»„ä»¶"><a href="#ä»»æ„ç»„ä»¶" class="headerlink" title="ä»»æ„ç»„ä»¶"></a>ä»»æ„ç»„ä»¶</h3><p>ä»»æ„ç»„ä»¶åŒ…æ‹¬ä¸Šé¢çš„ä¸‰ç§å…³ç³»ç»„ä»¶ï¼Œä¸Šé¢ä¸‰ç§å…³ç³»åº”è¯¥ä¼˜å…ˆä½¿ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•ï¼Œå¯¹äºä»»æ„çš„ä¸¤ä¸ªç»„ä»¶é—´é€šä¿¡ï¼Œæ€»å…±æœ‰ä¸‰ç§åŠæ³•ï¼Œåˆ†åˆ«æ˜¯å…±åŒç¥–å…ˆæ³•ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶å’ŒçŠ¶æ€ç®¡ç†</p><p>åŸºäºæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„çˆ·å­™ç»„ä»¶å’Œå…„å¼Ÿç»„ä»¶ï¼Œåªè¦æ‰¾åˆ°ä¸¤ä¸ªç»„ä»¶çš„å…±åŒç¥–å…ˆï¼Œå°±å¯ä»¥å°†ä»»æ„ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼Œè½¬åŒ–ä¸ºä»»æ„ç»„ä»¶å’Œå…±åŒç¥–å…ˆä¹‹é—´çš„é€šä¿¡ï¼Œè¿™ä¸ªæ–¹æ³•çš„å¥½å¤„å°±æ˜¯éå¸¸ç®€å•ï¼Œå·²çŸ¥çŸ¥è¯†å°±èƒ½æå®šï¼Œç¼ºç‚¹å°±æ˜¯ä¸Šé¢ä¸¤ç§æ¨¡å¼ç¼ºç‚¹çš„å åŠ ï¼Œé™¤äº†ä¸´æ—¶æ–¹æ¡ˆï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ³•</p><p>å¦ä¸€ç§æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå°±æ˜¯å¼•å…¥ä¸€ä¸ªå…¨å±€æ¶ˆæ¯å·¥å…·ï¼Œä¸¤ä¸ªç»„ä»¶é€šè¿‡è¿™ä¸ªå…¨å±€å·¥å…·è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·ä¸¤ä¸ªç»„ä»¶é—´çš„é€šä¿¡ï¼Œå°±é€šè¿‡å…¨å±€æ¶ˆæ¯åª’ä»‹å®Œæˆäº†</p><p>è¿˜è®°å¾—ä¸Šé¢ä»‹ç»çš„æ¶ˆæ¯åŸºç±»å—ï¼Ÿä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç»„ä»¶1å’Œç»„ä»¶2é€šè¿‡å…¨å±€eventè¿›è¡Œé€šä¿¡</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEimtter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.eventMap = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    sub(name, cb) &#123;</span><br><span class="line">        <span class="keyword">const</span> eventList = <span class="keyword">this</span>.eventMap[name] = <span class="keyword">this</span>.eventMap[name] || &#123;&#125;;</span><br><span class="line">        eventList.push(cb);</span><br><span class="line">    &#125;</span><br><span class="line">    pub(name, ...data) &#123;</span><br><span class="line">        (<span class="keyword">this</span>.eventMap[name] || []).forEach(<span class="function"><span class="params">cb</span> =&gt;</span> cb(...data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€æ¶ˆæ¯å·¥å…·</span></span><br><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> EventEimtter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¸ªç»„ä»¶</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        event.sub(<span class="string">'element2update'</span>, () =&gt; &#123;<span class="built_in">console</span>.log(<span class="string">'element2 update'</span>)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ä¸ªç»„ä»¶ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element2</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; event.pub(<span class="string">'element2update'</span>) &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¨¡å¼éå¸¸ç®€å•ï¼Œåˆ©ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå°†ä¸¤ä¸ªç»„ä»¶ä¹‹é—´çš„è€¦åˆè§£è€¦æˆäº†ç»„ä»¶å’Œæ¶ˆæ¯ä¸­å¿ƒ+æ¶ˆæ¯åç§°çš„è€¦åˆï¼Œä½†ä¸ºäº†è§£è€¦å´å¼•å…¥å…¨å±€æ¶ˆæ¯ä¸­å¿ƒå’Œæ¶ˆæ¯åç§°ï¼Œæ¶ˆæ¯ä¸­å¿ƒå¯¹ç»„ä»¶çš„ä¾µå…¥æ€§å¾ˆå¼ºï¼Œå’Œç¬¬ä¸‰æ–¹ç»„ä»¶é€šä¿¡ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼</p><p>å°å‹é¡¹ç›®æ¯”è¾ƒé€‚åˆä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½†éšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œè¾¾åˆ°ä¸­ç­‰é¡¹ç›®ä»¥åï¼Œæ¶ˆæ¯åå­—çˆ†ç‚¸å¼å¢é•¿ï¼Œæ¶ˆæ¯åå­—çš„ç»´æŠ¤æˆäº†æ£˜æ‰‹çš„é—®é¢˜ï¼Œé‡åæ¦‚ç‡æå¤§ï¼Œæ²¡æœ‰äººæ•¢éšä¾¿åˆ é™¤æ¶ˆæ¯ä¿¡æ¯ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…æ‰¾ä¸åˆ°æ¶ˆæ¯è®¢é˜…è€…çš„ä¿¡æ¯ç­‰</p><p>å…¶å®ä¸Šé¢çš„é—®é¢˜ä¹Ÿä¸æ˜¯æ²¡æœ‰è§£å†³åŠæ³•ï¼Œé‡åçš„é—®é¢˜å¯ä»¥é€šè¿‡åˆ¶å®šè§„èŒƒï¼Œæ¶ˆæ¯å‘½åç©ºé—´ç­‰æ–¹å¼æ¥æå¤§é™ä½å†²çªï¼Œå…¶ä»–é—®é¢˜å¯ä»¥é€šè¿‡æŠŠæ¶ˆæ¯åå­—ç»Ÿä¸€ç»´æŠ¤åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡å¯¹æ¶ˆæ¯çš„ä¸­å¿ƒåŒ–ç®¡ç†ï¼Œå¯ä»¥è®©å¾ˆå¤šé—®é¢˜éƒ½å¾ˆå®¹æ˜“è§£å†³</p><p>å¦‚æœä½ çš„é¡¹ç›®éå¸¸å¤§ï¼Œä¸Šé¢ä¸¤ç§æ–¹æ¡ˆéƒ½ä¸åˆé€‚ï¼Œé‚£ä½ å¯èƒ½éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·ï¼Œé€šè¿‡çŠ¶æ€ç®¡ç†å·¥å…·æŠŠç»„ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œå’Œå…³ç³»çš„å¤„ç†é€»è¾‘ä»ç»„å»ºä¸­æŠ½è±¡å‡ºæ¥ï¼Œå¹¶é›†ä¸­åŒ–åˆ°ç»Ÿä¸€çš„åœ°æ–¹æ¥å¤„ç†ï¼ŒReduxå°±æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„çŠ¶æ€ç®¡ç†å·¥å…·</p><p>é™¤äº†Reduxï¼Œè¿˜æœ‰Mobxï¼ŒRematchï¼Œreselectç­‰å·¥å…·ï¼Œæœ¬æ–‡ä¸å±•å¼€ä»‹ç»ï¼Œæœ‰æœºä¼šåé¢å•ç‹¬æˆæ–‡ï¼Œè¿™äº›éƒ½æ˜¯ç”¨æ¥è§£å†³ä¸åŒé—®é¢˜çš„ï¼Œåªè¦æ ¹æ®è‡ªå·±çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„å·¥å…·å°±å¥½äº†</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç»„ä»¶é—´çš„å…³ç³»åƒå˜ä¸‡åŒ–ï¼Œéƒ½å¯ä»¥ç”¨ä¸Šé¢ä»‹ç»çš„æ–¹æ³•è§£å†³ï¼Œå¯¹äºä¸åŒè§„æ¨¡çš„é¡¹ç›®ï¼Œåº”è¯¥é€‰æ‹©é€‚åˆè‡ªå·±çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸Šé¢ä»‹ç»çš„ä¸åŒæ–¹å¼è§£è€¦çš„ç¨‹åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…³äºä¸åŒè€¦åˆå…³ç³»çš„å¥½åï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€Š<a href="https://andyxw.com/archives/7e29.html">å›¾è§£7ç§è€¦åˆå…³ç³»</a>ã€‹</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡ä»‹ç»ä¼ ç»Ÿç»„ä»¶é—´é€šä¿¡ä¸Reactä¸­çš„ç»„ä»¶é€šä¿¡4ç§æ–¹å¼
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>å›¾è§£7ç§è€¦åˆå…³ç³»</title>
    <link href="https://andyxw.com/archives/7e29.html"/>
    <id>https://andyxw.com/archives/7e29.html</id>
    <published>2018-08-17T08:36:01.000Z</published>
    <updated>2018-08-17T08:42:17.490Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p>æ·±å…¥è®²è®²æ¨¡å—ä¹‹é—´çš„è€¦åˆå…³ç³»è¿™ä¸ªäº‹æƒ…ã€‚</p><p>æœ¬æ–‡å°†ç”¨å›¾æ–‡è¯¦ç»†è®²è§£ä¸ƒç§è€¦åˆçš„ä¸åŒä¹‹å¤„ã€‚</p><h2 id="é«˜å†…èšä¸ä½è€¦åˆ"><a href="#é«˜å†…èšä¸ä½è€¦åˆ" class="headerlink" title="é«˜å†…èšä¸ä½è€¦åˆ"></a>é«˜å†…èšä¸ä½è€¦åˆ</h2><p>é«˜å†…èšä¸ä½è€¦åˆæ˜¯æ¯ä¸ªè½¯ä»¶å¼€å‘è€…è¿½æ±‚çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå†…èšå’Œè€¦åˆåˆ†åˆ«æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p><img src="!--ï¿¼0--&gt;416.png" alt=""></p><blockquote><p>å†…èšæ˜¯ä»åŠŸèƒ½è§’åº¦æ¥åº¦é‡æ¨¡å—å†…çš„è”ç³»ï¼Œä¸€ä¸ªå¥½çš„å†…èšæ¨¡å—åº”å½“æ°å¥½åšä¸€ä»¶äº‹ã€‚å®ƒæè¿°çš„æ˜¯æ¨¡å—å†…çš„åŠŸèƒ½è”ç³»ã€‚</p></blockquote><blockquote><p>è€¦åˆæ˜¯è½¯ä»¶ç»“æ„ä¸­å„æ¨¡å—ä¹‹é—´ç›¸äº’è¿æ¥çš„ä¸€ç§åº¦é‡ï¼Œè€¦åˆå¼ºå¼±å–å†³äºæ¨¡å—é—´æ¥å£çš„å¤æ‚ç¨‹åº¦ã€è¿›å…¥æˆ–è®¿é—®ä¸€ä¸ªæ¨¡å—çš„ç‚¹ä»¥åŠé€šè¿‡æ¥å£çš„æ•°æ®ã€‚</p></blockquote><h2 id="è€¦åˆ"><a href="#è€¦åˆ" class="headerlink" title="è€¦åˆ"></a>è€¦åˆ</h2><p>ä¸åŒæ¨¡å—ä¹‹é—´çš„å…³ç³»å°±æ˜¯è€¦åˆï¼Œæ ¹æ®è€¦åˆç¨‹åº¦å¯ä»¥åˆ†ä¸º7ç§ï¼Œè€¦åˆåº¦ä¾æ¬¡å˜ä½ã€‚</p><ul><li>å†…å®¹è€¦åˆ</li><li>å…¬å…±è€¦åˆ</li><li>å¤–éƒ¨è€¦åˆ</li><li>æ§åˆ¶è€¦åˆ</li><li>æ ‡è®°è€¦åˆ</li><li>æ•°æ®è€¦åˆ</li><li>éç›´æ¥è€¦åˆ</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´æ¯ç§è€¦åˆæ˜¯ä»€ä¹ˆï¼Œå¼€å§‹ä¹‹å‰å…ˆæ¥è¯´ä¸‹è¦å®ç°çš„åŠŸèƒ½ã€‚m1å’Œm2æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå…¶ä¸­m2ç§ä¼šæ˜¾ç¤ºm1çš„è¾“å…¥ï¼Œm1ä¼šæ˜¾ç¤ºm2çš„è¾“å…¥ã€‚</p><p><img src="!--ï¿¼1--&gt;417.png" alt=""></p><p>å¾ˆæ˜¾ç„¶ï¼Œm1å’Œm2ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ä¼šæœ‰ä¸€äº›è”ç³»ï¼ˆè€¦åˆï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥æƒ³æƒ³å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¸‹é¢ç”¨7ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p><strong>æ³¨ï¼š</strong>é¡¹ç›®çš„ä»£ç æˆ‘æ”¾åˆ°äº†<a href="https://github.com/yanhaijing/coupling" target="_blank" rel="noopener">github</a>ï¼Œé¡¹ç›®çš„demoï¼Œå¯ä»¥åœ¨<a href="http://yanhaijing.com/coupling/" target="_blank" rel="noopener">è¿™é‡ŒæŸ¥çœ‹</a>ã€‚</p><h3 id="å†…å®¹è€¦åˆ"><a href="#å†…å®¹è€¦åˆ" class="headerlink" title="å†…å®¹è€¦åˆ"></a>å†…å®¹è€¦åˆ</h3><p>å†…å®¹è€¦åˆæ˜¯æœ€ç´§çš„è€¦åˆç¨‹åº¦ï¼Œä¸€ä¸ªæ¨¡å—ç›´æ¥è®¿é—®å¦ä¸€æ¨¡å—çš„å†…å®¹ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªæ¨¡å—ä¸ºå†…å®¹è€¦åˆã€‚</p><p><img src="!--ï¿¼2--&gt;418.png" alt=""></p><p>ä¸ºäº†å®ç°åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†m1çš„è¾“å…¥æ”¾åˆ°m2.m1inputä¸Šï¼Œå°†m2çš„è¾“å…¥æ”¾åˆ°m1.m2inputä¸Šã€‚</p><pre><code>// m1.jsroot.m2.m1input = this.value;m2.update();// m2.jsroot.m1.m2input = this.value;m1.update();</code></pre><p><strong>PS:</strong>ä¸çŸ¥é“è°ä¼šè¿™ä¹ˆå†™ä»£ç ï¼Œé™¤äº†æˆ‘ä¸ºäº†åšæ¼”ç¤ºä¹‹å¤–ã€‚ã€‚ã€‚</p><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo1" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo1/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="å…¬å…±è€¦åˆ"><a href="#å…¬å…±è€¦åˆ" class="headerlink" title="å…¬å…±è€¦åˆ"></a>å…¬å…±è€¦åˆ</h3><p>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€ä¸ªå…¨å±€æ•°æ®ç»“æ„ï¼Œåˆ™ç§°ä¹‹ä¸ºå…¬å…±è€¦åˆã€‚</p><p><img src="!--ï¿¼3--&gt;419.png" alt=""></p><p>åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€çš„dataä¸Šã€‚</p><pre><code>// m1.jsroot.data.m1input = this.value;m2.update();// m2.jsroot.data.m2input = this.value;m1.update();</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo2" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo2/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="å¤–éƒ¨è€¦åˆ"><a href="#å¤–éƒ¨è€¦åˆ" class="headerlink" title="å¤–éƒ¨è€¦åˆ"></a>å¤–éƒ¨è€¦åˆ</h3><p>ä¸€ç»„æ¨¡å—éƒ½è®¿é—®åŒä¸€å…¨å±€ç®€å•å˜é‡ï¼Œè€Œä¸”ä¸é€šè¿‡å‚æ•°è¡¨ä¼ é€’è¯¥å…¨å±€å˜é‡çš„ä¿¡æ¯ï¼Œåˆ™ç§°ä¹‹ä¸ºå¤–éƒ¨è€¦åˆã€‚å¤–éƒ¨è€¦åˆå’Œå…¬å…±è€¦åˆå¾ˆåƒï¼ŒåŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯ç®€å•å˜é‡ï¼Œä¸€ä¸ªæ˜¯å¤æ‚æ•°æ®ç»“æ„ã€‚</p><p><img src="!--ï¿¼4--&gt;420.png" alt=""></p><p>åœ¨è¿™ç§caseä¸­ï¼Œm1å’Œm2éƒ½å°†è‡ªå·±çš„è¾“å…¥æ”¾åˆ°å…¨å±€ä¸Šã€‚</p><pre><code>// m1.jsroot.m1input = this.value;m2.update();// m2.jsroot.m2input = this.value;m1.update();</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo3" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo3/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ§åˆ¶è€¦åˆ"><a href="#æ§åˆ¶è€¦åˆ" class="headerlink" title="æ§åˆ¶è€¦åˆ"></a>æ§åˆ¶è€¦åˆ</h3><p>æ¨¡å—ä¹‹é—´ä¼ é€’çš„ä¸æ˜¯æ•°æ®ä¿¡æ¯ï¼Œè€Œæ˜¯æ§åˆ¶ä¿¡æ¯ä¾‹å¦‚æ ‡å¿—ã€å¼€å…³é‡ç­‰ï¼Œä¸€ä¸ªæ¨¡å—æ§åˆ¶äº†å¦ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚</p><p>ä»æ§åˆ¶è€¦åˆå¼€å§‹ï¼Œæ¨¡å—çš„æ•°æ®å°±æ”¾åœ¨è‡ªå·±å†…éƒ¨äº†ï¼Œä¸åŒæ¨¡å—ä¹‹é—´é€šè¿‡æ¥å£äº’ç›¸è°ƒç”¨ã€‚</p><p><img src="!--ï¿¼5--&gt;421.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œå¾—å¢åŠ ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯å½“m1çš„è¾“å…¥ä¸ºç©ºæ—¶ï¼Œéšè—m2çš„æ˜¾ç¤ºä¿¡æ¯ã€‚</p><pre><code>// m1.jsroot.m1input = this.value;m2.update();m2.toggle(!!this.value); // ä¼ é€’flag</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­m1ç›´æ¥æ§åˆ¶äº†m2çš„æ˜¾ç¤ºå’Œéšè—ã€‚</p><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo4" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo4/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ ‡è®°è€¦åˆ"><a href="#æ ‡è®°è€¦åˆ" class="headerlink" title="æ ‡è®°è€¦åˆ"></a>æ ‡è®°è€¦åˆ</h3><p>è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´ä¼ é€’æ•°æ®ç»“æ„è€Œä¸æ˜¯ç®€å•æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿç§°ä½œç‰¹å¾è€¦åˆã€‚</p><p><img src="!--ï¿¼6--&gt;422.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><pre><code>// m1.jsme.m1input = this.value;m2.update(me); // ä¼ é€’å¼•ç”¨// m2.jsme.m2input = this.value;m1.update(me);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo5" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo5/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="æ•°æ®è€¦åˆ"><a href="#æ•°æ®è€¦åˆ" class="headerlink" title="æ•°æ®è€¦åˆ"></a>æ•°æ®è€¦åˆ</h3><p>è°ƒç”¨æ¨¡å—å’Œè¢«è°ƒç”¨æ¨¡å—ä¹‹é—´åªä¼ é€’ç®€å•çš„æ•°æ®é¡¹å‚æ•°ã€‚ç›¸å½“äºé«˜çº§è¯­è¨€ä¸­çš„å€¼ä¼ é€’ã€‚</p><p><img src="!--ï¿¼7--&gt;423.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseä¸­ï¼Œm1ä¼ ç»™m2çš„æ˜¯ä¸€ä¸ªç®€å•æ•°æ®ç»“æ„ã€‚</p><pre><code>// m1.jsme.m1input = this.value;m2.update(me.m1input); // ä¼ é€’å€¼// m2.jsme.m2input = this.value;m1.update(me.m2input);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo6" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo6/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h3 id="éç›´æ¥è€¦åˆ"><a href="#éç›´æ¥è€¦åˆ" class="headerlink" title="éç›´æ¥è€¦åˆ"></a>éç›´æ¥è€¦åˆ</h3><p>ä¸¤ä¸ªæ¨¡å—ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è”ç³»å®Œå…¨æ˜¯é€šè¿‡ä¸»æ¨¡å—çš„æ§åˆ¶å’Œè°ƒç”¨æ¥å®ç°çš„ã€‚è€¦åˆåº¦æœ€å¼±ï¼Œæ¨¡å—ç‹¬ç«‹æ€§æœ€å¼ºã€‚</p><p>å­æ¨¡å—æ— éœ€çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œå­æ¨¡å—ä¹‹é—´çš„è”ç³»ï¼Œå…¨éƒ¨å˜æˆå­æ¨¡å—å’Œä¸»æ¨¡å—ä¹‹é—´çš„è”ç³»ã€‚</p><p><img src="!--ï¿¼8--&gt;424.png" alt=""></p><p>åœ¨è¿™ä¸ªcaseç§ï¼Œå¢åŠ ä¸€ä¸ªindex.jsä½œä¸ºä¸»æ¨¡å—ã€‚</p><pre><code>// index.jsvar m1 = root.m1;var m2 = root.m2;m1.init(function (str) {    m2.update(str);});m2.init(function (str) {    m1.update(str);});// m1.jsme.m1input = this.value;inputcb(me.m1input); // inputcbæ˜¯å›è°ƒå‡½æ•°// m2.jsme.m2input = this.value;inputcb(me.m2input);</code></pre><p>æŸ¥çœ‹<a href="https://github.com/yanhaijing/coupling/tree/gh-pages/demo7" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>å’Œ<a href="http://yanhaijing.com/coupling/demo7/demo.html" target="_blank" rel="noopener">demo</a>ã€‚</p><h2 id="å†…èš"><a href="#å†…èš" class="headerlink" title="å†…èš"></a>å†…èš</h2><p>å…¶å®å…³äºå†…èšä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥è‡ªå·±ç ”ç©¶ç ”ç©¶ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†æ¥åˆ†äº«å†…èšçš„é—®é¢˜ã€‚</p><ul><li>å¶ç„¶å†…èš</li><li>é€»è¾‘å†…èš</li><li>æ—¶é—´å†…èš</li><li>é€šä¿¡å†…èš</li><li>é¡ºåºå†…èš</li><li>åŠŸèƒ½å†…èš</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¸Œæœ›ä½ çœ‹å®Œä¸Šé¢çš„æ–‡ç« ï¼Œææ‡‚äº†è€¦åˆçš„ç§ç±»ï¼Œä¹Ÿå¸Œæœ›ä½ ä»¥åèƒ½ä½¿ç”¨éç›´æ¥è€¦åˆè¿™ç§æ–¹å¼æ¥å†™ä»£ç ï¼Œç¥å¥½ã€‚</p><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      æœ¬æ–‡å°†ç”¨å›¾æ–‡è¯¦ç»†è®²è§£ä¸ƒç§è€¦åˆçš„ä¸åŒä¹‹å¤„
    
    </summary>
    
      <category term="æ¨¡å—åŒ–" scheme="https://andyxw.com/categories/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
    
      <category term="æ¨¡å—åŒ–" scheme="https://andyxw.com/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>é¸¡æ±¤</title>
    <link href="https://andyxw.com/archives/201.html"/>
    <id>https://andyxw.com/archives/201.html</id>
    <published>2018-08-05T02:32:11.000Z</published>
    <updated>2019-08-21T02:40:43.323Z</updated>
    
    <content type="html"><![CDATA[<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script><div id="security">  <div class="input-container">  <input type="password" class="form-control" id="pass" placeholder="è¿™æ˜¯ç¯‡æœ‰å¯†ç çš„åšå®¢" />    <label for="pass">è¿™æ˜¯ç¯‡æœ‰å¯†ç çš„åšå®¢</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">U2FsdGVkX19nIXYewi8xSTuJM3tACAv2fktBwlE9sqWoOugys6VA/eavQFssXU5vE7i74SZFrY8RFgXWf1y3EovjLyEmQbhqZlzX6B7h8q7+L1OWPbtuOrob2FbQSgzkF7RhKnKEhgaFNz+obnvffkGcy0g/T8EICYgD3+vBZ8mmKn5Lqvqif8jMz2ymTuinKXYo2P8rzddr5KmevDdxDWrWdk3PIURgl/Q0msMgjpgTG3YXRpr96Ik8b8SykE7LIC/5rySDMo4XD6MkP839vdpT63GgSpbKHEOWEwIHxX0iDqFD168INPn7R82rhPJn8LcuGHbCmkXjExnzNL7qGuQF7IAKq4bzAXlykLQZU9vpktUC8t2bLzV+77rEKRKMhMPjeyAlDEUCXV8JMZ9KhTN1G8qQp6BUSO1dFwTJ4c3k5SIsrm3OpLMuK+BtiiuTJITDw9WJo6TEg0e0oALFza2QbvT+DwMQsBBkRRXN2QLS2QZ+FtDrUHTQjzMEMmVoslCOiMuMmdFj8PJRaHn0R92HKo+h77ATtSSXQL/aAVDZHZhBfS5Tjgskh1wRPdqv31NPGEvMFyRY6b+/VmEiWu4uksBtf6cc+0qm8HHBBrzs1unoPUap964bJkMT9LIh9ruR3ECuhi3MeFzo6uSXUHhnYH92fpUihqPvG8Am8GAiR+oQyikKSbbSd6PAzpBtDxxBRxrLYi1W08k8z9Qgra2NaraaN472aXq8bOQbwjJX8P5W9XOosVo2oOv0njbZWKRdFDNC1v52BOhShGtZrIKA0Jk2hNMdKA/iUiI41268CH6MyVRQZZYKBfrbrXFKfTtWkQuAI2HmAXAezTjCRSI/dDMsg4tGXyHiuV94j9lBy/9ZTdNxXRvwgFezMgYV08NQL7yVqh/ZeXVKYr18wgZec9YxkgLD9DfTJObdvj50HCOrAGpdNLEaQlCviSBd5Ogc+imBmdU+rqGLWQp6vApyGx8m+Q81+EjlFPXNfm3pQma54Ym/uM7Y52Sm7T9tdJNaAuTC2I9ZnuEbPIifYgP4XRFrawsDIQyD2/YWQ8ga5hO4dq00+ZN89ZjcltIOy7pNE5v05P4UbukSMHlU93ifUBCM5Pr3v+C29sYW3XLqh7jy+l65fVqTTIBtjor13ovOEY3wvBH2e7JPIJqS3UgxcpIx9MUCs3Oos/602vKUrH2nZ93oPVqKO7ZXNzx/sAy3+f3BXftx6x8ND5X9y6P0DpRwdtD6R70OiQPHP9Y9deGKYvo0JRc0QHpYVmaIp9/v/OgzcG2hGS3WmnlLVzy7gwRs+RK6pejQtLU4/dv0ph/WKYAkbaII4adZsyLwI9ZTcI7fv9o3DnFE+IZA5bAsjSNHdm2iq1SQPbJlK7/eJa2OzV6Xdgdpcjr7l7oXzbv9xlb0M2yAyHPk5sd91d3W9CW0DBCJv8Yhvgq3SseM8GzUno/HVUYI9NgPuDny0Yls4677VxWwWMys7vaIed2rd2Cbm9nj1DpuxkeCjdmADLqLUMgSf0EmY6L243btqTPf05K9zHS6qp+jrrdzd4WMcW+gv/u9fDyuveNFTmDTLTfcUjzz1NBXdlSEkFVrFwQ+t/N8SYz27fw2kWaDiIDld2aPT1J7Uh6Ca8jf81wrLh6MW8OWaQcmzm1+VH22mVSwCP00DoOAJWHA3oBkye0VTEWBnCvUnBm6mIeJ+p8MW6CtRywNdYpSArwbWAdxl7B9Z6aIegsywbYz4idAfy2Jw9tsVdXwOOXgmuWHrbkI6GEGjua+u86FgEWW1ottwDSZcJ7ugrMvheUnqOp+ThlJlX9Dq+ChH1/V1TyZgOd7j3QJkci/Y2zIbAPokG0FRGbNWxNwV5OAwh/7EcHcRYlPWOU5HdMcQSPVHVygpHDxJc8MguXJyrhzPnV2zw2mdV3ieYgNYVNMXnSuiOmB608MkB8ndOaszTyDz+u7fKkm369Z/LV34kazZekRzG9lsxZANCs7MwPQesDLUFZhqHccTlcOEFS7qgJqkbqvjvUZidlj6USyPvVFbLpgT+3bueH2Vq7tXQ/FV/vVJmmXjUHIqRelPKgDqnAmUL1BhIhPWrbkLOAxjWS0emDJaawsGMoSE3lLD7BNqLsMJEBf7CiEEwb5KnSf5sThIvbsG9T0r14A7ARcVZJhJwVnAlYwMbeEMMAz3Gz2af7hgdJcOsG4drzTYetVNs70nE2vf1qb6httnFujTNJGIbbwEzOF3lAtyKHpKh+9gAXcmm9YY1PtvTliFJ6BUGANMg8AkDrFPncow9LMNpiKoxNojTCIMGdABKFU7cKFaSCpc1lu5Hl1cu8YC64/P8s4wU0N8yquD5ppu8H+bWbviuSq9fvCIjMjP/KF9R4X+05oE03btqjyGGiiiE90yh8Q3rmuo37oVnusfOlwqY8ay3PxSeUXfyCja03b9VYKaKBrQwpZFZv8qirW9VFWUfHKGkrx+gKwAEAoBI4zFaRy8RUNU9/+0KmOezZmMzlpIPNF4CP41tDvDlFhgXEr5gzjju5wMh+veXnO3VW0usK5usihFlM49R3sCzGzDwoXmjNAJvR6PfzMti4JoZtWqvc7KFN0lVl/m9wuZ86aQ4rcBlN7cpCxHZFsX+DKmqPGG44Jnkc0uktqwwOFYCz261zoJd7CQfpmUqYjYQDUIr6xD9um+tGKtyBQCEuvzpYktKL8pGjuqX3u1iw5bfqPDk5Wo4QPySarq6pAe7RBJbFFoqpNsg6lkPMScJQjKOirmpOa9s/DKAPnQIv4JO1hMjprJlF6gsCGYLrvc9Nu4FG4XJTH8pwCpSBZtH63WHY01vTRyAO6Ib7pXJIKBueBe1PtVu7a0DLMgRXRmg44GJD2ZEQT5R66lFqIAFLRdj1Vg1d7EbkTdPKvW8xoZCdfph7oecmCAj6sJqcR2QFv4TKSLwhGI8wtbykZfp73LOLdwiC1ckovUWOPoQpbqDGfsHk/EjZXXmhKPGcN/t8UL5qUAWxx1bZfUOBJWb7VXUtgBmenAV0aqFw62X2C3+S9YYMVmJ4lmWZT4PHh+eW4+QLmk/kVD7jOHvUk4d4WdH3150vE+IXAbewBaYuBIZpdXMsSqwtMuolxR3IKO3z94ABnlpv3iMJQzSzhWZPx+4jGkuyQc/ldJlt9ZBrbjRV1OSvFt8xY0q2WrDtdzGKcNMBuWElVisOQO907Oyezdbhq62OawUd6AigIrI97PoWjwvo/I9Hp/jn1gJhQce7ZbcQg/hoi21XaO26Eyaxb176OxDoJC2mIXnM9lj60AXyZJokpNs/7zV9PZHfj0biZgS5FsWn8ZaB+jKT4kdzQTECyALTXh8+1sQ3KvgHB4dUvl8Kazb+r9WsFta/S67b2AKgWRQF6hZZ9U/gKF7ODvXRvW0zP654UI+f1py/xCrRv6mZJKSe5yo7onADF5HrFS4tLsYhH+aC8Mz5qaJFpHBChGH+8wmjTmURdFU2nBLYpmCbVZ2XmT6T3nQo6WQ1JoK/y0jxd7zsD10f7p+RfWgf9JIi+5IXNe5KekZX+zlvDgTjazwVLs+HQ4tDBrwvE1P+20p9pVDSsRj0zYipDO4VWFoxiLJTyfCY0dY/zp//uzjrhkwoEIGgunw1jziKi5Yu9fqvvFHqySsaPItUUnW81LW46NDpJdagNMtI8CGLcZC77MgGSqdjwJElg+4GhQBKVwEiMq/gv+bdF1fdHXsDYYw8xYHFthvAmR6ZTWED38RjfHw8UTEBOAamaO6jHmUeLXoEOvXMuONKYAvOtKbhS+taGaG5SHd06fJ81vp2pMU+XCiIBRUStySCOx/MuN5lyJiK2E4rKvB2MBhkEsd7yX0ZUOZES0yGYDQtZ3kpyi3z3brPD7MWdnpvAvUeNUD5ENCjayjhEvvDu4i/k/UbkPVBJ/c0hIFbbOz8GYUiRXvkDdCF00+UoivTp3Kxu8LFc/ZjCdszb1Z2b/OJEyoPjcmaic4S4Rs6865FTfHMYBxuSivRrAJdixJX/NUxxHYspCqO2wcsP3YG1Cly7BW0EqyAWvQEFMfHAuk9bMZ3Z5Zp9Nzp/S8fXFlSlB7D7R7yiXe/qpQh/6X+Q9hMj8tVgDPznRJyQY+ReaSRLzSm38Cahwg5e9UBf6/dLBzoFSYo01wQYfQrlt4LEc5GsEq4tJTK18hBv0/Mii7M8cH11u2i/DQlkadXkBwVbrnxqphC2mw+10zy4eO9Mox3lrcFDHE4unAI0DFeeGODsx6F8088obX556lf05RzCmvoqf808v2Z6/cbRSfLmGLGm5yJEcEySJ9GEG3PjtXhH3Jaik/REk9keP2Mi46fa40KDkz4DzvOiArMXeZgw3k9TEbkysqlmcFd+Uo0FELTUr044iEBtpqFVw7Wd7Fpd1KmiG0Z5f1H1pp2Ok0x+iD7cOD2XhjcFiUSZRtwRYUOBWGwBnADfU7cTfyLia5p3hBxZfccHerDIsG9nmK/EOrapzYyjc56OjElo0s9dqe3TW09KfRJHNqxbzywbS8jzfeu2Xn1V/xP0IWHwiZF75FNgr+YVxkv7DNXTJyjw5fKIDJUP9Vrw3BdlM3WUEA3CSYnGNMsga50MgVhMMD4nRHF8+AaPD51wP5bzlfYG3Us7mV4yWszSo/fphcHUaqAOwNckFGWHOzjghdw4BHE1iaAV4d60oyG4/TRkt8sYH6bG1y3EgAVhf5JxLwxkdPScnFSPSsHU6JgmAfFj7Gi5T+yYu+HIXPGGvUYoBXEnOJFH5ssgoyiafQ6opbpzzkdCwzaImv/RI8Zkf+QCiNdbRWTJJ9jiAQGc7qVmt6/2AoDSCQkmmmr7cupyZkO3RCmEAaF2aCJ6MdHqhaFHZ3dks7MqSU7I85ViYqPjXsie8RJcbzmRliRD7qtqrdELjw312Stsn11JzTDk+BxsyuIW2nFeh/d5E9qyQU9Bz1MvrWPoN5gIiwJEqMO3kOJJ4GTpZ4ouhyo+ddK+31GiKzJudNBQWKBi1W/YJt3w4XAQb3iw1beIK6GP81Prynbd0PnJggCnXphmVIFmc2XunfvtAWNQmPQoqwgKn5IQPKqf6kdNqiHoiESHRNmKtn1rFnK+IwyhWyzVF2AM4TH41MWe+RxElygXPqgLt1b7Nup9t6x79m4FArKL1f0D0FLykqZV1FQN7A8739MONaJDYrKg58CZalkUiLZmA+4o19Ixv4UJujzBhS0xezxSXdaZelh1AW4Y/j3388NREfISwDM/Ca21PruGujvOwDAphI3Kct+eyi0FWD+o1k5ja2DYblMDXQ82Rb98DVuiM3RvN1OM1tZoosIKL3YYoN85iPPxK13r2tJDS8HiViDcsrhIhmPgMEvl/Gcct53WdjPmw67KojFgWwgyNw5uOaIbOBOf37AEvYkzg1L2PrLIW5nx3tHQrEQopSQuh4rWXABx52COeh6+XPPojiPDIHB3Dneo390JLxsJ/EG7SI3hANEt/QmAiueUK48HsQXPLhtLiA+DfovEsqNjJctAQcnbMKADlcsmIpylHJvlxP8SKauCUw/vpq3DJ6ql3dOhRmFTDTzCbz7ZKF2iZ6Zgx9Ymqp5Vo0FRbT66vECDWA6XQO+5BzUTljtHucTQuaVm7fkpzmLvJwH+H3thhuTXYzXpQXdHCGCyx76/gMcZhudEf7+tfF7SApNYLztNpiYfXSpeZXhWKSFfEnALXHuo3Z9jOcOZ8oOjMdAhZdmuSbBoNa7DsSWeDbzynoBVlQB7+O06kb5BPS6eDoDuL7bSPZy3IdyRiPgF6JxFVi6W/4REvv/a2x60ZGtj4jIxoxbYdNdgaoZE5PX2vfqKnMHSTSqW/rvqWO5rl/9oG1lwsOAoxqVSvq2kOj/22CV9+QYPqWp8DIM7dCP4fiBJE1VdBj2pH6KuWG6AqJN+sgKgGZDwVOZ19IuJR1eHr0esqAZAMZmiXVZFRE3UYhQWL1tjgIyr2iBio1SoKXWXseuIobwje9Dpy8lrSXQK1sf/ogafZ3TO9gKEMP7gRUSJVE9tuPNNdlIgXDxAeUzigvhiefiwtBYAjCBw7HnajrxJbuE4+2x/1gBDSHlXPlM79yIIFKQXH8/r0zfcgi/r0ZNH38qtpiDPGMlw2BFQGRBQTLcpJ7FWQB9/2IX1D5TYnSaJUqe2ZS/H2yaqr/O9fcGXnTob+jSQGE5/0wZFaF5W/JKbRa+kYU8y6AshNVCQf6qndHCJ7qH6qgh5APiAqTQjAKOorsg0GaA1KX3HeIpDYVZpgZvJXS2KE5IILWvByb+wckkrRA6flygpthM4vOlQUgyr4W894J0dGf8geNa9K+XPZTLEyv2Cix2WIfYUrNz5qwl56AyJA+UkNcbv4eh1g+Kv0NN8R6uczwcaN5faqxnXqDNP6avZTDDrisxgs/jI+uKKSRNhg90adW/n21gV+buD0dnY97FkrTiyrv++BvDPOuX8q7QZVAguvF2TAdmpzk2uWqkyP/baxxQjwbQqO9mLDKB5GzHi4n4eK/QE+U4TZJYGLyNcA7zPIpX99U+bxBEIuYouvuIwlUrMnDFlDeTH32hBXLUFD3BrVHLDBjMdwL7J4SEd+DImxRLfUwo3Rv2dHwexWcQ9BjXQSqvyRfhsdmtYif3+Ff41MdY1H49X3XCfFSiCB1YspzF6N+xiVDuCmk74AP5cOtS1xRtlLujXiA017Y29aiFKodi83m/S3qJ+8ws6yarjzHvvXhHuPxdzscwAZ1GEbOHlYdNPG0WIL7NX3GDFOurntDbDFiNVsnoCQ4rmrzlMKLVny94yYnMFrh3fUNU0+NNTL6+YhgyDkUIz2V80PDhIgQ1jVb/fi7ydmQR+7OFweT+ID/wgUw6tZMu5C/xaNo41PDEz2Gl0GMo93zq5dgpL8ASzygX7xh6KhbWvFRR49pwM8lrA0ZKpf4x8nI/cKVjkj0hzeuc/nW8LTrrcoxMaYTBzP9j2OYno23vODUnkyHufW+qTKnzh6+mi43cEdXUKE7yoJY4SIyby1RqElBkTAiNrDp2RXET6ekvu8zIbw896jGdZIXdloJTcFFhfcuGEL8+swVjpArRBWqdWuaYTt/qQlteOyv6blpWUU45bpocjPKT/7Wow4mu8/iABCuN2ECKzvQIss2+NUpNfPw12mAbep7pOIvViahMWODymPSip+2j1pU1yq24vY4YE7fAmpNdpHWR9mG10uiV4UfFt241/fsNZBM/5qnJBsFOgkJPQnIytw/Neavn1kb2xS7Jcab4bD5SUHfiGjrdlxKZ7ORvjB8KQ/2YZNwCQkw6riWmh8sHC0Sj/MgJe2Psz+Htv+tWGrqaxA4LcaVDI0i3ADVEj+yq/i4DtHfjMoGdgW/TcpEgYeihnk2ru+9VyMGmmpbXPqzkC7kdX7q1PZhE+YLCHQmQzI4KeoFdaN5YsnjpmJjHo767zo1vyx+w8Zbtqa7CjjK+/NIBVW2X0QdV11hqnhV4AFdv1IWCSqFe/DIoYaHWB5/spLaIXPGxX3DZfMQGBYAKPXIhHXzaHcGgpu88uiwIoAs28WruRUR8FZHcqZuZDo47CkSvuDJ3z18J+waWI27FDvwGlrQbFeShUEKhTrGqwDe6Kxz2p3ZYwCgfDvc9SqFj7lHfHuPe53bpGRGYB5JQkR8d8VTMpgK75c5M7FfW5TahhF2XkTnSq0omWeHsSDVyUmJU8opmJF1O64ZAW+k2aCph1nynBP4QBxFiXsLpL6iNXnxuzfO9yVKKwqHHPv572YEi1XYgsEUYUriY6Kl96KtbJxJH5T/zqN420+dQDDK9tfxJ22luI4mEiI/t3plfzyRNo2J+ryF/tzJgiOiRly5N9C+wS+n+gMoT84NLbTIg/mhwM3nkcsu8bC1O8wjuuHtJL5603KKCE1KGfkxzMXmBB5UdyHzH42PzqfpeW9KswrRA1VTBFNhJeKhf2oxoYhH/iZdXzRF3r+zVG+FWvmKWaYYT9S31L7r4PJDfIaMEv7RDfvFNQGXjNzdmBCgv15GBeoNvQCUkoj5NgseKBu8A=</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      é¸¡æ±¤ æ€»ç»“
    
    </summary>
    
      <category term="å…¶ä»–" scheme="https://andyxw.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="å…¶ä»–" scheme="https://andyxw.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>React æŠ€æœ¯æ ˆ</title>
    <link href="https://andyxw.com/archives/4a9b.html"/>
    <id>https://andyxw.com/archives/4a9b.html</id>
    <published>2018-07-26T02:26:34.000Z</published>
    <updated>2019-09-04T13:26:42.901Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><h1 id="React-æŠ€æœ¯æ ˆ"><a href="#React-æŠ€æœ¯æ ˆ" class="headerlink" title="React æŠ€æœ¯æ ˆ"></a>React æŠ€æœ¯æ ˆ</h1><p>React æ˜¯ç›®å‰æœ€çƒ­é—¨çš„å‰ç«¯æ¡†æ¶ã€‚</p><ul><li>Facebook å…¬å¸2013å¹´æ¨å‡º</li><li>ç°åœ¨æœ€å¥½çš„ç¤¾åŒºæ”¯æŒå’Œç”Ÿæ€åœˆ</li><li>å¤§é‡çš„ç¬¬ä¸‰æ–¹å·¥å…·</li></ul><p><img src="./images/react-logo.png" alt=""></p><hr><h2 id="React-çš„ä¼˜ç‚¹"><a href="#React-çš„ä¼˜ç‚¹" class="headerlink" title="React çš„ä¼˜ç‚¹"></a>React çš„ä¼˜ç‚¹</h2><ul><li>ç»„ä»¶æ¨¡å¼ï¼šä»£ç å¤ç”¨å’Œå›¢é˜Ÿåˆ†å·¥</li><li>è™šæ‹Ÿ DOMï¼šæ€§èƒ½ä¼˜åŠ¿</li><li>ç§»åŠ¨ç«¯æ”¯æŒï¼šè·¨ç»ˆç«¯</li></ul><hr><h2 id="React-çš„ç¼ºç‚¹"><a href="#React-çš„ç¼ºç‚¹" class="headerlink" title="React çš„ç¼ºç‚¹"></a>React çš„ç¼ºç‚¹</h2><ul><li>å­¦ä¹ æ›²çº¿è¾ƒé™¡å³­</li><li>å…¨æ–°çš„ä¸€å¥—æ¦‚å¿µï¼Œä¸å…¶ä»–æ‰€æœ‰æ¡†æ¶æˆªç„¶ä¸åŒ</li><li>åªæœ‰é‡‡ç”¨å®ƒçš„æ•´ä¸ªæŠ€æœ¯æ ˆï¼Œæ‰èƒ½å‘æŒ¥æœ€å¤§å¨åŠ›</li></ul><p>æ€»ç»“ï¼šReact éå¸¸å…ˆè¿›å’Œå¼ºå¤§ï¼Œä½†æ˜¯å­¦ä¹ å’Œå®ç°æˆæœ¬éƒ½ä¸ä½</p><hr><h2 id="JSX-è¯­æ³•"><a href="#JSX-è¯­æ³•" class="headerlink" title="JSX è¯­æ³•"></a>JSX è¯­æ³•</h2><p>React ä½¿ç”¨ JSX è¯­æ³•ï¼ŒJavaScript ä»£ç ä¸­å¯ä»¥å†™ HTML ä»£ç ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myTitle = &lt;h1&gt;Hello, world!&lt;/h1&gt;;</span><br></pre></td></tr></table></figure><hr><h2 id="JSX-è¯­æ³•è§£é‡Š"><a href="#JSX-è¯­æ³•è§£é‡Š" class="headerlink" title="JSX è¯­æ³•è§£é‡Š"></a>JSX è¯­æ³•è§£é‡Š</h2><p>ï¼ˆ1ï¼‰JSX è¯­æ³•çš„æœ€å¤–å±‚ï¼Œåªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯</span></span><br><span class="line"><span class="keyword">let</span> myTitle = &lt;p&gt;Hello&lt;/p&gt;&lt;p&gt;World&lt;/p&gt;;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰JSX è¯­æ³•ä¸­å¯ä»¥æ’å…¥ JavaScript ä»£ç ï¼Œä½¿ç”¨å¤§æ‹¬å·ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myTitle = &lt;p&gt;&#123;'Hello ' + 'World'&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><hr><h2 id="Babel-è½¬ç å™¨"><a href="#Babel-è½¬ç å™¨" class="headerlink" title="Babel è½¬ç å™¨"></a>Babel è½¬ç å™¨</h2><p>JavaScript å¼•æ“ï¼ˆåŒ…æ‹¬æµè§ˆå™¨å’Œ Nodeï¼‰éƒ½ä¸è®¤è¯† JSXï¼Œéœ€è¦é¦–å…ˆä½¿ç”¨ Babel è½¬ç ï¼Œç„¶åæ‰èƒ½è¿è¡Œã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// ** Our code goes here! **</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>React éœ€è¦åŠ è½½ä¸¤ä¸ªåº“ï¼šReact å’Œ React-DOMï¼Œå‰è€…æ˜¯ React çš„æ ¸å¿ƒåº“ï¼Œåè€…æ˜¯ React çš„ DOM é€‚é…åº“ã€‚</p><p>Babel ç”¨æ¥åœ¨æµè§ˆå™¨è½¬æ¢ JSX è¯­æ³•ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»è½¬å¥½äº†ï¼Œæµè§ˆå™¨å°±ä¸éœ€è¦åŠ è½½è¿™ä¸ªåº“ã€‚</p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šJSX-è¯­æ³•"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šJSX-è¯­æ³•" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šJSX è¯­æ³•"></a>è¯¾å ‚ç»ƒä¹ ï¼šJSX è¯­æ³•</h2><p>æµè§ˆå™¨æ‰“å¼€<code>demos/jsx-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#jsx">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;span&gt;Hello World!<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><h2 id="ç¤ºä¾‹ï¼šReact-ç»„ä»¶"><a href="#ç¤ºä¾‹ï¼šReact-ç»„ä»¶" class="headerlink" title="ç¤ºä¾‹ï¼šReact ç»„ä»¶"></a>ç¤ºä¾‹ï¼šReact ç»„ä»¶</h2><p>React å…è®¸ç”¨æˆ·å®šä¹‰è‡ªå·±çš„ç»„ä»¶ï¼Œæ’å…¥ç½‘é¡µã€‚</p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index1.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶è¯­æ³•">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;MyTitle/&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°"></a>è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„å‚æ•°</h2><p>ç»„ä»¶å¯ä»¥ä»å¤–éƒ¨ä¼ å…¥å‚æ•°ï¼Œå†…éƒ¨ä½¿ç”¨<code>this.props</code>è·å–å‚æ•°ã€‚</p><p>æ‰“å¼€<code>demos/react-component-demo/index2.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„å‚æ•°">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTitle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span></span></span></span><br><span class="line"><span class="xml">      style=&#123;&#123;color: this.props.color&#125;&#125;</span></span><br><span class="line"><span class="xml">    &gt;Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;MyTitle color=<span class="string">"red"</span> /&gt;,</span><br></pre></td></tr></table></figure><hr><h2 id="ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€"><a href="#ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€" class="headerlink" title="ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€"></a>ç¤ºä¾‹ï¼šç»„ä»¶çš„çŠ¶æ€</h2><p>ç»„ä»¶å¾€å¾€ä¼šæœ‰å†…éƒ¨çŠ¶æ€ï¼Œä½¿ç”¨<code>this.state</code>è¡¨ç¤ºã€‚</p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index3.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„çŠ¶æ€">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ã€‚</p><p><img src="./images/react-component-state.png" alt=""></p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šReact-ç»„ä»¶å®æˆ˜"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šReact-ç»„ä»¶å®æˆ˜" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šReact ç»„ä»¶å®æˆ˜"></a>è¯¾å ‚ç»ƒä¹ ï¼šReact ç»„ä»¶å®æˆ˜</h2><p>æµè§ˆå™¨æ‰“å¼€<code>demos/react-component-demo/index4.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶å®æˆ˜">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><hr><h2 id="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>React ä¸ºç»„ä»¶çš„ä¸åŒç”Ÿå‘½é˜¶æ®µï¼Œæä¾›äº†è¿‘åä¸ªé’©å­æ–¹æ³•ã€‚</p><ul><li><code>componentWillMount()</code>ï¼šç»„ä»¶åŠ è½½å‰è°ƒç”¨</li><li><code>componentDidMount()</code>ï¼šç»„ä»¶åŠ è½½åè°ƒç”¨</li><li><code>componentWillUpdate()</code>: ç»„ä»¶æ›´æ–°å‰è°ƒç”¨</li><li><code>componentDidUpdate()</code>: ç»„ä»¶æ›´æ–°åè°ƒç”¨</li><li><code>componentWillUnmount()</code>ï¼šç»„ä»¶å¸è½½å‰è°ƒç”¨</li><li><code>componentWillReceiveProps()</code>ï¼šç»„ä»¶æ¥å—æ–°çš„å‚æ•°æ—¶è°ƒç”¨</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›é’©å­ï¼Œè‡ªåŠ¨å®Œæˆä¸€äº›æ“ä½œã€‚</p><hr><h2 id="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>è¯¾å ‚ç»ƒä¹ ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ç»„ä»¶å¯ä»¥é€šè¿‡ Ajax è¯·æ±‚ï¼Œä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚Ajax è¯·æ±‚ä¸€èˆ¬åœ¨<code>componentDidMount</code>æ–¹æ³•é‡Œé¢å‘å‡ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">'...'</span>;</span><br><span class="line">  $.getJSON(url)</span><br><span class="line">    .done()</span><br><span class="line">    .fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>demos/react-lifecycle-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#react-ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œå®Œæˆç»ƒä¹ ã€‚</p><hr><h2 id="React-ç»„ä»¶åº“"><a href="#React-ç»„ä»¶åº“" class="headerlink" title="React ç»„ä»¶åº“"></a>React ç»„ä»¶åº“</h2><p>React çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œå°±æ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šå·²ç»å†™å¥½çš„ç»„ä»¶åº“ï¼Œå¯ä»¥ä½¿ç”¨ã€‚</p><p>React-Bootstrapï¼š<a href="https://react-bootstrap.github.io/" target="_blank" rel="noopener">https://react-bootstrap.github.io/</a></p><p><img src="./images/react-bootstrap.png" alt=""></p><hr><h2 id="ç¤ºä¾‹ï¼šReCharts"><a href="#ç¤ºä¾‹ï¼šReCharts" class="headerlink" title="ç¤ºä¾‹ï¼šReCharts"></a>ç¤ºä¾‹ï¼šReCharts</h2><p>ReCharts æ˜¯ä¸€ä¸ª React å›¾è¡¨ç»„ä»¶åº“ã€‚<a href="http://recharts.org/" target="_blank" rel="noopener">http://recharts.org/</a></p><p>æµè§ˆå™¨æ‰“å¼€<code>demos/recharts-demo/index.html</code>ï¼ŒæŒ‰ç…§<a href="../demos/README.md#recharts">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œä»”ç»†æŸ¥çœ‹æºç ï¼Œä½“ä¼š JSX è¯­æ³•å¯¹è¡¨è¾¾å¤æ‚ç»„ä»¶çš„ä¼˜åŠ¿ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LineChart</span> <span class="attr">width</span>=<span class="string">&#123;1000&#125;</span> <span class="attr">height</span>=<span class="string">&#123;400&#125;</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">XAxis</span> <span class="attr">dataKey</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">YAxis</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CartesianGrid</span> <span class="attr">stroke</span>=<span class="string">"#eee"</span> <span class="attr">strokeDasharray</span>=<span class="string">"5 5"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Line</span> <span class="attr">type</span>=<span class="string">"monotone"</span> <span class="attr">dataKey</span>=<span class="string">"uv"</span> <span class="attr">stroke</span>=<span class="string">"#8884d8"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Line</span> <span class="attr">type</span>=<span class="string">"monotone"</span> <span class="attr">dataKey</span>=<span class="string">"pv"</span> <span class="attr">stroke</span>=<span class="string">"#82ca9d"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LineChart</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="React-çš„æ ¸å¿ƒæ€æƒ³"><a href="#React-çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="React çš„æ ¸å¿ƒæ€æƒ³"></a>React çš„æ ¸å¿ƒæ€æƒ³</h2><p>View æ˜¯ State çš„è¾“å‡ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view = f(state)</span><br></pre></td></tr></table></figure><p>ä¸Šå¼ä¸­ï¼Œ<code>f</code>è¡¨ç¤ºå‡½æ•°å…³ç³»ã€‚åªè¦ State å‘ç”Ÿå˜åŒ–ï¼ŒView ä¹Ÿè¦éšä¹‹å˜åŒ–ã€‚</p><hr><p>React çš„æœ¬è´¨æ˜¯å°†å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰å‡½æ•°åŒ–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  name: <span class="string">"michel"</span>,</span><br><span class="line">  age: <span class="number">31</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123; person &#125;</span>) =&gt;</span> &lt;h1&gt;&#123; person.name &#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App person=&#123;person&#125; /</span>&gt;, <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure><hr><h2 id="React-æ²¡æœ‰è§£å†³çš„é—®é¢˜"><a href="#React-æ²¡æœ‰è§£å†³çš„é—®é¢˜" class="headerlink" title="React æ²¡æœ‰è§£å†³çš„é—®é¢˜"></a>React æ²¡æœ‰è§£å†³çš„é—®é¢˜</h2><p>React æœ¬èº«åªæ˜¯ä¸€ä¸ª DOM çš„æŠ½è±¡å±‚ï¼Œä½¿ç”¨ç»„ä»¶æ„å»ºè™šæ‹Ÿ DOMã€‚</p><p>å¦‚æœå¼€å‘å¤§åº”ç”¨ï¼Œè¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ã€‚</p><ul><li>æ¶æ„ï¼šå¤§å‹åº”ç”¨ç¨‹åºåº”è¯¥å¦‚ä½•ç»„ç»‡ä»£ç ï¼Ÿ</li><li>é€šä¿¡ï¼šç»„ä»¶ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</li></ul><hr><h2 id="æ¶æ„é—®é¢˜"><a href="#æ¶æ„é—®é¢˜" class="headerlink" title="æ¶æ„é—®é¢˜"></a>æ¶æ„é—®é¢˜</h2><p>React åªæ˜¯è§†å›¾å±‚çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨äºä»»ä½•ä¸€ç§æ¶æ„ã€‚</p><ul><li>MVC</li><li>MVVM</li><li>Observer</li><li>Reactive</li><li>â€¦</li></ul><p>åˆ°åº•å“ªä¸€ç§æ¶æ„æœ€åˆé€‚ React ï¼Ÿ</p><hr><h2 id="é€šä¿¡é—®é¢˜"><a href="#é€šä¿¡é—®é¢˜" class="headerlink" title="é€šä¿¡é—®é¢˜"></a>é€šä¿¡é—®é¢˜</h2><p>ç»„ä»¶ä¼šå‘ç”Ÿä¸‰ç§é€šä¿¡ã€‚</p><ul><li>å‘å­ç»„ä»¶å‘æ¶ˆæ¯</li><li>å‘çˆ¶ç»„ä»¶å‘æ¶ˆæ¯</li><li>å‘å…¶ä»–ç»„ä»¶å‘æ¶ˆæ¯</li></ul><p>React åªæä¾›äº†ä¸€ç§é€šä¿¡æ‰‹æ®µï¼šä¼ å‚ã€‚å¯¹äºå¤§åº”ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ã€‚</p><hr><h2 id="çŠ¶æ€çš„åŒæ­¥"><a href="#çŠ¶æ€çš„åŒæ­¥" class="headerlink" title="çŠ¶æ€çš„åŒæ­¥"></a>çŠ¶æ€çš„åŒæ­¥</h2><p>é€šä¿¡çš„æœ¬è´¨æ˜¯çŠ¶æ€çš„åŒæ­¥ã€‚</p><p>React åŒæ­¥çŠ¶æ€çš„åŸºæœ¬æ–¹æ³•ï¼šæ‰¾åˆ°é€šä¿¡åŒæ–¹æœ€è¿‘çš„å…±åŒçˆ¶ç»„ä»¶ï¼Œé€šè¿‡å®ƒçš„<code>state</code>ï¼Œä½¿å¾—å­ç»„ä»¶çš„çŠ¶æ€ä¿æŒåŒæ­¥ã€‚</p><hr><h2 id="Flux-æ¶æ„"><a href="#Flux-æ¶æ„" class="headerlink" title="Flux æ¶æ„"></a>Flux æ¶æ„</h2><p>Facebook æå‡º Flux æ¶æ„çš„æ¦‚å¿µï¼Œè¢«è®¤ä¸ºæ˜¯ React åº”ç”¨çš„æ ‡å‡†æ¶æ„ã€‚</p><p><img src="./images/flow.png" alt=""></p><p>æœ€å¤§ç‰¹ç‚¹ï¼šæ•°æ®å•å‘æµåŠ¨ã€‚ä¸ MVVM çš„æ•°æ®åŒå‘ç»‘å®šï¼Œå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><hr><h2 id="Flux-çš„æ ¸å¿ƒæ€æƒ³"><a href="#Flux-çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="Flux çš„æ ¸å¿ƒæ€æƒ³"></a>Flux çš„æ ¸å¿ƒæ€æƒ³</h2><ul><li>ä¸åŒç»„ä»¶çš„<code>state</code>ï¼Œå­˜æ”¾åœ¨ä¸€ä¸ªå¤–éƒ¨çš„ã€å…¬å…±çš„ Store ä¸Šé¢ã€‚</li><li>ç»„ä»¶è®¢é˜… Store çš„ä¸åŒéƒ¨åˆ†ã€‚</li><li>ç»„ä»¶å‘é€ï¼ˆdispatchï¼‰åŠ¨ä½œï¼ˆactionï¼‰ï¼Œå¼•å‘ Store çš„æ›´æ–°ã€‚</li></ul><p>Flux åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæœ‰30å¤šç§å®ç°ã€‚</p><hr><h2 id="ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª-React-æ¶æ„"><a href="#ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª-React-æ¶æ„" class="headerlink" title="ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª React æ¶æ„"></a>ç›®å‰æœ€æµè¡Œçš„ä¸¤ä¸ª React æ¶æ„</h2><p>React æ¶æ„çš„æœ€é‡è¦ä½œç”¨ï¼šç®¡ç† Store ä¸ View ä¹‹é—´çš„å…³ç³»ã€‚</p><ul><li>MobXï¼šå“åº”å¼ï¼ˆReactiveï¼‰ç®¡ç†ï¼Œstate æ˜¯å¯å˜å¯¹è±¡ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®</li><li>Reduxï¼šå‡½æ•°å¼ï¼ˆFunctionalï¼‰ç®¡ç†ï¼Œstate æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œé€‚åˆå¤§å‹é¡¹ç›®</li></ul><hr><h2 id="MobX-æ¶æ„"><a href="#MobX-æ¶æ„" class="headerlink" title="MobX æ¶æ„"></a>MobX æ¶æ„</h2><p>MobX çš„æ ¸å¿ƒæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><ul><li>Store æ˜¯è¢«è§‚å¯Ÿè€…ï¼ˆobservableï¼‰</li><li>ç»„ä»¶æ˜¯è§‚å¯Ÿè€…ï¼ˆobserverï¼‰</li></ul><p>ä¸€æ—¦<code>Store</code>æœ‰å˜åŒ–ï¼Œä¼šç«‹åˆ»è¢«ç»„ä»¶è§‚å¯Ÿåˆ°ï¼Œä»è€Œå¼•å‘é‡æ–°æ¸²æŸ“ã€‚</p><hr><h2 id="MobX-çš„æœ€ç®€å•ä¾‹å­"><a href="#MobX-çš„æœ€ç®€å•ä¾‹å­" class="headerlink" title="MobX çš„æœ€ç®€å•ä¾‹å­"></a>MobX çš„æœ€ç®€å•ä¾‹å­</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;observable&#125; = mobx;</span><br><span class="line"><span class="keyword">const</span> &#123;observer&#125; = mobxReact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = observable(&#123;<span class="attr">name</span>: <span class="string">"å¼ ä¸‰"</span>, <span class="attr">age</span>: <span class="number">31</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = observer(</span><br><span class="line">  (&#123; person &#125;) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123; person.name &#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">person</span>=<span class="string">&#123;person&#125;</span> /&gt;</span>, document.body);</span></span><br><span class="line"><span class="xml">person.name = "æå››";</span></span><br></pre></td></tr></table></figure><p>ä»£ç ï¼š<code>demos/mobx-demo/browser-demo</code>ç›®å½•</p><hr><h2 id="ç¤ºä¾‹ï¼šMobX"><a href="#ç¤ºä¾‹ï¼šMobX" class="headerlink" title="ç¤ºä¾‹ï¼šMobX"></a>ç¤ºä¾‹ï¼šMobX</h2><p>è¿›å…¥<code>demos/mobx-demo</code>ç›®å½•ï¼ŒæŒ‰ç…§<a href="../demos/README.md#mobx">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œç†è§£ MobX æ¡†æ¶ã€‚</p><hr><p>UI å±‚æ˜¯è§‚å¯Ÿè€…ï¼ŒStore æ˜¯è¢«è§‚å¯Ÿè€…ã€‚</p><p>Store æ‰€æœ‰çš„å±æ€§ï¼Œåˆ†æˆä¸¤å¤§ç±»ï¼šç›´æ¥è¢«è§‚å¯Ÿçš„å±æ€§å’Œè‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„å±æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  @observable name = <span class="string">'Bartek'</span>;</span><br><span class="line">  @computed get decorated() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> is awesome!`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UI ä¼šè§‚å¯Ÿåˆ° Store çš„å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“ã€‚</p><hr><h2 id="Redux-æ¶æ„"><a href="#Redux-æ¶æ„" class="headerlink" title="Redux æ¶æ„"></a>Redux æ¶æ„</h2><p>Redux çš„æ ¸å¿ƒæ¦‚å¿µ</p><ul><li>æ‰€æœ‰çš„çŠ¶æ€å­˜æ”¾åœ¨<code>Store</code>ã€‚ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“ï¼Œéƒ½å¿…é¡»ç”±çŠ¶æ€å˜åŒ–å¼•èµ·ã€‚</li><li>ç”¨æˆ·åœ¨ UI ä¸Šå‘å‡º<code>action</code>ã€‚</li><li><code>reducer</code>å‡½æ•°æ¥æ”¶<code>action</code>ï¼Œç„¶åæ ¹æ®å½“å‰çš„<code>state</code>ï¼Œè®¡ç®—å‡ºæ–°çš„<code>state</code>ã€‚</li></ul><p><img src="./images/redux-architecture.png" alt=""></p><hr><h2 id="Redux-åº”ç”¨çš„æ¶æ„"><a href="#Redux-åº”ç”¨çš„æ¶æ„" class="headerlink" title="Redux åº”ç”¨çš„æ¶æ„"></a>Redux åº”ç”¨çš„æ¶æ„</h2><p><img src="./images/architecture-redux.png" alt=""></p><p>Redux å±‚ä¿å­˜æ‰€æœ‰çŠ¶æ€ï¼ŒReact ç»„ä»¶æ‹¿åˆ°çŠ¶æ€ä»¥åï¼Œæ¸²æŸ“å‡º HTML ä»£ç ã€‚</p><hr><h2 id="ç¤ºä¾‹ï¼šRedux"><a href="#ç¤ºä¾‹ï¼šRedux" class="headerlink" title="ç¤ºä¾‹ï¼šRedux"></a>ç¤ºä¾‹ï¼šRedux</h2><p>è¿›å…¥<code>demos/redux-demo</code>ç›®å½•ï¼ŒæŒ‰ç…§<a href="../demos/README.md#redux">ã€Šæ“ä½œè¯´æ˜ã€‹</a>ï¼Œç†è§£ Redux æ¡†æ¶ã€‚</p><hr><ul><li>Redux å°†ç»„ä»¶åˆ†æˆ UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶ä¸¤ç±»ã€‚</li><li>UI ç»„ä»¶æ˜¯çº¯ç»„ä»¶ï¼Œä¸åŒ…å« state å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¸æ¶‰åŠç»„ä»¶çš„è¡Œä¸ºï¼Œåªæ¶‰åŠç»„ä»¶çš„å¤–è§‚ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"index"</span>&gt;</span><br><span class="line">  &lt;p&gt;&#123;<span class="keyword">this</span>.props.text&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;input</span></span><br><span class="line"><span class="regexp">    defaultValue=&#123;this.props.name&#125;</span></span><br><span class="line"><span class="regexp">    onChange=&#123;this.props.onChange&#125;</span></span><br><span class="line"><span class="regexp">  /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><hr><p>å®¹å™¨ç»„ä»¶æ­£å¥½ç›¸åã€‚</p><ul><li>ä¸æ¶‰åŠç»„ä»¶çš„å¤–è§‚ï¼Œåªæ¶‰åŠç»„ä»¶çš„è¡Œä¸ºã€‚</li><li>è´Ÿè´£è®¢é˜… Storeï¼Œå°† Store çš„æ•°æ®å¤„ç†ä»¥åï¼Œå†é€šè¿‡å‚æ•°ä¼ ç»™ UI ç»„ä»¶ã€‚</li><li>ç”¨æˆ·ç»™å‡ºé…ç½®ä»¥åï¼Œç”± Redux ç”Ÿæˆã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// MyComponent æ˜¯çº¯çš„ UI ç»„ä»¶</span><br><span class="line">const App = connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(MyComponent);</span><br></pre></td></tr></table></figure><ul><li>mapStateToProps: å®šä¹‰ UI ç»„ä»¶å‚æ•°ä¸ State ä¹‹é—´çš„æ˜ å°„</li><li>mapDispatchToPropsï¼šå®šä¹‰ UI ç»„ä»¶ä¸ Action ä¹‹é—´çš„æ˜ å°„</li></ul><hr><h2 id="æ‹†åˆ†-UI-ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„"><a href="#æ‹†åˆ†-UI-ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„" class="headerlink" title="æ‹†åˆ† UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„"></a>æ‹†åˆ† UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„å¥½å¤„</h2><ul><li>UI ç»„ä»¶ä¸åå°æ•°æ®æ— å…³ï¼Œå¯ä»¥ç”±è®¾è®¡å¸ˆè´Ÿè´£</li><li>å®¹å™¨ç»„ä»¶åªè´Ÿè´£æ•°æ®å’Œè¡Œä¸ºï¼Œä¸€æ—¦ Store çš„æ•°æ®ç»“æ„å˜åŒ–ï¼Œåªè¦è°ƒæ•´å®¹å™¨ç»„ä»¶å³å¯</li><li>è¡¨ç°å±‚å’ŒåŠŸèƒ½å±‚è„±é’©ï¼Œæœ‰åˆ©äºä»£ç é‡ç”¨ï¼Œä¹Ÿæœ‰åˆ©äºçœ‹æ¸…åº”ç”¨çš„æ•°æ®ç»“æ„å’Œä¸šåŠ¡é€»è¾‘</li></ul><hr><h2 id="Reducer-å‡½æ•°"><a href="#Reducer-å‡½æ•°" class="headerlink" title="Reducer å‡½æ•°"></a>Reducer å‡½æ•°</h2><p><code>reducer</code>æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶<code>action</code>ï¼Œç®—å‡ºæ–°çš„<code>state</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  text: <span class="string">'ä½ å¥½ï¼Œè®¿é—®è€…'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  name: <span class="string">'è®¿é—®è€…'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'change'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        name: action.payload,</span><br><span class="line">        text: <span class="string">'ä½ å¥½ï¼Œ'</span> + action.payload</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><code>Store</code>ç”± Redux æä¾›çš„<code>createStore</code>æ–¹æ³•ç”Ÿæˆï¼Œè¯¥æ–¹æ³•æ¥å—<code>reducer</code>ä½œä¸ºå‚æ•°ã€‚</li><li>ä¸ºäº†æŠŠ<code>Store</code>ä¼ å…¥ç»„ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ Redux æä¾›çš„<code>Provider</code>ç»„ä»¶åœ¨åº”ç”¨çš„æœ€å¤–é¢ï¼ŒåŒ…è£¹ä¸€å±‚ã€‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.body.appendChild(document.createElement('div'))</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      ReactæŠ€æœ¯æ ˆâ€”â€”é˜®ä¸€å³°
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>React è®¾è®¡æ€æƒ³</title>
    <link href="https://andyxw.com/archives/7615.html"/>
    <id>https://andyxw.com/archives/7615.html</id>
    <published>2018-07-26T02:25:48.000Z</published>
    <updated>2019-09-04T13:28:17.110Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><h1 id="React-è®¾è®¡æ€æƒ³"><a href="#React-è®¾è®¡æ€æƒ³" class="headerlink" title="React è®¾è®¡æ€æƒ³"></a>React è®¾è®¡æ€æƒ³</h1><blockquote><p>è¯‘è€…åºï¼šæœ¬æ–‡æ˜¯ React æ ¸å¿ƒå¼€å‘è€…ã€æœ‰ React API ç»ˆç»“è€…ä¹‹ç§°çš„ Sebastian MarkbÃ¥ge æ’°å†™ï¼Œé˜è¿°äº†ä»–è®¾è®¡ React çš„åˆè¡·ã€‚é˜…è¯»æ­¤æ–‡ï¼Œä½ èƒ½ç«™åœ¨æ›´é«˜çš„é«˜åº¦æ€è€ƒ React çš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥ã€‚åŸæ–‡åœ°å€ï¼š<a href="https://github.com/reactjs/react-basic" target="_blank" rel="noopener">https://github.com/reactjs/react-basic</a></p></blockquote><a id="more"></a><p>æˆ‘å†™æ­¤æ–‡æ˜¯æƒ³æ­£å¼åœ°é˜è¿°æˆ‘å¿ƒä¸­ React çš„<a href="http://baike.baidu.com/view/2333986.htm" target="_blank" rel="noopener">å¿ƒæ™ºæ¨¡å‹</a>ã€‚ç›®çš„æ˜¯è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šè¿™æ ·è®¾è®¡ Reactï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥æ ¹æ®è¿™äº›è®ºç‚¹åæ¨å‡º Reactã€‚</p><p>ä¸å¯å¦è®¤ï¼Œæ­¤æ–‡ä¸­çš„éƒ¨åˆ†è®ºæ®æˆ–å‰æå°šå­˜äº‰è®®ï¼Œè€Œä¸”éƒ¨åˆ†ç¤ºä¾‹çš„è®¾è®¡å¯èƒ½å­˜åœ¨ bug æˆ–ç–å¿½ã€‚è¿™åªæ˜¯æ­£å¼ç¡®å®šå®ƒçš„æœ€åˆé˜¶æ®µã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„å®Œå–„å®ƒçš„æƒ³æ³•å¯ä»¥éšæ—¶æäº¤ pull requestã€‚æœ¬æ–‡ä¸ä¼šä»‹ç»æ¡†æ¶ç»†èŠ‚ä¸­çš„å¥‡æŠ€æ·«å·§ï¼Œç›¸ä¿¡è¿™æ ·èƒ½æçº²æŒˆé¢†ï¼Œè®©ä½ çœ‹æ¸… React ç”±ç®€å•åˆ°å¤æ‚çš„è®¾è®¡è¿‡ç¨‹ã€‚</p><p>React.js çš„çœŸå®å®ç°ä¸­å……æ»¡äº†å…·ä½“é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œæ¸è¿›å¼çš„è§£æ³•ï¼Œç®—æ³•ä¼˜åŒ–ï¼Œå†å²é—ç•™ä»£ç ï¼Œdebug å·¥å…·ä»¥åŠå…¶ä»–ä¸€äº›å¯ä»¥è®©å®ƒçœŸçš„å…·æœ‰é«˜å¯ç”¨æ€§çš„å†…å®¹ã€‚è¿™äº›ä»£ç å¯èƒ½å¹¶ä¸ç¨³å®šï¼Œå› ä¸ºæœªæ¥æµè§ˆå™¨çš„å˜åŒ–å’ŒåŠŸèƒ½æƒé‡çš„å˜åŒ–éšæ—¶é¢ä¸´æ”¹å˜ã€‚æ‰€ä»¥å…·ä½“çš„ä»£ç å¾ˆéš¾å½»åº•è§£é‡Šæ¸…æ¥šã€‚</p><p>æˆ‘åå‘äºé€‰æ‹©ä¸€ç§æˆ‘èƒ½å®Œå…¨ hold ä½çš„ç®€æ´çš„å¿ƒæ™ºæ¨¡å‹æ¥ä½œä»‹ç»ã€‚</p><h2 id="å˜æ¢ï¼ˆTransformationï¼‰"><a href="#å˜æ¢ï¼ˆTransformationï¼‰" class="headerlink" title="å˜æ¢ï¼ˆTransformationï¼‰"></a>å˜æ¢ï¼ˆTransformationï¼‰</h2><p>è®¾è®¡ React çš„æ ¸å¿ƒå‰ææ˜¯è®¤ä¸º UI åªæ˜¯æŠŠæ•°æ®é€šè¿‡æ˜ å°„å…³ç³»å˜æ¢æˆå¦ä¸€ç§å½¢å¼çš„æ•°æ®ã€‚åŒæ ·çš„è¾“å…¥å¿…ä¼šæœ‰åŒæ ·çš„è¾“å‡ºã€‚è¿™æ°å¥½å°±æ˜¯çº¯å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameBox</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">fontWeight</span>: <span class="string">'bold'</span>, <span class="attr">labelContent</span>: name &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;Sebastian MarkbÃ¥ge&apos; -&gt;</span><br><span class="line">&#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;;</span><br></pre></td></tr></table></figure><h2 id="æŠ½è±¡ï¼ˆAbstractionï¼‰"><a href="#æŠ½è±¡ï¼ˆAbstractionï¼‰" class="headerlink" title="æŠ½è±¡ï¼ˆAbstractionï¼‰"></a>æŠ½è±¡ï¼ˆAbstractionï¼‰</h2><p>ä½ ä¸å¯èƒ½ä»…ç”¨ä¸€ä¸ªå‡½æ•°å°±èƒ½å®ç°å¤æ‚çš„ UIã€‚é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦æŠŠ UI æŠ½è±¡æˆå¤šä¸ªéšè—å†…éƒ¨ç»†èŠ‚ï¼Œåˆå¯å¤ç”¨çš„å‡½æ•°ã€‚é€šè¿‡åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°æ¥å®ç°å¤æ‚çš„ UIï¼Œè¿™å°±æ˜¯æŠ½è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">'1px solid blue'</span>,</span><br><span class="line">    childContent: [</span><br><span class="line">      <span class="string">'Name: '</span>,</span><br><span class="line">      NameBox(user.firstName + <span class="string">' '</span> + user.lastName)</span><br><span class="line">    ]</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123; firstName: &apos;Sebastian&apos;, lastName: &apos;MarkbÃ¥ge&apos; &#125; -&gt;</span><br><span class="line">&#123;</span><br><span class="line">  borderStyle: &apos;1px solid blue&apos;,</span><br><span class="line">  childContent: [</span><br><span class="line">    &apos;Name: &apos;,</span><br><span class="line">    &#123; fontWeight: &apos;bold&apos;, labelContent: &apos;Sebastian MarkbÃ¥ge&apos; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆï¼ˆCompositionï¼‰"><a href="#ç»„åˆï¼ˆCompositionï¼‰" class="headerlink" title="ç»„åˆï¼ˆCompositionï¼‰"></a>ç»„åˆï¼ˆCompositionï¼‰</h2><p>ä¸ºäº†çœŸæ­£è¾¾åˆ°é‡ç”¨çš„ç‰¹æ€§ï¼Œåªé‡ç”¨å¶å­ç„¶åæ¯æ¬¡éƒ½ä¸ºä»–ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ˜¯ä¸å¤Ÿçš„ã€‚ä½ è¿˜éœ€è¦å¯ä»¥åŒ…å«å…¶ä»–æŠ½è±¡çš„å®¹å™¨å†æ¬¡è¿›è¡Œç»„åˆã€‚æˆ‘ç†è§£çš„â€œç»„åˆâ€å°±æ˜¯å°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„æŠ½è±¡åˆå¹¶ä¸ºä¸€ä¸ªã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderStyle: <span class="string">'1px solid blue'</span>,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserBox</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>,</span><br><span class="line">    NameBox(user.firstName + <span class="string">' '</span> + user.lastName)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€ï¼ˆStateï¼‰"><a href="#çŠ¶æ€ï¼ˆStateï¼‰" class="headerlink" title="çŠ¶æ€ï¼ˆStateï¼‰"></a>çŠ¶æ€ï¼ˆStateï¼‰</h2><p>UI ä¸å•å•æ˜¯å¯¹æœåŠ¡å™¨ç«¯æˆ–ä¸šåŠ¡é€»è¾‘çŠ¶æ€çš„å¤åˆ¶ã€‚å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šçŠ¶æ€æ˜¯é’ˆå¯¹å…·ä½“çš„æ¸²æŸ“ç›®æ ‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ª text field ä¸­æ‰“å­—ã€‚å®ƒä¸ä¸€å®šè¦å¤åˆ¶åˆ°å…¶ä»–é¡µé¢æˆ–è€…ä½ çš„æ‰‹æœºè®¾å¤‡ã€‚æ»šåŠ¨ä½ç½®è¿™ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½ å‡ ä¹ä¸ä¼šå¤åˆ¶åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡çš„ã€‚</p><p>æˆ‘ä»¬å€¾å‘äºä½¿ç”¨ä¸å¯å˜çš„æ•°æ®æ¨¡å‹ã€‚æˆ‘ä»¬æŠŠå¯ä»¥æ”¹å˜ state çš„å‡½æ•°ä¸²è”èµ·æ¥ä½œä¸ºåŸç‚¹æ”¾ç½®åœ¨é¡¶å±‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyNameBox</span>(<span class="params">user, likes, onClick</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>, NameBox(user.firstName + <span class="string">' '</span> + user.lastName),</span><br><span class="line">    <span class="string">'Likes: '</span>, LikeBox(likes),</span><br><span class="line">    LikeButton(onClick)</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°ç»†èŠ‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likes = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addOneMoreLike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  likes++;</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">FancyNameBox(</span><br><span class="line">  &#123; <span class="attr">firstName</span>: <span class="string">'Sebastian'</span>, <span class="attr">lastName</span>: <span class="string">'MarkbÃ¥ge'</span> &#125;,</span><br><span class="line">  likes,</span><br><span class="line">  addOneMoreLike</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šæœ¬ä¾‹æ›´æ–°çŠ¶æ€æ—¶ä¼šå¸¦æ¥å‰¯ä½œç”¨ï¼ˆaddOneMoreLike å‡½æ•°ä¸­ï¼‰ã€‚æˆ‘å®é™…çš„æƒ³æ³•æ˜¯å½“ä¸€ä¸ªâ€œupdateâ€ä¼ å…¥æ—¶æˆ‘ä»¬è¿”å›ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„çŠ¶æ€ï¼Œä½†é‚£æ ·ä¼šæ¯”è¾ƒå¤æ‚ã€‚æ­¤ç¤ºä¾‹å¾…æ›´æ–°</em></p><h2 id="Memoization"><a href="#Memoization" class="headerlink" title="Memoization"></a>Memoization</h2><p>å¯¹äºçº¯å‡½æ•°ï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°ä¸€æ¬¡æ¬¡è°ƒç”¨æœªå…å¤ªæµªè´¹èµ„æºã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°çš„ memorized ç‰ˆæœ¬ï¼Œç”¨æ¥è¿½è¸ªæœ€åä¸€ä¸ªå‚æ•°å’Œç»“æœã€‚è¿™æ ·å¦‚æœæˆ‘ä»¬ç»§ç»­ä½¿ç”¨åŒæ ·çš„å€¼ï¼Œå°±ä¸éœ€è¦åå¤æ‰§è¡Œå®ƒäº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cachedArg;</span><br><span class="line">  <span class="keyword">var</span> cachedResult;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cachedArg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedResult;</span><br><span class="line">    &#125;</span><br><span class="line">    cachedArg = arg;</span><br><span class="line">    cachedResult = fn(arg);</span><br><span class="line">    <span class="keyword">return</span> cachedResult;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MemoizedNameBox = memoize(NameBox);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NameAndAgeBox</span>(<span class="params">user, currentTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox([</span><br><span class="line">    <span class="string">'Name: '</span>,</span><br><span class="line">    MemoizedNameBox(user.firstName + <span class="string">' '</span> + user.lastName),</span><br><span class="line">    <span class="string">'Age in milliseconds: '</span>,</span><br><span class="line">    currentTime - user.dateOfBirth</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ—è¡¨ï¼ˆListsï¼‰"><a href="#åˆ—è¡¨ï¼ˆListsï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆListsï¼‰"></a>åˆ—è¡¨ï¼ˆListsï¼‰</h2><p>å¤§éƒ¨åˆ† UI éƒ½æ˜¯å±•ç¤ºåˆ—è¡¨æ•°æ®ä¸­ä¸åŒ item çš„åˆ—è¡¨ç»“æ„ã€‚è¿™æ˜¯ä¸€ä¸ªå¤©ç„¶çš„å±‚çº§ã€‚</p><p>ä¸ºäº†ç®¡ç†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ª item çš„ state ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›é€ ä¸€ä¸ª Map å®¹çº³å…·ä½“ item çš„ stateã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users, likesPerUser, updateUserLikes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> FancyNameBox(</span><br><span class="line">    user,</span><br><span class="line">    likesPerUser.get(user.id),</span><br><span class="line">    () =&gt; updateUserLikes(user.id, likesPerUser.get(user.id) + <span class="number">1</span>)</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> likesPerUser = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUserLikes</span>(<span class="params">id, likeCount</span>) </span>&#123;</span><br><span class="line">  likesPerUser.set(id, likeCount);</span><br><span class="line">  rerender();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UserList(data.users, likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šç°åœ¨æˆ‘ä»¬å‘ FancyNameBox ä¼ äº†å¤šä¸ªä¸åŒçš„å‚æ•°ã€‚è¿™æ‰“ç ´äº†æˆ‘ä»¬çš„ memoization å› ä¸ºæˆ‘ä»¬æ¯æ¬¡åªèƒ½å­˜å‚¨ä¸€ä¸ªå€¼ã€‚æ›´å¤šç›¸å…³å†…å®¹åœ¨ä¸‹é¢ã€‚</em></p><h2 id="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"><a href="#è¿ç»­æ€§ï¼ˆContinuationsï¼‰" class="headerlink" title="è¿ç»­æ€§ï¼ˆContinuationsï¼‰"></a>è¿ç»­æ€§ï¼ˆContinuationsï¼‰</h2><p>ä¸å¹¸çš„æ˜¯ï¼Œè‡ªä» UI ä¸­æœ‰å¤ªå¤šçš„åˆ—è¡¨ï¼Œæ˜ç¡®çš„ç®¡ç†å°±éœ€è¦å¤§é‡çš„é‡å¤æ€§æ ·æ¿ä»£ç ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨è¿Ÿä¸€äº›å‡½æ•°çš„æ‰§è¡Œï¼Œè¿›è€ŒæŠŠä¸€äº›æ¨¡æ¿ç§»å‡ºä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨â€œæŸ¯é‡ŒåŒ–â€ï¼ˆJavaScript ä¸­çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener"><code>bind</code></a>ï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ ¸å¿ƒçš„å‡½æ•°å¤–é¢ä¼ é€’ stateï¼Œè¿™æ ·å°±æ²¡æœ‰æ ·æ¿ä»£ç äº†ã€‚</p><p>ä¸‹é¢è¿™æ ·å¹¶æ²¡æœ‰å‡å°‘æ ·æ¿ä»£ç ï¼Œä½†è‡³å°‘æŠŠå®ƒä»å…³é”®ä¸šåŠ¡é€»è¾‘ä¸­å‰¥ç¦»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    UserList.bind(<span class="literal">null</span>, users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> box = FancyUserList(data.users);</span><br><span class="line"><span class="keyword">const</span> resolvedChildren = box.children(likesPerUser, updateUserLikes);</span><br><span class="line"><span class="keyword">const</span> resolvedBox = &#123;</span><br><span class="line">  ...box,</span><br><span class="line">  children: resolvedChildren</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="State-Map"><a href="#State-Map" class="headerlink" title="State Map"></a>State Map</h2><p>ä¹‹å‰æˆ‘ä»¬çŸ¥é“å¯ä»¥ä½¿ç”¨ç»„åˆé¿å…é‡å¤æ‰§è¡Œç›¸åŒçš„ä¸œè¥¿è¿™æ ·ä¸€ç§é‡å¤æ¨¡å¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå’Œä¼ é€’ state é€»è¾‘æŒªåŠ¨åˆ°è¢«å¤ç”¨å¾ˆå¤šçš„ä½å±‚çº§çš„å‡½æ•°ä¸­å»ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> users.map(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    continuation: FancyNameBox.bind(<span class="literal">null</span>, user),</span><br><span class="line">    key: user.id</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyUserList</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBoxWithState.bind(<span class="literal">null</span>,</span><br><span class="line">    UserList(users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> continuation = FancyUserList(data.users);</span><br><span class="line">continuation(likesPerUser, updateUserLikes);</span><br></pre></td></tr></table></figure><h2 id="Memoization-Map"><a href="#Memoization-Map" class="headerlink" title="Memoization Map"></a>Memoization Map</h2><p>ä¸€æ—¦æˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ª memoization åˆ—è¡¨ä¸­ memoize å¤šä¸ª item å°±ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚å› ä¸ºä½ éœ€è¦åˆ¶å®šå¤æ‚çš„ç¼“å­˜ç®—æ³•æ¥å¹³è¡¡è°ƒç”¨é¢‘ç‡å’Œå†…å­˜å æœ‰ç‡ã€‚</p><p>è¿˜å¥½ UI åœ¨åŒä¸€ä¸ªä½ç½®ä¼šç›¸å¯¹çš„ç¨³å®šã€‚ç›¸åŒçš„ä½ç½®ä¸€èˆ¬æ¯æ¬¡éƒ½ä¼šæ¥å—ç›¸åŒçš„å‚æ•°ã€‚è¿™æ ·ä»¥æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªé›†åˆæ¥åš memoization æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç­–ç•¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å¯¹å¾… state åŒæ ·çš„æ–¹å¼ï¼Œåœ¨ç»„åˆçš„å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ª memoization ç¼“å­˜ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">memoize</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arg, memoizationCache</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (memoizationCache.arg === arg) &#123;</span><br><span class="line">      <span class="keyword">return</span> memoizationCache.result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> result = fn(arg);</span><br><span class="line">    memoizationCache.arg = arg;</span><br><span class="line">    memoizationCache.result = result;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBoxWithState</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children,</span></span></span><br><span class="line"><span class="function"><span class="params">  stateMap,</span></span></span><br><span class="line"><span class="function"><span class="params">  updateState,</span></span></span><br><span class="line"><span class="function"><span class="params">  memoizationCache</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> FancyBox(</span><br><span class="line">    children.map(<span class="function"><span class="params">child</span> =&gt;</span> child.continuation(</span><br><span class="line">      stateMap.get(child.key),</span><br><span class="line">      updateState,</span><br><span class="line">      memoizationCache.get(child.key)</span><br><span class="line">    ))</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MemoizedFancyNameBox = memoize(FancyNameBox);</span><br></pre></td></tr></table></figure><h2 id="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰"><a href="#ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic-Effectsï¼‰" class="headerlink" title="ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰"></a>ä»£æ•°æ•ˆåº”ï¼ˆAlgebraic Effectsï¼‰</h2><p>å¤šå±‚æŠ½è±¡éœ€è¦å…±äº«çç¢æ•°æ®æ—¶ï¼Œä¸€å±‚å±‚ä¼ é€’æ•°æ®éå¸¸éº»çƒ¦ã€‚å¦‚æœèƒ½æœ‰ä¸€ç§æ–¹å¼å¯ä»¥åœ¨å¤šå±‚æŠ½è±¡ä¸­å¿«æ·åœ°ä¼ é€’æ•°æ®ï¼ŒåŒæ—¶åˆä¸éœ€è¦ç‰µæ¶‰åˆ°ä¸­é—´å±‚çº§ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚React ä¸­æˆ‘ä»¬æŠŠå®ƒå«åšâ€œcontextâ€ã€‚</p><p>æœ‰æ—¶å€™æ•°æ®ä¾èµ–å¹¶ä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æŠ½è±¡æ ‘è‡ªä¸Šè€Œä¸‹è¿›è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å¸ƒå±€ç®—æ³•ä¸­ï¼Œä½ éœ€è¦åœ¨å®ç°ä»–ä»¬çš„ä½ç½®ä¹‹å‰äº†è§£å­èŠ‚ç‚¹çš„å¤§å°ã€‚</p><p>ç°åœ¨ï¼Œè¿™ä¸ªä¾‹å­æœ‰ä¸€ç‚¹è¶…çº²ã€‚æˆ‘ä¼šä½¿ç”¨ <a href="http://math.andrej.com/eff/" target="_blank" rel="noopener">ä»£æ•°æ•ˆåº”</a> è¿™ä¸ªç”±æˆ‘å‘èµ·çš„ <a href="https://esdiscuss.org/topic/one-shot-delimited-continuations-with-effect-handlers" target="_blank" rel="noopener">ECMAScript æ–°ç‰¹æ€§æè®®</a>ã€‚å¦‚æœä½ å¯¹å‡½æ•°å¼ç¼–ç¨‹å¾ˆç†Ÿæ‚‰ï¼Œå®ƒä»¬ åœ¨é¿å…ç”± monad å¼ºåˆ¶å¼•å…¥çš„ä»ªå¼ä¸€æ ·çš„ç¼–ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemeBorderColorRequest</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyBox</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> color = raise <span class="keyword">new</span> ThemeBorderColorRequest();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    borderWidth: <span class="string">'1px'</span>,</span><br><span class="line">    borderColor: color,</span><br><span class="line">    children: children</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlueTheme</span>(<span class="params">children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">    children();</span><br><span class="line">  &#125; <span class="keyword">catch</span> effect ThemeBorderColorRequest -&gt; [, continuation] &#123;</span><br><span class="line">    continuation(<span class="string">'blue'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> BlueTheme(</span><br><span class="line">    FancyUserList.bind(<span class="literal">null</span>, data.users)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Reactè®¾è®¡æ€æƒ³
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>Reactä¸­çš„stateå’Œprops</title>
    <link href="https://andyxw.com/archives/992.html"/>
    <id>https://andyxw.com/archives/992.html</id>
    <published>2018-07-26T02:23:10.000Z</published>
    <updated>2019-09-04T13:28:26.222Z</updated>
    
    <content type="html"><![CDATA[<!-- build time:Mon Sep 23 2019 18:28:11 GMT+0800 (GMT+08:00) --><p>æ•´ç†ä¸€ä¸‹Reactä¸­å…³äºstateå’Œpropsçš„çŸ¥è¯†ç‚¹ã€‚</p><hr><p>åœ¨ä»»ä½•åº”ç”¨ä¸­ï¼Œæ•°æ®éƒ½æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æˆ‘ä»¬éœ€è¦ç›´æ¥çš„æ”¹å˜é¡µé¢ä¸Šä¸€å—çš„åŒºåŸŸæ¥ä½¿å¾—è§†å›¾çš„åˆ·æ–°ï¼Œæˆ–è€…é—´æ¥åœ°æ”¹å˜å…¶ä»–åœ°æ–¹çš„æ•°æ®ã€‚Reactçš„æ•°æ®æ˜¯è‡ªé¡¶å‘ä¸‹å•å‘æµåŠ¨çš„ï¼Œå³ä»çˆ¶ç»„ä»¶åˆ°å­ç»„ä»¶ä¸­ï¼Œç»„ä»¶çš„æ•°æ®å­˜å‚¨åœ¨<code>props</code>å’Œ<code>state</code>ä¸­ï¼Œè¿™ä¸¤ä¸ªå±æ€§æœ‰å•¥å­åŒºåˆ«å‘¢ï¼Ÿ</p><a id="more"></a><h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>Reactçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç»„ä»¶åŒ–æ€æƒ³ï¼Œé¡µé¢ä¼šè¢«åˆ‡åˆ†æˆä¸€äº›ç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„ç»„ä»¶ã€‚</p><p>ç»„ä»¶ä»æ¦‚å¿µä¸Šçœ‹å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ä½œä¸ºè¾“å…¥å€¼ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯<code>props</code>ï¼Œæ‰€ä»¥å¯ä»¥æŠŠ<code>props</code>ç†è§£ä¸ºä»å¤–éƒ¨ä¼ å…¥ç»„ä»¶å†…éƒ¨çš„æ•°æ®ã€‚ç”±äºReactæ˜¯å•å‘æ•°æ®æµï¼Œæ‰€ä»¥<code>props</code>åŸºæœ¬ä¸Šä¹Ÿå°±æ˜¯ä»æœçˆ¶çº§ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’çš„æ•°æ®ã€‚</p><h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªåˆ—è¡¨ï¼Œæ ¹æ®Reactç»„ä»¶åŒ–æ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆ—è¡¨ä¸­çš„è¡Œå½“åšä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰è¿™æ ·ä¸¤ä¸ªç»„ä»¶ï¼š<code>&lt;ItemList/&gt;</code>å’Œ<code>&lt;Item/&gt;</code>ã€‚</p><p>å…ˆçœ‹çœ‹<code>&lt;ItemList/&gt;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import Item from &quot;./item&quot;;</span><br><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  const itemList = data.map(item =&gt; &lt;Item item=item /&gt;);</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &#123;itemList&#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ—è¡¨çš„æ•°æ®æˆ‘ä»¬å°±æš‚æ—¶å…ˆå‡è®¾æ˜¯æ”¾åœ¨ä¸€ä¸ª<code>data</code>å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡<code>map</code>å‡½æ•°è¿”å›ä¸€ä¸ªæ¯ä¸€é¡¹éƒ½æ˜¯<code>&lt;Item item=&#39;æ•°æ®&#39;/&gt;</code>çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå…¶å®åŒ…å«äº†<code>data.length</code>ä¸ª<code>&lt;Item/&gt;</code>ç»„ä»¶ï¼Œæ•°æ®é€šè¿‡åœ¨ç»„ä»¶ä¸Šè‡ªå®šä¹‰ä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚å½“ç„¶ï¼Œè¿™é‡Œæƒ³ä¼ é€’å‡ ä¸ªè‡ªå®šä¹‰å‚æ•°éƒ½å¯ä»¥ã€‚</p><p>åœ¨<code>&lt;Item /&gt;</code>ä¸­æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default class Item extends React.Component&#123;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;li&gt;&#123;this.props.item&#125;&lt;/li&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>render</code>å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œç»„ä»¶å†…éƒ¨æ˜¯ä½¿ç”¨<code>this.props</code>æ¥è·å–ä¼ é€’åˆ°è¯¥ç»„ä»¶çš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æ‰€æœ‰ä½ å¯¹è¿™ä¸ªç»„ä»¶çš„é…ç½®ï¼Œç°åœ¨åªåŒ…å«äº†ä¸€ä¸ª<code>item</code>å±æ€§ï¼Œæ‰€ä»¥é€šè¿‡<code>this.props.item</code>æ¥è·å–å³å¯ã€‚</p><h3 id="åªè¯»æ€§"><a href="#åªè¯»æ€§" class="headerlink" title="åªè¯»æ€§"></a>åªè¯»æ€§</h3><p><code>props</code>ç»å¸¸è¢«ç”¨ä½œæ¸²æŸ“ç»„ä»¶å’Œåˆå§‹åŒ–çŠ¶æ€ï¼Œå½“ä¸€ä¸ªç»„ä»¶è¢«å®ä¾‹åŒ–ä¹‹åï¼Œå®ƒçš„<code>props</code>æ˜¯åªè¯»çš„ï¼Œä¸å¯æ”¹å˜çš„ã€‚å¦‚æœ<code>props</code>åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è¢«æ”¹å˜ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºçš„å½¢æ€å˜å¾—ä¸å¯é¢„æµ‹ã€‚åªæœ‰é€šè¿‡çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ–¹å¼æ‰å¯ä»¥æŠŠæ–°çš„<code>props</code>ä¼ å…¥ç»„ä»¶ä¸­ã€‚</p><h3 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h3><p>åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æœ€å¥½ä¸º<code>props</code>ä¸­çš„å‚æ•°è®¾ç½®ä¸€ä¸ª<code>defaultProps</code>ï¼Œå¹¶ä¸”åˆ¶å®šå®ƒçš„ç±»å‹ã€‚æ¯”å¦‚ï¼Œè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Item.defaultProps = &#123;</span><br><span class="line">  item: &apos;Hello Props&apos;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Item.propTypes = &#123;</span><br><span class="line">  item: PropTypes.string,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…³äº<code>propTypes</code>ï¼Œå¯ä»¥å£°æ˜ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">optionalArray: PropTypes.array,</span><br><span class="line">optionalBool: PropTypes.bool,</span><br><span class="line">optionalFunc: PropTypes.func,</span><br><span class="line">optionalNumber: PropTypes.number,</span><br><span class="line">optionalObject: PropTypes.object,</span><br><span class="line">optionalString: PropTypes.string,</span><br><span class="line">optionalSymbol: PropTypes.symbol,</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>bool</code>å’Œ<code>func</code>æ˜¯ç®€å†™ã€‚</p><p>è¿™äº›çŸ¥è¯†åŸºç¡€æ•°æ®ç±»å‹ï¼Œè¿˜æœ‰ä¸€äº›å¤æ‚çš„ï¼Œé™„ä¸Šé“¾æ¥ï¼š</p><p><a href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">https://facebook.github.io/react/docs/typechecking-with-proptypes.html</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>props</code>æ˜¯ä¸€ä¸ªä»å¤–éƒ¨ä¼ è¿›ç»„ä»¶çš„å‚æ•°ï¼Œä¸»è¦ä½œä¸ºå°±æ˜¯ä»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œå®ƒå…·æœ‰å¯è¯»æ€§å’Œä¸å˜æ€§ï¼Œåªèƒ½é€šè¿‡å¤–éƒ¨ç»„ä»¶ä¸»åŠ¨ä¼ å…¥æ–°çš„<code>props</code>æ¥é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œå¦åˆ™å­ç»„ä»¶çš„<code>props</code>ä»¥åŠå±•ç°å½¢å¼ä¸ä¼šæ”¹å˜ã€‚</p><h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p><code>state</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>State is similar to props, but it is private and fully controlled by the component.</p></blockquote><p>ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€å¯ä»¥ç”±æ•°æ®çŠ¶æ€å’Œå¤–éƒ¨å‚æ•°æ‰€å†³å®šï¼Œå¤–éƒ¨å‚æ•°ä¹Ÿå°±æ˜¯<code>props</code>ï¼Œè€Œæ•°æ®çŠ¶æ€å°±æ˜¯<code>state</code>ã€‚</p><h3 id="ç”¨æ³•-1"><a href="#ç”¨æ³•-1" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      itemList:&apos;ä¸€äº›æ•°æ®&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render()&#123;</span><br><span class="line">    return (</span><br><span class="line">      &#123;this.state.itemList&#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ï¼Œé€šè¿‡<code>this.state</code>ç»™ç»„ä»¶è®¾å®šä¸€ä¸ªåˆå§‹çš„<code>state</code>ï¼Œåœ¨ç¬¬ä¸€æ¬¡<code>render</code>çš„æ—¶å€™å°±ä¼šç”¨è¿™ä¸ªæ•°æ®æ¥æ¸²æŸ“ç»„ä»¶ã€‚</p><h3 id="setState"><a href="#setState" class="headerlink" title="setState"></a>setState</h3><p><code>state</code>ä¸åŒäº<code>props</code>çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>state</code>æ˜¯å¯ä»¥è¢«æ”¹å˜çš„ã€‚ä¸è¿‡ï¼Œä¸å¯ä»¥ç›´æ¥é€šè¿‡<code>this.state=</code>çš„æ–¹å¼æ¥ä¿®æ”¹ï¼Œè€Œéœ€è¦é€šè¿‡<code>this.setState()</code>æ–¹æ³•æ¥ä¿®æ”¹<code>state</code>ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé€šè¿‡å¼‚æ­¥æ“ä½œæ¥è·å–æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code>didMount</code>é˜¶æ®µæ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">  fetch(&apos;url&apos;)</span><br><span class="line">    .then(response =&gt; response.json())</span><br><span class="line">    .then((data) =&gt; &#123;</span><br><span class="line">      this.setState(&#123;itemList:item&#125;);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ•°æ®è·å–å®Œæˆåï¼Œé€šè¿‡<code>this.setState</code>æ¥ä¿®æ”¹æ•°æ®çŠ¶æ€ã€‚</p><p>å½“æˆ‘ä»¬è°ƒç”¨<code>this.setState</code>æ–¹æ³•æ—¶ï¼ŒReactä¼šæ›´æ–°ç»„ä»¶çš„æ•°æ®çŠ¶æ€<code>state</code>ï¼Œå¹¶ä¸”é‡æ–°è°ƒç”¨<code>render</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¼šå¯¹ç»„ä»¶è¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚</p><p><strong>æ³¨æ„ï¼šé€šè¿‡<code>this.state=</code>æ¥åˆå§‹åŒ–<code>state</code>ï¼Œä½¿ç”¨<code>this.setState</code>æ¥ä¿®æ”¹<code>state</code>ï¼Œ<code>constructor</code>æ˜¯å”¯ä¸€èƒ½å¤Ÿåˆå§‹åŒ–çš„åœ°æ–¹ã€‚</strong></p><p><code>setState</code>æ¥å—ä¸€ä¸ªå¯¹è±¡æˆ–è€…å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªéœ€è¦ä¼ å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å³å¯ï¼Œä¸éœ€è¦ä¼ å…¥æ•´ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export default class ItemList extends React.Component&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      name:&apos;axuebin&apos;,</span><br><span class="line">      age:25,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount()&#123;</span><br><span class="line">    this.setState(&#123;age:18&#125;)  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œå®Œ<code>setState</code>ä¹‹åçš„<code>state</code>åº”è¯¥æ˜¯<code>{name:&#39;axuebin&#39;,age:18}</code>ã€‚</p><p><code>setState</code>è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨<code>setState</code>è°ƒç”¨å®Œæˆå¹¶ä¸”ç»„ä»¶å¼€å§‹é‡æ–°æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬æ¸²æŸ“æ˜¯å¦å®Œæˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.setState(&#123;</span><br><span class="line">  name:&apos;xb&apos;</span><br><span class="line">&#125;,()=&gt;console.log(&apos;setState finished&apos;))</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>state</code>çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºç»„ä»¶ä¿å­˜ã€æ§åˆ¶ä»¥åŠä¿®æ”¹è‡ªå·±çš„çŠ¶æ€ï¼Œå®ƒåªèƒ½åœ¨<code>constructor</code>ä¸­åˆå§‹åŒ–ï¼Œå®ƒç®—æ˜¯ç»„ä»¶çš„ç§æœ‰å±æ€§ï¼Œä¸å¯é€šè¿‡å¤–éƒ¨è®¿é—®å’Œä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡ç»„ä»¶å†…éƒ¨çš„<code>this.setState</code>æ¥ä¿®æ”¹ï¼Œä¿®æ”¹<code>state</code>å±æ€§ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><ol><li><code>state</code>æ˜¯ç»„ä»¶è‡ªå·±ç®¡ç†æ•°æ®ï¼Œæ§åˆ¶è‡ªå·±çš„çŠ¶æ€ï¼Œå¯å˜ï¼›</li><li><code>props</code>æ˜¯å¤–éƒ¨ä¼ å…¥çš„æ•°æ®å‚æ•°ï¼Œä¸å¯å˜ï¼›</li><li>æ²¡æœ‰<code>state</code>çš„å«åšæ— çŠ¶æ€ç»„ä»¶ï¼Œæœ‰<code>state</code>çš„å«åšæœ‰çŠ¶æ€ç»„ä»¶ï¼›</li><li>å¤šç”¨<code>props</code>ï¼Œå°‘ç”¨<code>state</code>ã€‚ä¹Ÿå°±æ˜¯å¤šå†™æ— çŠ¶æ€ç»„ä»¶ã€‚</li></ol><!-- rebuild by neat -->]]></content>
    
    <summary type="html">
    
      Reactä¸­çš„stateå’Œprops
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://andyxw.com/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://andyxw.com/tags/React/"/>
    
  </entry>
  
</feed>
